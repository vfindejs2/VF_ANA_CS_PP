<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ER Diagram — PasPort (PP) — Cyklicke svozy CS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #1a1a2e;
            padding: 24px;
        }
        h1 { font-size: 1.5rem; margin-bottom: 4px; }
        .subtitle { color: #666; font-size: 0.9rem; margin-bottom: 16px; }
        .legend {
            display: flex;
            gap: 24px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid rgba(0,0,0,0.15);
        }
        .diagram-container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        .note {
            margin-top: 16px;
            padding: 12px 16px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <h1>ER Diagram: PasPort (PP) — Zmeny pro Cyklicke svozy</h1>
    <p class="subtitle">Projekt CS-MPG | 2026-02-23 | Nove entity a jejich navaznosti na stavajici model</p>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #dbeafe;"></div>
            <span>Stavajici entita (beze zmen)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #fed7aa;"></div>
            <span>Stavajici entita (modifikovana)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #bbf7d0;"></div>
            <span>Nova entita (Etapa 1)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e9d5ff;"></div>
            <span>Nova entita (Etapa 2)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #fecaca;"></div>
            <span>Vazebni tabulka (nova)</span>
        </div>
    </div>

    <div class="diagram-container">
        <pre class="mermaid">
erDiagram
    %% ============================================
    %% STAVAJICI ENTITY (beze zmen)
    %% ============================================

    order {
        int id PK
        int order_number
        int customer_id FK
        int organization_unit_id FK
    }

    order_item {
        int id PK
        int order_id FK
        string item_number
    }

    site {
        int id PK
        string name
        int address_id FK
        float lat
        float lng
        int geocoding_state FK
        int organization_unit_id FK
    }

    container {
        int id PK
        string evidence_number
        int garbage_group_id FK
        int container_type_id FK
    }

    organization_unit {
        int id PK
        string name
    }

    waste_disposal_day {
        int id PK
        string days
    }

    waste_disposal_frequency {
        int id PK
        string name
    }

    site_container_assignment {
        int id PK
        int site_id FK
        int container_id FK
    }

    container_order_item_assignment {
        int id PK
        int container_id FK
        int order_item_id FK
    }

    wd_day_oir_assignment {
        int id PK
        int waste_disposal_day_id FK
        int order_item_revision_id FK
    }

    code_geocoding_state {
        int id PK
        string name
    }

    %% ============================================
    %% STAVAJICI ENTITY (modifikovane)
    %% ============================================

    order_item_revision {
        int id PK
        int order_item_id FK
        int zone_id FK "NOVY"
        int garbage_group_id FK "NOVY"
        int waste_disposal_day_id FK
    }

    garbage_group {
        int id PK
        string name
        string short_name
        int garbage_group_color_id FK
        int organization_unit_id FK "NOVY"
    }

    garbage_type {
        int id PK
        string code
        string description
        string category
        int garbage_group_id FK "NOVY"
    }

    container_type {
        int id PK
        string name
        int service_time_seconds "NOVY"
    }

    address {
        int id PK
        string street
        string city
        string postal_code
        float lat "NOVY"
        float lng "NOVY"
        int geocoding_state FK "NOVY"
    }

    %% ============================================
    %% NOVE ENTITY (Etapa 1)
    %% ============================================

    circuit {
        int id PK
        string external_id
        string name
        string description
        int organization_unit_id FK
        int vehicle_id FK
        bit is_active
    }

    schedule {
        int id PK
        string external_id
        string name
        int organization_unit_id FK
        date valid_from
        date valid_to
        bit is_active
    }

    schedule_calendar_day {
        int id PK
        int schedule_id FK
        date calendar_date
    }

    zone {
        int id PK
        string external_id
        string name
        string description
        int organization_unit_id FK
        bit is_active
    }

    %% ============================================
    %% NOVE VAZEBNI TABULKY (Etapa 1)
    %% ============================================

    oir_circuit_assignment {
        int id PK
        int order_item_revision_id FK
        int circuit_id FK
        date valid_from
        date valid_to
    }

    oir_schedule_assignment {
        int id PK
        int order_item_revision_id FK
        int schedule_id FK
        date valid_from
        date valid_to
    }

    %% ============================================
    %% NOVA ENTITA (Etapa 2)
    %% ============================================

    gg_ct_parameters {
        int id PK
        int garbage_group_id FK
        int container_type_id FK
        float weight_density_per_liter
        float volume_fill_percentage
        int organization_unit_id FK
    }

    %% ============================================
    %% VZTAHY — stavajici
    %% ============================================

    order ||--o{ order_item : "obsahuje"
    order_item ||--o{ order_item_revision : "ma revize"
    site ||--o{ site_container_assignment : "umisteni"
    container ||--o{ site_container_assignment : "prirazena"
    container ||--o{ container_order_item_assignment : "prirazena"
    order_item ||--o{ container_order_item_assignment : "obsahuje"
    order_item_revision ||--o{ wd_day_oir_assignment : "dny svozu"
    waste_disposal_day ||--o{ wd_day_oir_assignment : "prirazeni"
    container }o--|| container_type : "typ"
    container }o--o| garbage_group : "skupina odpadu"
    site }o--|| address : "adresa"
    site }o--|| organization_unit : "provozovna"
    order }o--|| organization_unit : "provozovna"

    %% ============================================
    %% VZTAHY — nove (Etapa 1)
    %% ============================================

    order_item_revision }o--o| zone : "A3: zona 1:1"
    order_item_revision }o--o| garbage_group : "A4: skupina odpadu"
    order_item_revision ||--o{ oir_circuit_assignment : "A1: okruhy M:N"
    circuit ||--o{ oir_circuit_assignment : "A1: prirazeni"
    order_item_revision ||--o{ oir_schedule_assignment : "A2: rozvrhy M:N"
    schedule ||--o{ oir_schedule_assignment : "A2: prirazeni"
    schedule ||--o{ schedule_calendar_day : "A2: kalendar"

    circuit }o--|| organization_unit : "provozovna"
    schedule }o--|| organization_unit : "provozovna"
    zone }o--|| organization_unit : "provozovna"

    garbage_type }o--o| garbage_group : "A4: druh->skupina"
    garbage_group }o--o| organization_unit : "A4: per provozovna"

    address }o--o| code_geocoding_state : "A6: stav geokodovani"

    %% ============================================
    %% VZTAHY — nove (Etapa 2)
    %% ============================================

    gg_ct_parameters }o--|| garbage_group : "A11: parametry"
    gg_ct_parameters }o--|| container_type : "A11: typ nadoby"
    gg_ct_parameters }o--o| organization_unit : "A11: provozovna"
        </pre>
    </div>

    <div class="note">
        <strong>Poznamka:</strong> Diagram zobrazuje pouze entity relevantni pro projekt Cyklicke svozy.
        Kompletni datovy model PP obsahuje dalsi entity (uzivatele, fotografie, historie, ciselnikove tabulky atd.),
        ktere nejsou projektem CS dotceny. Zkratky: RPO = Revize polozky objednavky, OIR = order_item_revision,
        GG = garbage_group, CT = container_type.
    </div>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                fontSize: '14px',
                entityPadding: 8
            },
            er: {
                layoutDirection: 'TB',
                entityPadding: 12,
                useMaxWidth: false,
                minEntityWidth: 180
            }
        });
    </script>
</body>
</html>
