<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Monitoring</title>
</head>
<body>
<div class="wiki-content">
<div class="ak-renderer-extension  "><div class="ak-renderer-extension-overflow-container"><div class="css-1y8lsgj e1ihjts80"><div class="toc-macro client-side-toc-macro  conf-macro output-block hidden-outline"><ul><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Konceptu%C3%A1lna-architekt%C3%BAra">Konceptuálna architektúra</a></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#HW-infra%C5%A1trukt%C3%BAra">HW infraštruktúra</a></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#In%C5%A1tal%C3%A1cia-a-Konfigur%C3%A1cia">Inštalácia a Konfigurácia</a><ul><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#In%C5%A1tal%C3%A1cia">Inštalácia</a></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Prometheus">Prometheus</a><ul><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Prometheus.yml">Prometheus.yml</a></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Rules.yml">Rules.yml</a></li></ul></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Alert-Manager">Alert Manager</a><ul><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Alertmanager.yml">Alertmanager.yml</a></li></ul></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Grafana">Grafana</a><ul><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Grafana-dashboard-template---pre-NodeJS-aplikaciu">Grafana dashboard template - pre NodeJS aplikaciu</a></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#Pridanie-nov%C3%A9ho-dashboardu">Pridanie nového dashboardu</a></li><li><a href="https://ai-maps.atlassian.net/wiki/spaces/OF/pages/5099814947/Monitoring+radium#%C5%A0trukt%C3%BAra-dashboardov">Štruktúra dashboardov</a></li></ul></li></ul></li></ul></div></div></div></div><h1>Konceptuálna architektúra </h1><p>Konceptuálna architektúra logovania ktorá je použitá pri vývoji systému ale aj v produkčnom prostredí.</p><div class="ak-renderer-extension  "><div class="ak-renderer-extension-overflow-container"><div class="css-1y8lsgj e1ihjts80"><div class="ap-container conf-macro output-block"><div class="ap-content "><div class="ap-iframe-container iframe-init"><img src="monitoring-106136329_images/monitoring sangis architecture.drawio.png" data-attachment="true"></div></div></div></div></div></div><h1>HW infraštruktúra </h1><div class="pm-table-container  sc-kpOJdX kAzjOl"><p> </p><table><tbody><tr><th colspan="1" rowspan="1"><div class="ak-renderer-tableHeader-sortable-column__button"><p><strong>Komponent</strong></p></div></th><th colspan="1" rowspan="1"><div class="ak-renderer-tableHeader-sortable-column__button"><p><strong>Version</strong></p></div></th><th colspan="1" rowspan="1"><div class="ak-renderer-tableHeader-sortable-column__button"><p><strong>IP</strong></p></div></th><th colspan="1" rowspan="1"><div class="ak-renderer-tableHeader-sortable-column__button"><p><strong>Port</strong></p></div></th><th colspan="1" rowspan="1"><div class="ak-renderer-tableHeader-sortable-column__button"><p><strong>Umiestnenie súborov</strong></p></div></th><th colspan="1" rowspan="1"><div class="ak-renderer-tableHeader-sortable-column__button"><p><strong>Volume</strong></p></div></th></tr><tr><td colspan="1" rowspan="1"><p>Prometheus</p></td><td colspan="1" rowspan="1"><p><code>v2.33.4</code></p></td><td colspan="1" rowspan="1"><p>192.168.77.38</p></td><td colspan="1" rowspan="1"><p>9090</p></td><td colspan="1" rowspan="1"><p>/flww/monitoring</p></td><td colspan="1" rowspan="1"><div class="code-block sc-cmTdod lgZzvS"></div></td></tr><tr><td colspan="1" rowspan="1"><p>Alertmanager</p></td><td colspan="1" rowspan="1"><p><code>v0.23.0</code></p></td><td colspan="1" rowspan="1"><p>192.168.77.38</p></td><td colspan="1" rowspan="1"><p>9093</p></td><td colspan="1" rowspan="1"><p>/flww/monitoring</p></td><td colspan="1" rowspan="1"><div class="code-block sc-cmTdod lgZzvS"></div></td></tr><tr><td colspan="1" rowspan="1"><p>Grafana</p></td><td colspan="1" rowspan="1"><p><code>7.3.1</code></p></td><td colspan="1" rowspan="1"><p>192.168.77.38</p></td><td colspan="1" rowspan="1"><p>3008</p></td><td colspan="1" rowspan="1"><p>/flww/monitoring</p></td><td colspan="1" rowspan="1"><div class="code-block sc-cmTdod lgZzvS">  </div></td></tr></tbody></table><p> </p></div><h1>Inštalácia a Konfigurácia </h1><p>Prometheus, alertmanager a grafana sú inštalované spoločne cez docker-compose v ktorom sú jednotlivé services definované</p><p>Potrebné súbory v nasledovnej súborovej štruktúre</p><ul><li><p>docker-compose.yml</p></li><li><p>alertmanager_conf</p><ul><li><p>alertmanager.yml</p></li></ul></li><li><p>prometheus_conf</p><ul><li><p>prometheus.yml</p></li></ul></li><li><p>rules</p><ul><li><p>rules.yml</p></li></ul></li></ul><h2><strong>Inštalácia </strong> </h2><p><strong>pomocou</strong> <code>docker-compose up -d</code></p><p>Docker compose</p>true<p> </p><div class="sc-dUjcNx fsaVOa"><div class="sc-eilVRo fWEqRM"><div class="expand-content-wrapper"><div class="sc-bdVaJa jGgciL"><p>Prometheus </p></div></div></div></div><p>Komponent používa dva konfigruačné súbory.</p><ul><li><p>prometheus.yml</p></li><li><p>rules.yml</p></li></ul><p>Po zmenách týchto súborov je potrebné reštartovať komponent Prometheus aby sa zmeny prejavili.</p><p>Command pre reštart: <code>docker restart prometheus</code></p><h3>Prometheus.yml </h3><p>definuje</p><ul><li><p>endpointy ktoré má Prometheus scrapovať</p></li><li><p>cestu k rules.yml ktorý bude Prometheus používať</p></li><li><p>Pripojenie k Alertmanager - kam posielať alerty</p></li><li><p>systémové nastavenia</p></li></ul><div class="sc-dUjcNx fsaVOa"><div class="sc-eilVRo fWEqRM"><div class="expand-content-wrapper"><div class="sc-bdVaJa jGgciL"><div class="sc-VigVT ctywm"><p> </p>true<p> </p></div><div class="code-block sc-cmTdod lgZzvS">Rules.yml </div></div></div></div></div><p>Definícia alertov ktoré má Prometheus sledovať</p>true<p> </p><div class="sc-dUjcNx fsaVOa"><div class="sc-eilVRo fWEqRM"><div class="expand-content-wrapper"><div class="sc-bdVaJa jGgciL"><div class="code-block sc-cmTdod lgZzvS">  </div></div></div></div></div><h2>Alert Manager </h2><p>Komponent používa konfiguračný súbor alertmanager.yml</p><p>Po zmene tohoto súboru je potrebné reštartovať komponent Alertmanager aby sa zmeny prejavili.</p><p>Command pre reštart: <code>docker restart alertmanager</code></p><h3>Alertmanager.yml </h3><p>Definuje akcie ktoré sa majú vykonať pri obdržaní alertu z Prometheus komponentu - filtrovanie a odosielanie alertov</p>true<p>  </p><h2>Grafana </h2><p>Grafana Dashboardy sú definované ako json súbory, nahrávajú sa cez GUI Grafana.</p><p>Grafana dashboardy vo formate json</p><div class="MediaGroup"><div class="sc-esjQYD ikJPMC"><div class="new-file-experience-wrapper sc-gJWqzi ctiabG"><div><div class="media-file-card-view sc-rBLzX kuVLkH"><div class="sc-bHwgHz cBingy"><div class="css-1mgeve7 edaccvb0"> </div></div></div></div></div></div></div><h3>Grafana dashboard template - pre NodeJS aplikaciu </h3><p>Json súbory ako definícia dashboardu sú rovnaké pre všetky monitorované komponenty (všetky komponenty sú NodeJS aplikácie)</p><p>jediné rozdiely sú v Json objekte <code>templating</code> kde sa zadáva názov Jobu ktorého metriky majú byť zobrazované. Názov Jobu sa definuje v konfigurácii Prometheus.</p>true<p> </p><p> </p><h3>Pridanie nového dashboardu </h3><p>Import nového dashboardu definovaného pomocou json súboru</p><ol><li><p>V ľavom panely kliknite na dashboards → Manage</p></li><li><p>Následne kliknite na tlačidlo Import</p></li><li><div class="rich-media-item mediaSingleView-content-wrap image-center sc-epnACN jKBFzx sc-iyvyFf iQLRxN"><div class="sc-gzOgki kvtqtL"><div class="sc-esjQYD ikJPMC"><div class="new-file-experience-wrapper sc-gJWqzi bEYHHR"><div class="media-file-card-view sc-rBLzX kuVLkH"><div class="sc-bHwgHz lkBxUG"> </div></div></div><div class="media-card-viewport-anchor"><img src="monitoring-106136329_images/image-20220225-150510.png" data-attachment="true"></div></div></div></div></li><li><p>Následne upload json file</p></li><li><p>Zadajte meno novému dashboardu a prípadne umiestnenie do foldra</p></li></ol><p> </p><h3>Štruktúra dashboardov </h3><p>Jednotlivé dashboardy sú rozdelené do priečinkov podla jednotlivých nasadení, V priečinku sú nasledne dashboardy pre jednotlivé komponenty nasadenia a dashboard pre overview komponentov.</p><div class="rich-media-item mediaSingleView-content-wrap image-align-start sc-epnACN jKBFzx sc-iyvyFf eRccPW"><div class="sc-gzOgki eXDHxD"><div class="sc-esjQYD ikJPMC"><div class="media-card-viewport-anchor"><img src="monitoring-106136329_images/image-20220228-091344.png" data-attachment="true"></div><div class="new-file-experience-wrapper sc-gJWqzi jHNsxH"><div class="media-file-card-view sc-rBLzX kuVLkH"><div class="sc-bHwgHz lkBxUG"> </div></div></div></div></div></div><p>Overview dashboard poskytuje základné informácie o stave jednotlivých komponentov. Obsahuje taktiež prelink na detailný dashboard vybraného komponentu (po kliknutí na názov jobu)</p><div class="rich-media-item mediaSingleView-content-wrap image-align-start sc-epnACN jKBFzx sc-iyvyFf eRccPW"><div class="sc-gzOgki lnqMwE"><div class="sc-esjQYD ikJPMC"><div class="new-file-experience-wrapper sc-gJWqzi iDIsum"><div class="media-file-card-view sc-rBLzX kuVLkH"><div class="sc-bHwgHz lkBxUG"> <img src="monitoring-106136329_images/image-20220228-091744.png" data-attachment="true"></div></div></div></div></div></div>
</div>
</body>
</html>
