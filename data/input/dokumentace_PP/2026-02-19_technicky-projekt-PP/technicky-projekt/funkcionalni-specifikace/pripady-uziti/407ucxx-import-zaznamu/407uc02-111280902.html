<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>407UC02: Importovat události výsypů nádob z mobilní čtečky</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je import na vstupu získaného souboru s událostmi výsypu nádob z mobilní čtečky do aplikace.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Uživatel</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Uživatel zadá požadavek na import událostí výsypů nádob z mobilní čtečky, a to jedním z uvedených způsobů:</p><ul><li>Uživatel zadá požadavek na import událostí výsypů nádob z mobilní čtečky v přehledu nádob (viz <a href="../400ucxx-sprava-nadob/400uc06-88036373.html">400UC06: Zobrazit přehled nádob</a>).</li></ul><h2>Vstupní podmínky</h2><p>Ke spuštění případu užití jsou nutná následující oprávnění na typ entit (viz <a href="../../../uzivatelska-88033399.html">Uživatelská oprávnění a role</a>):</p><ul><li>Nádoby - modifikace.</li></ul><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Provozovna</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Provozovna</a></td><td colspan="1">Ano</td><td colspan="1">Provozovna, v rámci které byly provedeny výsypy nádob.</td><td colspan="1">–</td></tr><tr><td colspan="1">Objekt</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Objekt</a></td><td colspan="1">Ne</td><td colspan="1">Vozidlo, pomocí kterého byly provedeny výsypy nádob.</td><td colspan="1">–</td></tr><tr><td colspan="1">Importní soubor</td><td colspan="1">Soubor (CSV)</td><td colspan="1">Ano</td><td colspan="1">Importní soubor s výsypy nádob.</td><td colspan="1">–</td></tr><tr><td colspan="1">Zdroj změny</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Zdroj změny</a></td><td colspan="1">Ano</td><td colspan="1">Zařízení, ve kterém byl proveden import událostí výsypů nádob z mobilní čtečky.</td><td colspan="1">–</td></tr></tbody></table><h1>Základní tok událostí</h1><ol><li>Systém zahájí import na vstupu získaného souboru (vstupní parametr Importní soubor).<br><ol><li>Systém přeskočí první řádek souboru (jedná se o řádek s hlavičkou).</li><li>Pokud není obsažen žádný další řádek:<br><ol><li><strong>Přechod na krok 2</strong>.</li></ol></li><li>Systém načte aktuální řádek:<br><ol><li>Pokud je v rámci aktuálně načteného řádku obsažen text (je obsažen jiný než „neviditelný“ znak):<br><ol><li>Systém vyhodnotí obsah aktuálně načteného řádku (viz <a href="407uc02-111280902.html">ALG01: Načíst událost výsypu nádoby</a>; pokud algoritmus neproběhne v pořádku, je vyvolán <a href="407uc02-111280902.html">EF02: Import souboru skončil chybou</a>).</li><li>Systém vyhodnotí, zda pro aktuálně načtený řádek již existuje duplicitní <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a> (viz <a href="407uc02-111280902.html">AF01: Nalezena duplicitní událost výsypu</a>).<br><ol><li>Pokud se jedná o duplicitní záznam, pokračujeme na další řádek (právě zkoumaný řádek je přeskočen, <strong>přechod na krok 1.b</strong>).<br><ul><li><em>Poznámka: V rámci volaného alternativního toku může dojít také k ukončení celého UC.</em></li></ul></li></ol></li><li>Systém založí dle získaných informací <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a> – spustí <a href="#" data-page-title="301UC07: Založit událost výsypu nádoby"></a>, na vstup jsou předány následující informace:<br><ul><li>Zakládaná událost výsypu nádoby: <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a> získaná v rámci <a href="407uc02-111280902.html">ALG01: Načíst událost výsypu nádoby</a>.</li><li>Zdroj změny: <a href="../../../datove-modely/datovy-88033012.html">Zdroj změny</a> získaný na vstupu (vstupní parametr Zdroj změny).</li></ul></li></ol></li><li>Jinak je aktuálně načtený řádek prázdný – systém tento řádek přeskočí.</li></ol></li><li>Systém pokračuje na další řádek (<strong>přechod na krok 1.b</strong>).</li></ol></li><li>Systém potvrdí založení odpovídajících <a href="../../../datove-modely/datovy-88033012.html">Události výsypů nádob</a> (případně jejich část). </li></ol><h1>Alternativní toky událostí</h1><h2>AF01: Nalezena duplicitní událost výsypu</h2><p>Alternativní tok události řeší situace, kdy importní soubor obsahuje alespoň jednu <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>, která již v systému existuje (dle sledovaných kritérií).</p><ul><li>Je možné buď pokračovat v importu, kdy dojde k nahrání pouze takových záznamů, které se v systému zatím nevyskytují.</li><li>Nebo můžeme import přerušit , kdy není nahrán žádný ze záznamů dostupných v importním souboru.</li></ul><h3>Vstupní podmínky</h3><p>Pro právě zkoumaný záznam importního souboru existuje alespoň jedna taková <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>, která splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Provozovna</strong> odpovídá <a href="../../../datove-modely/datovy-88033012.html">Provozovně</a> získané na vstupu UC (vstupní parametr <strong>Provozovna</strong>).</li><li>Hodnota atributu <strong>Čas</strong> je rovna položce <strong>FirstSeen</strong> u právě zkoumaného řádku importního souboru (viz<a href="407uc02-111280902.html">ALG01: Načíst událost výsypu nádoby</a>).</li><li>Hodnota atributu <strong>Kód identifikátoru</strong> je rovna položce <strong>ASCII</strong> / <strong>Identifier</strong> u právě zkoumaného řádku importního souboru (viz <a href="407uc02-111280902.html">ALG01: Načíst událost výsypu nádoby</a>).</li><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> je rovna hodnotě atributu <strong>Externí identifikátor</strong> u <a href="../../../datove-modely/datovy-88033012.html">Objektu</a> získaného na vstupu UC (vstupní parametr <strong>Objekt</strong>).<br><ul><li>Pokud není na vstupu získán <a href="../../../datove-modely/datovy-88033012.html">Objekt</a>, nesmí být k dispozici ani hodnota atributu <strong>Externí identifikátor objektu</strong> dané <a href="../../../datove-modely/datovy-88033012.html">Události výsypu nádoby</a>.</li></ul></li><li>Hodnota atributu <strong>Zdrojové zařízení</strong> je nastavena na hodnotu <strong>Mobilní čtečka</strong> (viz <a href="../../../datove-modely/datovy-88033012.html">Zdrojové zařízení události výsypu nádoby</a>).</li></ul><h3>Tok události</h3><ol><li>Alternativní tok událostí začíná krokem <strong>1.c.i.2</strong> základního toku událostí.</li><li>Systém předá nadřazenému UC systémové hlášení <strong>MSG_CONF_IMPORT_EMPTY_CONTAINER_EVENT_EXISTS</strong> (viz <a href="#" data-page-title="Systémová hlášení">Systémová hlášení</a>).<br><ol><li>Pokud je získána odpověď <strong>Ano</strong>, systém pokračuje ve zpracování importního souboru (návrat ke kroku <strong>1.c.i.2</strong> základního toku událostí).</li><li>Jinak je získán odpověď <strong>Ne</strong>…<br><ol><li>Systém zruší import již zpracovaných <a href="../../../datove-modely/datovy-88033012.html">Událostí výsypu nádoby</a> (pro již zpracované řádky importního souboru).</li><li>Systém předčasně ukončí běh tohoto UC (návrat k nadřazenému případu užití).</li></ol></li></ol></li></ol><p>Poznámka: Systémové hlášení je nadřazenému UC předáno maximálně jednou. Odpověď na něj je společná pro celý importní soubor. </p><p><em>Interní poznámka: Uvedený návrh řešení se může lišit od samotné implementace (optimalizace technického řešení).</em></p><h3>Výstupní podmínky</h3><p>Další zpracování záznamů odpovídá získané reakci na odpovídající systémové hlášení…</p><ul><li>buď pokračujeme v importu získaného souboru (duplicitní záznamy přeskakujeme),</li><li>nebo je import přerušen (není importován žádný ze záznamů importního souboru).</li></ul><h1>Výjimkové toky událostí</h1><h2>EF01: Odkazovaná hodnota není k dispozici</h2><h3>Vstupní podmínky</h3><ul><li>Na vstupu získaná reference se odkazuje na neexistující instanci odpovídající entity.  </li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení (MSG_ERR_REFERENCE_NOT_FOUND, viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>).</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Soubor nebyl importován.</li></ul><h2>EF02: Import souboru skončil chybou</h2><h3>Vstupní podmínky</h3><ul><li>Import výsledného souboru skončil chybou (obsažené řádky neodpovídají dané struktuře, uvedená hodnota nevyhovuje odpovídajícímu atributu entity <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení (MSG_ERR_IMPORT_ENDED_WITH_ERROR, viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>).</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Soubor nebyl importován.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Byl proveden import všech instancí entity <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>, které byly získány v rámci importního souboru.</p><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Načíst událost výsypu nádoby</h2><p>Jednotlivé řádky obsažené v importním souboru představují záznamy o načtení identifikátoru nádoby mobilní čtečkou. Každý takový záznam pak vyhodnocujeme jako <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>. Abychom tak mohli učinit, musíme se seznámit se strukturou importního souboru:</p><ul><li>Typ souboru: <strong>CSV</strong>.</li><li>Obsahuje hlavičku: <strong>Ano</strong>.</li><li>Oddělovač řádků: <strong>„Enter“</strong>.</li><li>Oddělovač záznamů: <strong>Čárka</strong>.</li><li>Desetinná značka: <strong>Tečka</strong>.</li><li>Vkládání hodnot: Některé textové hodnoty jsou vloženy do uvozovek.</li><li>Poznámka: Mezi jednotlivé záznamy je vkládán prázdný řádek.</li></ul><p>Poznámka: Znaky tabulátoru mezi jednotlivými záznamy jsou vloženy z důvody lepší čitelnosti, v samotném souboru se nevyskytují. Přiložena je pak i ukázka samotného souboru: .</p><p><img src="407uc02-importovat-udalosti-vysypu-nadob-z-mobilni-ctecky-111280902_images/image2022-9-22 13-7-45.png" data-attachment="true"></p><p>Pokud dílčí řádky rozdělíme na jednotlivé položky (dle oddělovače záznamů), získáme následující informace:</p><ul><li><strong>Type</strong> – způsob, jakým bylo načtení identifikátoru nádoby provedeno (T: RFID čip, B: čárový kód).</li><li><strong>Identifier</strong> – načtený identifikátor nádoby.</li><li><em><strong>Signal</strong> – informace není vyhodnocována.</em></li><li><em><strong>SeenCount</strong> – informace není vyhodnocována.</em></li><li><strong>FirstSeen</strong> – datum a čas načtení identifikátoru.</li><li><em><strong>LastSeen</strong> – informace není vyhodnocována.</em></li><li><strong>ASCII</strong> – načtený identifikátor nádoby v ASCII.</li><li><em><strong>RSSI</strong> – informace není vyhodnocována (pro Type:B není hodnota obsažena vůbec, chybí také oddělovač záznamu).</em></li></ul><p>Když známe dílčí položky řádku importního souboru, můžeme provést mapování na <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>, řešeny jsou pouze nesystémové atributy (viz tabulka).</p><p>Poznámka: Protože se struktura řádku mírně liší dle položky <strong>Type</strong> v importním souboru, musíme mapování specifikovat pro každou z možných hodnot (pokud se hodnota liší od těch dále zmíněných, je vyvolán <a href="407uc02-111280902.html">EF02: Import souboru skončil chybou</a>).</p><table><tbody><tr><th>Atribut řešené entity</th><th>Položka řádku (Type:T)</th><th>Položka řádku (Type:B)</th><th>Poznámka</th></tr><tr><td>Externí identifikátor</td><td>–</td><td>–</td><td>Je předáno NULL.</td></tr><tr><td>Provozovna</td><td>–</td><td>–</td><td>Je předána <a href="../../../datove-modely/datovy-88033012.html">Provozovna</a> získaná na vstupu (vstupní parametr Provozovna).</td></tr><tr><td colspan="1">Čas</td><td colspan="1">FirstSeen</td><td colspan="1">FirstSeen</td><td colspan="1"><p>Hodnota je uvedena v následujícím formátu: <strong>dd/MM/yyyy HH:mm:ss</strong>.</p><p>Příklad hodnoty je následující: <strong>22/09/2022 07:09:04</strong>.</p><p>Hodnota není uvedena v UTC, je tedy nutné provést převod dle aktuálního časového posunu (dle Slovenské republiky). Převod by pak měl být vyhodnocen také dle hodnoty v rámci položky <strong>FirstSeen</strong>.</p></td></tr><tr><td colspan="1">Souřadnice</td><td colspan="1">–</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Lokalita</td><td colspan="1">–</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Ulice lokality</td><td colspan="1">–</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Město lokality</td><td colspan="1">–</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Stát lokality</td><td colspan="1">–</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Kód identifikátoru</td><td colspan="1">ASCII</td><td colspan="1">Identifier</td><td colspan="1">V obou případech je hodnota uvedena v uvozovkách, ty jsou však odebrány.</td></tr><tr><td>Externí identifikátor objektu</td><td>–</td><td>–</td><td><p>Je předána hodnota atributu Externí identifikátor <a href="../../../datove-modely/datovy-88033012.html">Objektu</a> získaného na vstupu (vstupní parametr Objekt).</p><p>Pokud není hodnota na vstupu získána, je předáno NULL.</p></td></tr><tr><td>Činnost ramene</td><td>–</td><td>–</td><td>Je předáno NULL.</td></tr><tr><td>Hmotnost obsahu</td><td>–</td><td>–</td><td>Je předáno NULL.</td></tr><tr><td>Zdrojové zařízení</td><td>–</td><td>–</td><td>Je předána hodnota <strong>Mobilní čtečka</strong> (viz <a href="../../../datove-modely/datovy-88033012.html">Zdrojové zařízení události výsypu nádoby</a>).</td></tr></tbody></table><h1>Validace</h1><h2>VAL01: Kontrola vstupních dat</h2><p>Je provedena kontrola vstupních dat, která zahrnuje následující akce:</p><ul><li>kontrola existence odkazovaných instancí (viz <a href="407uc02-111280902.html">EF01: Odkazovaná hodnota není k dispozici</a>).</li></ul><p>Poznámka: Importní soubor není součásti této validace, ta probíhá během jeho čtení (viz <a href="407uc02-111280902.html">EF02: Import souboru skončil chybou</a>).</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h2>29. 6. 2024: Tomáš Nadrchal</h2><p>RADIUMPOP-2351</p><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny</div></div></th></tr><tr><td colspan="1"><a href="407uc02-111280902.html">Základní tok událostí</a></td><td colspan="1">Doplněno chování pro vyhodnocení duplicitních záznamů (naznačeno modře).</td></tr><tr><td colspan="1"><a href="407uc02-111280902.html">AF01: Nalezena duplicitní událost výsypu</a></td><td colspan="1">Doplněn AF pro vyhodnocení duplicitních záznamů (naznačeno modře).</td></tr></tbody></table><h2>19. 12. 2022: Tomáš Nadrchal</h2><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny</div></div></th></tr><tr><td colspan="1"><a href="407uc02-111280902.html">ALG01: Načíst událost výsypu nádoby</a></td><td colspan="1">Rozšířen popis o nové atributy (naznačeno modře), viz změnové požadavky <strong>č. 127 </strong>(viz <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=89066925">Rozvojové požadavky</a>).</td></tr></tbody></table>
</div>
</body>
</html>
