<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>407UC06: Importovat události výsypů nádob z mobilní čtečky v JSON</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je import na vstupu získaných událostí výsypu nádob z mobilní čtečky do aplikace. Jedná se pak o popis této API metody <strong>POST: importMobileReaderJson</strong>.</p><ul><li>Popis odpovídající integrace je pak dostupný ve formě samostatného dokumentu: .</li><li>Pro úplnost je uvedena také původní verze, kde není k dispozici zde řešená API metoda: .</li></ul><p>Poznámka: Dle informací od Gaben by měly být výsypy posílány hned po jejich načtení (tedy jednotlivě). V případě výpadku pak ale může dojít také k jejich hromadnému odeslání.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Externí systém</td><td colspan="1">Původně vytvořeno pro aplikaci dodavatele Gaben, navrženo ale pro obecné využití.</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Externí systém zadá požadavek na import událostí výsypů nádob z mobilní čtečky v JSON (voláním odpovídající API metody).</p><h2>Vstupní podmínky</h2><p>Ke spuštění případu užití jsou nutná následující oprávnění na typ entit (viz <a href="../../../uzivatelska-88033399.html">Uživatelská oprávnění a role</a>):</p><ul><li>Nádoby - modifikace.</li></ul><h2>Vstupní data</h2><p>Data jsou předána v těle této API metody jako JSON. Tabulka s jejich popisem je uvedena spíše pro úplnost. Do této podoby je nutné data nejprve načíst.</p><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Provozovna</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Provozovna</a></td><td colspan="1">Ano</td><td colspan="1">Provozovna, v rámci které byly provedeny výsypy nádob.</td><td colspan="1">–</td></tr><tr><td colspan="1">Objekt</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Objekt</a></td><td colspan="1">Ne</td><td colspan="1">Vozidlo, pomocí kterého byly provedeny výsypy nádob.</td><td colspan="1">–</td></tr><tr><td colspan="1">Výsypy</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a></td><td colspan="1">Ano</td><td colspan="1">Seznam výsypů, které mají být nahrány.</td><td colspan="1">–</td></tr></tbody></table><h1>Základní tok událostí</h1><ol><li>Systém zpracuje na vstupu získaná data – ta jsou předána v těle volání této API metody (viz <a href="407uc06-122202239.html">ALG01: Načíst událost výsypu nádoby</a>).</li><li>Systém zpracuje dílčí výsypy získané v rámci <a href="407uc06-122202239.html">ALG01: Načíst událost výsypu nádoby</a>.<br><ol><li>Pokud se jedná o duplicitní záznam, pokračujeme na další záznam (právě zkoumaný řádek je přeskočen, <strong>přechod na krok 2</strong>).<br><ul><li><em>Poznámka: V rámci volaného alternativního toku může dojít také k ukončení celého UC.</em><br></li></ul></li><li>Systém založí dle získaných informací <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a> – spustí <a href="#" data-page-title="301UC07: Založit událost výsypu nádoby"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná událost výsypu nádoby</strong>: <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a> získaná v rámci <a href="407uc06-122202239.html">ALG01: Načíst událost výsypu nádoby</a>.</li><li><strong>Zdroj změny</strong>: je nastavena hodnota <strong>Synchronizace</strong> (viz <a href="../../../datove-modely/datovy-88033012.html">Zdroj změny</a>).</li></ul></li><li>Systém pokračuje zpracováním dalšího záznamu – pokud je k dispozici (<strong>přechod na krok 2</strong>).</li></ol></li><li>Systém potvrdí založení odpovídajících <a href="../../../datove-modely/datovy-88033012.html">Události výsypů nádob</a> (případně jejich část).</li></ol><p>Pro úplnost je uvedena také struktura, v jaké jsou předány informace.</p><h1>Alternativní toky událostí</h1><h2>AF01: Nalezena duplicitní událost výsypu</h2><p>Alternativní tok události řeší situace, kdy je dodána taková <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>, která již v systému existuje (dle sledovaných kritérií).</p><ul><li>Je možné buď pokračovat v importu výsypu, kdy dojde k nahrání pouze takových záznamů, které se v systému zatím nevyskytují.</li><li>Nebo můžeme import přerušit , kdy není nahrán žádný ze záznamů dostupných v importním souboru.</li></ul><p>Poznámka: V dokumentaci pro externí systémy není možnost nahrát pouze část výsypů typicky zmíněna.</p><ul><li>Uvedená logika vychází z <a href="#" data-page-title="407UC02: Importovat události výsypů nádob z mobilní čtečky"></a> (jedná se o obdobný UC). </li><li>Možnost nahrát pouze část výsypů je tedy primárně určena pro interní použití pouze v aplikaci Pasport.</li></ul><h3>Vstupní podmínky</h3><p>Pro právě zkoumaný záznam s výsypem existuje alespoň jedna taková <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>, která splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Provozovna</strong> odpovídá <a href="../../../datove-modely/datovy-88033012.html">Provozovně</a> získané na vstupu UC (vstupní parametr <strong>Provozovna</strong>).</li><li>Hodnota atributu <strong>Čas</strong> je rovna položce <strong>timestamp</strong> u právě zkoumaného záznamu s výsypem (viz <a href="407uc06-122202239.html">ALG01: Načíst událost výsypu nádoby</a>).</li><li>Hodnota atributu <strong>Kód identifikátoru</strong> je rovna položce <strong>code</strong> u právě zkoumaného záznamu s výsypem (viz <a href="407uc06-122202239.html">ALG01: Načíst událost výsypu nádoby</a>).</li><li>Hodnota atributu <strong>Zeměpisná šířka</strong> je rovna položce <strong>lat</strong> u právě zkoumaného záznamu s výsypem (viz <a href="407uc06-122202239.html">ALG01: Načíst událost výsypu nádoby</a>).</li><li>Hodnota atributu <strong>Zeměpisná délka</strong> je rovna položce <strong>lng</strong> u právě zkoumaného záznamu s výsypem (viz <a href="407uc06-122202239.html">ALG01: Načíst událost výsypu nádoby</a>).</li><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> je rovna hodnotě atributu <strong>Externí identifikátor</strong> u <a href="../../../datove-modely/datovy-88033012.html">Objektu</a> získaného na vstupu UC (vstupní parametr <strong>Objekt</strong>).<br><ul><li>Pokud není na vstupu získán <a href="../../../datove-modely/datovy-88033012.html">Objekt</a>, nesmí být k dispozici ani hodnota atributu <strong>Externí identifikátor objektu</strong> dané <a href="../../../datove-modely/datovy-88033012.html">Události výsypu nádoby</a>.</li></ul></li><li>Hodnota atributu <strong>Zdrojové zařízení</strong> je nastavena na hodnotu <strong>Mobilní čtečka</strong> (viz <a href="../../../datove-modely/datovy-88033012.html">Zdrojové zařízení události výsypu nádoby</a>).</li></ul><h3>Tok události</h3><ol><li>Alternativní tok událostí začíná krokem <strong>2.a</strong> základního toku událostí.</li><li>Systém předá nadřazenému UC systémové hlášení <strong>MSG_CONF_IMPORT_EMPTY_CONTAINER_EVENT_EXISTS</strong> (viz <a href="#" data-page-title="Systémová hlášení">Systémová hlášení</a>).<br><ol><li>Pokud je získána odpověď <strong>Ano</strong>, systém pokračuje ve zpracování importního souboru (návrat ke kroku <strong>2.a</strong> základního toku událostí).</li><li>Jinak je získán odpověď <strong>Ne</strong>…<br><ol><li>Systém zruší import již zpracovaných <a href="../../../datove-modely/datovy-88033012.html">Událostí výsypu nádoby</a> (pro již zpracované výsypy).</li><li>Systém předčasně ukončí běh tohoto UC (návrat k nadřazenému případu užití).</li></ol></li></ol></li></ol><p>Poznámka: Systémové hlášení je nadřazenému UC předáno maximálně jednou. Odpověď na něj je společná pro celý importní soubor. </p><p><em>Interní poznámka: Uvedený návrh řešení se může lišit od samotné implementace (optimalizace technického řešení).</em></p><h3>Výstupní podmínky</h3><p>Další zpracování záznamů odpovídá získané reakci na odpovídající systémové hlášení…</p><ul><li>buď pokračujeme v importu získaného souboru (duplicitní záznamy přeskakujeme),</li><li>nebo je import přerušen (není importován žádný ze záznamů importního souboru).</li></ul><h1>Výjimkové toky událostí</h1><h2>EF01: Odkazovaná hodnota není k dispozici</h2><h3>Vstupní podmínky</h3><ul><li>Na vstupu získaná reference se odkazuje na neexistující instanci odpovídající entity.  </li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení (MSG_ERR_REFERENCE_NOT_FOUND, viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>).</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Výsypy nebyly importovány.</li></ul><h2>EF02: Import souboru skončil chybou</h2><h3>Vstupní podmínky</h3><ul><li>Import získaných výsypů skončil chybou (obsažené informace neodpovídají dané struktuře, uvedená hodnota nevyhovuje odpovídajícímu atributu entity <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení (MSG_ERR_IMPORT_ENDED_WITH_ERROR, viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>).</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Výsypy nebyly importovány.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Byl proveden import všech instancí entity <a href="../../../datove-modely/datovy-88033012.html">Událost výsypu nádoby</a>, které byly získány na vstupu.</p><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Načíst událost výsypu nádoby</h2><p>Cílem algoritmu je načíst <a href="../../../datove-modely/datovy-88033012.html">Události výsypu nádob</a> získané z externího systému. Ty jsou předávány voláním specializovaného API.</p><table><tbody><tr><th>Specifikace volání API</div></div></th><th>Hodnota</div></div></th><th>Poznámka</div></div></th></tr><tr><td>Cesta</td><td><p>/emptyContainerEvent/importMobileReaderJson</p></td><td>–</td></tr><tr><td>Metoda</td><td>POST</td><td>–</td></tr></tbody></table><p>V těle metody jsou pak předány potřebné informace</p><ul><li><strong>organizationUnitId</strong> – identifikátor provozovny (povinný údaj),</li><li><strong>objectId</strong> – identifikátor vozidla,</li><li><strong>emptyContainerEvents</strong> – předávané výsypy v odpovídajícím formátu (povinný údaj).</li></ul><p>Na úrovni parametru <strong>emptyContainerEvents</strong> je předána kolekce záznamů, které představují výsypy. Každý z nich má dále uvedené parametry:</p><ul><li><strong>timestamp</strong> – okamžik, ve kterém došlo k výsypu (povinný údaj).</li><li><strong>code</strong> – načtený kód identifikátoru na dané nádobě.</li><li><strong>lat</strong> – souřadnice, na kterých došlo k výsypu (zeměpisná šířka).</li><li><strong>lng</strong> – souřadnice, na kterých došlo k výsypu (zeměpisná délka).</li></ul><p>Strukturu, ve které jsou předány informace o výsypech, si ukážeme na příkladu…</p><p>Když víme, v jaké podobě jsou výsypy předány, popíšeme si jejich mapování na <a href="../../../datove-modely/datovy-88033012.html">Události výsypu nádob</a>.</p><table><tbody><tr><th>Atribut řešené entity</div></th><th>Položka odpovědi API</div></th><th>Poznámka</div></th></tr><tr><td>Externí identifikátor</td><td>–</td><td>Je předáno NULL.</td></tr><tr><td>Provozovna</td><td>organizationUnitId</td><td>V rámci hodnoty je získán interní identifikátor <a href="../../../datove-modely/datovy-88033012.html">Provozovny</a>, tu předáme (je společná pro všechny obsažené výsypy).</td></tr><tr><td colspan="1">Čas</td><td colspan="1">timestamp</td><td colspan="1"><p>Hodnota je uvedena v následujícím formátu ISO 8601 (podporováno je předání jak v UTC, tak v lokálním čase). <strong>Její uložení do DB je pak provedeno v UTC.</strong></p></td></tr><tr><td colspan="1">Zeměpisná šířka</td><td colspan="1">lat</td><td colspan="1"><p>Pokud není hodnota na vstupu získána, je předáno NULL.</p></td></tr><tr><td colspan="1">Zeměpisná šířka</td><td colspan="1">lng</td><td colspan="1"><p>Pokud není hodnota na vstupu získána, je předáno NULL.</p></td></tr><tr><td colspan="1">Lokalita</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Ulice lokality</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Město lokality</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Stát lokality</td><td colspan="1">–</td><td colspan="1">Je předáno NULL.</td></tr><tr><td colspan="1">Kód identifikátoru</td><td colspan="1"> </td><td colspan="1">V obou případech je hodnota uvedena v uvozovkách, ty jsou však odebrány.</td></tr><tr><td>Externí identifikátor objektu</td><td>objectId</td><td><p>V rámci hodnoty je získán interní identifikátor <a href="../../../datove-modely/datovy-88033012.html">Objektu</a>, předáme pak hodnotu jeho atributu <strong>Externí identifikátor</strong> (je společný pro všechny obsažené výsypy).</p><p>Pokud není hodnota na vstupu získána, je předáno NULL.</p></td></tr><tr><td>Činnost ramene</td><td>–</td><td>Je předáno NULL.</td></tr><tr><td>Hmotnost obsahu</td><td>–</td><td>Je předáno NULL.</td></tr><tr><td>Zdrojové zařízení</td><td>–</td><td>Je předána hodnota <strong>Mobilní čtečka</strong> (viz <a href="../../../datove-modely/datovy-88033012.html">Zdrojové zařízení události výsypu nádoby</a>).</td></tr></tbody></table><h1>Validace</h1><h2>VAL01: Kontrola vstupních dat</h2><p>Je provedena kontrola vstupních dat, která zahrnuje následující akce:</p><ul><li>kontrola existence odkazovaných instancí (viz <a href="407uc06-122202239.html">EF01: Odkazovaná hodnota není k dispozici</a>).</li></ul><p>Poznámka: Importní soubor není součásti této validace, ta probíhá během jeho čtení (viz <a href="407uc06-122202239.html">EF02: Import souboru skončil chybou</a>).</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><p>–</p>
</div>
</body>
</html>
