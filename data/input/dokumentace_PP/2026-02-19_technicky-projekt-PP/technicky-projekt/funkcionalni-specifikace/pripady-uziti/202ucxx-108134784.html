<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>202UCxx: Synchronizace dat z Helios – MPG SK</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Úvod</h1><p>Cílem dokumentu je popis integrace FLW Pasport na systém Helios u zákazníka MPG SK. V první fázi je pak přebráno stávající <a href="../../integrace/synchronizace-93257926.html">DB rozhraní s WinyX</a>, které bude v potřebném rozsahu modifikováno.</p><ul><li>Aktuálně je řešena pouze komunikace z FLW Pasport do Helios (opačný směr není podporován).</li><li>Součástí integračního projektu je také posouzení možnosti jednorázových importů do FLW Pasport.</li></ul><h1>Otevřené body</h1><table><tbody><tr><th>#</th><th>Otevřený bod</th><th colspan="1">Popis</th><th>Řešení</th><th>Řešitel</th><th colspan="1">Stav</th><th>Poznámka</th></tr><tr><td>1</td><td>Identifikace položky objednávky</td><td colspan="1"><p>V rámci příprav zadání pro vývojáře jsem narazil na nejasnosti v synchronizaci řádků smluv (jejich verzí). </p><p>Aktuálně systém WinyX předává jednotlivá pořadí řádků smluv tak, že je identifikátor řádku smlouvy společný pro všechny její revize (liší se hodnota atributu Pořadí). Primární klíč je pak složen z následujících položek:</p><ul><li><strong>ID řádku smlouvy</strong>,</li><li>ID provozovny,</li><li>ID objednávky,</li><li><strong>Pořadí řádku smlouvy</strong>,</li><li>Typ předmětu smlouvy.</li></ul><p>Helios sice dodrží strukturu dat na integrační DB, ale změní se primární klíč řádku smlouvy:</p><ul><li>ID řádku smlouvy,</li><li>ID stanoviště.</li></ul><p>Zde nám pak není jasné, jak „propojíme“ dva stejné řádku smluv s různým pořadím… Dle uvedeného primárního klíče dojde při modifikaci k řádku smlouvy k následujícím akcím:</p><ul><li>Po modifikaci řádku smlouvy dojde k ukončení jeho platnosti. Předpokládejme pak, že tento řádek smlouvy měl hodnotu atributu Pořadí nastavenou na 1.</li><li>Je pak vytvořen nový řádek smlouvy, kde jsou zaneseny provedené změny. Hodnota atributu Pořadí u tohoto řádku smlouvy je nastavena na 2.</li><li><strong>Problém</strong>: Ze struktury primárního klíče předpokládáme, že se na řádku smlouvy změní hodnota jeho ID. Tedy že zmíněné řádky smluv budou mít odlišné ID.</li></ul><p>Tím však ztrácíme informaci, které řádky smluv k sobě „patří “. Aktuálně (ve WinyX) je ID řádku smlouvy zachováno a změní se hodnota atributu Pořadí.</p><p>Jak Helios uvedený problém řeší? My pak navrhujeme rozšíření primárního klíče řádku smlouvy právě o Pořadí s tím, že při řízených změnách řádku smlouvy bude jeho ID zachováno.</p></td><td>Primární klíč řádku smlouvy bude rozšířen o Pořadí s tím, že při řízených změnách řádku smlouvy bude jeho ID zachováno.</td><td>d2B</td><td colspan="1"></td><td><strong>Vyjádření d2B</strong>: Do HeliosNephrite sme pridali atribúty číslo riadku zmluvy a poradie riadku zmluvy tak aby sme dokázali zachovať štruktúru a kľúč.</td></tr><tr><td>2</td><td>Platnost přiřazení nádoby k položce objednávky</td><td colspan="1"><p>Ještě jsme narazili na jednu věc v rámci synchronizace, týká se pak entity <strong>ContractItemContainer</strong>. Ta obsahuje mj. 2 atributy s následujícím významem:</p><ul><li>DeliveredDate: datum fyzického umístění nádoby na stanoviště.</li><li>TakenAwayDate: datum fyzického stažení nádoby ze stanoviště.</li></ul><p>Hodnoty jsou pak ovšem v Pasport využity jiným způsobem, z pohledu synchronizace jsou použity následovně:</p><ul><li>DeliveredDate: datum přiřazení nádoby k položce objednávky (řádku smlouvy).</li><li>TakenAwayDate: datum ukončení platnosti přiřazení nádoby k položce objednávky (řádku smlouvy).</li></ul><p>Jak je patrné z uvedeného popisu, hodnoty představují fyzický pohyb nádoby na stanovištích, využity jsou však pro smluvní přiřazení nádoby k položce objednávky (řádku smlouvy).</p><p>Je v Helios k dispozici odpovídající informace, kterou by bylo možné použít jako zdroj hodnoty pro uvedené atributy?</p></td><td>Plnění zmíněných hodnot (jejich zdroj) bude řešeno s MPG SK, princip chování je pak zachován.</td><td>d2B</td><td colspan="1"></td><td><strong>Vyjádření d2B</strong>: V HeN máme na sledovanie pohybu nádoby vytvorenú rovnomennú triedu POHYB NÁDOBY. Na zázname pohybu nádoby je evidovaný dátum pohybu (DeliveredDate), nádobu a stanovisko, do triedy ešte pribudne atribút kde bude možné sledovať dôvod pohybu nádoby napr. pristavenie na stanovisko, odvezenie nádoby zo stanoviska, krádež nádoby ..... dôvody pohybu nádoby si musí špecifikovať MariusPedersen. Pridáme do pohybu nádoby ďalší dátumový atribút ktorý bude reprezentovať TakenAwayDate</td></tr><tr><td>3</td><td>Centrální evidence parametrů svozu</td><td colspan="1"><p>Aktuálně jsou číselníky s parametry svozu (frekvence vývozu, základní dny svozu) evidovány na úrovni jednotlivých společností (MPG, Waste…). Jako vhodný se pak jeví přechod na centrální evidenci záznamů. To ovšem vyžaduje sjednocení těchto číselníku.</p><p>Jakým způsobem budou parametry svozu evidovány – centrálně nebo na úrovni jednotlivých společností?</p></td><td><p>Bude zavedena „smíšená“ evidence parametrů svozu. Chování pak bude následující:</p><ul><li>Pokud není provozovna k dispozici, záznam je dostupný vždy.</li><li>Pokud je provozovna k dispozici, záznam je dostupný pro danou provozovnu a pro její podřízené provozovny.</li></ul></td><td>MPG SK</td><td colspan="1"></td><td><strong>Vyjádření d2B</strong>: Evidencia parametrov zvozu by z nášho pohľadu mala byť jednotná centrálna v rámci všetkých spoločností, podmienky prípadne zjednotenie však musí vykonať MariusPedersen.</td></tr><tr><td colspan="1">4</td><td colspan="1"> </td><td colspan="1"> </td><td colspan="1"> </td><td colspan="1"> </td><td colspan="1"> </td><td colspan="1"> </td></tr></tbody></table><h1>Transportované entity</h1><p>Než začneme s návrhem integračního rozhraní, musíme analyzovat, které z entit figurují v obou řešených systémech – u takových entit musíme specifikovat jejich primární systém (tzv. zdroj pravdy).</p><table><tbody><tr><th>Entita</th><th>Primární systém</th><th>Synchronizace</th><th>Směr synchronizace</th><th>Poznámka</th></tr><tr><td colspan="1"><em><a href="../../datove-modely/datovy-88033012.html">Provozovna</a></em></td><td colspan="1"><em>FLWW2</em></td><td colspan="1"><em>Ano</em></td><td colspan="1"><em>FLWW2 → FLW Pasport</em></td><td colspan="1"><p><em>Výhradním zdrojem pro získání informací je FLWW2. Informace z Helios jsou předávány přímo na FLWW2.</em></p></td></tr><tr><td colspan="1"><em><a href="../../datove-modely/datovy-88033012.html">Objekt</a></em></td><td colspan="1"><em>FLWW2</em></td><td colspan="1"><em>Ano</em></td><td colspan="1"><em>FLWW2 → FLW Pasport</em></td><td colspan="1"><em>Výhradním zdrojem pro získání informací je FLWW2. Informace z Helios jsou předávány přímo na FLWW2.</em></td></tr><tr><td colspan="1"><em><a href="../../datove-modely/datovy-88033012.html">Uživatel</a></em></td><td colspan="1"><em>FLWW2</em></td><td colspan="1"><em>Ano</em></td><td colspan="1"><em>FLWW2 → FLW Pasport</em></td><td colspan="1"><em>Výhradním zdrojem pro získání informací je FLWW2.</em></td></tr><tr><td colspan="1"><em><a href="../../datove-modely/datovy-88033012.html">Zaměstnanec</a></em></td><td colspan="1"><em>FLWW2</em></td><td colspan="1"><em>Ano</em></td><td colspan="1"><em>FLWW2 → FLW Pasport</em></td><td colspan="1"><em>Výhradním zdrojem pro získání informací je FLWW2. Informace z Helios jsou předávány přímo na FLWW2.</em></td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Zákazník</a></td><td colspan="1">Helios</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">–</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Objednávka</a></td><td colspan="1">Helios</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">–</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Položka objednávky</a></td><td colspan="1">Helios</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">–</td></tr><tr><td><a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a></td><td>Helios</td><td>Ano</td><td>Helios → FLW Pasport</td><td>–</td></tr><tr><td><a href="../../datove-modely/datovy-88033012.html">Frekvence vývozu</a></td><td>Helios</td><td>Ano</td><td>Helios → FLW Pasport</td><td>–</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Základní dny svozu</a></td><td colspan="1">Helios</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">–</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Typ nádoby</a></td><td colspan="1">Helios</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">Jedná se o typy nádob z pohledu objednávek.</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Nádoba</a></td><td colspan="1">Pasport</td><td colspan="1">Ne</td><td colspan="1">–</td><td colspan="1">Nádoby jsou zakládány ve FLW Pasport, může však být proveden jejich jednorázový import.</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Přiřazení nádoby ke stanovišti</a></td><td colspan="1">Helios</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">Aktuálně je možné modifikovat odpovídající záznamy i v rámci aplikace Pasport.</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Adresa</a></td><td colspan="1">–</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">–</td></tr><tr><td colspan="1"><a href="../../datove-modely/datovy-88033012.html">Druh odpadu</a></td><td colspan="1">Helios</td><td colspan="1">Ano</td><td colspan="1">Helios → FLW Pasport</td><td colspan="1">–</td></tr></tbody></table><h1>Architektura komunikace</h1><p>Architektura komunikace je postavena na integrační databázi, která slouží k předávání informací mezi jednotlivými systémy. Data jsou na komunikační rozhraní předávána výhradně ze systému Helios. Jejich načítání je pak zajištěno synchronizační komponentou systému FLW Pasport.</p><p><img src="202ucxx-synchronizace-dat-z-helios-mpg-sk-108134784_images/image2022-5-31 11-27-29.png" data-attachment="true"></p><p>Popis jednotlivých aktérů na straně systému FLW Pasport je popsán v tabulce.</p><table><tbody><tr><th>Aktér</th><th>Popis</th></tr><tr><td>Integrační databáze</td><td><p>Jedná se o MS SQL databázi, v rámci které jsou ukládána data z databáze Helios (tam jsou informace evidovány centrálně).</p><p>Při předávání informací jsou pak dodržována určitá pravidla:</p><ul><li>Při založení či editaci záznamu je aktualizována hodnota časového razítka poslední změny.</li><li>Jednotlivé záznamy nejsou mazány, jsou pouze označeny jako odebrané (tzv. soft delete).</li><li>Zápis probíhá v pravidelných časových intervalech.</li></ul></td></tr><tr><td>Synchronizační služba Helios</td><td><p>Synchronizační služba zajišťující čtení dat z integrační databáze a jejich následné předání do systému FLW Pasport.</p><ul><li>Implementace je specifická pro systém Helios, zajišťuje výhradně čtení dat.</li><li>Čtení probíhá v pravidelných časových intervalech.</li><li>Pro zápis dat do FLW Pasport je využita obecná synchronizační komponenta.</li></ul></td></tr><tr><td>Obecná synchronizační služba</td><td>API rozhraní umožňující nahrávání dat do systému FLW Pasport (viz <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=88037469">API - Synchronizačná komponenta</a>).</td></tr></tbody></table>
</div>
</body>
</html>
