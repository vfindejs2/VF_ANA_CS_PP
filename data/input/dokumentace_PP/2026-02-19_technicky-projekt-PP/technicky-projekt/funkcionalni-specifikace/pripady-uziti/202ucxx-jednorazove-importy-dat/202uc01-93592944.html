<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>202UC01: Nahrát importní soubor</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Případ užití umožňuje nahrát importní soubor ve standardní struktuře a provést formální kontroly vstupních dat. </p><p><em>Poznámka: V prvotní fázi projektu Pasport pro tento UC neexistuje uživatelské rozhraní a je spouštěn administrátorsky. Případ užití tak začíná přímo nahráním souboru (voláním API).</em></p><p><em>Poznámka: V prvotní fázi projektu bude UC implementován ve zjednodušené podobě bez podpory pro importní šablony.</em></p><p><br>Seznam aktérů</p><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Uživatel</td><td colspan="1">Jedná se o uživatele webové aplikace Pasport.</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Uživatel zadá požadavek na nahrání souboru, přičemž předá požadovaná vstupní data.</p><h2>Vstupní podmínky</h2><p>Existuje příslušná <a href="../../../datove-modely/datovy-88033012.html">Šablona importu</a>.</p><p>Ke spuštění případu užití jsou nutná následující oprávnění na typ entit (viz <a href="../../../uzivatelska-88033399.html">Uživatelská oprávnění a role</a>):</p><ul><li>Import dat z externích zdrojů (IMPORT_PP_EXTERNAL_RESOURCES ).</li></ul><h2>Vstupní data</h2><ul><li>Povinná vstupní data:<br><ul><li><a href="../../../datove-modely/datovy-88033012.html">Šablona importu</a>.</li><li>Importní soubor ve standardním formátu (viz <a href="202uc01-93592944.html">ALG01: Formát a struktura importního souboru</a>).</li><li><a href="../../../datove-modely/datovy-88033012.html">Provozovna</a>, pod kterou importovaná data patří.</li></ul></li></ul><h1>Základní tok událostí</h1><ol><li>Systém nahraje importovaný soubor na server (<a href="202uc01-93592944.html">EF01: Instance předaná na vstupu neexistuje</a>, <a href="202uc01-93592944.html">EF02: Překročena maximální velikost souboru</a>).</li><li>Systém zkontroluje, zda <a href="../../../datove-modely/datovy-88033012.html">Šablona importu</a> předaná na vstupu existuje a jedná se o podporovanou verzi šablony (<a href="202uc01-93592944.html">EF04: Neznámá nebo nepodporovaná importu</a>). </li><li>Systém zkontroluje, zda obecný formát souboru pro vybranou <a href="../../../datove-modely/datovy-88033012.html">Šablonu importu</a> (a její verzi) odpovídá <a href="202uc01-93592944.html">ALG01: Formát a struktura importního souboru</a> (<a href="202uc01-93592944.html">EF03: Chyba formátu importního souboru</a>).</li><li>Systém založí novou <a href="../../../datove-modely/datovy-88033012.html">Importní dávku</a> s těmito hodnotami atributů:<br><ul><li>Šablona importu: Na vstupu předaná hodnota <a href="../../../datove-modely/datovy-88033012.html">Šablony importu</a></li><li>Provozovna: Na vstupu předaná <a href="../../../datove-modely/datovy-88033012.html">Provozovna</a>.</li><li><em>Systémové atributy jsou naplněny standardně dle volajícího uživatele a aktuálního času.</em></li></ul></li><li>Systém pro jednotlivé řádky importovaného souboru: <br><ol><li>Provede validace dle <a href="202uc01-93592944.html">VAL01: Validace záznamů</a>.</li><li>Uloží záznam jako <a href="../../../datove-modely/datovy-88033012.html">Položku importní dávky</a> do databáze, hodnoty jejích atributů nastaví takto:<br><ul><li>Importní dávka: reference na příslušnou <a href="../../../datove-modely/datovy-88033012.html">Importní dávku</a>.</li><li>Ŕádek: Číslo odpovídajícího řádku ze vstupního souboru.</li><li>Obsah: Obsah odpovídajícího řádku ve vstupním souboru.</li><li>Je validní: Pokud nebyla nalezena žádná validační chyba v rámci <a href="202uc01-93592944.html">VAL01: Validace záznamů</a>, pak hodnota "True". Jinak hodnota "False".</li><li>Validační chyby: Popis nalezených validačních chyb v rámci <a href="202uc01-93592944.html">VAL01: Validace záznamů</a>.</li><li>Stav zpracován: "Nezpracovaná" (viz <a href="../../../datove-modely/datovy-88033012.html">Stav zpracování položky importu</a>).</li><li>Chyba zpracování: –</li><li><em>Systémové atributy jsou naplněny standardně dle volajícího uživatele a aktuálního času.</em></li></ul></li></ol></li></ol><h1>Alternativní toky události</h1><p>Nejsou.</p><h1>Výjimkové toky událostí</h1><h2>EF01: Instance předaná na vstupu neexistuje</h2><h3>Vstupní podmínky</h3><ul><li>Na vstupu předaný Typ importního souboru nebo Provozovna neexistuje.</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_ITEM_NOT_FOUND,</li><li>typ entity (Provozovna).</li></ul></li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nebyla založena importní dávka, nedošlo k uložení jednotlivých záznamů k importu.</li></ul><h2>EF02: Překročena maximální velikost souboru</h2><h3>Vstupní podmínky</h3><ul><li>Velikost importovaného souboru překračuje hodnotu maxImportFileSize nastavenou v <a href="#" data-page-title="Konfigurační parametry"></a>.</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_MAXIMUM_FILE_SIZE_EXCEEDED.</li></ul></li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nahrání souboru na server nebylo dokončeno z důvodu překročené maximální velikosti.</li></ul><h2>EF03: Chyba formátu importního souboru</h2><h3>Vstupní podmínky</h3><ul><li>Formát importního souboru pro příslušný typ importu neodpovídá obecnému formátu dle <a href="202uc01-93592944.html">ALG01: Formát a struktura importního souboru</a></li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_INVALID_FILE_FORMAT.</li></ul></li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nebyla založena importní dávka, nedošlo k uložení jednotlivých záznanů k importu.</li></ul><h2>EF04: Neznámá nebo nepodporovaná šablona importu</h2><h3>Vstupní podmínky</h3><ul><li><a href="../../../datove-modely/datovy-88033012.html">Šablona importu</a> předaná na vstupu neexistuje, nebo se jedná se o nepodporovanou verzi šablony (atribut Je podporovaná = FALSE).</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_UNSUPPORTED_IMPORT_TEMPLATE.</li></ul></li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nebyla založena importní dávka, nedošlo k uložení jednotlivých záznanů k importu.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Byla uložena kolekce <a href="../../../datove-modely/datovy-88033012.html">Položek importní dávky</a>. </p><h2>Výstupní data</h2><table><tbody><tr><th colspan="1">Výsledek UC</th><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th></tr><tr><td rowspan="3">Úspěšné dokončení</td><td colspan="1"><p>Identifikátor importní dávky.</p></td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1"> </td></tr><tr><td colspan="1">Počet validních záznamů k importu</td><td colspan="1">Celé číslo</td><td colspan="1">Ano</td><td colspan="1">Tok událostí končí úspěchem i v případě, kdy importní soubor neobsahuje žádný validní záznam.</td></tr><tr><td colspan="1">Počet nevalidních záznamů k importu</td><td colspan="1">Celé číslo</td><td colspan="1">Ano</td><td colspan="1"> </td></tr><tr><td colspan="1">Chyba</td><td colspan="1">Chybové hlášení.</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1">Jedná se o popis chyby (viz jednotlivé EF), kvůli které nemohl UC úspěšně dokončen.</td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Formát a struktura importního souboru</h2><h3>Obecný formát</h3><ul><li>Soubor XLSX.</li><li>První řádek obsahuje níže definované názvy atributů ve formátu <Entita>.<Atribut> (např. Nádoba.Evidenčné_číslo).</li></ul><h3>Šablona importu = Nádoby_MP, verze 1</h3><p>Předpoklad: V importní dávce je <strong>každá nádoba obsažena pouze jednou</strong> a k ní aktuální data o stanovišti a poplatníkovi. V případě vícenásobného výskytu stejné nádoby (shoda identifikačního čísla) je zapsán pouze první záznam; při pokusu o vytvoření dalšího záznamu dojde k chybě (duplicitní záznam).</p><p><br></p><h5>Schéma importního souboru</h5><table><tbody><tr><th>Entita</th><th colspan="1">Povinná entita</th><th>Atribut</th><th colspan="1">Povinný atribut</th><th colspan="1">Datový typ</th><th colspan="1">Rozsah</th><th colspan="1">Povolené výčtové hodnoty</th><th colspan="1">Poznámka</th></tr><tr><td rowspan="9">Nádoba</td><td rowspan="9">Ano</td><td colspan="1">Evidenčné_číslo</td><td colspan="1">Ano</td><td colspan="1">Řetězec</td><td colspan="1">20</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Interné_číslo</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">20</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Číslo_čipu</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">20</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Vlastníctvo</td><td colspan="1">Ne</td><td colspan="1">Řetězec, výčet</td><td colspan="1">15</td><td colspan="1"><p>Cudzia</p><p>Vlastná (výchozí)</p></td><td colspan="1">V Pasport povinné, případně doplněna výchozí hodnota.</td></tr><tr><td colspan="1">Poznámka</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">255</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Nádoba.Pozn_zákazníka</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">¯</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Skupina_odpadu</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">50</td><td colspan="1">¯</td><td colspan="1">Vstupní data budou připravena tak, že předaná hodnota odpovídá atributu Zkrácený název Skupiny odpadu v aplikaci Pasport.</td></tr><tr><td colspan="1">Vzor_nádoby</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">50</td><td colspan="1">¯</td><td colspan="1">Vstupní data budou připravena tak, že předaná hodnota odpovídá atributu Zkrácený název Vzoru nádoby v aplikaci Pasport.</td></tr><tr><td colspan="1">Nádoba.Kategória_nádoby</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">50</td><td colspan="1"><p>ds<br> </p><p>ko<br> </p><p>k_ds<br> </p><p>k_ko<br> </p><p>mn_ds<br> </p><p>mn_ko<br> </p><p>ppk_ds<br> </p><p>ppk_ko<br> </p><p>un_ko<br> </p><p>z/g_ds</p></td><td colspan="1">Validace: Pokud bude hodnota atributu Kategorie nádoby ve vstupním souboru neprázdná, bude při nahrání importního souboru provedena validace, zda se jedná o platnou Kategorii nádoby.</td></tr><tr><td><p>Poplatník</p><p> </p><p> </p><p> </p><p> </p></td><td><p>Ne</p><p> </p><p> </p><p> </p><p> </p><p> </p></td><td>Názov</td><td colspan="1">Ano</td><td colspan="1">Řetězec</td><td colspan="1">255</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">dtto</td><td colspan="1">dtto</td><td colspan="1">FO_PO</td><td colspan="1">FO_PO</td><td colspan="1">Řetězec, výčet</td><td colspan="1">5</td><td colspan="1"><p>FO</p><p>PO</p></td><td colspan="1">V Pasport nepovinné.</td></tr><tr><td><p>Obdobie</p><p><br></p></td><td><p>Neviz Pozn.</p><p><em>Pozn.:</em></p><p><em>Pokud není zadáno stanoviště / poplatník. </em><em>Jinak Ano.</em></p></td><td colspan="1">Od</td><td colspan="1">Ano</td><td colspan="1">Datum a čas</td><td colspan="1">¯</td><td colspan="1"><p> </p></td><td colspan="1"> </td></tr><tr><td>dtto</td><td colspan="1">dtto</td><td colspan="1">Do</td><td colspan="1">Ne</td><td colspan="1">Datum a čas</td><td colspan="1">¯</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td rowspan="5">Stanovisko</td><td rowspan="5">Ne</td><td>Ulica</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">80</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Čp</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">15</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Mesto</td><td colspan="1">Ano</td><td colspan="1">Řetězec</td><td colspan="1">80</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">PSČ</td><td colspan="1">Ne</td><td colspan="1">Řetězec</td><td colspan="1">15</td><td colspan="1">¯</td><td colspan="1"> </td></tr><tr><td colspan="1">Typ stavby</td><td colspan="1">Ne</td><td colspan="1"><p>Řetězec</p><p> </p></td><td colspan="1">20</td><td colspan="1"> </td><td colspan="1"><p>Rodinný dům</p><p>Bytový dům</p><p>Polyfunkční dům</p><p>Areál</p><p>Jiné</p></td></tr></tbody></table><h1>Validace</h1><h2>VAL01: Validace záznamů</h2><p>Systém provede tyto kontroly oproti schématu importního souboru pro příslušný typ importu - viz <a href="202uc01-93592944.html">ALG01: Formát a struktura importního souboru</a>:</p><ol><li>Záznam obsahuje všechny povinné entity.</li><li>V případě, že je v záznamu obsažena entita, musí obsahovat všechny své povinné atributy.</li><li>Neprázdné hodnoty atributů jsou správného datového typu a rozsahu.</li><li>Výčtové typy atributů obsahují jen povolené hodnoty.</li><li>Vo všech  sloupcích budou odstránené  mezery</li><li>Pro hodnoty atributů Vlastnictví nádoby, Typ poplatníka a Typ stavby budou provedeny následující akce<br><ol><li>Budou odstraněny všechny bílé znaky (mezery, tabulátory a nové řádky) ze začátku řetězce reprezentující konkrétní hodnotu některého z výše uvedených výčtových atributů, například hodnota atributu Typ stavby " Rodinny dom" bude upravena na "Rodinný dom". Kontroluje se jenom diakritika a male/velký písmena.</li><li> Budou odstraněny všechny bílé znaky (mezery, tabulátory a nové řádky) z konce řetězce reprezentující konkrétní hodnotu některého z výše uvedených výčtových atributů, například hodnota atributu Vlastnictví "Vlastna " bude upravena na "Vlastná". Kontroluje se jenom diakritika a male/velký písmena.<br>Následně bude provedena samotná validace záznamů. </li></ol></li></ol><h1>Revize</h1><h2>14.1. 2025: Terézia Psotková</h2><table><tbody><tr><th>Odkaz</th><th>Stručný popis změny</th><th colspan="1">Jira</th></tr><tr><td colspan="1"><p><a href="202uc01-93592944.html">ALG01: Formát a struktura importního souboru</a></p><p><a href="202uc01-93592944.html">VAL01: Validace záznamů</a></p></td><td colspan="1">Doplněna schéma importního souboru a validace záznamu. Změny naznačené mordě</td><td colspan="1">RADIUMFLWWPAS-780</td></tr></tbody></table>
</div>
</body>
</html>
