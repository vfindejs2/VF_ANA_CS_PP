<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>202UC04: Nahrát soubor mapování na číselníková data (NEREALIZOVAT)</title>
</head>
<body>
<div class="wiki-content">
<p></p><p> </p><p>Zatím NEREALIZOVAT, v současné fázi projektu budou potřebná mapování vyřešena úpravou vstupních souborů.</p><h1>Stručný popis, cíl</h1><p>Případ užití umožňuje uživateli (v rámci procesu importu z externích zdrojů) specifikovat mapování z číselníkových hodnot obsažených na vstupu na číselníkové hodnoty Pasport. UC navazuje na <a href="#" data-page-title="202UC01: Nahrát importní soubor">202UC01: Nahrát importní soubor</a>. - zadané mapování je platné pouze pro specifikovanou importní dávku.</p><p>UC lze k jedné importní dávce vykonat opakovaně - pak dojde ke smazání všech existujících Položek mapování stejné Definice k dané importní dávce (tj. jedná se o kompletní nahrazení předchozího nahraného mapování).</p><p><em>Poznámka: V prvotní fázi projektu Pasport pro tento UC neexistuje uživatelské rozhraní a je spouštěn administrátorsky. </em></p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Uživatel</td><td colspan="1">Jedná se o uživatele webové aplikace Pasport.</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Uživatel zadá požadavek na nahrání souboru s definici mapování, přičemž předá vstupní data.</p><h2>Vstupní podmínky</h2><p>Existuje příslušná Definice mapování pro import.</p><p>Ke spuštění případu užití jsou nutná následující oprávnění na typ entit (viz <a href="../../../uzivatelska-88033399.html">Uživatelská oprávnění a role</a>):</p><ul><li>Import dat z externích zdrojů (IMPORT_PP_EXTERNAL_RESOURCES).</li></ul><h2>Vstupní data</h2><ul><li>Povinná vstupní data:<ul><li>Definice mapování pro import.</li><li>Identifikátor importní dávky.<br></li><li>Importní soubor s mapováním ve standardním formátu.</li></ul></li></ul><h1>Základní tok událostí</h1><ol><li>Systém nahraje importní soubor na server (<a href="202uc04-94537522.html">EF01: Instance předaná na vstupu neexistuje</a>, <a href="202uc04-94537522.html">EF02: Překročena maximální velikost souboru</a>).</li><li>Systém zkontroluje, že na vstupu předaná Definice mapování pro import souhlasí se Šablonou importního souboru Importní dávky odkazované na vstupu. (<a href="202uc04-94537522.html">EF03: Definice mapování neodpovídá Šabloně importu</a>)</li><li>Systém zkontroluje, zda obecný formát souboru pro příslušný typ importu odpovídá <a href="202uc04-94537522.html">ALG01: Formát položek mapování pro import</a> (<a href="202uc04-94537522.html">EF04: Chyba formátu importního souboru</a>).</li><li>Systém provede validace vstupních dat <a href="202uc04-94537522.html">VAL01: Validace přijatých záznamů</a> (<a href="202uc04-94537522.html">EF05: Chybný vstupní záznam</a>).</li><li>Systém nalezne a smaže všechny Položky mapování pro import příslušící k dané Definici mapování pro import, které jsou v současnosti uloženy k danému Identifikátoru importní dávky.</li><li>Systém uloží nové Položky mapování pro import:<br><ul><li>Definice mapování pro import:</li><li>Identifikátor importní dávky:</li><li>Vstupní mapování: Hodnoty pro vstupní mapování.</li><li>Výstupní mapování: Hodnota výstupního mapování.</li><li>Datum vytvoření: Aktuální čas.</li><li>Vytvořil: <a href="../../../datove-modely/datovy-88033012.html">Uživatel</a>, který spustil UC.</li></ul></li></ol><h1>Alternativní toky události</h1><p>Nejsou.</p><h1>Výjimkové toky událostí</h1><h2>EF01: Instance předaná na vstupu neexistuje</h2><h3>Vstupní podmínky</h3><ul><li>Na vstupu předaná Definice mapování pro import nebo Importní dávka neexistuje.</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_ITEM_NOT_FOUND,</li><li>typ entity (Definice mapování pro import, Importní dávka).</li></ul></li><li>Systém smaže nahraný soubor.</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k vytvoření nového mapování na číselníková data.</li></ul><h2>EF02: Překročena maximální velikost souboru</h2><h3>Vstupní podmínky</h3><ul><li>Velikost importovaného souboru překračuje hodnotu maxImportFileSize nastavenou v <a href="../../../konfiguracni-hodnoty/konfiguracni-88033346.html">Konfigurační parametry</a>.</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_MAXIMUM_FILE_SIZE_EXCEEDED.</li></ul></li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nahrání souboru na server nebylo dokončeno z důvodu překročené maximální velikosti.</li></ul><h2>EF03: Definice mapování neodpovídá Šabloně importu</h2><h3>Vstupní podmínky</h3><ul><li>Na vstupu předaná Definice mapování pro import neodpovídá Typu importu.</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_TYPE_MISMATCH,</li><li>typ entity.</li></ul></li><li>Systém smaže nahraný soubor.</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k vytvoření nového mapování na číselníková data.</li></ul><h2>EF04: Chyba formátu importního souboru</h2><h3>Vstupní podmínky</h3><ul><li>Formát importního souboru pro příslušný typ importu neodpovídá obecnému formátu dle ALG01</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_INVALID_FILE_FORMAT.</li></ul></li><li>Systém smaže nahraný soubor.</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k vytvoření nového mapování na číselníková data.</li></ul><h2>EF05: Chybný vstupní záznam</h2><h3>Vstupní podmínky</h3><ul><li>V kontrolovaných záznamech se vyskytuje validační chyba (např. nebyla dodána očekávaná hodnota, byl překročen povolený rozsah, povinnost zadání, jedinečnost záznamu a podobně).</li></ul><h3>Tok událostí</h3><ol><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemova-88033342.html">Systémová hlášení</a>):<br><ul><li>chybové hlášení: MSG_ERR_INVALID_DATA,</li><li>hodnota vstupního parametru: hodnota odpovídajícího vstupního parametru.</li></ul></li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k vytvoření nového mapování na číselníková data.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Bylo uložena kolekce Položek mapování na číselníková data k dané importní dávce. (TODO doplnit nové entity do Datového slovníku a nahradit zde odkazem)</p><h2>Výstupní data</h2><table><tbody><tr><th colspan="1">Výsledek UC</th><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th></tr><tr><td>Úspěšné dokončení</td><td colspan="1"><p>–</p></td><td colspan="1"><strong>–<br></strong></td><td colspan="1">–</td><td colspan="1">–</td></tr><tr><td colspan="1">Chyba</td><td colspan="1">Chybové hlášení.</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1">Jedná se o popis chyby (viz jednotlivé EF), kvůli které nemohl UC úspěšně dokončen.</td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Formát položek mapování pro import</h2><h3>Obecný formát</h3><ul><li>Soubor CSV, kódování UTF-08, oddělovačem je středník.</li><li>První řádek obsahuje níže definované názvy atributů ve formátu In.<Entita>.<Atribut> (např. In.Nádoba.Typ_nádoby) v daném pořadí. Poslední hodnota v řádku je pouze informativní (název entity na výstupu).</li></ul><h3>Formáty pro Šablonu importu = Containers_MP</h3><h5>Definice typu mapování = Containers_MP.ContainerPattern</h5><p>Definice mapuje atributy Nádoba.Typ_Nádoby a Nádoba.Farba na hodnotu <a href="../../../datove-modely/datovy-88033012.html">Vzor nádoby</a>.</p><h5>Schéma importního souboru</h5><table><tbody><tr><th colspan="1">Strana mapování</th><th>Atribut</th><th>Povinný</th><th>Datový typ a rozsah</th><th colspan="1">Poznámka</th></tr><tr><td rowspan="2"><p>Mapování na vstupu</p><p>(atribut z importního souboru)</p></td><td>Nádoba.Typ_nádoby</td><td>Neviz Pozn.</td><td>Viz <a href="202uc01-93592944.html">Formát importního souboru, typ importu = Containers_MP</a></td><td rowspan="2">Alespoň jeden z atributů mapování na vstupu musí být vyplněn.</td></tr><tr><td>Nádoba.Farba</td><td>Neviz Pozn.</td><td>Viz <a href="202uc01-93592944.html">Formát importního souboru, typ importu = Containers_MP</a></td></tr><tr><td colspan="1"><p>Mapování na výstupu</p><p>(atribut Pasport)</p></td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Vzor nádoby</a>.Externí id</td><td colspan="1">Ano</td><td colspan="1">Řetězec</td><td colspan="1">Obsahuje Externí identifikátor příslušného záznamu <a href="../../../datove-modely/datovy-88033012.html">Vzor nádoby</a>.</td></tr></tbody></table><p><em>Příklad jedné položky mapování:</em></p><table><tbody><tr><th>In.Nádoba.Typ_nádoby</th><th>In.Nádoba.Farba</th><th>Vzor nádoby</th></tr><tr><td>1100 l, papier</td><td>modrá</td><td>K_1100l_P_papír</td></tr></tbody></table><p>Definice typu mapování = Containers_MP.WasteGroup</p><p>Definice mapuje atribut Nádoba.Odpad na hodnotu <a href="../../../datove-modely/datovy-88033012.html">Skupina odpadu</a>.</p><table><tbody><tr><th colspan="1">Strana mapování</th><th>Atribut</th><th>Povinný</th><th>Datový typ a rozsah</th><th colspan="1">Poznámka</th></tr><tr><td><p>Mapování na vstupu</p><p>(atribut z importního souboru)</p></td><td>Nádoba.Odpad</td><td>Ano</td><td>Viz <a href="202uc01-93592944.html">Formát importního souboru, typ importu = Containers_MP</a></td><td> </td></tr><tr><td colspan="1"><p>Mapování na výstupu</p><p>(atribut Pasport)</p></td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Skupina odpadu</a></td><td colspan="1">Ano</td><td colspan="1">Řetězec</td><td colspan="1">Obsahuje Externí identifikátor příslušného záznamu <a href="../../../datove-modely/datovy-88033012.html">Skupina odpadu</a>.</td></tr></tbody></table><p><em>Příklad jedné položky mapování:</em></p><table><tbody><tr><th>In.Nádoba.Odpad</th><th>Skupina odpadu</th></tr><tr><td>papier</td><td>PAP</td></tr></tbody></table><h1>Validace</h1><h2>VAL01: Validace přijatých záznamů</h2><p>Kontrola je vykonávána vzhledem k formátu na vstupu předaného odkazu na Definici typu mapování - viz <a href="202uc04-94537522.html">ALG01: Formát položek mapování pro import</a>.</p><ol><li>Záznam obsahuje všechny povinné položky.</li><li>Neprázdné hodnoty atributů jsou správného datového typu a rozsahu.</li><li>Odkazované číselníkové položky na straně Pasport  (mapování na výstupu) existují a jsou platné.</li><li>Záznamy mapování na vstupu jsou jedinečné (nesmí se vyskytovat více záznamů mapování na vstupu, které mají stejné hodnoty všech atributů).</li></ol><h1>Revize</h1><h2>29. 5. 2020: Jméno Příjmení</h2><table><tbody><tr><th>Odkaz</th><th>Stručný popis změny</th></tr></tbody></table>
</div>
</body>
</html>
