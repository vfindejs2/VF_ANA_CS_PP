<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>203UC01: Synchronizovat záznam</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je synchronizace záznamů ze systému FLWW2. Notifikace o dílčích změnách je pak zasílána prostřednictvím zpráv (RabbitMQ), informace o jednotlivých záznamech jsou získávány z odpovídajícího API.</p><p>Poznámka: Chování by mělo být společné bez ohledu na další napojené systémy třetích stran.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Systém FLWW2</td><td colspan="1">Zajišťuje jak spuštění případu užití, tak následné dodání informací o synchronizovaném záznamu.</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Systém FLWW2 zadá požadavek na synchronizaci záznamu, a to jedním z uvedených způsobů:</p><ul><li>Systém FLWW2 odešle zprávu o změně konkrétního záznamu (viz <a href="https://confluence.radium.cz/display/FLWW2/RabbitMQ+Exchanges+a+queues">RabbitMQ Exchanges a queues</a>).</li></ul><h2>Vstupní podmínky</h2><p>Je nastavena konfigurace pro synchronizaci záznamů:</p><ul><li>Napojení systému FLWW2 (RabbitMQ).</li></ul><p>Na vstupu přijatá zpráva splňuje všechny dále uvedené podmínky (vyhodnoceno dle <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>):</p><ul><li>Je k dispozici identifikátor instance ve FLWW2 (položka <strong>EntityID</strong>).</li><li>Jedná se o zprávu odpovídajícího typu (položka <strong>EntityType</strong>).</li></ul><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Zpráva</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1">Paket obsahující konkrétní zprávu.</td><td colspan="1"><p>Zpráva je získána z RabbitMQ, konkrétně se jedná o exchange <strong>fleetware.entities.events</strong> (viz <a href="https://confluence.radium.cz/display/FLWW2/RabbitMQ+Exchanges+a+queues">RabbitMQ Exchanges a queues</a>). Kódována je pak pomocí <a href="https://confluence.radium.cz/display/FLWW2/Protocol+Buffers">Protocol Buffers</a>.</p></td></tr></tbody></table><h1>Základní tok událostí</h1><ol><li>Systém vyhodnotí obsah na vstupu získané zprávy (vstupní parametr Zpráva; viz <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>).</li><li>Systém provede synchronizaci odpovídajícího záznamu (viz <a href="203uc01-112558461.html">ALG02: Synchronizovat záznam</a>).</li></ol><p>Poznámka: Synchronizace probíhá v kontextu daného tenanta (položka <strong>CompanyAlias</strong>, viz <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>).</p><h1>Alternativní toky událostí</h1><p>–</p><h1>Výjimkové toky událostí</h1><p>–</p><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Došlo k synchronizaci záznamu, provedená akce odpovídá informacím předaným v na vstupu získané zprávě.</p><h2>Výstupní data</h2><p>–</p><h1>Algoritmy</h1><h2>ALG01: Vyhodnotit obsah zprávy</h2><p>Cílem algoritmu je vyhodnocení obsahu zprávy získané na vstupu UC (vstupní parametr Zpráva). Na jeho výstupu jsou pak předány informace přenášené ve zprávě.</p><p>Poznámka: Zpráva jako taková je kódována pomocí <a href="https://confluence.radium.cz/display/FLWW2/Protocol+Buffers">Protocol Buffers</a>, tomu odpovídá i dále uvedený popis. Uvedeny jsou pouze takové položky, které nás v rámci tohoto UC zajímají.</p><table><tbody><tr><th>Položka</div></div></th><th>Datový typ</div></div></th><th>Popis</div></div></th><th>Poznámka</div></div></th></tr><tr><td>EntityID</td><td>long?</td><td>Identifikátor instance dané entity ve FLWW2.</td><td>–</td></tr><tr><td>EntityType</td><td>int</td><td>Identifikátor typu přenášené informace.</td><td><p>Informace je také součástí „routing key“ zprávy.</p></td></tr><tr><td colspan="1">EntityOperationType</td><td colspan="1">EntityOperationType</td><td colspan="1">Typ operace, která byla nad instancí dané entity provedena (<strong>created</strong>, <strong>updated</strong>, <strong>deleted</strong>).</td><td colspan="1">Informace je také součástí „routing key“ zprávy.</td></tr><tr><td colspan="1">CompanyAlias</td><td colspan="1">CompanyAlias</td><td colspan="1">Tenant, v rámci kterého je záznam evidován.</td><td colspan="1">–</td></tr></tbody></table><h2>ALG02: Synchronizovat záznam</h2><p>Cílem algoritmu je zajištění synchronizace ve zprávě získaného záznamu. Samotné chování se pak odvíjí od typu daného záznamu (položka <strong>EntityType</strong>, viz <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>).</p><p>Poznámka: Zprávy nepodporovaných typů jsou ignorovány.</p><table><tbody><tr><th>EntityType</div></th><th colspan="1">Odpovídající entita</div></th><th>Popis</div></th><th>Poznámka</div></th></tr><tr><td><strong>3</strong>: EntityType.Objects</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Objekt</a></td><td><p>Systém provede synchronizaci odpovídajícího <a href="../../../datove-modely/datovy-88033012.html">Objektu</a> – spustí <a href="#" data-page-title="203UC02: Synchronizovat objekt">203UC02: Synchronizovat objekt</a>, na vstup jsou předány následující informace:</p><ul><li>Externí identifikátor: hodnota položky <strong>EntityID</strong> získaná v rámci <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Akce při modifikaci instance: hodnota získána v rámci <a href="203uc01-112558461.html">ALG03: Získat akci při modifikaci instance</a>.</li></ul></td><td>–</td></tr><tr><td colspan="1"><strong>6</strong>: EntityType.Users</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Uživatel</a></td><td colspan="1"><p>Systém provede synchronizaci odpovídajícího <a href="../../../datove-modely/datovy-88033012.html">Uživatele</a> – spustí <a href="#" data-page-title="203UC05: Synchronizovat uživatele"></a>, na vstup jsou předány následující informace:</p><ul><li>Externí identifikátor: hodnota položky <strong>EntityID</strong> získaná v rámci <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Akce při modifikaci instance: hodnota získána v rámci <a href="203uc01-112558461.html">ALG03: Získat akci při modifikaci instance</a>.</li></ul></td><td colspan="1">–</td></tr><tr><td colspan="1"><strong>7</strong>: EntityType.Employees</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Zaměstnanec</a></td><td colspan="1"><p>Systém provede synchronizaci odpovídajícího <a href="../../../datove-modely/datovy-88033012.html">Zaměstnance</a> – spustí <a href="#" data-page-title="203UC06: Synchronizovat zaměstnance"></a>, na vstup jsou předány následující informace:</p><ul><li>Externí identifikátor: hodnota položky <strong>EntityID</strong> získaná v rámci <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Akce při modifikaci instance: hodnota získána v rámci <a href="203uc01-112558461.html">ALG03: Získat akci při modifikaci instance</a>.</li></ul></td><td colspan="1">–</td></tr><tr><td colspan="1"><strong>11</strong>: EntityType.OrganizationUnits</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Provozovna</a></td><td colspan="1"><p>Systém provede synchronizaci odpovídající <a href="../../../datove-modely/datovy-88033012.html">Provozovny</a> – spustí <a href="#" data-page-title="203UC04: Synchronizovat provozovnu">203UC04: Synchronizovat provozovnu</a>, na vstup jsou předány následující informace:</p><ul><li>Externí identifikátor: hodnota položky <strong>EntityID</strong> získaná v rámci <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Akce při modifikaci instance: hodnota získána v rámci <a href="203uc01-112558461.html">ALG03: Získat akci při modifikaci instance</a>.</li></ul></td><td colspan="1">–</td></tr></tbody></table><p>Záznamy některých entit jsou získávány ručně, neprobíhá tedy průběžná synchronizace, pro úplnost však zmíníme i ty…</p><table><tbody><tr><th>EntityType</div></th><th colspan="1">Odpovídající entita</div></th><th>Popis</div></th><th>Poznámka</div></th></tr><tr><td colspan="1">–</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Pracovní pozice</a></td><td colspan="1"><p>Systémový administrátor provede synchronizaci odpovídající <a href="../../../datove-modely/datovy-88033012.html">Pracovní pozice</a> – spustí <a href="#" data-page-title="203UC07: Synchronizovat pracovní pozici">203UC07: Synchronizovat pracovní pozici</a>, na vstup jsou předány následující informace:</p><ul><li>Externí identifikátor: hodnota zadaná systémovým administrátorem.</li><li>Akce při modifikaci instance: hodnota zadaná systémovým administrátorem.</li></ul></td><td colspan="1">Jedná se o jednorázový import.</td></tr></tbody></table><h2>ALG03: Získat akci při modifikaci instance</h2><p>V rámci získané zprávy je mj. k dispozici informace o typu operace, která byla provedena nad daným záznamem. Tu musíme převést na odpovídajícího hodnotu výčtového typu <a href="../../../datove-modely/datovy-88033012.html">Akce při modifikaci instance</a>, která je předána na výstupu algoritmu.</p><ol><li>Systém vyhodnotí hodnotu získanou v rámci položky <strong>EntityOperationType</strong> (viz <a href="203uc01-112558461.html">ALG01: Vyhodnotit obsah zprávy</a>):<br><ul><li><strong>Created</strong>: předána hodnota <strong>Založení</strong>.</li><li><strong>Updated</strong>: předána hodnota <strong>Editace</strong>.</li><li><strong>Deleted</strong>: předána hodnota <strong>Odebrání</strong>.</li></ul></li></ol><h1>Validace</h1><p>Poznámka: Validace jsou prováděny v rámci volaných UC.</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><p>–</p>
</div>
</body>
</html>
