<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>400UC18: Získat přiřazení nádob k položkám objednávek pro externí zákazníky</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je vytvoření dotazu, na základě kterého bude možné specifikovat, jaká <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádob k položkám objednávek</a> má konkrétní externí zákazník (resp. odpovídající uživatel) k dispozici. Jednotlivá kritéria, na základě kterých je sestaven výsledný dotaz, jsou pak pevně dána, a to na úrovni konkrétních uživatelů. </p><p>Poznámka: Pokud není pro konkrétního uživatele specifikace k dispozici, nejsou v rámci tohoto UC dostupné instance nijak omezovány.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Uživatel</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Uživatel zadá požadavek na získání přiřazení nádob k položkám objednávek pro externí zákazníky, a to jedním z uvedených způsobů:</p><ul><li>Uživatel zadá požadavek na zobrazení přehledu nádob pro externí zákazníky (viz <a href="#" data-page-title="400UC14: Zobrazit přehled nádob pro externí zákazníky"></a>).</li></ul><h2>Vstupní podmínky</h2><p>–</p><h2>Vstupní data</h2><p>–</p><h1>Základní tok událostí</h1><ol><li>Systém nalezne specifikaci dostupných <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádob k položkám objednávek</a> pro právě přihlášeného <a href="../../../datove-modely/datovy-88033012.html">Uživatele</a> – získá takové <a href="../../../datove-modely/datovy-88033012.html">Nastavení externího zákazníka</a>, které splňuje všechny dále uvedené podmínky zároveň:<br><ul><li><p>Hodnota atributu <strong>Uživatel</strong> odpovídá právě přihlášenému <a href="../../../datove-modely/datovy-88033012.html">Uživateli</a>.</p></li><li>Hodnota atributu <strong>Dostupná přiřazení nádob k položkám objednávek</strong> je různá od NULL.</li></ul></li><li>Pokud není pro <a href="../../../datove-modely/datovy-88033012.html">Uživatele</a> nalezeno žádné <a href="../../../datove-modely/datovy-88033012.html">Nastavení externího zákazníka</a>:<br><ol><li><strong>Konec toku událostí</strong> (na výstupu není předána žádná hodnota).</li></ol></li><li>Systém vytvoří výsledný dotaz pro specifikaci dostupných <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádob k položkám objednávek</a> – nastaví hodnotu výstupního parametru <strong>Výsledný dotaz</strong> následovně:<br><ul><li>Vloží kritéria obsažená v rámci získaného <a href="../../../datove-modely/datovy-88033012.html">Nastavení externího zákazníka</a> (atribut <strong>Dostupná přiřazení nádob k položkám objednávek</strong>).</li></ul></li></ol><p>Poznámka: Struktura specifikace dostupných instancí byla rozšířena, došlo tedy k jejímu přesunu na společné místo (viz popis entity <a href="../../../datove-modely/datovy-88033012.html">Nastavení externího zákazníka</a>).</p><h2>Struktura specifikace dostupných instancí</h2><p>Aby bylo možné určit, jaké instance entity <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádoby k položce objednávky</a> bude mít konkrétní externí zákazník (resp. odpovídající uživatel) k dispozici, musíme doplnit vhodnou strukturu pro uchování těchto informací. Ta je složena z následujících částí:</p><ul><li>Specifikace – množina dílčích kritérií, která specifikuje dostupnost odpovídajících instancí na úrovní konkrétního uživatele.</li><li>Kritérium – konkrétní podmínka, na základě které je vyhodnocována dostupnost jednotlivých instancí.</li></ul><p>Poznámka: Úplná struktura je v režii externího dodavatele. Tomu odpovídá i samotný popis chování.</p><h3>Specifikace</h3><p>Pro každého <a href="../../../datove-modely/datovy-88033012.html">Uživatele</a>, u kterého chceme omezit dostupné informace, musíme vytvořit odpovídající záznam se specifikací dostupných dat. K tomu slouží v tabulce uvedená struktura.</p><p>Poznámka: Pro jednoho <a href="../../../datove-modely/datovy-88033012.html">Uživatele</a> může být vytvořeno 0..N specifikací.</p><table><tbody><tr><th>Parametr</th><th>Popis</th><th>Poznámka</th></tr><tr><td>Uživatel</td><td>Konkrétní <a href="../../../datove-modely/datovy-88033012.html">Uživatel</a>, pro kterého je specifikace dostupných instancí vytvořena.</td><td>K jednomu uživateli může existovat i více specifikací (mezi nimi použit operátor OR).</td></tr><tr><td>Kritéria</td><td>Množina dílčích kritérií, která jsou v rámci konkrétní specifikace vyhodnocována (mezi jednotlivými kritérii je použit operátor AND).</td><td><p>Každé kritérium je pak uvedeno včetně konkrétní hodnoty, podle které je podmínka vyhodnocována.</p></td></tr></tbody></table><h3>Kritérium</h3><p>V rámci každé specifikace je nutné určit, jakým způsobem budou data omezena. K tomu slouží jednotlivá kritéria přímo omezující dostupné informace. Struktura konkrétního kritéria je uvedena v tabulce. </p><table><tbody><tr><th>Parametr</th><th>Popis</th><th>Poznámka</th></tr><tr><td>Název</td><td>Název slouží k identifikaci kritéria při jeho použití v rámci konkrétní specifikace.</td><td>–</td></tr><tr><td>Entita</td><td>Konkrétní entita, podle které budou omezována dostupná data.</td><td>Filtrujeme <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádoby k položce objednávky</a> např. dle atributu přiřazené <a href="../../../datove-modely/datovy-88033012.html">Nádoby</a>.</td></tr><tr><td colspan="1">Dotaz</td><td colspan="1">Předpis, podle kterého jsou záznamy filtrovány.</td><td colspan="1">Jednotlivé hodnoty, podle kterých je filtrováno, jsou určeny až v rámci konkrétní specifikace.</td></tr><tr><td colspan="1">Parametry</td><td colspan="1">Parametry dotazu, které jsou specifikovány v rámci konkrétní specifikace.</td><td colspan="1">–</td></tr></tbody></table><p>Aktuálně pak máme k dispozici následující dílčí kritéria.</p><table><tbody><tr><th>Název</th><th colspan="1">Entita</th><th>Dotaz</th><th>Parametry</th></tr><tr><td colspan="1">Skupina odpadu nádoby</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Skupina odpadu</a></td><td colspan="1"><p><a href="../../../datove-modely/datovy-88033012.html">Skupina odpadu</a> je rovna jedné z dostupný hodnot (parametr Skupiny odpadu) – atribut Skupina odpadu entity <a href="../../../datove-modely/datovy-88033012.html">Nádoba</a> – atribut Nádoba entity <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádoby k položce objednávky</a>.</p><ul><li>Pokud není <a href="../../../datove-modely/datovy-88033012.html">Skupina odpadu</a> k dispozici, není podmínka splněna.</li></ul><p><em>Zkrácený zápis: <a href="../../../datove-modely/datovy-88033012.html">Skupina odpadu</a>-<a href="../../../datove-modely/datovy-88033012.html">Nádoba</a>-<a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádoby k položce objednávky</a>.</em></p></td><td colspan="1"><ul><li>Skupiny odpadu: Výčet požadovaných <a href="../../../datove-modely/datovy-88033012.html">Skupin odpadu</a> (v rámci specifikace uveden přímo interní identifikátor instance).</li></ul></td></tr><tr><td>Číslo objednávky</td><td colspan="1"><a href="../../../datove-modely/datovy-88033012.html">Objednávka</a></td><td><p><a href="../../../datove-modely/datovy-88033012.html">Objednávka</a> je rovna jedné z dostupných hodnot (parametr Čísla objednávek) – atribut Objednávka entity <a href="../../../datove-modely/datovy-88033012.html">Položka objednávky</a> – atribut Položka objednávky entity <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádoby k položce objednávky</a>.</p><p><em>Zkrácený zápis: <a href="../../../datove-modely/datovy-88033012.html">Objednávka</a>-<a href="../../../datove-modely/datovy-88033012.html">Položka objednávky</a>-<a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádoby k položce objednávky</a>.</em></p></td><td><ul><li>Čísla objednávek: Výčet požadovaných <a href="../../../datove-modely/datovy-88033012.html">Objednávek</a> (v rámci specifikace uveden přímo interní identifikátor instance).</li></ul></td></tr></tbody></table><h2>Specifikace dostupných instancí</h2><p>Dostupnost konkrétních záznamů je vyhodnocována na základě specifikace, která se u každého externího zákazníka může lišit. My si nyní popíšeme postup, jakým je odpovídající uživatel připraven (od vytvoření uživatele po nastavení omezujících kritérií).</p><p>Poznámka: Specifikace externích zákazníků je uvedena samostatně, liší se totiž dle konkrétního nasazení aplikace.</p><ol><li><strong>Založení uživatele</strong> – v první řadě je nutné vytvořit samotného uživatele, pomocí kterého se bude externí zákazník přihlašovat do aplikace. Tato akce se skládá z několika kroků:<br><ol><li>založení uživatele,</li><li>nastavení jeho oprávnění (ideálně přiřazení do odpovídající role, viz <a href="#" data-page-title="Nastavení uživatelů a rolí"></a>),</li><li>přiřazení organizační složky (resp. složek),</li><li><em> přiřazení dostupných reportů a tiskových sestav (zatím není implementováno).</em></li></ol></li><li><strong>Specifikace dostupných instancí</strong> – následně můžeme určit, jaká data bude mít externí zákazník k dispozici:<br><ul><li>Pro nastavení kritérií slouží speciální API, které na vstupu přijímá jak identifikátor konkrétního uživatele, tak specifikaci požadovaných kritérií.</li><li>Technický popis je uveden samostatně, viz <a href="#" data-page-title="Nádoby - Externí zákazníci">Nádoby - Externí zákazníci</a>.</li><li>Přehled jednotlivých externích zákazníků je uveden samostatně (viz <a href="#" data-page-title="Nastavení uživatelů a rolí"></a>).</li></ul></li><li><strong>Kontrola provedených akcí</strong> – v závěru je vhodné provést kontrolu vytvořeného uživatele:<br><ul><li>uživatel se přihlásí do aplikace,</li><li>uživatel má k dispozici jen povolené moduly,</li><li>uživatel může spouštět jen povolené akce,</li><li>uživatel vidí jen zpřístupněné záznamy.</li></ul></li><li><strong>Předání přihlašovacích údajů</strong> – nakonec předáme přihlašovací údaje externímu zákazníkovi. S tím souvisí dále uvedené poznámky:<br><ul><li><em> Uživatel je instruován, aby provedl změnu vygenerovaného hesla (zatím není implementováno; viz <a href="#" data-page-title="Rozvojové požadavky"></a>, bod 115). Je možné provést ve FLWW2.</em></li><li>Může být vyžadováno použití VPN přístupu (to již není v kompetenci Radium).</li></ul></li></ol><p>V rámci kroku 2 je prováděna specifikace dat, která jsou dostupná externímu zákazníkovi (odpovídajícímu uživateli). My si zde ukážeme, jakým způsobem postupovat při volání odpovídajícího API. Vstupní parametry volání budou následující:</p><ul><li>Uživatel: <strong>novak.p</strong></li><li>Kritéria:<br><ul><li>Skupina odpadu nádoby: <strong>Komunální odpad</strong>, <strong>Plasty</strong></li><li>Číslo objednávky: <strong>20220018</strong></li></ul></li></ul><p>Použijeme pak volání typu <strong>POST: </strong><strong>{{url}}/containerExternalCustomersAdvancedFilters</strong>, vstupní parametry jsou předány v těle dotazu. Jeho ukázka je uvedena následně (použité hodnoty interních identifikátorů jsou pouze ilustrativní).</p><p>Poznámka: Část s URL může pro konkrétní volání vypadat např. takto: <strong>https://mpg-pptest.fleetwareweb.eu/apiBackend/api</strong>.</p>truecsharp1<p>Poznámka: Pokud chceme provedená nastavení zrušit, můžeme použít metodu typu <strong>DELETE: {{url}}/containerExternalCustomersAdvancedFilters</strong>. Ta je volána na úrovni jednotlivých uživatelů, kdy je odpovídající uživatel předán jako parametr URL (<strong>userId</strong>). Ukázka volání je uvedena následně:</p><ul><li>{{url}}/containerExternalCustomersAdvancedFilters?userId=18944</li></ul><h1>Alternativní toky událostí</h1><p>–</p><h1>Výjimkové toky událostí</h1><p>–</p><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Byl předán výsledný dotaz specifikující množinu dostupných <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádob k položkám objednávek</a>, kterou má konkrétní externí zákazník (resp. odpovídající uživatel) k dispozici.</p><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Výsledný dotaz</td><td colspan="1">– </td><td colspan="1">Ne</td><td colspan="1"><p>Dotaz specifikující množinu dostupných <a href="../../../datove-modely/datovy-88033012.html">Přiřazení nádob k položkám objednávek</a> pro konkrétního externího zákazníka (resp. uživatele).</p></td><td colspan="1">Dle výsledného dotazu mohou být filtrována související data.</td></tr></tbody></table><h1>Algoritmy</h1><p>–</p><h1>Validace</h1><p>–</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h2>16. 12. 2022: Tomáš Nadrchal</h2><table><tbody><tr><th>Odkaz</div></div></div></div></div></th><th>Stručný popis změny</div></div></div></div></div></th></tr><tr><td colspan="1"><a href="400uc18-97652690.html">Základní tok událostí</a></td><td colspan="1">Revize popisu chování – nově ve vazbě na entitu <a href="../../../datove-modely/datovy-88033012.html">Nastavení externího zákazníka</a> (naznačeno modře), viz změnové požadavky <strong>č. 127</strong> (viz <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=89066925">Rozvojové požadavky</a>). Chování jako takové bylo zachováno.</td></tr></tbody></table>
</div>
</body>
</html>
