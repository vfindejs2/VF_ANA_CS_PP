<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>WinyxUC09: Synchronizovat řádky smluv</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je import dávky řádků smluv z DB rozhraní WinyX. Odpovídající entitou v Pasportu je <a href="../../datove-modely/datovy-88033012.html">Položka objednávky</a>.</p><p>Poznámka: V kompetenci UC je jen synchronizace entity <a href="../../datove-modely/datovy-88033012.html">Položka objednávky</a>., věcný obsah řádků smluv je předáván v rámci <a href="#" data-page-title="WinyxUC10: Synchronizovat pořadí řádků smluv"></a>. </p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">Systém spouští tento UC nepřímo spuštěním jiných UC.</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Případ užití je spouštěn v rámci <a href="#" data-page-title="WinyxUC01: Zahájit synchronizaci">WinyxUC01: Zahájit synchronizaci</a>.</p><h2>Vstupní podmínky</h2><p>Nejsou.</p><h2>Vstupní data</h2><p>Relevantní data entity ContractItem, která jsou načtená z DB rozhraní Winyx.</p><h1>Základní tok událostí</h1><ol><li>Systém provede kontolu vstupních dat dle <a href="winyxuc09-93592940.html">VAL01: Validace vstupních dat</a> (<a href="winyxuc09-93592940.html">EF01: Nevalidní vstupní data</a>).</li><li>Systém takto připravené záznamy předá na rozhraní pro synchronizaci dat aplikace Pasport - zavolá <a href="#" data-page-title="200UC10: Synchronizovat položku objednávky"></a>. Na vstupu jsou předány tyto informace:<br><ul><li>Data připravená dle <a href="winyxuc09-93592940.html">ALG01: Příprava vstupních dat</a>.<br><ul><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Položky objednávky</a>.</li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Objednávky</a></li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Provozovn</a>y.</li><li>Číslo položky objednávky entity <a href="../../datove-modely/datovy-88033012.html">Položka objednávky</a>. </li><li>Je aktivní.</li></ul></li><li>Zdroj změny: Synchronizace (viz <a href="../../datove-modely/datovy-88033012.html">Zdroj změny</a>)<em>.</em></li></ul></li><li>Systém zapíše do logu informaci o průběhu přenosu. V logu jsou uložena data:<br><ul><li>Datum a čas volání.</li><li>Plná data odchozího požadavku.</li><li>Návratový kód.</li><li>Případná chybová zpráva.</li></ul></li></ol><h1>Alternativní toky události</h1><p>Nejsou.</p><h1>Výjimkové toky událostí</h1><h3>EF01: Nevalidní vstupní data</h3><ol><li>Systém zaloguje informaci o nevalidních vstupních datech:<br><ul><li>Datum a čas.</li><li>Typ entity.</li><li>Identifikace záznamu.</li><li>Typ nalezené chyby.</li></ul></li><li>Systém daný záznam přeskočí a pokračuje ve zpracování.</li></ol><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Proběhlo předání záznamů na rozhraní pro synchronizaci dat. </p><h2>Výstupní data</h2><p>Průběh přenosu byl zalogován.</p><h1>Algoritmy</h1><h2>ALG01: Příprava vstupních dat</h2><p>Objekt předávaný na synchronizační API aplikace Pasport je sestavený z dat na DB rozhraní (viz <a href="../synchronizace-93257926.html">Definice rozhraní</a>) dle níže uvedeného mapování.</p><p>Odpovídající entitou Pasport je <a href="../../datove-modely/datovy-88033012.html">Položka objednávky</a>. Povinnost, datový typ a rozsah jsou uvedeny v datovém slovníku.</p><p>Protože ve WinyX existuje k řádku smluv obecně N pořadí řádků smluv, jsou data nejprve seskupena (GROUP BY) dle atributů Id, CustomerContractId, ContractSubjectTypeId, OrganizationalUnitId, MAX(Sequence).</p><p>Pozor: Maximální pořadí řádku smlouvy tedy řídí podobu dat v řádku smlouvy včetně jeho aktivity! (Případně pravidlo upravit dle zkušeností z pilotního provozu.)</p><table><tbody><tr><th>Atribut DB rozhraní</th><th colspan="1">Primární klíč</th><th>Atribut na vstupu</th><th>Poznámka</th></tr><tr><td><p>ContractItem.Id</p><p>ContractItem.ContractSubjectTypeId</p></td><td colspan="1"></td><td><p>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Položky objednávky</a>.</p></td><td><p>Externí identifikátor je klíč složený z uvedených atributů</p></td></tr><tr><td>ContractItem.CustomerContractId</td><td colspan="1"></td><td><p>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Objednávky</a></p></td><td>Hodnota je využívána k dohledání reference na Objednávku entity <a href="../../datove-modely/datovy-88033012.html">Položka objednávky</a>.</td></tr><tr><td colspan="1">ContractItem.OrganizationalUnitId</td><td colspan="1"></td><td colspan="1"><p>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Provozovny</a>.</p></td><td colspan="1">Hodnota je využívána k dohledání reference na Objednávku entity <a href="../../datove-modely/datovy-88033012.html">Položka objednávky</a>.</td></tr><tr><td colspan="1"><p>ContractItem.Id</p><p>ContractItem.ContractSubjectTypeId</p></td><td colspan="1"> </td><td colspan="1">Číslo položky objednávky</td><td colspan="1"><p>Hodnota složená z uvedených atributů dle <a href="winyxuc09-93592940.html">ALG02: Sestava čísla položky objednávky</a>.</p><p>Jedná se o atribut zobrazovaný v uživatelském rozhraní, způsob jeho sestavy je pevně daný.</p></td></tr><tr><td>ContractItem.Status</td><td colspan="1"> </td><td>Je aktivní</td><td> Hodnota atributu řídí, zda se bude jednat o založení/úpravu či o odebrání záznamu.</td></tr></tbody></table><h2>ALG02: Sestava čísla položky objednávky</h2><p>V konfiguraci synchronizace z WinyX existuje mapování, podle kterého je přidělen krátký kód k Id Typu předmětu smlouvy:</p><ul><li>ContractSubjectType.Id (např. 4)</li><li>Kód předmětu smlouvy (např. PR)</li></ul><p>Externí identifikátor je klíč složený z uvedených atributů rozhraní takto: [Kód předmětu smlouvy]:[ContractItem.Id]. Např. "PRI:1234".</p><h3>Hodnoty číselníku</h3><table><tbody><tr><th>ContractSubjectType.Id</th><th>Kód předmětu smlouvy</th></tr><tr><td><p>1</p></td><td>KOM</td></tr><tr><td>2</td><td>PRI</td></tr><tr><td>3</td><td>PRE</td></tr><tr><td>4</td><td>OST</td></tr><tr><td>5</td><td>NAK</td></tr><tr><td>6</td><td>PRE</td></tr><tr><td>7</td><td>VYK</td></tr></tbody></table><p>Poznámky:</p><ul><li> Číselník Typů předmětů smluv je v podstatě statický a nemění se. Pokud by ke změně mělo docházet, bude procesně zajištěno, aby zákazník změnu v předstihu nahlásil a dojde k úpravě konfigurace.</li><li>Nebude možné zpětně měnit Kód předmětu smlouvy.</li><li>Pokud k položce číselniku neexistuje Kód předmětu smlouvy v konfiguraci, nejsou příslušné položky objednávky vytovřeny, import záznamu končí chybou.</li></ul><h1>Validace</h1><h2>VAL01: Validace vstupních dat</h2><ul><li>Všechny povinné položky jsou vyplněny.</li><li>Vyplněné položky jsou správného datového typu a v povoleném rozsahu.</li><li>V konfiguraci synchronizační služby existuje mapování ContractItem.ContractSubjectTypeId na Kód typu předmětu smlouvy.</li></ul><h1>Revize</h1><h2>27. 7. 2021: Miroslav Slivoně</h2><table><tbody><tr><th>Odkaz</th><th>Stručný popis změny</th></tr><tr><td colspan="1"><p><a href="winyxuc09-93592940.html">ALG01: Příprava vstupních dat</a></p></td><td colspan="1">Upřesnění práce s agregací pořadí řádků smluv.</td></tr></tbody></table>
</div>
</body>
</html>
