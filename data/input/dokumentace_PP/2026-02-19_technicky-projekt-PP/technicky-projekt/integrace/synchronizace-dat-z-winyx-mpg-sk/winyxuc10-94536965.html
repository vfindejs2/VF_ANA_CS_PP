<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>WinyxUC10: Synchronizovat pořadí řádků smluv</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je import dávky řádků smluv z DB rozhraní WinyX. Odpovídající entitou v Pasportu je <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</p><p>Poznámka: V kompetenci UC je synchronizace věcného obsahu řádků smluv, který odpovídá <a href="../../datove-modely/datovy-88033012.html">Revizi položky objednávky</a>. Existuje také <a href="#" data-page-title="WinyxUC09: Synchronizovat řádky smluv"></a> zajišťující vytvoření <a href="../../datove-modely/datovy-88033012.html">Položky objednávky</a>.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">Systém spouští tento UC nepřímo spuštěním jiných UC.</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Přehled aktérů"></a>.</p><h1>Spuštění případů užití</h1><p>Případ užití je spouštěn v rámci <a href="#" data-page-title="WinyxUC01: Zahájit synchronizaci">WinyxUC01: Zahájit synchronizaci</a>.</p><h2>Vstupní podmínky</h2><p>Nejsou.</p><h2>Vstupní data</h2><p>Relevantní data entity ContractItem načtená z DB rozhraní Winyx.</p><h1>Základní tok událostí</h1><ol><li>Systém provede kontolu vstupních dat dle <a href="winyxuc10-94536965.html">VAL01: Validace vstupních dat</a> (<a href="winyxuc10-94536965.html">EF01: Nevalidní vstupní data</a>)</li><li>Systém takto připravené záznamy předá na rozhraní pro synchronizaci dat aplikace Pasport - zavolá <a href="#" data-page-title="200UC26: Synchronizovat revizi položky objednávky"></a>. Na vstupu jsou předány tyto informace: <br><ul><li>Data připravená dle <a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a>:<br><ul><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a></li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Položky objednávky</a>.</li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Objednávky</a></li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Provozovny</a>.</li><li>Platnost od</li><li>Platnost do</li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Adres</a>y</li><li>Počet nádob</li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Typu nádoby</a></li><li>Vlastnictví nádoby</li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Druhu odpadu</a></li><li>Externí identifikátor  <a href="../../datove-modely/datovy-88033012.html">Frekvence vývozu</a></li><li>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Základní dny svozu</a></li><li>Poplatník</li><li>Poznámka</li><li>Poznámka 2</li><li>Poznámka 3</li><li>Je aktivní (Viz také <a href="winyxuc10-94536965.html">ALG02: Ošetření záznamů s nevalidní platností</a>)</li></ul></li><li>Zdroj změny: Synchronizace (viz <a href="../../datove-modely/datovy-88033012.html">Zdroj změny</a>)<em>.</em></li></ul></li><li>Systém zapíše do logu informaci o průběhu přenosu. V logu jsou uložena data:<br><ul><li>Datum a čas volání.</li><li>Plná data odchozího požadavku.</li><li>Návratový kód.</li><li>Případná chybová zpráva.</li></ul></li></ol><h1>Alternativní toky události</h1><p>Nejsou.</p><h1>Výjimkové toky událostí</h1><h3>EF01: Nevalidní vstupní data</h3><ol><li>Systém zaloguje informaci o nevalidních vstupních datech:<br><ul><li>Datum a čas.</li><li>Typ entity.</li><li>Identifikace záznamu.</li><li>Typ nalezené chyby.</li></ul></li><li>Systém daný záznam přeskočí a pokračuje ve zpracování.</li></ol><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Proběhlo předání záznamů na rozhraní pro synchronizaci dat. </p><h2>Výstupní data</h2><p>Průběh přenosu byl zalogován.</p><h1>Algoritmy</h1><h2>ALG01: Příprava vstupních dat</h2><p>Objekt předávaný na synchronizační API aplikace Pasport je sestavený z dat na DB rozhraní (viz <a href="../synchronizace-93257926.html">Definice rozhraní</a>) dle níže uvedeného mapování.</p><p>Odpovídající entitou Pasport je <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>. Povinnost, datový typ a rozsah jsou uvedeny v datovém slovníku.</p><table><tbody><tr><th>Atributy DB rozhraní</th><th colspan="1">Primární klíč</th><th>Atribut na vstupu</th><th>Poznámka</th></tr><tr><td>ContractItem.Sequence</td><td></td><td>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a></td><td> </td></tr><tr><td><p>ContractItem.Id</p><p>ContractItem.ContractSubjectTypeId</p></td><td colspan="1"></td><td>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Položky objednávky</a>.</td><td><p>Externí identifikátor je klíč složený z uvedených atributů</p><p>Hodnota je využívána k dohledání reference na Položku objednávky entity <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</p></td></tr><tr><td>ContractItem.CustomerContractId</td><td></td><td>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Objednávky</a></td><td>Hodnota je využívána k dohledání reference na Položku objednávky entity <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</td></tr><tr><td colspan="1">ContractItem.OrganizationalUnitId</td><td colspan="1"></td><td colspan="1">Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Provozovny</a>.</td><td colspan="1">Hodnota je využívána k dohledání reference na Položku objednávky entity <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</td></tr><tr><td colspan="1">ContractItem.ValidFrom</td><td colspan="1"> </td><td colspan="1">Platnost od</td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem.ValidTo</td><td colspan="1"> </td><td colspan="1">Platnost do</td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem.CustomerSiteId</td><td colspan="1"> </td><td colspan="1">Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Adres</a>y</td><td colspan="1"><p>Hodnota je využívána k dohledání reference na Adresu místa realizace entity <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</p><p>Pozor, ContractItem.CustomerSiteId odkazuje přímo na Address.Id.</p></td></tr><tr><td colspan="1">ContractItem.ContainerCount</td><td colspan="1"> </td><td colspan="1">Počet nádob</td><td colspan="1">Počet nádob může být desetinné číslo.</td></tr><tr><td colspan="1"><p>ContractItem.ContainerTypeId</p><p>ContractItem.ContainerTypeOrganizationalUnitId</p></td><td colspan="1"> </td><td colspan="1"><p>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Typu nádoby</a></p></td><td colspan="1"><p>Externí identifikátor k typu nádoby je složený z uvedených atributů rozhraní.</p><p>Hodnota je využívána k dohledání reference na Typ nádoby entity <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</p></td></tr><tr><td colspan="1">ContractItem.IsOwnProperty</td><td colspan="1"> </td><td colspan="1">Vlastnictví nádoby</td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem.WasteTypeId</td><td colspan="1"> </td><td colspan="1"><p>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Druhu odpadu</a></p></td><td colspan="1"> </td></tr><tr><td colspan="1"><p>ContractItem.CollectionFrequencyId</p><p>ContractItem.CollectionFrequencyOrganizationalUnitId</p></td><td colspan="1"> </td><td colspan="1"><p>Externí identifikátor  <a href="../../datove-modely/datovy-88033012.html">Frekvence vývozu</a></p></td><td colspan="1"><p>Externí identifikátor k frekvenci výzozu je složený z uvedených atributů rozhraní.</p><p>Hodnota je využívána k dohledání reference na Frekvenci vývozu entity <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</p></td></tr><tr><td colspan="1"><p>ContractItem.CollectionDaysOfWeekId</p><p>ContractItem.CollectionDaysOfWeekOrganizationalUnitId</p></td><td colspan="1"> </td><td colspan="1"><p>–</p><p>Externí identifikátor <a href="../../datove-modely/datovy-88033012.html">Základní dny svozu</a></p></td><td colspan="1"><p><a href="../../datove-modely/datovy-88033012.html">Základní dny svozu</a> nejsou dále evidovány přímo na <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>. Nově s nimi pracujeme na úrovni vazební entity <a href="../../datove-modely/datovy-88033012.html">Přiřazení základních dní svozu k revizi položky objednávky</a> (viz <a href="winyxuc10-94536965.html">ALG03: Zpracování základních dní svozu</a>).</p><p>Externí identifikátor k základním dnům svozu je složený z uvedených atributů rozhraní.</p><p>Hodnota je využívána k dohledání reference na základní dny svozu entity <a href="../../datove-modely/datovy-88033012.html">Revize položky objednávky</a>.</p></td></tr><tr><td colspan="1">ContractItem.EndCustomer</td><td colspan="1"> </td><td colspan="1">Poplatník</td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem.NoteForDispatcher</td><td colspan="1"> </td><td colspan="1">Poznámka</td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem.ContainerPlacementNote</td><td colspan="1"> </td><td colspan="1">Poznámka 2</td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem.GeneralNote</td><td colspan="1"> </td><td colspan="1">Poznámka 3</td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem.Status</td><td colspan="1"> </td><td colspan="1">Je aktivní</td><td colspan="1"><p>Hodnota atributu řídí, zda se bude jednat o založení/úpravu či o odebrání záznamu.</p><p>Zohlednit <a href="winyxuc10-94536965.html">ALG02: Ošetření záznamů s nevalidní platností</a></p></td></tr></tbody></table><h2>ALG02: Ošetření záznamů s nevalidní platností</h2><p>V systému WinyX dochází z procesně-technických důvodů k situaci, kdy je při řízené změně pořadí řádku smlouvy nastavena Platnost do < Platnost od. Takové záznamy jsou z pohledu systému Pasport nevalidní a provedenou změnu nelze importovat standardním způsobem. Z tohoto důvodu existuje na úrovni synchronizace níže popsaný mechanismus, který zaručí zneplatnění takových záznamů v Pasportu.</p><ul><li>Pokud platí, že ContractItem.ValidTo < ContractItem.ValidFrom, pak:<br><ul><li>Je potřeby synchronizace uměle nastavena hodnota ContractItem.Status = 0.</li><li>Dojde k zneaktivnění záznamu.</li></ul></li></ul><h2>ALG03: Zpracování základních dní svozu</h2><p>Vzhledem ke změně struktury, ve které jsou evidovány <a href="../../datove-modely/datovy-88033012.html">Základní dny svozu</a>, je nutné upravit také způsob jejich synchronizace. Bude tedy prováděna transformace získaných informací do nové struktury…</p><ul><li>Na rozhraní systému WinyX získáváme přímo identifikaci konkrétního záznamu entity <a href="../../datove-modely/datovy-88033012.html">Základní dny svozu</a>.</li><li>Aplikace pak pracuje s vazební entitou <a href="../../datove-modely/datovy-88033012.html">Přiřazení základních dní svozu k revizi položky objednávky</a>.</li></ul><p>Postup zmíněné transformace si popíšeme.</p><ol><li>Pokud nejsou získány základní dny svozu – tedy není k dispozici hodnota pro alespoň jeden z atributů <strong>CollectionDaysOfWeekId</strong>, <strong>CollectionDaysOfWeekOrganizationalUnitId</strong> (viz <a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a>):<br><ol><li>Systém získá takovou <a href="../../datove-modely/datovy-88033012.html">Revizi položky objednávky</a>, která splňuje všechny dále uvedené podmínky zároveň:<ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá získanému klíči (viz <a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a>).</li></ul></li><li>Systém získá taková <a href="../../datove-modely/datovy-88033012.html">Přiřazení základních dní svozu k revizi položky objednávky</a>, která splňují všechny dále uvedené podmínky zároveň:<ul><li>Hodnota atributu <strong>Revize položky objednávky</strong> odpovídá získané <a href="../../datove-modely/datovy-88033012.html">Revizi položky objednávky</a> (viz krok <strong>1.a</strong>).</li><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.<br></li></ul></li><li>Pro všechna získaná <a href="../../datove-modely/datovy-88033012.html">Přiřazení základních dní svozu k revizi položky objednávky</a> (viz krok <strong>1.b</strong>) – systém spustí <a href="#" data-page-title="304UC25: Odebrat přiřazení základních dní svozu k revizi položky objednávky">304UC25: Odebrat přiřazení základních dní svozu k revizi položky objednávky</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Odebírané přiřazení základních dní svozu k revizi položky objednávky</strong>: právě zkoumané <a href="../../datove-modely/datovy-88033012.html">Přiřazení základních dní svozu k revizi položky objednávky</a>,</li><li><strong>Zdroj změny</strong>: předána hodnota <strong>Synchronizace</strong> (viz <a href="../../datove-modely/datovy-88033012.html">Zdroj změny</a>).</li></ul></li></ol></li><li>Jinak základní dny svozu získány jsou – systém provede jejich synchronizaci – spustí <a href="#" data-page-title="200UC32: Synchronizovat přiřazení základních dní svozu k revizi položky objednávky">200UC32: Synchronizovat přiřazení základních dní svozu k revizi položky objednávky</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Externí identifikátor</strong>: předána formátovaná hodnota…<br><ul><li>Formát: <strong><CollectionDaysOfWeekId>::<CollectionDaysOfWeekOrganizationalUnitId>::<strong><Sequence>::<Id>::<ContractSubjectTypeId>::<CustomerContractId>::<OrganizationalUnitId></strong></strong> (viz <a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a>).</li><li>Příklad: <strong>10::110::<strong>8::235::1::11010069::1115</strong></strong>.</li></ul></li><li><p><strong>Externí identifikátor revize položky objednávky</strong>: předána formátovaná hodnota…</p><ul><li><p>Formát: <strong><Sequence>::<Id>::<ContractSubjectTypeId>::<CustomerContractId>::<OrganizationalUnitId></strong> (viz <a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a>).</p></li><li><p>Příklad: <strong>8::235::1::11010069::1115</strong>.</p></li></ul></li><li><p><strong>Externí identifikátor základních dní svozu</strong>: předána formátovaná hodnota…</p><ul><li>Formát: <strong><CollectionDaysOfWeekId>::<CollectionDaysOfWeekOrganizationalUnitId></strong> (viz <a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a>).</li><li><p>Příklad: <strong>10::110</strong>.<br></p></li></ul></li><li><p><strong>Je aktivní</strong>: předána hodnota atributu <strong>Status</strong> (viz <a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a>).</p></li><li><p><strong>Zdroj změny</strong>: předána hodnota <strong>Synchronizace</strong> (viz <a href="../../datove-modely/datovy-88033012.html">Zdroj změny</a>)<em>.</em></p></li></ul></li></ol><h1>Validace</h1><h2>VAL01: Validace vstupních dat</h2><ul><li>Všechny povinné položky jsou vyplněny.</li><li>Vyplněné položky jsou správného datového typu a v povoleném rozsahu.</li></ul><h1>Revize</h1><h2>18. 11. 2024: Tomáš Nadrchal</h2><table><tbody><tr><th>Odkaz</div></div></div></th><th>Stručný popis změny</div></div></div></th></tr><tr><td colspan="1"><a href="winyxuc10-94536965.html">Základní tok událostí</a></td><td colspan="1">Revize způsobu zpracování základních dní svozu (naznačeno modře).</td></tr><tr><td colspan="1"><a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a></td><td colspan="1">Revize způsobu zpracování základních dní svozu (naznačeno modře).</td></tr><tr><td colspan="1"><a href="winyxuc10-94536965.html">ALG03: Zpracování základních dní svozu</a></td><td colspan="1">Doplněn algoritmus pro zpracování základních dní svozu (naznačeno modře).</td></tr></tbody></table><h2>27. 7. 2021: Miroslav Slivoně</h2><table><tbody><tr><th>Odkaz</th><th>Stručný popis změny</th></tr><tr><td colspan="1"><p><a href="winyxuc10-94536965.html">ALG02: Zneplatnění záznamů s nevalidní platností</a></p></td><td colspan="1">Doplnění mechanismu ošetřujícího záznamy s nevalidní platností.</td></tr></tbody></table><h2>19. 8. 2021: Miroslav Slivoně</h2><table><tbody><tr><th>Odkaz</th><th>Stručný popis změny</th></tr><tr><td colspan="1"><p><a href="winyxuc10-94536965.html">ALG01: Příprava vstupních dat</a></p></td><td colspan="1">Upraveno mapování, na rozhraní s WinyX se totiž ContractItem.CustomerSiteId odkazuje přímo na adresu.</td></tr></tbody></table>
</div>
</body>
</html>
