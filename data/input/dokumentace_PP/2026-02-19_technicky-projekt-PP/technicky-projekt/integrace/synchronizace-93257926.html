<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Synchronizace dat z WinyX (MPG SK)</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Úvod</h1><p>Jedná se o živý dokument, které je průběžně v rámci návrhu integračního rozhraní doplňován.</p><p>Dokument popisuje integraci Fleetware Pasport na systém Winyx u zákazníka MPG SK. Půjde o rozšíření existujícího DB rozhraní s Winyx, které již slouží pro potřeby RoadPlan a Fleetware. </p><p>V řešené etapě projektu se bude se jednat o výměnu dat směrem WinyX → Pasport.</p><p>Protože zákazník eviduje část údajů mimo systém WinyX (typicky Excelové soubory), je součástí integračního projektu i posouzení možností převést tato data do systému Pasport.</p><p>Předpokládáme, že implementace rozhraní bude mít následující fáze:</p><ol><li><a href="#" data-page-title="Iniciální importy">Iniciální importy</a>. Součástí mohou být jednorázové převody dat, které byly dosud evidovány ve WinyX (případně v Excel souborech) a nově budou spravovány v Pasport.</li><li>Standardní běh rozhraní popsaný níže.</li></ol><h1>Otevřené body</h1><table><tbody><tr><th colspan="1">#</th><th>Otevřený bod</th><th>Řešení</th><th>Řešitel</th><th>Stav</th></tr><tr><td colspan="1">1</td><td colspan="1">Zajištění návaznosti řádků smluv při jejich změnách.</td><td colspan="1"><p>Nutno používat řízenou změnu, kdy jsou řádky "verzovány" pomocí atributu Pořadí řádku smlouvy.</p><p>MPG ošetří procesně. V případě nedodržení procesu nejsou v Pasport návaznosti zachovány.</p></td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">2</td><td>Struktura řádku smlouvy.</td><td>Bylo vyjasněno v průběhu workshopů. Finální struktrura zaznamenána níže v návrhu.</td><td>MPG</td><td><p>Uzavřená </p></td></tr><tr><td colspan="1">3</td><td>Vztah smlouva - podsmlouva?</td><td>Není pro Pasport relevantní. S podsmlouvami nebude pracováno, používají se jen k fakturaci.</td><td>MPG</td><td>Uzavřená </td></tr><tr><td colspan="1">4</td><td colspan="1"><p>Práce s typem předmětu smlouvy.</p><p>Je tento údaj pro Pasport relevantní? Bude nutné importovat různé předměty smluv? Jaké?</p></td><td colspan="1"><p>Do Pasportu budou importovány smlouvy s různými předměty. Atribut jako takový není z pohledu Pasport relevantní.</p><p>V případě řádku smlouvy je atribut "Typ předmětu smlouvy" jednou z položek, které určují jedinečnost záznamu.</p></td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">5</td><td colspan="1"><p>Využijeme existující tabulky využívané pro RoadPlan?</p><p>Důsledek: Nutno doplnit rozlišení relevance pro RP/Pasport, upravit synchronizaci RP.</p></td><td colspan="1"><p>Návrh RAD:</p><ul><li>Druh nádoby - doplněn atribut ApplicationArea. RP nově importuje pouze položky s hodnotu "e-dispečink". PAS importuje předem dohodnuté položky (konfigurace importu).<br><ul><li>MPG určí, jaké hodnoty budou relevantní pro PAS.</li></ul></li><li>Provozovna - beze změny.</li><li>Zákazník - beze změny, importovány všechny položky do obou aplikací.</li><li>Adresa - beze změny, importováno jen v případě použití na jiné entitě (např. Místo realizace, Zákazník).</li><li>Druh odpadu - beze změny, importovány všechny položky do obou aplikací.</li><li>Smlouva - doplněny nové atributy, i nadále společná tabulka pro PP a RP. Již nyní tabulka obsahuje všechny smlouvy, tj. rozsah dat se pro RP nemění.</li></ul></td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">6</td><td><p>Budeme v této etapě projektu pracovat s entitou Trasa?</p><p>Aktuálně aplikace Pasport údaj nevyužije, navyšuje se tím scope integrace s Winyx.</p></td><td><p>Ne.</p><p>Na rozhraní nicméně mohou být od BC Logia data exportována pro pozdější využití v rámci RoadPlan Svoz.</p></td><td>MPG</td><td>Uzavřená </td></tr><tr><td colspan="1">7</td><td colspan="1"><p>Budou se importovat Nádoby?</p><p>Jedná se o údaje v kompetenci aplikace Pasport, ale iniciální import může dávat smysl.</p></td><td colspan="1"><p>Na rozhraní bude vystavena tabulka pro import nádob, kam WinyX předá nádoby, které je žádoucí naimportovat.</p><p>Bude závisieť od konkrétnej prevádzky a typu zákazníka (mesto/obec). Bude potrebné podrobnejšie prediskutovať.</p><p>Pracovní předpoklad: Budou předány nádoby evidované ke stanovišti, které má příznak "V trase".</p><p>Některé nádoby budou importovány z Excel evidencí - viz #11.</p></td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">8</td><td colspan="1"><p>Budou se importovat Stanoviště pro umístění Nádob?</p><p>Jedná se o údaje v kompetenci aplikace Pasport, ale iniciální import může dávat smysl.</p><p>Poznámka: Pasport v současnosti nemá přímou vazbu Položka objednávky - Stanoviště.</p></td><td colspan="1"><p>Na rozhraní bude vystavena tabulka pro import stanovišť, kam WinyX předá stanoviště, které je žádoucí naimportovat.</p><p>Bude závisieť od konkrétnej prevádzky a typu zákazníka (mesto/obec). Bude potrebné podrobnejšie prediskutovať. Vo winyx je jeden riadok, jedna nádoba = stanovisko.</p><p>Pracovní předpoklad: Budou předána stanoviště, které mají příznak "V trase". (Taková jsou zadaná přesněji.)</p><p>Některé stanoviště budou importována z Excel evidencí - viz #11.<br></p></td><td colspan="1"> MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">9</td><td colspan="1"><p>Budou mít některá importovaná data z WinyX příznak neověřeného záznamu?</p><p>Pokud ano, jaká (nádoby, případně stanoviště)?</p></td><td colspan="1"><p>Tato možnost bude existovat, na rozhraní přidáme na Nádobu příznak, který odpovídá datové struktuře ověřování záznamů.</p><p>Je na MPG, jak se v rámci pokračování integračního projektu rozhodne příznak plnit.</p><p>Aktualizace: Ověřování záznamů bude podporováno jen pro data zadaná z mobilní aplikace.</p></td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">10</td><td colspan="1">Struktura číselníku Frekvence vývozu</td><td colspan="1">MPG poslalo příklad dat: ID, Název, Popis, Skupina frekvencí (= další popis), Text na faktuře.</td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">11</td><td colspan="1">Import dat z jiných datových zdrojů.</td><td colspan="1"><p>MPG navrhne rozsah dat - východisko pro standardní importní formát. Viz .</p><ul><li><ul><li>Nebude používán atribut "počet ks", na řádku bude vždy jednotlivá nádoba.</li><li>RAD upraví datový model, aby bylo možné k nádobě zaevidovat "poplatníka" bez existence vazby na řádek smlouvy.</li></ul></li></ul><p>RAD navrhne proces zpracování takových dat, dále bude řešeno dle aktuální potřeby.</p></td><td colspan="1">MPG + RAD</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">12</td><td colspan="1"><p>Bude Pasport pracovat s číselníkem adres?</p><p>Závisí na rozsahu dat přenášených z Pasport do WinyX (přenos Stanovišť do WinyX).</p></td><td colspan="1"><p>V této etapě ne.</p></td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">13</td><td colspan="1"><p>Bude možné namapovat vzory a kategorie nádob při importu z WinyX?</p></td><td colspan="1"><p>MPG poskytlo číselník  (s tím, že lze vytvořit základní kategorie nádob s příznakem, že jsou určeny pro Pasport).</p><p>Pro potřeby namapování ContainerTypeId na vzor, kategorii a WasteTypeId na skupinu odpadu vznikne převodník - součást konfigurace importu.</p><ul><li><ul><li>Prerekvizitou pro vznik převodní tabulky je návrh vzorů, kategorií a skupin odpadu od MPG.</li></ul></li></ul></td><td colspan="1">MPG + RAD</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">14</td><td colspan="1">Budou přenášena nějaká data ve směru Pasport → WinyX?</td><td colspan="1">V současné etapě řešit nebudeme.</td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">15</td><td colspan="1">Dochází ke sdílení Stanovišť mezi řádky smlouvy?</td><td colspan="1"><p>Jedno identické stanoviště (stejné ID) se může objevit na více řádcích smlouvy.</p><p>Dochází k tomu spíše výjimečně. V datech jsou duplicitní stanoviště (stejná adresa, ale různá ID).</p></td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr><tr><td colspan="1">16</td><td colspan="1">Lze přibližně určit počet řádků smluv, které budou na rozhraní přeneseny?</td><td colspan="1">Řádků smluv budou cca statisíce.</td><td colspan="1">MPG</td><td colspan="1">Uzavřená </td></tr></tbody></table><h1>Transportované entity</h1><p>Před samotným návrhem integračního rozhraní je nezbytné identifikovat, jaké hlavní entity figurují v obou systémech a který systém bude pro danou entitu primární ("zdroj pravdy").</p><p>V současném rozsahu integrace je uvažováno výhraně s importem dat z WinyX do Fleetware Pasport.</p><p><img src="synchronizace-dat-z-winyx-mpg-sk-93257926_images/image2021-3-19 14-6-57.png" data-attachment="true"></p><p> </p><table><tbody><tr><th>Entita</th><th colspan="1">Primární systém</th><th><p>Synchronizace</p></th><th>Směr</th><th>Komentáře</th></tr><tr><td colspan="1">Provozovna</td><td colspan="1">Není</td><td colspan="1">Ne</td><td colspan="1"> </td><td colspan="1">Číselník Provozoven je udržován v obou systémech (WinyX, Fleetware), položky jsou provázané pomocí externího ID zadaného ve Fleetware.</td></tr><tr><td colspan="1">Zákazník</td><td colspan="1">WinyX</td><td colspan="1">Ano</td><td colspan="1">Winyx → Pasp</td><td colspan="1"> </td></tr><tr><td>Smlouva</td><td colspan="1">WinyX</td><td>Ano</td><td>Winyx → Pasp</td><td><p>Bude se dále rozpadnout na další entity (adresy, číselníky apod).</p></td></tr><tr><td colspan="1">Řádek smlouvy</td><td colspan="1">WinyX</td><td colspan="1">Ano</td><td colspan="1">Winyx → Pasp</td><td colspan="1"><p> </p></td></tr><tr><td>Typ nádoby</td><td colspan="1">WinyX</td><td>Ano</td><td>Winyx → Pasp</td><td>Typ nádob z pohledu smlouvy. Např. "1100 l papír".</td></tr><tr><td colspan="1">Druh odpadu</td><td colspan="1">WinyX</td><td colspan="1">Ano</td><td colspan="1">Winyx → Pasp</td><td colspan="1"><p> </p></td></tr><tr><td colspan="1">Místa realizace</td><td colspan="1">Pasport</td><td colspan="1"><p>Ano</p></td><td colspan="1">Winyx → Pasp</td><td colspan="1"><p>Místo realizace obecně <strong>není</strong> evivalentem Stanoviště nádoby, jedná se o evidenční údaj na smlouvě.</p></td></tr><tr><td colspan="1">Nádoba</td><td colspan="1">Pasport</td><td colspan="1"><p>Omezená</p></td><td colspan="1"><p>Winyx → Pasp</p></td><td colspan="1"><p>Omezeno jen na:</p><p>a) Zakládání v Pasport dosud neexistujících nádob. <strong>Jen v rámci iniciálního importu</strong> dat pro danou provozovnu.</p><p>b) Aktualizace vazeb nádoba - řádek smlouvy pro existující nádoby. Jiná data nádoby <strong>nejsou</strong> v aplikaci Pasport na existujících nádobách aktualizována.</p></td></tr></tbody></table><h1>Architektura komunikace</h1><p><img src="synchronizace-dat-z-winyx-mpg-sk-93257926_images/image2020-12-30 10-40-53.png" data-attachment="true"></p><h4>Integrační DB</h4><ul><li>MS SQL databáze, do které zapisuje WinyX data z databází WinyXu, které odpovídají centrální DB nebo instancím pro jednotlivé společnosti.</li><li>Při každé upsert operaci WinyX aktualizuje LastModified datum daného záznamu.</li><li>Zápis probíhá v pravidelných časových intervalech.</li><li>WinyX nemaže záznamy, provádí deaktivaci (soft delete). </li></ul><h4>Winyx synchronizační služba</h4><ul><li>Synchronizační služba, implementace specifická pro WinyX.</li><li>Z integrační DB výhradně čte.</li><li>Čtení probíha v pravidelných časových intervalech.</li><li>Služba provolává obecnou synchronizační komponentu.</li></ul><h4>Obecná synchronizační komponenta</h4><ul><li>API, pomocí kterého do aplikace Pasport importovat data. Viz <a href="#" data-page-title="API - Synchronizačná komponenta"></a>.</li></ul><h1>Integrační DB - ER model</h1><ul><li>Stávající entity, které již využívá RoadPlan a jsou relevantní i pro Pasport, jsou znázorněny <strong>černou barvou</strong>.</li><li>Nové entity, zavedené pro potřeby Pasportu, jsou <strong>znázorněny žlutě</strong>.</li><li>Entity stávajícího rozhraní s RoadPlanem, které nejsou pro Pasport relevantní, diagram nezobrazuje vůbec.</li></ul><p><img src="synchronizace-dat-z-winyx-mpg-sk-93257926_images/image2021-4-13 6-45-36.png" data-attachment="true"></p><p>Poznámka: Pozor, implementace DB rozhraní je taková, že adresa je k řádku smlouvy získávána prostřednictvím reference CustomerSiteId, které ovšem obsahuje atribut referenci do tabulky Address, nikoli CustomerSite!</p><h1>Integrační scénáře importu</h1><h3>Definice rozhraní</h3><p>Detailní specifikace jednotlivých entit viz </p><h3>Smluvní údaje, související číselníky</h3><p>Tyto entity jsou plně ve správě WinyX, zákazník MPG SK na nich nebude provádět v aplikaci Pasport žádné změny.</p><p>V rámci importu jsou na všech entitách podporovány operace založení, úprava, smazání.</p><p>Frekvence přenosu je pro všechny entity jednotná (konfigurační hodnota, předpoklad: 15 min).</p><table><tbody><tr><td><strong>Entita integrační rozhraní</strong></td><td><strong>Entita Pasport</strong></td><td><strong>Založení</strong></td><td colspan="1"><strong>Úprava</strong></td><td colspan="1"><strong>Smazání</strong></td><td colspan="1"><strong>Komentář</strong></td></tr><tr><td>Customer</td><td><p><a href="../datove-modely/datovy-88033012.html">Zákazník</a></p></td><td></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr><tr><td colspan="1">Address</td><td colspan="1"><p><a href="../datove-modely/datovy-88033012.html">Adresa</a></p></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr><tr><td colspan="1">CustomerContract</td><td colspan="1"><p><a href="../datove-modely/datovy-88033012.html">Objednávka</a></p></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr><tr><td colspan="1">WasteType</td><td colspan="1"><p><a href="../datove-modely/datovy-88033012.html">Druh odpadu</a></p></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr><tr><td colspan="1">ContainerType</td><td colspan="1"><p><a href="../datove-modely/datovy-88033012.html">Typ nádoby</a></p></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr><tr><td colspan="1">ContractItem</td><td colspan="1"><p><a href="../datove-modely/datovy-88033012.html">Položka objednávky</a></p></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr><tr><td colspan="1">CollectionFrequency</td><td colspan="1"><p><a href="../datove-modely/datovy-88033012.html">Frekvence vývozu</a></p></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr><tr><td colspan="1">CollectionDaysOfWeek</td><td colspan="1"><p><a href="../datove-modely/datovy-88033012.html">Základní dny svozu</a></p></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"> </td></tr></tbody></table><h3>Nádoby a jejich vazby</h3><p>Ačkoli jsou tyto entity primárně ve správě aplikace Pasport, z procesních důvodů na straně zákazníka je zapotřebí pro určitou podmnožinu nádob omezený import dat provádět.</p><table><tbody><tr><td><strong>Entita integrační rozhraní</strong></td><td><strong>Entita Pasport</strong></td><td><strong>Založení</strong></td><td colspan="1"><strong>Úprava</strong></td><td colspan="1"><strong>Smazání</strong></td><td colspan="1"><strong>Komentář</strong></td></tr><tr><td>Container</td><td><p><a href="../datove-modely/datovy-88033012.html">Nádoba</a></p></td><td> pouze iniciální import</td><td colspan="1"></td><td colspan="1"></td><td colspan="1"><strong>Pouze iniciální import</strong>. Spouštěný manuálně pro danou provozovnu.</td></tr><tr><td colspan="1">ContractItemContainer</td><td colspan="1"><a href="../datove-modely/datovy-88033012.html">Přiřazení nádoby k položce objednávky</a></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1"><p>Klíčem pro napárování nádoby je Evidenční číslo, protože kontejner bude zakládán v Pasportu a obecně nemá externí identifikátor.</p><p>Poznámka: WinyX v případě vytvoření navazujícího pořadí řádku smlouvy přesune vazby na nově vzniklý řádek smlouvy. Tento přesun proběhne okamžitě, nezávisí na nastavené platnosti nového řádku smlouvy. Na rozhraní je ukončena platnost vazeb na původní řádek smlouvy.</p></td></tr></tbody></table><h4>Iniciální import nádob</h4><p>Bude se jednat <strong>výhradně o iniciální import</strong>, proběhne manuálně administrátorským zásahem.</p><p>Importovány budou pouze nádoby, které současně splňují tyto podmínky:</p><ul><li>Jedná se o aktivní záznamy. Hodnota parametru Status = 1.</li><li>Nádoby jsou tzv. malé. Odpovídající Typ nádoby má hodnotu parametru Skupina = "malé nádoby".</li><li>První 4 znaky parametru Evidenční číslo odpovídají Id některé z existujících Provozoven.</li></ul><p>Nádoby budou naimportovány pod Provozovnu dle shody prvních 4 znaků Evidenčního čísla nádoby. (V DB rozhraní jsou totiž Nádoby přiřazeny ke společnostem, nikoli k Provozovnám.)</p><h4>Import vazeb nádoba - řádek smlouvy</h4><p>Jedná se o součást standardního běhu rozhraní.</p>
</div>
</body>
</html>
