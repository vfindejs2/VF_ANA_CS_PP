<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Použítaveľské nastavenia</title>
</head>
<body>
<div class="wiki-content">
<h1></h1><h1>Popis</h1><p>Detailný popis aké používateľská nastavenia sú ukladané pre každého používateľa systému je tu <a href="../../funkcionalni-specifikace/persistence-stavu-ui/uzivatelska-88033406.html">https://confluence.radium.cz/pages/viewpage.action?pageId=88033406#U%C5%BEivatelsk%C3%A1nastaven%C3%AD-U%C5%BEivatelsk%C3%A1nastaven%C3%ADmapy</a></p><p>Dokument popisuje technický návrh riešenia z pohľadu ukladania týchto nastavení v databáze a koncepčne ako s nimi pracuje UI.</p><h1>Základný koncept</h1><p>Na základe detailnej analýzy ktoré časti systému sú pre používateľa ukladané, každá táto časť systému bude predstavovať jeden záznam uloženia pod konkrétnym identifikátorom pre používateľa</p><p>Napr. v module Stanovísk sa má ukladať nastavenie tabuľky stanovísk - príklad identifikátora: <strong>ui_site_site-table_v1</strong></p><p>Hierarchia vyskladania identifikátora komponentu má pravidlá:</p><ul><li>oddelenie podtržníkom predstavuje hierarchické členenie. <ul><li>jedná sa o UI - <strong>ui</strong></li><li>modul Stanoviská - <strong>site</strong></li><li>komponent tabuľky stanovísk - <strong>site-table</strong></li></ul></li><li>na konci je vždy verzia daného nastavenia - <strong>v1</strong></li></ul><h2>Uloženie nastavenia</h2><p>Pre každý identifikátor bude ukladaná hodnota nastavenia podľa typu komponentu.</p><p>V prípade ak nastala zmena (úprava alebo vymazanie) nejakých konfigurácii, povyšujeme verziu identifikátora. Tento scenár bude mať plne pod kontrolou UI počas vývoja. Príklad scenára pre tabuľku stanovísk.</p><ul><li>nastalo odstránenie stĺpca v tabuľke</li><li>UI povýši verziu daného komponentu (z v1 na v2)</li><li>v prípade ak prišlo použ. nastavenie pre v1, UI rozozná že táto verzia nie je podporovaná a používateľské nastavenie bude následne pre tento komponent systému resetované - to znamená že nastavenie v1 sa nebude brat do úvahy, ale vytvorí sa a uloží nové s verziou v2</li></ul><p>Hodnota nastavenia bude na dátovej úrovni ukladaná ako textový reťazec.</p><h2>Verzie identifikátora</h2><p>V prípade ak nastalo na UI zmena v zmysle odstránenia alebo úpravy konkrétneho nastavenia, povyšujeme verziu tohto nastavenia.</p><ul><li>cislo verze je v tvare: v{{number}}</li><li>udáva sa vždy na konci identifikátora</li></ul><p> </p><h1>Ukladanie nastavení</h1><p>Dátový model ukladanie používateľských nastavení</p><table><tbody><tr><th>Atribút</th><th>Popis</th><th colspan="1">Dátový typ</th><th>Poznámka</th></tr><tr><td>user_id</td><td>identifikátor používateľa</td><td colspan="1">INTEGER</td><td> </td></tr><tr><td>key</td><td>identifiktér komponentu </td><td colspan="1">TEXT</td><td>viď príklad vyššie, napr.: <strong>ui_site_site-table_v1</strong></td></tr><tr><td>value</td><td>hodnota nastavenia</td><td colspan="1">TEXT</td><td>ukladáme textovú hodnotu. UI pracuje s JSON objektami ktoré budú na úrovni Backendu parsované z/do textového reťazca</td></tr><tr><td colspan="1">tenant_id</td><td colspan="1">identifikátor tenanta</td><td colspan="1">INTEGER</td><td colspan="1"> </td></tr><tr><td colspan="1">created_at</td><td colspan="1">dátum a čas vytvorenia</td><td colspan="1">DATETIMEOFFSET</td><td colspan="1"> </td></tr><tr><td colspan="1">updated_at</td><td colspan="1">dátum a čas editácie</td><td colspan="1">DATETIMEOFFSET</td><td colspan="1"> </td></tr></tbody></table><div>Tabuľka: <strong>userSettings</strong></div><h1>Návrh API</h1><ul><li>API ktoré vráti konkrétne nastavenia podľa zoznamu key-s</li><li>API ktoré vráti konkrétne nastavenie podľa key</li><li>API na setovanie konkrétneho nastavenia podľa key<ul><li>API bude postavené tak že bude možné poslať viacero objektov s nastaveniami</li></ul></li></ul><p>TODO doplnit link</p><p> </p><h1>UI - Koncept</h1><p>Príklad architektúry napojenia User Setting na UI pre modul Nádob - konkrétne pre ukladanie nastavení pre mapu a tabuľku</p><p><img src="pouzitavelske-nastavenia-98241923_images/pasport user settings ui architecture.drawio.png" data-attachment="true"></p><p>User Settings na úrovni UI riešime per module - napr. module Container (Nádoby)</p><p>Samotný modul je rozdelený na samostatné bloky - components, pre ktoré riešime samostatne ukladanie. Napr. sa jedná o ukladanie nastavení pre tabuľku, mapu a pod.</p><ul><li>user settings service<br><ul><li>base class ktorá je extendovaná pre hlavnú user settings modulu → napr. container-user-settings.service </li><li>zabezpečuje dočitanie a ukladanie jednotlivých nastavení </li><li>táto service má napojené user settings jednotlivých komponentov (napr. mapa, tabuľka, toolbar, layout a pod. daného modulu)</li><li>nastavenia sa ukladajú intervalovo - default každých 5 sekund<br><ul><li>uloží a dočíta nastavenie všetkých komponentov ktoré sú do nej napojené</li><li>uložia sa len tie nastavenia kde nastala nejaká zmena</li></ul></li></ul></li><li>user settings resolver service, ktorú napojíme do routing modulu<br><ul><li>vyžaduje user settings service cez ktorú volá metódy na dočítanie (pred vstupom do modulu z pohľadu routingu) a uloženie (po odídení z modulu z pohľadu routingu) user settings</li></ul></li><li>user settings component<br><ul><li>base class ktorá je extendovaná pre konkrétny user settings component service → napr. container-table-user-settings.service<br><ul><li>tá je následne napojená do príslušnej</li></ul></li><li>manažuje konkrétne používateľské nastavenie</li><li>napája sa do príslušnej user-settings.service</li></ul></li><li>user settings standalone component<br><ul><li>base class ktorá je extendovaná  pre konkrétny user settings component service → napr. container-table-user-settings.service</li><li>používame v prípade ak nechceme aby sa tento komponent pripíjal do user settings service ale aby načítanie a uloženie prebiehalo v rámci tejto implementácie<br><ul><li>dočítanie a uloženie sa musí manažovať v príslušnej business logike, nerobí sa automaticky</li></ul></li><li>využíva sa napr. v nasledovnom Use Case<br><ul><li>máme Use case vytvorenie/editácie priradenie stanoviska na nádobu ktorý sa používa vo viacerých moduloch a potrebujeme ukladať nastavenie mapy. Tým pádom nevieme toto konkrétne nastavenie napájať pre všetky moduly kde sa tento UC vyskytuje</li></ul></li><li>Implementácia<br><ul><li>napojíme len do providers modulu tohto daného Use Case</li><li>nezapája sa do žiadnej user settings service a ani pre žiadny resolver</li></ul></li></ul></li></ul><p> </p>
</div>
</body>
</html>
