<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Dátové úložisko</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Základný popis</h1><p>Systém FLWW Pasport pre účely ukladania súborov potrebuje dátové úložisko do ktorého môže pristupovať za účelom ukladania, manipulácie a čítanie týchto súborov.</p><p> </p><p>Pre tento účel bola vybratá technológia MinIO - viac info tu <a href="https://min.io/">https://min.io/</a></p><p>Pasport komponenty ktoré pristupujú do tohto úložiska:</p><ul><li>backend</li><li>sync-service</li></ul><h1>Koncept uloženia a prístupu ku súborom</h1><p>Z hľadiska Use Case sú ukladané tieto typy súborov:</p><ul><li>fotografie (nádob a stanovísk) + thumbnails pre tieto fotografie</li></ul><p>Aby sme vedeli ukladať a následne pristupovať ku súborom cez MinIO API, je potrebné pre daný súbor v rámci databázy pasportu ukladať nasledovné metadáta:</p><ul><li><strong>bucket</strong>- názov bucketu v rámci ktoré je súbor uložený.<ul><li>môžeme si predstaviť ako "folder"</li></ul></li><li><strong>key</strong>- identifikátor súboru v rámci bucketu pod ktorým je súbor uložený<ul><li>vytvárame na aplikačnej úrovni</li></ul></li></ul><h2>Ukladanie fotografií</h2><p>V databáze pasportu existuje tabuľka "<strong>photos</strong>", ktorá ukladá potrebné informácie cez ktoré vieme pristupovať ku týmto súborom v MinIO.</p><p>Do úložiska ukladáme originál fotografiu, a následne small a medium thumbnail. Každý tento súbor má svoj vlastný key a bucket uložený v rámci tabuľky photos.</p><p>Pattern pre key pre originálnu fotografiu:</p><ul><li>v1/{ Date.now().toString() }_{original_file_name}</li></ul><p>Pattern pre key thumbnail</p><ul><li>v1/{ Date.now().toString() }_{original_file_name}_thumbnail_{pixel_size}.{file_format}<ul><li>pixe_size<ul><li>pre small hodnota: 200</li><li>pre medium hodnota: 800</li></ul></li><li>file_format - napr. hodnota: jpg</li></ul></li></ul><p> </p><h1>Konfigurácia komponentov systému Pasport</h1><p>Definujú sa nasledovné konfiguračné nastavenia pre komponenty pasportu ktoré potrebujú komunikovať s MinIO (definujú sa na úrovni .env parametrov):</p><table><tbody><tr><th>Parameter</th><th>Popis</th><th>Príklad hodnoty</th><th colspan="1">Poznámka</th></tr><tr><td><p>MINIO_ACCESS_KEY</p></td><td>prístupový kľúč, definuje sa pri nasadeni v rámci konfiguračných parametrov</td><td> </td><td colspan="1"> </td></tr><tr><td><p>MINIO_SECRET_KEY</p></td><td>prístupový secret kľúč, definuje sa pri nasadeni v rámci konfiguračných parametrov</td><td> </td><td colspan="1"> </td></tr><tr><td><p>MINIO_ENDPOINT</p></td><td><p>endpoint v rámci siete docker (pristupuje cez neho ku dátam v Minio komponent (napr. backend))</p><p>nemusí sa vždy jednať o endpoint ktorý beží v rámci siete docker s ostatnými docker komponentami systému</p></td><td><a href="http://file-server:9000">http://file-server:9000</a></td><td colspan="1"> </td></tr><tr><td><p>MINIO_PUBLIC_ENDPOINT</p></td><td>public endpoint pre UI cez ktorý následne vie získať súbory</td><td><a href="https://apps.ai-maps.com/flwwpasport/s3/dev">https://apps.ai-maps.com/flwwpasport/s3/dev</a></td><td colspan="1"> </td></tr><tr><td><p>MINIO_BUCKET_PHOTOS</p></td><td>názov bucket pre fotografie</td><td>photos</td><td colspan="1"> </td></tr></tbody></table><p> </p><h1>Nasadenie MinIO</h1><p>V rámci systému Pasport je MinIO nasadzovaný ako samostatný komponent v rámci aplikačného stacku pomocou docker.</p><p>MinIO poskytuje API rozhranie kompatibilné s Amazon S3 cloud storage službou, čomu zodpovedá aj konfigurácia pasport komponentov aby vedeli komunikovať s MinIO API.</p><h2>Backup dát</h2><p>Komponent MinIO v nasadení pomocou Docker ukladá všetky dáta do adresára <strong><code>/data</code></strong> v rámci docker kontajneru (Default konfigurácia vychádzajúca z docker-compose).</p><p>Tento adresár je následne namapovaný na konkrétny adresár na disku pomocou docker volumes, konfigurácia docker volume sa nastavuje v súbore docker-compose.yml</p><p>Pre jednoduché zálohovanie dát je potrebné nastaviť zálohovanie tohto adresára na serveri.</p><p>Pre obnovenie dát stačí nanovo nasadiť komponent MinIO a následne nakopírovať odzálohované dáta do nového adresára na ktorý je MinIO namapované.</p><h2>Prístup do MinIO</h2><p>MinIO poskytuje používateľské rozhranie na prehliadanie dát ktoré tam sú uložené. Prístup do tohto rozhrania je uvedený v sekcii Infraštruktúra pre jednotlivé nasadenia. </p><ul><li>URL do rozhrania je nasledovná: <a href="http://IP">http://IP:</a>PORT/minio/</li><li>V rámci login obrazovky treba zadat ACCESS_KEY a SECRET_KEY<ul><li>sú súčasťou konfiguračných parametrov pre dané nasadenie</li></ul></li><li>následne sa zobrazí rozhranie kde sú jednotliví buckety a jednotlivé súbory</li></ul><p><img src="datove-ulozisko-98241916_images/image2021-6-25_10-0-26.png"></p><p> </p><p> </p><p> </p>
</div>
</body>
</html>
