<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Synchronizácia udalostí výsypov nádoby z FLWW</title>
</head>
<body>
<div class="wiki-content">
<p>Popis UC tu <a href="../../../funkcionalni-specifikace/pripady-uziti/200ucxx-obecna-synchronizacni-komponenta/200uc30-97651949.html">https://confluence.radium.cz/pages/viewpage.action?pageId=97651949</a></p><p>Dokument popisuje koncept synchronizácie udalostí výsypov nádob z FLWW systému do FLWW Pasport systému. </p><p></p><h1>Synchronizačné komponenty a ich interakcie</h1><p>V rámci komponentu “backend” vo FLWW Pasport je naprogramovaný job “Object Events Sync Job”, ktorý v rámci definovaného intervalu dopytuje FLWW API za účelom získania entít udalostí výsypov a ich uloženia do Pasport databázy. Udalosť výsypu patrí vždy ku konkrétnemu objektu (máme na mysli FLWW objekt/vozidlo). </p><p> </p><p><img src="synchronizacia-98241931_images/flww pasport - sync object events architecture.drawio.png" data-attachment="true"></p><h1>Koncept synchronizácie</h1><h2>Parametrizácia</h2><ul><li><p>definovanie parametru ci je synchronizácia povolená alebo nie (<strong>objectEventsSyncEnabled</strong>)</p><br><ul><li><p>zadáva sa default hodnota cez API aplikačných nastavení - <a href="#" data-page-title="Aplikačné nastavenia"></a> (pri post install konfigurácii)</p><br><ul><li><p>uložené v rámci tabuľky “application_settings”</p></li></ul></li><li><p>zmena cez API manažment synchronizácie (viď kapitola nižšie)</p></li></ul></li><li><p>definovanie intervalu synchronizácie (<strong>objectEventsSyncIntervalInMinutes</strong>)</p><br><ul><li><p>zadáva sa default hodnota cez API aplikačných nastavení - <a href="#" data-page-title="Aplikačné nastavenia"></a> (pri post install konfigurácii)</p><br><ul><li><p>uložené v rámci tabuľky “application_settings”</p></li></ul></li><li><p>zmena cez API manažment synchronizácie (viď kapitola nižšie)</p></li></ul></li><li><p>definovanie počtu koľko krát sa môže chybný cyklus znovu opakovať (<strong>objectEventsSyncRetryCount</strong>)</p><br><ul><li><p>zadáva sa default hodnota cez API aplikačných nastavení - <a href="#" data-page-title="Aplikačné nastavenia"></a> (pri post install konfigurácii)</p><br><ul><li><p>uložené v rámci tabuľky “application_settings”</p></li></ul></li><li><p>zmena cez API manažment synchronizácie (viď kapitola nižšie)</p></li></ul></li></ul><p> </p><div><p>Cez API “aplikačné nastavenia” nastavíme len default stav ktorý ale nemá dopad hneď po nastavení. Ak chceme aby sa toto nastavenie prejavilo, musíme spraviť reštart backend komponentu.</p><p>Zmenu týchto parametrov počas behu systému sa<strong> odporúča meniť cez API určené na manažment tejto synchronizácie</strong> - viď kapitola popísaná nižšie v rámci tohto dokumentu.</p><p>Backend má interne default zastavenú synchronizáciu.</p></div><h2>Proces synchronizácie</h2><h3>Ukladanie procesu synchronizácie</h3><ul><li><p>každý synchronizačný cyklus bude ukladaný do tabuľky “<strong>object_events_sync_cycle_log</strong>”</p></li><li><p>sú ukladané informácie ako:</p><ul><li><p>tenant id - pre akého tenanta synchronizačný cyklus prebiehal</p></li><li><p>začiatok a koniec <strong>synchronizačného cyklu</strong> - na základe neho vieme koľko synchronizácia trvala</p></li><li><p>začiatok a koniec <strong>okna </strong>podľa ktorého vyťahujeme dáta z FLWW API</p></li><li><p>stav synchronizácie</p><ul><li><p>prebehla úspešne</p></li><li><p>zlyhala</p></li></ul></li></ul></li><li><p>na základe tejto tabuľky sa bude určovať vyhodnotenie procesu synchronizácie</p></li></ul><h3>Základné vlastnosti synchronizácie</h3><ul><li><p>synchronizácia prebieha v pravidelných intervaloch = cykloch</p></li><li><p>v jednom čase <strong>nemôže </strong>bežať viacero synchronizácii</p><ul><li><p>ak by nastala situácia že predošlý cyklus neskončil, a začal ďalší, tak ten bude preskočený</p></li></ul></li><li><p>ak cyklus dobehne, zaznamená sa proces synchronizácie do DB</p></li><li><p>začiatok a koniec cyklu, prípadne iné incidenty sa logujú</p></li><li><p>synchronizácia beží zvlášť pre každého tenanta</p></li></ul><h3>Koncept procesu synchronizácie</h3><ol><li><p>Zistenie intervalu synchronizácie</p><ol><li><p>ak neexistuje - vyhodí error</p></li></ol></li><li><p>Začatie cyklu (beží x cyklov pre každého tenanta)</p></li><li><p>Vyhodnotenie čo sa ide synchronizovať</p><ol><li><p>vyhľadanie zlyhaných cyklov</p><ol><li><p>vyhľadajú sa len také ktoré majú počet zlyhaní menší ako parameter <strong>objectEventsSyncRetryCount</strong></p></li></ol></li><li><p>vyhľadanie posledného cyklu</p><ul><li><p>na základe posledného cyklu sa stanoví časové okno na základe ktorého sa majú ťahať dáta z FLWW</p><ul><li><p>ak posledný cyklus neexistuje, ide sa podľa definovaného okna</p></li><li><p>ak posledný cyklus bol nájdený, tak okno sa definuje nasledovne:</p><ul><li><p>začiatok: zoberie sa čas ukončenia okna nájdeného cyklu</p></li><li><p>koniec: koniec definovaného okna</p></li></ul></li></ul></li></ul></li></ol></li><li><p>Spustenie synchronizácie</p><ol><li><p>zlyhané cykly</p><ul><li><p>zlyhaný cyklus sa znovu spustí a následne po dobehnutí zmení svoj stav synchronizácie</p></li><li><p>v prípade ak znovú zlyhá, zaloguje sa že znovu zlyhal</p></li></ul></li><li><p>nový cyklus</p><ol><li><p>ak prebehne, vytvorí sa záznam do DB pre cykly a s akým stavom skončil</p></li></ol></li></ol></li><li><p>Ukončenie cyklu</p></li></ol><p><strong>Podrobný popis toho aké kroky sa logujú je popísané v rámci dokumentu v sekcii Logovanie.</strong></p><p> </p><h1>Manažment synchronizácie</h1><p>Synchronizačný proces je možné manažovať cez API <a href="https://ai-maps.atlassian.net/wiki/spaces/FP/pages/4962919185/Dokument+cia+API#Mana%C5%BEment-synchroniz%C3%A1cie-v%C3%BDsypov-n%C3%A1dob-z-FLWW">https://ai-maps.atlassian.net/wiki/spaces/FP/pages/4962919185/Dokument+cia+API#Mana%C5%BEment-synchroniz%C3%A1cie-v%C3%BDsypov-n%C3%A1dob-z-FLWW</a> , ponúka možnosti:</p><ul><li><p>zistenie stavu synchronizácie</p></li><li><p>zastaviť/spustiť synchronizáciu</p></li><li><p>zmeniť interval synchronizácie</p></li><li><p>opraviť chybné cykly</p></li><li><p>zmeniť počet opakovaní koľko krát sa môže zlyhaný cyklus opakovať</p></li></ul><h1>Logovanie</h1><p>Logujú sa nasledovné procesy:</p><table><tbody><tr><th><p>Proces</p></th><th><p>Popis</p></th><th><p>Poznámka</p></th></tr><tr><td><p>Synchronizačný proces</p></td><td><p>Jedná sa o managera celkovej synchronizácie - teda kedy sa daný proces spúšťa (na základe intervalu), kontroluje či sa môže pustiť iný proces, má mechanizmy na zastavenie/spustenie synchronizačného cyklu, zmenu intervalu</p></td><td><p> </p></td></tr><tr><td><p>Synchronizačný cyklus</p></td><td><p>Predstavuje samotnú synchronizáciu udalostí výsypov z FLWW API a ukladanie dát do pasport databázy</p><p> </p></td><td><p> </p></td></tr></tbody></table><h2>Logované procesy</h2><p>Detailný popis pre každý proces je popísaný nižšie s ukážkami jednotlivých logov a ako tieto logy filtrovať.</p><h3>Synchronizačný proces</h3><table><tbody><tr><th><p>Field</p></th><th><p>Operator</p></th><th><p>Values</p></th><th><p>Popis</p></th></tr><tr><td><p>COMPONENT_NAME</p></td><td><p>is</p></td><td><p><strong>backend</strong></p></td><td><p> </p></td></tr><tr><td><p>code</p></td><td><p>is</p></td><td><p><strong>SYNC_PROCESS_SUCCESS</strong></p></td><td><p><strong>OBJECT_EVENTS_SYNC_PROCESS_STARTED </strong>- proces synchronizácie začal</p><p><strong>OBJECT_EVENTS_SYNC_PROCESS_SUCCESS</strong> - proces synchronizácie skončil úspešne</p><p><strong>OBJECT_EVENTS_SYNC_PROCESS_FAILED</strong> - proces synchronizácie skončil s chybou</p><p><strong>OBJECT_EVENTS_SYNC_PROCESS_SKIPPED </strong>- proces synchronizácie sa preskočil pretože beží predošlý cyklus</p></td></tr></tbody></table><h3>Synchronizačný cyklus</h3><p>Logujeme len chybové stavy ak nastanú.</p><table><tbody><tr><th><p>Field</p></th><th><p>Operator</p></th><th><p>Values</p></th><th><p>Popis</p></th></tr><tr><td><p>COMPONENT_NAME</p></td><td><p>is</p></td><td><p><strong>backend</strong></p></td><td><p> </p></td></tr><tr><td><p>code</p></td><td><p>is</p></td><td><p><strong>OBJECT_EVENTS_SYNC_CYCLE_FALIED </strong></p></td><td><p><strong>OBJECT_EVENTS_SYNC_CYCLE_FALIED </strong>- proces synchronizácie skončil úspešne</p><p><strong>OBJECT_EVENTS_SYNC_FIX_CYCLE_FAILED </strong>- synchronizácia zlyhané cyklu opäť zlyhala</p><p><strong>OBJECT_EVENTS_SYNC_CYLE_ENTITY_VALIDATION_FAILED</strong> - entita z FLWW nebola validná</p></td></tr></tbody></table><p> </p><p> </p>
</div>
</body>
</html>
