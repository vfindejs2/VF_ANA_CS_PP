<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Postup inštalácie</title>
</head>
<body>
<div class="wiki-content">
<h3>Potrebné softwérové vybavenie</h3><ul><li>Docker v.18.09 alebo vyssia</li><li>Docker-compose v.1.24 alebo vyssia</li><li>MS-SQL 2014</li></ul><p> </p><div><h2>Postup inštalácie systému</h2></div><ul><li>Vytvorenie databázy MS SQL Server<br><ol><li>Vytvorenie prázdenej DB pre potreby aplikácie</li><li>Vytvorenie používateľa pre pristup aplikácie do DB, nastavenie práv pre čítanie a zapisovanie do DB (prihlasovacie meno a heslo ktoré bude aplikácia používať sa uvádzajú v súbore <strong><code>primary_db.env</code></strong>  v kroku <a href="#" data-page-title="Deployment">Deployment</a>)</li><li><p>Vytvorenie používateľa ktorý má práva pre vytváranie tabuliek a funkcií. Tento používateľ bude použitý iba pri tovrbe a updat-e databázy v rámci nasadenia aplikácie</p></li><li><p>Vytvorenie následných funkcií v databáze</p><p> </p>generate_search_addresssqltrue</li><li>Build DB docker image obsahujúci SQL scripty nachádzajúce sa v GIT  <strong>database/migrations</strong> (všetky zmeny ktoré boli na DB robené) a následne<strong> database/repeatable</strong><br><ul><li>jednotlivé skripty vytvoria databázový model, prípadne zmeny ktoré boli v čase robené</li><li>tieto skripty slúžia aj na ďalšie uprgrade DB</li><li>Postup pre build DB docker image je popísaný v časti <a href="#" data-page-title="Build Docker Images"></a>); SQL scripty budú automaticky spustené v rámci deploymentu</li><li>Prístupové údaje do databázy (DB_host, DB_password, DB_user) sa zadávajú do konfiguračného súboru pri deploymente.</li></ul></li></ol></li><li>Vytvorenie docker images jednotlivých komponentov systému <br><ul><li><p>postup vytvorania docker images je podrobne popísaný v rámci sekcie <a href="#" data-page-title="Build Docker Images">Build Docker Images</a></p></li></ul></li><li>Sieťová konfigurácia<br><ul><li>konfigurácia haproxy</li></ul></li><li>Deployment systému<br><ul><li>Deployment aplikačného stacku prebieha pomocou docker-compose. Postup je popísaný v kapitole <a href="#" data-page-title="Deployment"></a></li><li>Postinštalačná konfigurácia aplikačného stacku, uvedená v kapitole <a href="#" data-page-title="Postup postinštalačnej konfigurácie"></a></li><li>Deployment externých služieb (Nenachádzajú sa  v rámci primárneho docker-compose aplikačného stacku) Winyx sync service.  Postup je popísaný v kapitole <a href="#" data-page-title="Deployment"></a></li></ul></li></ul><h2>Upgrade systému</h2><p>Pre Upgrade existujúceho systému na vyššiu verziu je potrebné:</p><ol><li>Upraviť súbor .env podľa požadovanej verzie<br><ul><li>Okrem zmien jednotlivých premenných je potrebné zmeniť najmä tag pre docker images, verzia komponentu, ktoré sa použíjú popísané v kapitole <a href="#" data-page-title="Deployment"></a></li></ul></li><li>Upraviť súbor docker-compose.yml podľa požadovanej verzie</li><li>Skontrolovať softwérové dependencies pre požadovanú verziu, prípadne doinštalovať chýbajúce komponenty</li><li>Nasadiť systém s novou konfiguráciou <code>docker-compose up -d (</code>Ak boli pri upgrade odstránené komponenty z docker compose súboru, a chcete odstániť aj kontajnery v ktorých bežali je možné použiť dodatočný flag<code><code>--remove-orphans)</code></code></li><li>Najlepšie je spúšťať docker-compose príkazy z rovnakého adresára ako boli spúštané pôvodne, inak hrozí že docker-compose nerozpozná že sa jedná o update bežiacich kontajnerov a bude sa ich snažiť nasadiť nanovo</li></ol>
</div>
</body>
</html>
