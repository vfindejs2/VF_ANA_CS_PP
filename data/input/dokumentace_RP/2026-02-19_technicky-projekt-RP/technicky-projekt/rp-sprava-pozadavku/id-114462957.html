<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>ID-072: Zobrazení souhrnného itineráře trasy ve FOB</title>
</head>
<body>
<div class="wiki-content">
<p> </p><p></p><h1>Požadavek</h1><p>Cílem požadavku je rozšíření aplikace FOB o souhrnný itinerář zakázek vozidla pro daný den. Tento itinerář má svou logikou vycházet z tiskové sestavy POVOS, ve které dochází k agregaci jednotlivých objednaných služeb do skupin. Dodány pak byly také náhledy naznačující požadované chování.</p><p>Poznámka: Zadání požadavku bylo aktualizováno dle informací získaných v rámci on-line střetnutí. Původní zadání není v rámci dokumentu zachováno.</p><p><img src="id-072-zobrazeni-souhrnneho-itinerare-trasy-ve-fob-114462957_images/MicrosoftTeams-image%20%28104%29.png"><img src="id-072-zobrazeni-souhrnneho-itinerare-trasy-ve-fob-114462957_images/MicrosoftTeams-image%20%28105%29.png"><img src="id-072-zobrazeni-souhrnneho-itinerare-trasy-ve-fob-114462957_images/Frontpress_S%C3%BAhrnn%C3%BD%20itiner%C3%A1r.jpg"><img src="id-072-zobrazeni-souhrnneho-itinerare-trasy-ve-fob-114462957_images/Valn%C3%ADk_S%C3%BAhrnn%C3%BD%20itiner%C3%A1r.jpg"><img src="id-072-zobrazeni-souhrnneho-itinerare-trasy-ve-fob-114462957_images/Lisovacia%20vozidlo-pilot_S%C3%BAhrnn%C3%BD%20itiner%C3%A1r.jpg"></p><h1>Aktuální stav</h1><p>Aktuálně je trasa posílána v takové podobě, která neumožňuje požadované zobrazení. Odesílány jsou přímo lokace objednané služby, které neobsahují dostatek informací. Pro úplnost si připomeneme rozsah aktuálně předávaných informací.</p>truecsharp1<h1>Návrh řešení</h1><p>Byť se jedná o požadavek na aplikaci FOB, úpravy bude nutné provést také na straně RoadPlan. Role jsou pak rozděleny následovně (zjednodušeně):</p><ul><li><strong>Webová aplikace</strong>: Zajistí přípravu potřebných informací včetně zmíněné agregace do požadované struktury. Data jsou tedy odesílána v takové podobě, která nepotřebuje další zásah na straně FOB.</li><li><strong>Mobilní aplikace</strong>: Zajišťuje pouze získání informací a následné zobrazení řidiči (včetně souvisejících akcí jako odeslání požadavku na aktualizaci načtených dat).</li></ul><h2>Webová aplikace</h2><p>V rámci webové aplikace není chování vidět, i přesto je třeba zajistit provedení hned několika úprav. Ty si nyní popíšeme…</p><ul><li><strong>Příprava itineráře trasy</strong> – zjednodušeně se jedná o export denního výkonu do požadované struktury (včetně dříve naznačených agregací). </li><li><strong>Odeslání itineráře do FOB</strong> – připravené informace je pak nutné odeslat do FOB, je tedy nutné rozšířit komunikační rozhraní o nové typy zpráv.</li></ul><h3>Příprava itineráře trasy</h3><p>Příprava itineráře trasy nezahrnuje pouze export denního výkonu do požadované podoby, provedena musí být další opatření zajišťující aktuálnost získaného výstupu.</p><p>Poznámka: Jedná se o obdobné chování, které je již řešeno při odesílání trasy pro navigaci posádky vozidla.</p><h4>Export itineráře trasy</h4><p>Export itineráře neprobíhá pro všechny denní výkony, je spouštěn pouze v uvedených případech:</p><ul><li>Je přijat požadavek na získání itineráře trasy z FOB (itinerář je generován až na vyžádání).</li><li>Dojde ke změně odpovídajícího denního výkonu (pouze denní výkony, u kterých proběhl předchozí krok).</li></ul><p>Nyní můžeme přijít k samotnému exportu – jeho výsledek bude ukládán společně s trasou v rámci entity <strong>Přihlášené zařízení na denním výkonu</strong>, kde bude k tomuto účelu přidán nový atribut.</p><ul><li><em>Interní poznámka: V rámci detailní analýzy bude nutné konzultovat (interně) způsob verzování zpráv – společná verze pro trasu a itinerář / oddělené verzování.</em></li></ul><p>V rámci exportu je pak řešena agregace dat, kdy jsou na vstupu získány objednané služby obsažené v rámci denního výkonu. Na výstupu je pak předána výsledná množina v předepsané struktuře (viz dále).</p><ul><li>Poznámka: Zmíněná agregace objednaných služeb vychází z logiky tiskové sestavy POVOS. V rámci této sestavy je pak plánováno rozšíření, které by ale mělo být v rám exportu do FOB již zaneseno (bude zobrazena jak poznámka, tak kontakt k místu realizace).</li><li><em>Interní poznámka: Za zvážení stojí zobecnění algoritmu pro oba případy – sestava POVOS a itinerář ve FOB. Rozdíl je pak především ve způsobu zobrazení, v sestavě POVOS totiž řešíme velikost stránky výsledného dokumentu (vyhodnocení počtu záznamů na stránce, které ve FOB odpadá).</em></li></ul><p>Nyní se dostáváme k samotnému zpracování záznamů – agregaci objednaných služeb do výsledné struktury. Ta probíhá následovně:</p><ol><li><strong>Zákazník</strong> – výsledná položka itineráře je pro 1 konkrétního zákazníka.</li><li><strong>Místo realizace</strong> – výsledná položka itineráře je pro 1 konkrétní místo realizace (z pohledu jeho adresy).<br><ul><li>Porovnáváno textově dle atributů adresy, nikoliv dle identifikátoru místa realizace.</li></ul></li><li><strong>Objednaný úkon</strong> – výsledná položka itineráře může obsahovat různé objednané úkony.<br><ul><li>Na úrovni objednaného úkonu (jeho typu) je slučováno dle typu nádoby a v ní obsaženého druhu odpadu.</li><li>V případě HNK a RNK odpovídá četnost počtu objednaných služeb sloučených v jeden záznam.</li><li>U ostatních typu dopravy se jedná o součet četnosti nádob v rámci sloučených objednaných služeb.</li></ul></li><li><strong>Druh odpadu s likvidačním místem</strong> – výsledná položka itineráře může obsahovat různé druhy odpadu s likvidačními místy.<br><ul><li>Na úrovni vývozu na likvidační místo je slučováno dle druhu odpadu a likvidačního místa (může se jednat o kolekce).</li><li>Paušál zobrazený v rámci tiskové sestavy POVOS zde není požadován.</li></ul></li><li><strong>Místo realizace</strong> – výsledná položka itineráře může obsahovat různé poznámky a kontakty k danému místu realizace.<br><ul><li>Důvodem je to, že jsou místa realizace slučována dle jejich adresy, nikoliv jednoznačného identifikátoru.</li><li>Na úrovni místa realizace je slučováno dle poznámky a kontaktu daného místa realizace.</li></ul></li></ol><p>Poznámka: Výsledná podoba itineráře trasy se pak může lišit dle typu dopravy daného denního výkonu (obdobně jako v rámci tiskové sestavy POVOS).</p><h4>Aktualizace itineráře trasy</h4><p>Abychom měli vždy k dispozici vždy aktuální data, je nutné je při každé změně denního výkonu aktualizovat. Děje se tak za splnění dále uvedených podmínek:</p><ul><li>Jedná se o <strong>„dnešní“</strong> denní výkon (aktuální den realizace).</li><li>Denní výkon je v jednom z uvedených stavů: <strong>Schválený</strong>, <strong>Plněný</strong>.</li><li>K dennímu výkonu <strong>je přihlášeno vozidlo</strong> (vozidla s tabletem).</li></ul><p>Pokud tedy dojde ke změně v rámci takového denního výkonu, je aktualizována jak trasa pro navigaci posádky, tak zde řešený itinerář trasy. Současně je odeslána notifikace řidiči, že došlo ke změně na trase.</p><p>Poznámka: Stažení aktualizované trasy či itineráře je v režii aplikace FOB. </p><h3>Odeslání itineráře do FOB</h3><p>Neméně důležité je předání itineráře trasy aplikaci FOB, zde vzniknou minimálně 2 nové typy zpráv…</p><ul><li><strong>Požadavek na část itineráře</strong> – zprávu odesílá aplikace FOB, která požaduje zaslání konkrétní části itineráře trasy (nutné posílat postupně z důvodu maximální velikosti zprávy). </li><li><strong>Odeslání části itineráře</strong> – zprávu odesílá aplikace RoadPlan, jedná se pak o odpověď na zprávu předchozího typu. Obsaženy jsou informace o konkrétní části itineráře.</li></ul><p>Poznámka: Uvedené chování probíhá na pozadí, neprobíhá zde žádná interakce s uživatelem. Uvedeno je zde především pro úplnost.</p><p><em>Interní poznámka: Nové typy zpráv svou logikou vychází z těch pro odesílání trasy denního výkonu (data pro navigaci posádky vozidla).</em></p><h4>Požadavek na část itineráře</h4><p>Zpráva je odesílána aplikací FOB, její struktura je uvedena následně (jedná se o návrh, který se v rámci detailního návrhu řešení může ještě mírně měnit).</p>html/xml1<p>Význam jednotlivých elementů je následující…</p><table><tbody><tr><th>Element/atribut</div></div></th><th colspan="1">Datový typ</div></div></th><th colspan="1">Povinnost</div></div></th><th>Popis</div></div></th></tr><tr><td colspan="1">itineraryPart</td><td colspan="1">–</td><td colspan="1">Ano</td><td colspan="1">Element s informacemi o požadovaných částech itineráře.</td></tr><tr><td colspan="1">routeId</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1"><p>Identifikátor denního výkonu, pro který mají být odeslány požadované části itineráře.</p></td></tr><tr><td colspan="1">partFrom</td><td colspan="1">Číslo</td><td colspan="1">Ano</td><td colspan="1">Pořadí první požadované části itineráře (začátek intervalu požadovaných částí itineráře včetně).</td></tr><tr><td colspan="1">partTo</td><td colspan="1">Číslo</td><td colspan="1">Ano</td><td colspan="1">Pořadí poslední požadované části itineráře (konec intervalu požadovaných částí itineráře včetně).</td></tr><tr><td colspan="1">fileV</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1">Verze, ve které je požadováno zaslání části itineráře.</td></tr></tbody></table><h4>Odeslání části itineráře</h4><p>Zpráva je odesílána aplikací RP, její struktura je uvedena následně (jedná se o návrh, který se v rámci detailního návrhu řešení může ještě mírně měnit).</p>html/xml1<p>Význam jednotlivých elementů je následující…</p><table><tbody><tr><th>Element/atribut</div></th><th colspan="1">Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th></tr><tr><td colspan="1">itineraryPart</td><td colspan="1">–</td><td colspan="1">Ano</td><td colspan="1">Element s informacemi o konkrétní části itineráře.</td></tr><tr><td colspan="1">routeId</td><td colspan="1">Číslo</td><td colspan="1">Ano</td><td colspan="1"><p>Jedinečný identifikátor denního výkonu.</p></td></tr><tr><td colspan="1">order</td><td colspan="1">Číslo</td><td colspan="1">Ano</td><td colspan="1">Pořadí konkrétní části itineráře.</td></tr><tr><td colspan="1">count</td><td colspan="1">Číslo</td><td colspan="1">Ano</td><td colspan="1">Celkový počet částí itineráře.</td></tr><tr><td colspan="1">lastMod</td><td colspan="1">Datum a čas</td><td colspan="1">Ano</td><td colspan="1">Datum poslední změny itineráře.</td></tr><tr><td colspan="1">file</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1">Popis o konkrétní části itineráře.</td></tr></tbody></table><p>Obsah zprávy je pak z důvodu minimalizace přenášeného množství dat kódován. I zde si ukážeme strukturu obsaženého hodnoty (i zde se jedná o návrh, který se v rámci detailního návrhu řešení může ještě mírně měnit).</p><p>Poznámka: Význam jednotlivých hodnot je uveden v rámci uvedené struktury, a to ve formě poznámky.</p>truecsharp1<h2>Mobilní aplikace</h2><p>Grafický návrh:</p><p><strong>List:</strong></p><p><img src="id-072-zobrazeni-souhrnneho-itinerare-trasy-ve-fob-114462957_images/2 (2).png" data-attachment="true"></p><p> </p><p><strong>Detail:</strong></p><p><img src="id-072-zobrazeni-souhrnneho-itinerare-trasy-ve-fob-114462957_images/3 (2).png" data-attachment="true"></p><p> </p><h1>Akceptační testy</h1><p>Pro splnění požadavku musí být splněny následující testovací scénáře.</p><h2>TC01: Xxx</h2><ol><li>Systém…</li></ol><h1>Poznámka</h1><p>–</p>
</div>
</body>
</html>
