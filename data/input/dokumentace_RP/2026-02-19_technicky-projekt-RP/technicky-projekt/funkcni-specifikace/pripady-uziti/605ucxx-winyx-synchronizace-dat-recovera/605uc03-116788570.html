<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>605UC03: Získat jízdy</title>
</head>
<body>
<div class="wiki-content">
<p><strong>Rozpracováno – volané UC!</strong></p><p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je synchronizace jízd z REST API systému WinyX (metoda <strong>jizdy</strong> typu <strong>GET</strong>). V aplikaci RoadPlan pak pracujeme s entitou <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> (včetně souvisejících entit).</p><p>Poznámka: Synchronizace je připravena pro data ze systému WinyX (zákazník Recovera).</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>Nastane okamžik, ve kterém má dojít k synchronizaci (viz <a href="605uc01-116788568.html">605UC01: Zahájit import záznamů</a>).</p><h2>Vstupní podmínky</h2><p>–</p><h2>Vstupní data</h2><p>–</p><h1>Základní tok událostí</h1><ol><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> dostupné v RoadPlan pro řešené období (viz <a href="605uc03-116788570.html">ALG01: Získání objednaných služeb</a>).<br><ul><li><em>Záznam z WinyX může být získán pro <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>, která je již pouze ke čtení (je zrušená či realizovaná). Pokud by taková situace nastala, bude odpovídající jízda ignorována.</em></li><li><em>Všechny nalezené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, pro které již není k dispozici jízda ve WinyX, jsou zrušeny (jejich realizace není dále požadována).</em></li><li><em>Pracujeme pak pouze s takovými <a href="../../../datove-modely/datovy-78681044.html">Objednanými službami</a>, které vznikly v rámci synchronizace.</em></li></ul></li><li>Systém získá počet aktuálně dostupných jízd na straně WinyX (viz <a href="605uc03-116788570.html">ALG03: Získání počtu jízd</a>).<br><ol><li><em>Dojde k volání API metody, která poskytuje jízdy dostupné na straně WinyX. Součástí odpovědi je také celkový počet těchto záznamů.</em></li><li><em>Získaná hodnota je platná pro celý synchronizační běh. Aktuálně není prováděna kontrola, zda se v průběhu synchronizace množství záznamů nezměnilo.</em> </li></ol></li><li>Systém získá jízdy dostupné na straně WinyX (viz <a href="605uc03-116788570.html">ALG04: Získání jízd</a>).<br><ul><li><em>Jednotlivé záznamy jsou získávány po skupinách – je použito stránkování. Jízdy jsou pak zpracovány společně, tedy po načtení všech stran.</em></li><li><em>Data mohou být načítána paralelně. To znamená, že načítáme více stránek současně (možnost parametrizace).</em></li></ul></li><li>Systém zpracuje jízdy získané z WinyX (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).<br><ul><li><em>Zpracování jízdy je komplexní úkon, v rámci kterého musí být vyhodnoceno, zda dochází k založení nové či aktualizaci stávající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>.</em></li><li><em>V případě založení nové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> navíc vyhodnocujeme, zda je možné využít již existující objednávku, nebo musí být založena nová.</em></li><li><em>Při aktualizaci existující <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> musíme ověřit, zda nedošlo k nějakým změnám na úrovni jízdy (např. změna data realizace).</em></li><li><em>Při zpracování získaných záznamů jsou současně označovány také jim odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> na straně RoadPlan (viz krok <strong>1</strong>).</em></li><li><em>Pokud je <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> označena, znamená to, že byl získán a zpracován odpovídající záznam z WinyX.</em></li><li><em>Takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, které označeny nebyly, již nemají odpovídající záznam na straně WinyX (budou zrušeny).</em></li><li><em>Označování <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> probíhá pouze na úrovni tohoto UC, informace <strong>není</strong> ukládána na úrovni DB.</em></li><li><em>Nad rámec dat o jízdě zpracováváme další podpůrné informace nutné pro založení <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (např. zákazník či rámcová smlouva).</em><br></li><li><em>Součástí algoritmu je také plánování získaných <em><a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a></em> na vozidla (pořadí na úrovni denního výkonu je vyhodnocováno dle data poslední změny odpovídající jízdy).</em></li></ul></li><li>Systém zpracuje takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> na straně RoadPlan (viz krok <strong>1</strong>), které nebyly označeny jako zpracované (viz krok <strong>4</strong>) – provede jejich zrušení (viz <a href="605uc03-116788570.html">ALG06: Zrušení objednaných služeb</a>).<br><ul><li><em>Zrušení neoznačených <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> probíhá až po načtení a zpracování všech jízd na straně WinyX.</em></li></ul></li></ol><h1>Alternativní toky událostí</h1><p>–</p><h1>Výjimkové toky událostí</h1><h2>EF01: Služba není dostupná</h2><p>Dotaz nebylo možné odeslat z důvodu nedostupnosti služby, případně nebyla získána odpověď v požadovaném čase.</p><h3>Vstupní podmínky</h3><ul><li>Volaní metody pro získání likvidačních míst skončilo jednou z dále uvedených chyb:<br><ul><li>500: Internal Server Error,</li><li>502: Bad Gateway,</li><li>503: Service Unavailable,</li><li>504: Gateway Timeout.</li></ul></li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem <strong>2</strong> nebo <strong>3</strong> základního toku událostí.</li><li>Systém provede logování uvedené skutečnosti.</li><li>Systém provede opakované spuštění UC (provedeny jsou maximálně 3 pokusy).</li></ol><h3>Výstupní podmínky</h3><ul><li>Došlo k opakovanému spuštění UC. Uvedená skutečnost byla logována (pro každý pokus).</li></ul><h2>EF02: Chyba dotazu</h2><p>Dotaz nebylo možné zpracovat z důvodu nesprávné syntaxe.</p><h3>Vstupní podmínky</h3><ul><li>Volaní metody pro získání likvidačních míst skončilo chybou 400: Bad Request.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem <strong>2</strong> nebo <strong>3</strong> základního toku událostí.</li><li>Systém provede logování uvedené skutečnosti.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k dokončení UC. Uvedená skutečnost byla logována.</li></ul><h2>EF03: Chyba autorizace</h2><p>Dotaz nebylo možné zpracovat z důvodu vypršení či neprovedení autorizace.</p><ul><li><em>Pokud bude průběžně vyhodnocována platnost tokenu, nemělo by dojít ke spuštění tohoto výjimkového toku.</em></li></ul><h3>Vstupní podmínky</h3><ul><li>Volaní metody pro získání likvidačních míst skončilo chybou 401: Unauthorized.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem <strong>2</strong> nebo <strong>3</strong> základního toku událostí.</li><li>Systém provede logování uvedené skutečnosti.</li><li>Systém provede autorizaci a následné spuštění tohoto UC (provedeny jsou maximálně 3 pokusy).<br><ul><li><em>Autorizace je řešena v rámci <a href="605uc01-116788568.html">605UC01: Zahájit import záznamů</a>.</em><em><br></em></li></ul></li></ol><h3>Výstupní podmínky</h3><ul><li>Došlo k autorizaci a opakovanému spuštění UC. Uvedená skutečnost byla logována (pro každý pokus).</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Došlo k synchronizaci validních jízd (včetně souvisejících záznamů). Případné komplikace byly logovány.</p><h2>Výstupní data</h2><p>–</p><h1>Algoritmy</h1><h2>ALG01: Získání objednaných služeb</h2><p>V rámci synchronizace jízd pracujeme pouze s takovými <a href="../../../datove-modely/datovy-78681044.html">Objednanými službami</a>, které vznikly právě v rámci synchronizace (nebyly vytvořeny uživatelem). V potaz jsou ale brána také další kritéria…</p><ul><li>Zajímají nás pouze takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, které se nevyskytují v minulosti (historická data již nelze modifikovat, navíc již může být potvrzena jejich realizace).</li><li>Datum předpokládané realizace těchto <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> se vyskytuje ve sledovaném období (tedy takovém, pro které načítáme jízdy).</li><li>Dále uvažujeme takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, u kterých zatím nebyla provede realizace (je s nimi tedy možné dále pracovat).</li><li>V získané kolekci se pak mohou vyskytovat <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> se stejným identifikátorem jízdy, které typicky vznikají při jejich dělení.</li></ul><p>Hlavní využití takto získaných <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> pak spočívá v jejich označování při synchronizaci jízd…</p><ul><li>Takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, pro které byla získána jízda u WinyX, jsou označeny.</li><li>Neoznačené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> jsou pak zrušeny (jejich realizace není dále požadována).</li></ul><p>Systém tedy nalezne takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, které splňují všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Stav</strong> je nastavena na jednu z uvedených hodnot: <strong>K naplánování</strong>, <strong>Naplánovaná</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednané služby</a>).</li><li>Hodnota atributu <strong>Identifikátor jízdy</strong> je k dispozici.</li><li>Hodnota atributu <strong>Výchozí datum realizace</strong> je větší nebo rovna dnešnímu datu.</li><li>Hodnota atributu <strong>Výchozí datum realizace</strong> je menší nebo rovna dnešnímu datu, ke kterému je přičten počet dní daný konfigurační hodnotou <strong>recoveraSyncSettings.ridesPeriodLength</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li>Hodnota atributu <strong>Vytvořeno systémem</strong> odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> je rovna <strong>TRUE</strong>. </li></ul><p>Získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> jsou předány na výstupu algoritmu, v rámci UC s nimi dále pracujeme.</p><h2>ALG02: Specifikace metody pro získání jízd</h2><p>Cílem algoritmu je popis metody odpovídajícího REST API, která poskytuje jízdy dostupné na straně WinyX.</p><table><tbody><tr><th>Specifikace volání API</div></th><th>Hodnota</div></th><th>Poznámka</div></th></tr><tr><td>Cesta</td><td><p><url>/<verze>/roadplan/jizdy</p><ul><li><strong>url</strong>: dáno konfigurační hodnotou <strong>recoveraSyncSettings.ridesUrl</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>verze</strong>: dáno konfigurační hodnotou <strong>recoveraSyncSettings.ridesVesrion</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul></td><td><p>Viz <a href="https://bridge.api.bclogia.cz/index.html">https://bridge.api.bclogia.cz/index.html</a>.</p></td></tr><tr><td>Metoda</td><td>GET</td><td>–</td></tr><tr><td>Parametry</td><td><p><strong>Spolid</strong>: Identifikátor společnosti z pohledu WinyX.</p><ul><li>Datový typ: integer ($int32).</li></ul><p><strong>DatumOd</strong>: Období, pro které mají být získány jízdy (vyhodnocováno dle data realizace).</p><ul><li>Datový typ: string ($date-time).</li><li>Povinný údaj: Ano.</li></ul><p><strong>DatumDo</strong>: Období, pro které mají být získány jízdy (vyhodnocováno dle data realizace).</p><ul><li>Datový typ: string ($date-time).</li><li>Povinný údaj: Ano.</li></ul><p><strong>Start</strong>: Pořadí prvního záznamu, který chceme získat z jejich výsledné množiny (tedy „začátek“ stránky)</p><ul><li>Datový typ: integer ($int32).</li><li>Minimální hodnota: 0.</li></ul><p><strong>Limit</strong>: Nastavení počtu záznamů na stránce (tedy délka stránky).</p><ul><li>Datový typ: integer ($int32).</li><li>Minimální hodnota: 1.</li><li>Maximální hodnota: 100.</li></ul></td><td>Specifikováno v rámci daného volání této metody.</td></tr><tr><td colspan="1">Příklad volání</td><td colspan="1"><p>https://bridge.api.bclogia.cz/v1/roadplan/jizdy?<strong>Spolid=98</strong>&<strong>DatumOd=2024-01-08</strong>&<strong>DatumDo=2024-01-12</strong>&<strong>Start=0</strong>&<strong>Limit=100</strong></p></td><td colspan="1">Vstupní parametry jsou zvýrazněny tučným řezem písma. Příklad nemusí být aktuální.</td></tr></tbody></table><p>Současně je uvedena také struktura získané odpovědi. Jedná se pak pouze o ilustrativní příklad, samotný popis je uveden v rámci odpovídajících algoritmů.</p><h2>ALG03: Získání počtu jízd</h2><p>Cílem algoritmu je je získání aktuálního počtu jízd dostupných na straně WinyX. Hodnota je pak dostupná v rámci metody pro získání jízd (viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>).</p><p>Poznámka: Získaná hodnota je platná pro celý synchronizační běh. Aktuálně není prováděna kontrola, zda se v průběhu synchronizace množství záznamů nezměnilo.</p><ol><li>Systém zavolá metodu pro získání jízd (viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>) s následujícími parametry:<ul><li><strong>Spolid</strong>: konfigurační hodnota <strong>recoveraSyncSettings.spolid</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).<br></li><li><strong>DatumOd</strong>: předáno dnešní datum.</li><li><strong>DatumDo</strong>: předáno dnešní datum, ke kterému je přičten počet dní daný konfigurační hodnotou <strong>recoveraSyncSettings.ridesPeriodLength</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Start</strong>: předána hodnota <strong>0</strong>.</li><li><strong>Limit</strong>: předána hodnota <strong>1</strong>.</li></ul></li><li>Systém zpracuje získanou odpověď – na výstupu algoritmu je předána hodnota získaná v rámci elementu <strong>TotalRecords</strong> (viz dále).</li></ol><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td>Data</td><td colspan="1">Informace o požadovaných jízdách.</td><td colspan="1"><em>V rámci tohoto algoritmu není využito.</em></td><td><p>Získané záznamy nejsou v rámci tohoto algoritmu využity, zde pracujeme pouze s celkovým počtem záznamů.</p><p>Samotná likvidační místa jsou načítána až v rámci <a href="605uc03-116788570.html">ALG04: Získání jízd</a>.</p></td></tr><tr><td>TotalRecords</td><td colspan="1">Celkový počet takových jízd na straně WinyX, která odpovídají zadaným vstupním parametrům.</td><td colspan="1">Předání obsažené hodnoty.</td><td>–</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG04: Získání jízd</h2><p>Cílem algoritmu je získání informací o jízdách dostupných na straně WinyX. Dílčí záznamy jsou dostupné v rámci metody pro získání jízd (viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>).</p><p>Poznámka: Vzhledem k množství dostupných jízd je použito stránkování, záznamy jsou tedy získávány postupně. Jednotlivé skupiny záznamů pak mohou být získány paralelně.</p><ol><li>Systém připraví pomocné proměnné pro stránkování a provede jejich výchozí nastavení:<br><ul><li><strong>Pořadí</strong>: pořadí prvního záznamu v rámci aktuálně načítané stránky (nastaveno na <strong>0</strong>).</li></ul></li><li>Systém postupně načítá informace o jízdách z WinyX – pokud je hodnota pomocné proměnné <strong>Pořadí</strong> menší nebo rovna <strong>celkovému počtu záznamů</strong> (viz <a href="605uc03-116788570.html">ALG03: Získání počtu jízd</a>), je provedena následující sekvence kroků:<ol><li>Systém zavolá metodu pro získání jízd (viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>) s následujícími parametry:<br><ul><li><strong>Spolid</strong>: konfigurační hodnota <strong>recoveraSyncSettings.spolid</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li><li><strong>DatumOd</strong>: předáno dnešní datum.</li><li><strong>DatumDo</strong>: předáno dnešní datum, ke kterému je přičten počet dní daný konfigurační hodnotou <strong>recoveraSyncSettings.ridesPeriodLength</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Start</strong>: předána hodnota pomocné proměnné <strong>Pořadí</strong>.</li><li><strong>Limit</strong>: konfigurační hodnota <strong>recoveraSyncSettings.ridesPageSize</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li></ul></li><li>Systém aktualizuje hodnotu pomocné proměnné <strong>Pořadí</strong> – provede její inkrementaci o konfigurační hodnotu <strong>recoveraSyncSettings.ridesPageSize</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li><li>Přechod na krok <strong>2</strong> (načtení další stránky).</li></ol></li></ol><p>Poznámka: Získání jednotlivých stránek s jízdami (viz krok <strong>2</strong>) může probíhat paralelně. To znamená, že další provedení tohoto kroku může být spuštěno před dokončením toho aktuálně běžícího. Maximální počet aktuálně zpracovávaných stránek je pak dán konfigurační hodnotou <strong>recoveraSyncSettings.ridesParallelRunsCount</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>). Pro zachování přehlednosti algoritmu je tato logika zmíněna pouze ve formě této poznámky.</p><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td>Data</td><td colspan="1">Informace o požadovaných jízdách (v rámci dané stránky).</td><td colspan="1"><p>Předání obsažených objektů.</p></td><td><p>Zpracování informací o jízdách je řešeno v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.</p></td></tr><tr><td>TotalRecords</td><td colspan="1">Celkový počet takových jízd na straně WinyX, která odpovídají zadaným vstupním parametrům.</td><td colspan="1"><em>V rámci tohoto algoritmu není využito.</em></td><td>Hodnota je využita v rámci <a href="605uc03-116788570.html">ALG03: Získání počtu jízd</a> (nedochází k její průběžné aktualizaci).</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG05: Zpracování jízd</h2><p>Cílem algoritmu je zpracování informací o jízdách získaných z WinyX (viz <a href="605uc03-116788570.html">ALG04: Získání jízd</a>). Na úrovni každého záznamu je pak prováděno hned několik akcí, ty si nyní stručně popíšeme:</p><ul><li>validace informací o jízdě (synchronizujeme pouze validní záznamy),</li><li>zpracování „podpůrných“ informací (např. zákazníka či smlouvy),</li><li>založení nové či aktualizace stávající objednané služby (včetně objednávky),</li><li>vložení objednané služby na denní výkon (naplánování na vozidlo a den).<br></li></ul><p>Samotný algoritmus je pak popsán z pohledu jedné konkrétní jízdy, prováděn je však pro všechny získané záznamy (viz <a href="605uc03-116788570.html">ALG04: Získání jízd</a>). Zpracovány jsou v pořadí, které je dáno hodnotou dostupnou v rámci elementu <strong>posledniZmena</strong> (vzestupné řazení).</p><ol><li>Systém označí odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> jako zpracované (nedojde tedy k jejich zrušení v závěru UC) – provede dále uvedené kroky:<br><ol><li>Systém v kolekci <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> získaných v rámci <a href="605uc03-116788570.html">Základního toku událostí</a> (viz krok <strong>1</strong>) nalezne takové záznamy, které splňují všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Identifikátor jízdy</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.</li></ul></li><li>Systém označí všechny nalezené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz krok <strong>1.a</strong>) jako zpracované.<br><ul><li><em>Takto označené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> nebudou zpracovány v rámci <a href="605uc03-116788570.html">ALG06: Zrušení objednaných služeb</a>.</em></li><li><em>Jejich označení probíhá hned na začátku zpracování jízdy a je zachováno i v případě nedokončení tohoto algoritmu.</em></li><li><em>Případné problémy při zpracování jízdy tedy nezpůsobí případné zrušení existujících <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a>.</em></li><li><em>Označování <strong>Objednaných služeb</strong> pak probíhá pouze na úrovni tohoto UC, informace <strong>není</strong> ukládána na úrovni DB.</em></li></ul></li></ol></li><li>Systém provede validaci právě zkoumané jízdy (viz <a href="605uc03-116788570.html">VAL01: Validace jízdy</a>).<br><ol><li>Pokud proběhla validace záznamu v pořádku, systém pokračuje ve zpracování informací o jízdě.</li><li>Jinak validace záznamu skončila chybou – systém provede logování dané skutečnosti a pokračuje zpracováním další jízdy (tato jízda je přeskočena).</li></ol></li><li>Systém provede zpracování informací získaných v rámci jízdy:<br><ol><li>Systém zpracuje obsah elementu <strong>zakaznik</strong> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).<br></li><li>Systém zpracuje obsah elementu <strong>smlouva</strong> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).<br></li><li>Systém získá <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a>, pod kterým má být provedena realizace jízdy:<br><ol><li>Systém nalezne takový <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy objektu</a>, který splňuje všechny dále uvedené podmínky zároveň (hledáme pouze první výskyt):<br><ul><li>Hodnota atributu <strong>Objekt</strong> odpovídá danému <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (získán při zpracování elementu <strong>vozidloEvc</strong>).</li></ul></li><li>Pokud byl nalezen požadovaný <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy objektu</a> (viz krok <strong>3.c.i</strong>), systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a> (atribut <strong>Typ dopravy</strong> nalezeného <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy objektu</a>).</li><li>Jinak <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy objektu</a> nalezen nebyl (viz krok <strong>3.c.i</strong>) – systém provede logování dané skutečnosti a pokračuje zpracováním další jízdy (tato jízda je přeskočena).<br><ul><li><em>Aby mohla být jízda zpracována, musí být získáno vozidlo, pro které probíhá plánování denních výkonů.</em><br></li></ul></li></ol></li><li>Systém získá <a href="../../../datove-modely/datovy-78681044.html">Typ nádoby</a>, který má být použit v při realizaci jízdy – hodnota se odvíjí od získaného <a href="../../../datove-modely/datovy-78681044.html">Typu dopravy</a> (viz krok <strong>3.c</strong>):<br><ul><li><strong>Hákový nakladač</strong>: takový <a href="../../../datove-modely/datovy-78681044.html">Typ nádoby</a>, u kterého interní identifikátor odpovídá konfigurační hodnotě <strong>recoveraSyncSettings.</strong><strong>ridesDefContainerTypeIdHnk</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Ramenový nakladač</strong>: takový <a href="../../../datove-modely/datovy-78681044.html">Typ nádoby</a>, u kterého interní identifikátor odpovídá konfigurační hodnotě <strong>recoveraSyncSettings.</strong><strong>ridesDefContainerTypeIdRnk</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Valník</strong>: takový <a href="../../../datove-modely/datovy-78681044.html">Typ nádoby</a>, u kterého interní identifikátor odpovídá konfigurační hodnotě <strong>recoveraSyncSettings.</strong><strong>ridesDefContainerTypeIdVal</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Cisterna</strong>: takový <a href="../../../datove-modely/datovy-78681044.html">Typ nádoby</a>, u kterého interní identifikátor odpovídá konfigurační hodnotě <strong>recoveraSyncSettings.</strong><strong>ridesDefContainerTypeIdCis</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><em>Poznámka: Řešeny jsou pouze <a href="../../../datove-modely/datovy-78681044.html">Typy dopravy</a> relevantní pro tento UC.</em></li></ul></li><li>Systém zpracuje obsah elementů <strong>pocatekJizdy</strong> a <strong>cilJizdy</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).<br><ul><li><em>V rámci algoritmu pracujeme mj. s <a href="../../../datove-modely/datovy-78681044.html">Typem dopravy</a>, ten je získán v rámci kroku <strong>3.c.ii</strong>).</em></li><li><em>Kromě jednotlivých bodu jízdy získáme také jim odpovídající <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a>.</em></li></ul></li><li>Systém zpracuje obsah elementu <strong>odpady</strong> (viz <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a>).<br><ul><li><em>V rámci algoritmu zpracováváme <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu</a> hned z několika důvodů…</em></li><li><em>V první řadě musíme ověřit, zda jsou odebírány odpovídajícím <a href="../../../datove-modely/datovy-78681044.html">Likvidačním místem</a>.</em></li><li><em>Následně musíme provést jejich přiřazení k odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a>.</em></li></ul></li></ol></li><li>Systém provede zpracování <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> dle informací získaných v rámci jízdy (její aktualizaci či založení):<br><ol><li>Systém nalezne takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, které splňují všechny dále uvedené podmínky zároveň (v případě rozdělení <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> může být získána kolekce):<br><ol><li> Hodnota atributu <strong>Identifikátor jízdy</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong> (další parametry jsou vyhodnocovány až následně).</li></ol></li><li>Pokud byla nalezena alespoň jedna <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> (viz krok <strong>4.a</strong>), systém provede zpracování získaných záznamů:<br><ol><li>Pokud není ani jedna ze získaných <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz krok <strong>4.a</strong>) v některém z dále uvedených stavů: <strong>K naplánování</strong>, <strong>Naplánovaná</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednané služby</a>).<br><ol><li>Systém provede logování dané skutečnosti a pokračuje zpracováním další jízdy (tato jízda je přeskočena).<br><ul><li><em>Jízdy, pro které existují pouze zrušené či realizované <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, jsou přeskočeny.</em></li><li><em>Muselo by jinak dojít k založení nové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, ta by měla stejný identifikátor jízdy.</em></li></ul></li></ol></li><li>Systém vyhodnotí aktuálnost získaných <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz krok <strong>4.a</strong>) – porovná je s informacemi získanými v jízdě (viz <a href="605uc03-116788570.html">ALG18: Vyhodnocení aktuálnosti objednané služby</a>).<br><ol><li>Pokud nejsou získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz krok <strong>4.a</strong>) aktuální:<br><ol><li>Systém provede zrušení získaných <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz <a href="605uc03-116788570.html">ALG19: Zrušení neaktuálních objednaných služeb</a>).</li><li>Systém pro získanou jízdu založí novou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> (přechod na krok <strong>4.c</strong>).</li></ol></li></ol></li><li>Systém vyhodnotí aktuálnost naplánování získaných <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz krok <strong>4.a</strong>) – porovná je s informacemi získanými v jízdě (viz <a href="605uc03-116788570.html">ALG20: Vyhodnocení aktuálnosti naplánování objednané služby</a>).<br><ol><li>Pokud není naplánování získaných <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz krok <strong>4.a</strong>) aktuální:<br><ol><li>Systém zruší naplánování získaných <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz <a href="605uc03-116788570.html">ALG21: Odebrání objednaných služeb z denních výkonů</a>).</li><li>Systém provede naplánování těchto <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> dle informací získaných v jízdě (přechod na krok <strong>5</strong>).<br></li></ol></li></ol></li><li>Systém pokračuje zpracováním další jízdy (získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> jsou aktuální, není tedy prováděno jejich další zpracování).</li></ol></li><li>Jinak žádná taková <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> nalezena nebyla (viz krok <strong>4.a</strong>), systém provede založení nového záznamu:<br><ol><li>Systém nalezne takovou <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a> (resp. konkrétní <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a>), která odpovídá získané jízdě (viz <a href="605uc03-116788570.html">ALG22: Získání objednávky</a>; hledáme pouze první výskyt):<br><ol><li>Pokud byla nalezena odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávka</a>, systém s ní pracuje při zpracování jízdy (použije odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a>).</li><li>Jinak odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávka</a> nalezena nebyla, systém provede její založení (viz <a href="605uc03-116788570.html">ALG23: Založení objednávky</a>).</li></ol></li><li> Systém pro získanou <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a> (resp. odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a>; viz krok <strong>4.c.i</strong>) založí <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> na výzvu (viz <a href="605uc03-116788570.html">ALG24: Založení objednané služby na výzvu</a>).</li></ol></li></ol></li><li>Systém provede naplánování <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> dle informací získaných v rámci jízdy (viz <a href="605uc03-116788570.html">ALG25: Naplánování objednané služby</a>).<br><ul><li><em>V rámci algoritmu může být řešeno také založení nového <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>. Jedná se o případy, kdy je dané vozidlo vypůjčeno na jinou <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a>.</em></li><li><em><a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> domovské <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> je v tomto případě vyprázdněn a dochází ke změně jeho stavu (není možné na něj dále plánovat <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>).</em></li><li><em>Pokud tedy získáme jízdy různých <a href="../../../datove-modely/datovy-78681044.html">Provozoven</a>, které jsou ale přiřazeny ke stejnému vozidlu v daný den, nebude část jízd naplánována na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>.</em></li></ul></li></ol><p>Poznámka: Zpracování jízdy probíhá v dílčích transakcích, ty můžeme rozdělit do několika základních skupin…</p><ul><li><strong>Zpracování podpůrných informací</strong> – zajišťuje načtení informací předávaných spolu s jízdou (např. zákazník), dílčí kroky jsou zpracovány samostatně (krok <strong>3</strong>).<br><ul><li>Systém postupně zpracovává dílčí záznamy, každý z nich je po svém zpracování rovnou uložen v databázi (bez ohledu na výsledek zpracování jízdy).</li><li>Pokud tedy v rámci tohoto algoritmu založíme zákazníka, zůstává uložen v databázi i v případě, kdy nedojde k úspěšnému zpracování jízdy jako celku.</li></ul></li><li><strong>Zpracování jízdy</strong> – zajišťuje založení objednané služby (případně také objednávky) a její naplánování na denní výkon (krok <strong>4</strong>, <strong>5</strong>). Zde je provedeno vše nebo nic.</li></ul><p>V rámci algoritmu je přímo odkazováno na informace získané z WinyX (na odpovídající elementy). Nyní si tedy popíšeme strukturu, ve které jsou informace o jízdách předávány (včetně způsobu, jakým jsou dílčí hodnoty zpracovány).</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">id</td><td colspan="1">Identifikátor jízdy ve WinyX.</td><td colspan="1">Převedení obsažené hodnoty na text (odpovídá atributu <strong>Identifikátor jízdy</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>).</td><td colspan="1">Slouží k „párování“ záznamů napříč systémy.</td></tr><tr><td colspan="1">posledniZmena</td><td colspan="1">Datum a čas, ve který došlo k poslední změně v rámci jízdy.</td><td colspan="1">Předání obsažené hodnoty (vzhledem ke způsobu použití hodnoty není nutný její převod do UTC).</td><td colspan="1">Slouží k určení pořadí, ve kterém budou jízdy zpracovány.</td></tr><tr><td colspan="1">provozovna</td><td colspan="1">Provozovna, pod kterou je jízda realizována.</td><td colspan="1"><p>V první řadě je obsažená hodnota převedena na text. Následně dochází k nalezení takové <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a>, která splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá obsažené hodnotě (mapování je uvedeno samostatně, viz <a href="605uc01-116788568.html">ALG02: Mapování provozoven</a> popsaný v rámci <a href="605uc01-116788568.html">605UC01: Zahájit import záznamů</a>).</li></ul></td><td colspan="1">Pokud není pro získaný identifikátor nalezena žádná <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> (případně je nalezen neaktivní záznam), končí zpracování jízdy chybou (je přeskočena).</td></tr><tr><td colspan="1">vozidloEvc</td><td colspan="1">Evidenční číslo vozidla, kterým má být jízda realizována.</td><td colspan="1"><p>Dochází k nalezení takového <a href="../../../datove-modely/datovy-78681044.html">Objektu</a>, který splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Evidenční číslo</strong> odpovídá obsažené hodnotě.</li><li>Hodnota atributu <strong>Typ objektu</strong> je nastavena <strong>Vozidlo</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Typ objektu</a>).</li><li>Hodnota atributu <strong>Provozovna</strong> je k dispozici (různá od NULL).</li><li>Hodnota atributu <strong>Datum zařazení</strong> je menší nebo rovna hodnotě získané v rámci elementu <strong>datumRealizace</strong>.</li><li>Hodnota atributu <strong>Datum vyřazení</strong> je větší nebo rovna hodnotě získané v rámci elementu <strong>datumRealizace</strong>.</li><li>Existuje alespoň jeden takový <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy objektu</a>, který odkazuje na zkoumaný <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> (atribut <strong>Objekt</strong>).</li></ul><p>Hledáme tedy pouze mezi takovými <a href="../../../datove-modely/datovy-78681044.html">Objekty</a>, pro které jsou generovány <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>.</p></td><td colspan="1">Pokud není pro získané evidenční číslo vozidla nalezen žádný <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> (případně je nalezen neaktivní či nevyhovující záznam), končí zpracování jízdy chybou (je přeskočena).</td></tr><tr><td colspan="1">datumRealizace</td><td colspan="1">Den, ve který má být jízda realizována.</td><td colspan="1">Převedení obsažené hodnoty na datum, část obsahující čas je ignorována.</td><td colspan="1"><p>Pokud není pro získáno validní datum realizace, nedochází k naplánování odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (jízda je však i přesto zpracována).</p><p>Obsažené časové razítko je předáváno v lokálním čase. Při zpracování hodnoty pak nesmí docházet k jeho převodu do UTC, který by mohl způsobit získání chybné hodnoty (posun na předchozí den).</p></td></tr><tr><td colspan="1">smlouva</td><td colspan="1">Informace o smlouvě, pod kterou má být jízda realizována.</td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (odpovídá entitě <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>).</td><td colspan="1"><p>Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>.</p></td></tr><tr><td colspan="1">zakaznik</td><td colspan="1">Zákazník, pro kterého má být jízda realizována.</td><td colspan="1"><p>Zpracování obsaženého objektu, viz poznámka (odpovídá entitě <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>).</p></td><td colspan="1">Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>.</td></tr><tr><td colspan="1">pocatekJizdy</td><td colspan="1">Počáteční bod jízdy.</td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (dle typu položky je zpracováno jako <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> či <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">Informace jsou předány ve formě objektu, při zpracování je současně uvažována také hodnota elementu <strong>cilJizdy</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</td></tr><tr><td colspan="1">cilJizdy</td><td colspan="1">Koncový bod jízdy.</td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (dle typu položky je zpracováno jako <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> či <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">Informace jsou předány ve formě objektu, při zpracování je současně uvažována také hodnota elementu <strong>pocatekJizdy</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</td></tr><tr><td colspan="1">odpady</td><td colspan="1">Odpady (včetně kódu nakládání), s kterými je v rámci jízdy nakládáno.</td><td colspan="1">Zpracování obsažených objektů, viz poznámka (odpovídá entitě <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu ve smlouvě</a>, současně je porovnáváno také s <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a>).</td><td colspan="1">Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a>.</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG06: Zrušení objednaných služeb</h2><p>Cílem algoritmu je zrušení takových <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a>, které sice figurují na straně RoadPlan, ale již nejsou dostupné ve WinyX. V potaz jsou pak samozřejmě brány pouze <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> vytvořené v rámci synchronizace.</p><p>Poznámka: Při zpracování jízd došlo k označení takových <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a>, pro které byly získány informace z WinyX. S touto informací v rámci algoritmu pracujeme.</p><ol><li>Systém získá takové <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, které splňují všechny dále uvedené podmínky zároveň:<ul><li>Daná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> byla načtena na začátku UC (byla získána v rámci <a href="605uc03-116788570.html">ALG01: Získání objednaných služeb</a>).</li><li>Daná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> nebyla označena (nedošlo k jejímu zpracování v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ul></li><li>Pro všechny získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz krok <strong>1</strong>):<ol><li>Pokud je hodnota atributu <strong>Stav</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> nastavena na <strong>Naplánovaná</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednané služby</a>):<ol><li>Systém nalezne odpovídající <a href="../../../datove-modely/datovy-78681044.html">Položku denního výkonu</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Objednaná služba</strong> odpovídá právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané službě</a>.</li></ul></li><li>Systém zruší naplánování nalezené <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> – spustí <a href="#" data-page-title="200UC26: Odebrat položky z denního výkonu"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Položky denního výkonu</strong>: nalezená <a href="../../../datove-modely/datovy-78681044.html">Položka denního výkonu</a> (viz krok <strong>2.a.i</strong>).</li><li><em>Poznámka: Pokud nedojde k úspěšnému odebrání položky z <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>, je tato <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> přeskočena (současně dochází k logování této skutečnosti). </em></li></ul></li></ol></li></ol></li><li>Systém zruší získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> – spustí <a href="#" data-page-title="101UC05: Zrušit objednanou službu"></a>, na vstup jsou předány následující informace:<ul><li><strong>Objednané služby</strong>: všechny získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz krok <strong>1</strong>).</li><li><em>Poznámka: Pokud nedojde k úspěšnému zrušení některé z <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a>, dochází k jejímu přeskočení (současně dochází k logování této skutečnosti). </em><br></li></ul></li></ol><p>Poznámka: Rozdělené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> nejsou před zrušením slučovány. V některých případech již nemusí být jejich sloučení ani možné.</p><h2>ALG07: Zpracování zákazníka</h2><p>Cílem algoritmu je zpracování informací o zákazníkovi, který byl spolu s jízdou získán z WinyX. Výsledkem pak může provedení jedné z dále uvedených akci:</p><ul><li>založení nového <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (neexistuje záznam s odpovídajícím identifikátorem),</li><li>aktualizace stávajícího <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (případně obnovení již odebraného záznamu).</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takového <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a>, který splňuje všechny dále uvedené podmínky:<ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.</li></ul></li><li>Pokud je nalezen <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz krok <strong>1</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit zákazníka, na vstup jsou předány následující informace:<ul><li><strong>Editovaný zákazník</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz krok <strong>1</strong>). </li><li><strong>Změny v zákazníkovi</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>:<ul><li><strong>Externí identifikátor</strong>: hodnota získána v rámci elementu <strong>id</strong> (nedochází ke změně hodnoty).</li><li><strong>Název</strong>: hodnota získaná v rámci elementu <strong>nazev</strong>.</li><li><strong>Je podnikatel</strong>: pokud je k dispozici hodnota elementu <strong>ico</strong>, je nastavena hodnota <strong>TRUE</strong> (jinak <strong>FALSE</strong>).</li><li><strong>Právní forma</strong>: hodnota atributu <strong>Právní forma</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>IČO</strong>: hodnota získaná v rámci elementu <strong>ico</strong>.</li><li><strong>DIČ</strong>: hodnota atributu <strong>DIČ</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>IČ DPH</strong>: hodnota atributu <strong>IČ DPH</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Plátce DPH</strong>: hodnota atributu <strong>Plátce DPH</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Adresa sídla</strong>: hodnota získána v rámci elementu <strong>adresa</strong> (viz <a href="605uc03-116788570.html">ALG08: Zpracování adresy zákazníka</a>).</li><li><strong>Výchozí statutární zástupce</strong>: hodnota atributu <strong>Výchozí statutární zástupce</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Výchozí kontaktní osoba</strong>: hodnota atributu <strong>Výchozí kontaktní osoba</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Výchozí místo realizace</strong>: hodnota atributu <strong>Výchozí místo realizace</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Výchozí bankovní spojení</strong>: hodnota atributu <strong>Výchozí bankovní spojení</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Poznámka</strong>: hodnota atributu <strong>Poznámka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Bonita</strong>: hodnota atributu <strong>Bonita</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Odeslán ke kontrole</strong>: hodnota atributu <strong>Odeslán ke kontrole</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Načten z rejstříku</strong>: hodnota atributu <strong>Načten z rejstříku</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Zákazníka</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (tedy opravdu dochází k jeho změně).</em></li></ul></li><li>Jinak takový <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> nalezen není (viz krok <strong>1</strong>), systém provede jeho založení – spustí TODO: UC – Založit zákazníka, na vstup jsou předány následující informace:<ul><li><strong>Zakládaný zákazník</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>:<ul><li><strong>Externí identifikátor</strong>: hodnota získána v rámci elementu <strong>id</strong>.</li><li><strong>Název</strong>: hodnota získaná v rámci elementu <strong>nazev</strong>.</li><li><strong>Je podnikatel</strong>: pokud je k dispozici hodnota elementu <strong>ico</strong>, je nastavena hodnota <strong>TRUE</strong> (jinak <strong>FALSE</strong>).</li><li><strong>Právní forma</strong>: není předána žádná hodnota (NULL).</li><li><strong>IČO</strong>: hodnota získaná v rámci elementu <strong>ico</strong>.</li><li><strong>DIČ</strong>: není předána žádná hodnota (NULL).</li><li><strong>IČ DPH</strong>: není předána žádná hodnota (NULL).</li><li><strong>Plátce DPH</strong>: nastavena hodnota <strong>TRUE</strong>.</li><li><strong>Adresa sídla</strong>: hodnota získána v rámci elementu <strong>adresa</strong> (viz <a href="605uc03-116788570.html">ALG08: Zpracování adresy zákazníka</a>).</li><li><strong>Výchozí statutární zástupce</strong>: není předána žádná hodnota (NULL).</li><li><strong>Výchozí kontaktní osoba</strong>: není předána žádná hodnota (NULL).</li><li><strong>Výchozí místo realizace</strong>: není předána žádná hodnota (NULL; nastaveno při zpracování prvního <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a>).</li><li><strong>Výchozí bankovní spojení</strong>: není předána žádná hodnota (NULL).</li><li><strong>Poznámka</strong>: není předána žádná hodnota (NULL).</li><li><strong>Bonita</strong>: nastavena hodnota <strong>TRUE</strong>.</li><li><strong>Odeslán ke kontrole</strong>: nastavena hodnota <strong>FALSE</strong>.</li><li><strong>Načten z rejstříku</strong>: nastavena hodnota <strong>FALSE</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li></ul></li></ol><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">id</td><td colspan="1">Identifikátor zákazníka ve WinyX.</td><td colspan="1">Převedení obsažené hodnoty na text (odpovídá atributu <strong>Externí identifikátor</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>).</td><td colspan="1">Slouží k „párování“ záznamů napříč systémy.</td></tr><tr><td colspan="1">nazev</td><td colspan="1">Název zákazníka.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Název</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">ico</td><td colspan="1">Identifikační číslo osoby.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>IČO</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>).</td><td colspan="1">Vyhodnocován také při nastavení hodnoty atributu <strong>Je podnikatel</strong>.</td></tr><tr><td colspan="1">adresa</td><td colspan="1">Adresa sídla.</td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (odpovídá atributu <strong>Adresa</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>).</td><td colspan="1"><p>Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc03-116788570.html">ALG08: Zpracování adresy zákazníka</a>.</p><p>Geokódování adresy není v tomto případě potřeba.</p></td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG08: Zpracování adresy zákazníka</h2><p>Cílem algoritmu je zpracování informací o adrese daného zákazníka, které byly získány z WinyX. Pracujeme pak s dále uvedenými informacemi:</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>, který byl získán či založen v rámci <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>.</li><li>Informace o adrese, které byly získány v rámci elementu <strong>adresa</strong>.</li></ul><p>Výsledkem pak může být provedení některé z dále uvedených akcí:</p><ul><li>založení nové <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (neexistuje záznam s odpovídajícím identifikátorem),</li><li>aktualizace stávající <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (případně obnovení již odebraného záznamu).</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takovou <a href="../../../datove-modely/datovy-78681044.html">Adresu</a>, která splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.</li></ul></li><li>Pokud je nalezena <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>1</strong>), systém provede její aktualizaci – spustí TODO: UC – Upravit adresu, na vstup jsou předány následující informace:<br><ul><li><ul><li><strong>Editovaná adresa</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>1</strong>). </li><li><strong>Změny v adrese</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong> (nedochází ke změně hodnoty).</li><li><strong>Ulice</strong>: hodnota získaná v rámci elementu <strong>ulice</strong>.</li><li><strong>Číslo popisné</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Číslo orientační</strong>: hodnota atributu <strong>Číslo orientační</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Město</strong>: hodnota získaná v rámci elementu <strong>obec</strong>.</li><li><strong>PSČ</strong>: hodnota získaná v rámci elementu <strong>psc</strong>.</li><li><strong>Stát</strong>: hodnota získaná v rámci elementu <strong>zeme</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (tedy opravdu dochází k její změně).</em></li></ul></li></ul></li><li>Jinak taková <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> nalezena není (viz krok <strong>1</strong>), systém provede její založení – spustí TODO: UC – Založit adresu, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná adresa</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong>.</li><li><strong>Ulice</strong>: hodnota získaná v rámci elementu <strong>ulice</strong>.</li><li><strong>Číslo popisné</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Číslo orientační</strong>: není předána žádná hodnota (NULL).</li><li><strong>Město</strong>: hodnota získaná v rámci elementu <strong>obec</strong>.</li><li><strong>PSČ</strong>: hodnota získaná v rámci elementu <strong>psc</strong>.</li><li><strong>Stát</strong>: hodnota získaná v rámci elementu <strong>zeme</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li></ul></li></ol><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">id</td><td colspan="1">Identifikátor adresy ve WinyX.</td><td colspan="1"><p>Převedení obsažené hodnoty na text (odpovídá atributu <strong>Externí identifikátor</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</p><p>Pokud není hodnota k dispozici, provedeme její generování. Využijeme informace získané v rámci odpovídajícího zákazníka:</p><ul><li>Formát: <strong>ZAK::<id></strong></li><li>Příklad hodnoty: <strong>ZAK::84229</strong></li></ul><p>Význam jednotlivých položek je následující:</p><ul><li><strong>id</strong>: identifikátor zákazníka získaný z WinyX (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li></ul></td><td colspan="1"><p>Slouží k „párování“ záznamů napříč systémy.</p></td></tr><tr><td colspan="1">ulice</td><td colspan="1">Ulice dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Ulice</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">cislo</td><td colspan="1">Číslo popisné (případně také číslo orientační) dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Číslo popisné</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">obec</td><td colspan="1">Obec dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Město</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">psc</td><td colspan="1">Poštovní směrovací číslo dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>PSČ</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">zeme</td><td colspan="1">Stát dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Stát</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG09: Zpracování smlouvy</h2><p>Cílem algoritmu je zpracování informací o smlouvě, která byla spolu s jízdou získána z WinyX. Výsledkem pak může provedení jedné z dále uvedených akci:</p><ul><li>založení nové <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (neexistuje záznam s odpovídajícím identifikátorem),</li><li>aktualizace stávající <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (případně obnovení již odebraného záznamu).</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takovou <a href="../../../datove-modely/datovy-78681044.html">Rámcovou smlouvu</a>, která splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.</li></ul></li><li>Pokud je nalezena <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a> (viz krok <strong>1</strong>), systém provede její aktualizaci – spustí TODO: UC – Upravit rámcovou smlouvu, na vstup jsou předány následující informace:<br><ul><li><strong>Editovaná rámcová smlouva</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a> (viz krok <strong>1</strong>). </li><li><strong>Změny v rámcové smlouvě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získána v rámci elementu <strong>id</strong> (nedochází ke změně hodnoty).</li><li><strong>Provozovna</strong>: hodnota získaná v rámci elementu <strong>provozovna</strong> získané jízdy (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Číslo smlouvy</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Zákazník</strong>: hodnota získaná v rámci elementu <strong>zakaznik</strong> získané jízdy (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><strong>Platnost od</strong>: hodnota získaná v rámci elementu <strong>platnostOd</strong>.</li><li><strong>Platnost do</strong>: hodnota získaná v rámci elementu <strong>platnostDo</strong>.</li><li><strong>Kategorie smlouvy</strong>: hodnota atributu <strong>Kategorie smlouvy</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Typ smlouvy</strong>: hodnota atributu <strong>Typ smlouvy</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Stav smlouvy</strong>: hodnota atributu <strong>Stav smlouvy</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Nákladové středisko</strong>: hodnota atributu <strong>Nákladové středisko</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Je interní smlouva</strong>: hodnota atributu <strong>Je interní smlouva</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Informace k zákazníkovi</strong>: hodnota atributu <strong>Informace k zákazníkovi</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvy</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (tedy opravdu dochází k její změně).</em></li></ul></li><li>Jinak taková <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a> nalezena není (viz krok <strong>1</strong>), systém provede její založení – spustí TODO: UC – Založit rámcovou smlouvu, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná rámcová smlouva</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získána v rámci elementu <strong>id</strong>.</li><li><strong>Provozovna</strong>: hodnota získaná v rámci elementu <strong>provozovna</strong> získané jízdy (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Číslo smlouvy</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Zákazník</strong>: hodnota získaná v rámci elementu <strong>zakaznik</strong> získané jízdy (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><strong>Platnost od</strong>: hodnota získaná v rámci elementu <strong>platnostOd</strong>.</li><li><strong>Platnost do</strong>: hodnota získaná v rámci elementu <strong>platnostDo</strong>.</li><li><strong>Kategorie smlouvy</strong>: není předána žádná hodnota (NULL).</li><li><strong>Typ smlouvy</strong>: není předána žádná hodnota (NULL).</li><li><strong>Stav smlouvy</strong>: není předána žádná hodnota (NULL).</li><li><strong>Nákladové středisko</strong>: není předána žádná hodnota (NULL).</li><li><strong>Je interní smlouva</strong>: není předána žádná hodnota (NULL).</li><li><strong>Informace k zákazníkovi</strong>: není předána žádná hodnota (NULL).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li></ul></li></ol><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">id</td><td colspan="1">Identifikátor smlouvy ve WinyX.</td><td colspan="1">Převedení obsažené hodnoty na text (odpovídá atributu <strong>Externí identifikátor</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>).</td><td colspan="1">Slouží k „párování“ záznamů napříč systémy.</td></tr><tr><td colspan="1">cislo</td><td colspan="1">Číslo smlouvy.</td><td colspan="1">Převedení obsažené hodnoty na text (odpovídá atributu <strong>Číslo smlouvy</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">platnostOd</td><td colspan="1">Začátek platnosti smlouvy.</td><td colspan="1">Převedení obsažené hodnoty na datum, část obsahující čas je ignorována (odpovídá atributu <strong>Platnost od</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>).</td><td colspan="1">Obsažené časové razítko je předáváno v lokálním čase. Při zpracování hodnoty pak nesmí docházet k jeho převodu do UTC, který by mohl způsobit získání chybné hodnoty (posun na předchozí den).</td></tr><tr><td colspan="1">platnostDo</td><td colspan="1">Konec platnosti smlouvy.</td><td colspan="1">Převedení obsažené hodnoty na datum, část obsahující čas je ignorována (odpovídá atributu <strong>Platnost do</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>).</td><td colspan="1"><p>Obsažené časové razítko je předáváno v lokálním čase. Při zpracování hodnoty pak nesmí docházet k jeho převodu do UTC, který by mohl způsobit získání chybné hodnoty (posun na předchozí den).</p><p>Pokud není předána hodnota, jedná se o smlouvu s neomezenou platností</p></td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG10: Zpracování bodů jízdy</h2><p>Cílem algoritmu je zpracování počátku a cíle jízdy. K dispozici máme dále uvedené informace:</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a>, pod kterým má být provedena realizace jízdy (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>, pro kterého má být provedena realizace jízdy (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>; využito pro případné zpracování <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a>).</li><li>Informace o bodech jízdy, které byly získány v rámci elementů <strong>pocatekJizdy</strong> a <strong>cilJizdy</strong>.</li></ul><p>Snažíme se pak především o získání následujících informací nutných pro zpracování jízdy…</p><ul><li>adresné body (určení trasy vozidla),</li><li>typ úkonu (určení prováděné akce).</li></ul><p>Každý ze získaných bodů je specifikován svým typem, tomu odpovídají také s ním předané informace. Pracujeme pak s dále uvedenými typy bodů:</p><ul><li><strong>LM</strong>: likvidační místo,</li><li><strong>SS</strong>: stanoviště smlouvy,</li><li><strong>PM</strong>: předávací místo,</li><li><strong>J</strong>: jiné (není podporováno).</li></ul><p>Pro určení <a href="../../../datove-modely/datovy-78681044.html">Typu úkonu</a>, který má být v rámci jízdy proveden, vyhodnocujeme konfiguraci získaných bodů. Ta je dána právě typem získaných bodů, na úrovni jednotlivých <a href="../../../datove-modely/datovy-78681044.html">Typů dopravy</a> jsou pak podporovány dále uvedené kombinace:</p><table><tbody><tr><th>Háková nakladač</th><th>Ramenový nakladač</th><th>Valník</th><th>Cisterna</th></tr><tr><td><ul><li><strong>LM-LM</strong>: Vývoz mezi likvidačními místy,</li><li><strong>SS-LM</strong>, <strong>LM-SS</strong>: Vývoz s výměnou,</li><li><strong>PM-LM</strong>, <strong>LM-PM</strong>: Vývoz s výměnou.</li></ul></td><td><ul><li><strong>LM-LM</strong>: Vývoz mezi likvidačními místy,</li><li><strong>SS-LM</strong>, <strong>LM-SS</strong>: Vývoz s výměnou,</li><li><strong>PM-LM</strong>, <strong>LM-PM</strong>: Vývoz s výměnou.</li></ul></td><td><ul><li><strong>LM-LM</strong>: Vývoz mezi likvidačními místy,</li><li><strong>SS-LM</strong>, <strong>LM-SS</strong>: Sběr,</li><li><strong>PM-LM</strong>, <strong>LM-PM</strong>: Sběr.</li></ul></td><td><ul><li><strong>LM-LM</strong>: Vývoz mezi likvidačními místy,</li><li><strong>SS-LM</strong>, <strong>LM-SS</strong>: Sběr,</li><li><strong>PM-LM</strong>, <strong>LM-PM</strong>: Sběr.</li></ul></td></tr></tbody></table><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém zpracuje počáteční bod jízdy získaný v rámci elementu <strong>pocatekJizdy</strong> – provedená akce se odvíjí od jeho typu (element <strong>type</strong>):<br><ul><li><strong>LM</strong>: Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (viz <a href="605uc03-116788570.html">ALG11: Zpracování likvidačního místa</a>).</li><li><strong>SS</strong>: Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz <a href="605uc03-116788570.html">ALG12: Zpracování místa realizace pro stanoviště smlouvy</a>).</li><li><strong>PM</strong>: Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz <a href="605uc03-116788570.html">ALG28: Zpracování místa realizace pro předávací místo</a>).</li><li><strong>J</strong>: Systém provede logování uvedené skutečnosti a pokračuje dalším záznamem v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.</li></ul></li><li>Systém zpracuje koncový bod jízdy získaný v rámci elementu <strong>cilJizdy</strong> – provedená akce se odvíjí od jeho typu (element <strong>type</strong>):<br><ul><li><strong>LM</strong>: Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (viz <a href="605uc03-116788570.html">ALG11: Zpracování likvidačního místa</a>).</li><li><strong>SS</strong>: Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz <a href="605uc03-116788570.html">ALG12: Zpracování místa realizace pro stanoviště smlouvy</a>).</li><li><strong>PM</strong>: Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz <a href="605uc03-116788570.html">ALG28: Zpracování místa realizace pro předávací místo</a>).</li><li><strong>J</strong>: Systém provede logování uvedené skutečnosti a pokračuje dalším záznamem v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.<br></li></ul></li><li>Systém vyhodnotí, jaký <a href="../../../datove-modely/datovy-78681044.html">Typu úkonu</a> má být v rámci daného <a href="../../../datove-modely/datovy-78681044.html">Typu dopravy</a> proveden (viz dříve uvedená tabulka).<br><ul><li><em>Dochází k porovnání počátečního a cílového bodu jízdy (elementy <strong>pocatekJizdy</strong> a <strong>cilJizdy</strong>).</em></li><li><em>V rámci uvedených bodů pak pracujeme s elementem <strong>type</strong>, který specifikuje typ daného bodu.</em></li></ul></li><li>Pokud je získán odpovídající <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> (viz krok <strong>3</strong>), systém s ním dále pracuje při zpracování jízdy.</li><li>Jinak takový <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> získán není, systém provede logování uvedené skutečnosti a pokračuje dalším záznamem v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.<br><ul><li><em>Jedná se o nepodporovanou kombinaci počátku a cíle jízdy.</em></li></ul></li></ol><p>Strukturu odpovědi (její odpovídající části společně pro všechny typy bodů) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">type</td><td colspan="1">Typ získaného bodu jízdy.</td><td colspan="1">Předání obsažené hodnoty.</td><td colspan="1">Dostupné hodnoty jsou pevně dány, viz dříve uvedený popis.</td></tr><tr><td colspan="1">id</td><td colspan="1"><p>Identifikátor záznamu odpovídající entity ve WinyX.</p><ul><li>Dostupné pro dále uvedené typy bodů: <strong>LM</strong>, <strong>SS</strong>, <strong>PM</strong>.</li></ul></td><td colspan="1"><p>Převedení obsažené hodnoty na text (typicky odpovídá atributu <strong>Externí identifikátor</strong> odpovídající entity, tedy <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> či <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a>).</p></td><td colspan="1"><p>Slouží k „párování“ záznamů napříč systémy.</p></td></tr><tr><td colspan="1">nazev</td><td colspan="1"><p>Název stanoviště smlouvy.</p><ul><li>Dostupné pro dále uvedené typy bodů: <strong>SS</strong>.</li></ul></td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Název</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>).</td><td colspan="1"><p>Pokud není hodnota k dispozici, je hodnota generována systémem (<a href="605uc03-116788570.html">ALG15: Získání názvu místa realizace</a>). To je využito v dále uvedených případech:</p><ul><li>Pro typ bodu <strong>SS: Stanoviště smlouvy</strong> nebyla získána hodnota.</li><li>Jedná se o body typu <strong>PP: Předávací místo</strong>.</li></ul></td></tr><tr><td colspan="1">gps</td><td colspan="1"><p>Souřadnice stanoviště smlouvy či předávacího místa.</p><ul><li>Dostupné pro dále uvedené typy bodů: <strong>SS</strong>, <strong>PM</strong>.</li></ul></td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (odpovídá atributům <strong>Zeměpisná délka</strong> a <strong>Zeměpisná šířka</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>).</td><td colspan="1"><p>Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a>.</p><p>Souřadnice jsou pak na úrovni existujícího <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> aktualizovány pouze v případě, kdy nedošlo k jejich upřesnění uživatelem.</p></td></tr><tr><td colspan="1">adresa</td><td colspan="1"><p>Adresa stanoviště smlouvy či předávacího místa.</p><ul><li>Dostupné pro dále uvedené typy bodů: <strong>SS</strong>, <strong>PM</strong>.</li></ul></td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (odpovídá atributu <strong>Adresa</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>).</td><td colspan="1"><p>Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc03-116788570.html">ALG14: Zpracování adresy místa realizace</a>.</p></td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části pro jednotlivé typy bodů) je pak naznačen následně (včetně ilustrativních hodnot).</p><table><tbody><tr><th>LM: Likvidační místo</th><th>SS: Stanoviště smlouvy</th><th>PM: Předávací místo</th><th>J: Jiné</th></tr><tr><td colspan="1"></td><td colspan="1"></td><td colspan="1"><p><em>Dočasná poznámka: Došlo ke změně struktury.</em></p></td><td colspan="1"></td></tr></tbody></table><h2>ALG11: Zpracování likvidačního místa</h2><p>Cílem algoritmu je zpracování identifikátoru likvidačního místa, který byl získán z WinyX. Hledáme tedy odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> na straně RoadPlan.</p><ul><li><em>Pokud takové <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> nalezeno není, není synchronizována ani jízda.</em></li><li><em>Důvodem je skutečnost, že jsou <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> synchronizována samostatně.</em></li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takové <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, které splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.<br></li></ul></li><li>Pokud je nalezeno <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (viz krok <strong>1</strong>), systém s ním dále pracuje při zpracování jízdy.<ul><li><em>Poznámka: Získané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> musí obsahovat validní souřadnice (atributy <strong>Zeměpisná délka</strong> a <strong>Zeměpisná šířka</strong>). </em></li></ul></li><li>Jinak takové <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> nalezeno není (viz krok <strong>1</strong>), systém provede logování uvedené skutečnosti a pokračuje dalším záznamem v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.</li></ol><p>Strukturu odpovědi (její odpovídající části) je včetně ilustrativního příkladu uvedena v rámci <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>. Proto ji zde neopakujeme.</p><h2>ALG12: Zpracování místa realizace pro stanoviště smlouvy</h2><p>Cílem algoritmu je zpracování informací o místě realizace, které byly získány z WinyX (jako bod typu <strong>Stanoviště smlouvy</strong>). Pracujeme pak s dále uvedenými informacemi:</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>, pro kterého má být provedena realizace jízdy (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><a href="../../../datove-modely/datovy-78681044.html">Provozovna</a>, pod kterou je jízda realizována (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>, pod kterou je jízda realizována (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li>Informace o bodu jízdy, které byly získány v rámci jednoho z dále uvedených elementů: <strong>pocatekJizdy</strong>, <strong>cilJizdy</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).<br><ul><li><em>Jedná se o body, které představují <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>. Způsob jejich zpracování se však žádným způsobem neliší.</em></li></ul></li></ul><p>Na výstupu algoritmu pak získáváme nejen samotná <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a>, ale také jemu odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>…</p><ul><li><em>Tyto informace jsou důležité při hledání odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> (resp. jejího <a href="../../../datove-modely/datovy-78681044.html">Objednaného úkonu</a></em><em>).</em></li><li><em>Pokud je takový <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> nalezen, můžeme pro něj rovnou vytvořit <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a></em><em>.</em></li></ul><p>Struktura záznamu i jeho zpracování je dáno typem bodu, zde pracujeme se <strong>Stanovištěm smlouvy</strong> (hodnota <strong>SS</strong>)…</p><ul><li>Jedná se o obdobu <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> na straně RoadPlan (předáváno včetně identifikátoru).</li><li>Snažíme se najít odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> na straně RoadPlan (případně ho zakládáme).</li><li>Získaný záznam je pak dostupný také pro běžné zakládání <a href="../../../datove-modely/datovy-78681044.html">Objednávek</a> uživatelem.</li></ul><p>Struktura, ve které jsou informace získány, pak odpovídá typu odpovídajícího bodu jízdy:</p><ul><li><strong>SS: Stanoviště smlouvy</strong> – obdoba <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> na straně RoadPlan (předáváno včetně identifikátoru).</li><li><strong>PM: Předávací místo</strong> – běžná adresa bodu jízdy (na straně RoadPlan zpracováno jako <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>).</li></ul><p>Dle typu bodu jízdy je také určen způsob zpracování záznamu…</p><ul><li><strong>SS: Stanoviště smlouvy</strong> – snažíme se najít odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> na straně RoadPlan (případně ho zakládáme). Získaný záznam je pak dostupný také pro běžné zakládání <a href="../../../datove-modely/datovy-78681044.html">Objednávek</a> uživatelem.</li><li><strong>PM: Předávací místo</strong> – rovnou zakládáme nové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>, které je ale následně označeno jako odebrané. Není tedy dostupné pro běžné zakládání <a href="../../../datove-modely/datovy-78681044.html">Objednávek</a> uživatelem.<br><ul><li><em>Jedná se o obdobu ad-hoc založených <a href="../../../datove-modely/datovy-78681044.html">Míst realizace</a> ve formuláři objednávky. Záznam navíc není opatřen ani externím identifikátorem.</em></li><li><em>Můžeme pak přímo založit neaktivní <em><a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>, z pohledu validací při zakládání objednávky by to neměl být problém.</em></em></li><li><em><em>Obdobně se chováme také k dopovídajícímu <em><em><a href="../../../datove-modely/datovy-78681044.html">Místu realizace ve smlouvě</a>, i zde zakládáme neaktivní záznam.</em></em></em></em></li></ul></li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém se pokusí najít odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> – hledá takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>, které splňuje všechny dále uvedené podmínky:<ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci více elementů (viz <a href="605uc03-116788570.html">ALG26: Získání externího identifikátoru místa realizace pro stanoviště smlouvy</a>).</li></ul></li><li>Systém zpracuje získané informace o bodu jízdy – získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ol><li>Pokud je nalezeno <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>1</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit místo realizace, na vstup jsou předány následující informace:<br><ul><li><strong>Editované místo realizace</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>1</strong>).</li><li><strong>Změny v místě realizace</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG26: Získání externího identifikátoru místa realizace pro stanoviště smlouvy</a>; nedochází ke změně hodnoty).<br><ul><li><em>Dostupné pouze pro body jízdy typu <strong>SS</strong>, u kterých je k dispozici hodnota pro element <strong>id</strong>.</em></li></ul></li><li><strong>Zákazník</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><strong>Název</strong>: hodnota získaná v rámci elementu <strong>nazev</strong>.</li><li><strong>Adresa</strong>: hodnota získaná v rámci elementu <strong>adresa</strong> (viz <a href="605uc03-116788570.html">ALG14: Zpracování adresy místa realizace</a>).</li><li><strong>Zeměpisná délka</strong>: vyhodnoceno dle hodnoty atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>).<br><ul><li><strong>Manuálně</strong>: hodnota atributu <strong>Zeměpisná <strong>délka</strong></strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>; zachování hodnoty).</li><li><em><strong>Jinak</strong></em>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a>).<br></li></ul></li><li><strong>Zeměpisná šířka</strong>: vyhodnoceno dle hodnoty atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>).<br><ul><li><strong>Manuálně</strong>: hodnota atributu <strong>Zeměpisná <strong>šířka</strong></strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>; zachování hodnoty).</li><li><em><strong>Jinak</strong></em>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a>).<br></li></ul></li><li><strong>Stav geokódování</strong>: vyhodnoceno dle hodnoty atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>).<br><ul><li><strong>Manuálně</strong>: hodnota atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>; zachování hodnoty).</li><li><em><strong>Jinak</strong></em>: hodnota získaná při vyhodnocení elementu <strong>gps</strong> (viz <a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a>).<br></li></ul></li><li><strong>Kontakt</strong>: hodnota atributu <strong>Kontakt</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>; zachování hodnoty).</li><li><strong>Poznámka</strong>: hodnota atributu <strong>Poznámka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>1.a</strong>; zachování hodnoty).</li><li><strong>Provozovna</strong>: není předána žádná hodnota (NULL; řešeno na úrovni entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (opravdu dochází k jeho změně).</em></li></ul></li><li>Jinak takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> nalezeno není (viz krok <strong>1.a</strong>), systém provede jeho založení – spustí TODO: UC – Založit místo realizace, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná místo realizace</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG26: Získání externího identifikátoru místa realizace pro stanoviště smlouvy</a>). nastavená hodnota odpovídá hodnotě získané v rámci elementu <strong>type</strong>:<br><ul><li><strong>SS</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG26: Získání externího identifikátoru místa realizace</a>),</li><li><strong>PM</strong>: není nastavena žádná hodnota (u bodů tohoto typu není k dispozici identifikátor).</li></ul></li><li><strong>Zákazník</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><strong>Název</strong>: hodnota získaná v rámci elementu <strong>nazev</strong>.</li><li><strong>Adresa</strong>: hodnota získaná v rámci elementu <strong>adresa</strong> (viz <a href="605uc03-116788570.html">ALG14: Zpracování adresy místa realizace</a>).</li><li><strong>Zeměpisná délka</strong>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a>).</li><li><strong>Zeměpisná šířka</strong>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a>).</li><li><strong>Stav geokódování</strong>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a>).</li><li><strong>Kontakt</strong>: není předána žádná hodnota (NULL).</li><li><strong>Poznámka</strong>: není předána žádná hodnota (NULL).</li><li><strong>Provozovna</strong>: není předána žádná hodnota (NULL; řešeno na úrovni entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>. nastavená hodnota odpovídá hodnotě získané v rámci elementu <strong>type</strong>:<br><ul><li><strong>SS</strong>: nastavena hodnota <strong>TRUE</strong>,</li><li><strong>PM</strong>: nastavena hodnota <strong>FALSE</strong>.</li></ul></li></ul></li></ul></li></ol></li><li>Systém zpracuje získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> vzhledem k odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> – získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>:<br><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>, které splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Místo realizace</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Místu realizace</a> (viz krok <strong>2</strong>).</li><li>Hodnota atributu <strong>Rámcová smlouva</strong> odpovídá <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> získané v rámci jízdy (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li></ul></li><li>Pokud je nalezeno <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a> (viz krok <strong>3.a</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit místo realizace ve smlouvě, na vstup jsou předány následující informace:<br><ul><li><strong>Editované místo realizace ve smlouvě</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a> (viz krok <strong>3.a</strong>).</li><li><strong>Změny v místě realizace ve smlouvě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG27: Získání externího identifikátoru místa realizace ve smlouvě pro stanoviště smlouvy</a>, nedochází ke změně hodnoty).<br><ul><li><em>Poznámka: Dostupné pouze pro body jízdy typu <strong>SS</strong>, u kterých je k dispozici hodnota pro element <strong>id</strong> daného bodu jízdy.</em></li></ul></li><li><strong>Rámcová smlouva</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>(viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li><strong>Místo realizace</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>2</strong>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Místa realizace ve smlouvě</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (opravdu dochází k jeho změně).</em><br></li></ul></li><li>Jinak takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a> nalezeno není (viz krok <strong>3.a</strong>), systém provede jeho založení – spustí TODO: UC – Založit místo realizace ve smlouvě, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná místo realizace ve smlouvě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG27: Získání externího identifikátoru místa realizace ve smlouvě pro stanoviště smlouvy</a>). nastavená hodnota odpovídá hodnotě získané v rámci elementu <strong>type</strong>:<br><ul><li><strong>SS</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG27: Získání externího identifikátoru místa realizace ve smlouvě</a>),</li><li><strong>PM</strong>: není nastavena žádná hodnota (u bodů tohoto typu není k dispozici identifikátor).</li></ul></li><li><strong>Rámcová smlouva</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li><strong>Místo realizace</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>2</strong>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>. nastavená hodnota odpovídá hodnotě získané v rámci elementu <strong>type</strong>:<br><ul><li><strong>SS</strong>: nastavena hodnota <strong>TRUE</strong>,</li><li><strong>PM</strong>: nastavena hodnota <strong>FALSE</strong>.</li></ul></li></ul></li></ul></li></ol></li></ol><p>Strukturu odpovědi (její odpovídající části) je včetně ilustrativního příkladu uvedena v rámci <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>. Proto ji zde neopakujeme.</p><h2>ALG13: Zpracování souřadnic místa realizace</h2><p>Cílem algoritmu je zpracování informací o souřadnicích daného místa realizace, které byly získány z WinyX. Pracujeme pak s dále uvedenými informacemi…</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>, které bylo získáno či založeno v rámci <a href="605uc03-116788570.html">ALG12: Zpracování místa realizace pro stanoviště smlouvy</a>.</li><li>Informace o souřadnicích, které byly získány v rámci elementu <strong>gps</strong>.</li></ul><p>Ke spuštění algoritmu pak dochází pouze v dále uvedených případech (viz <a href="605uc03-116788570.html">ALG12: Zpracování místa realizace pro stanoviště smlouvy</a>):</p><ul><li>založení nového záznamu (žádné informace zatím nejsou k dispozici),</li><li>editace záznamu, u kterého ale nebyly souřadnice upřesněny uživatelem.</li></ul><p>Vzhledem k tomu, že jsou souřadnice nepovinným údajem, může být výsledná hodnota získána různými způsoby…</p><ul><li>načtení souřadnic z WinyX (pokud jsou předány),</li><li>geokódování adresy místa realizace.</li></ul><p>V případě, kdy se nepodaří souřadnice získat, nedochází ani k synchronizaci jízdy (tato skutečnost je logována).</p><p>Poznámka: Zpracování souřadnic probíhá pouze u bodů typu <strong>SS: Stanoviště smlouvy</strong>. a <strong>PM: Předávací místo</strong>.</p><p>Samotný postup si nyní popíšeme…</p><ol><li>Pokud jsou k dispozici validní souřadnice (viz <a href="605uc03-116788570.html">VAL01: Validace jízdy</a>), systém předá na výstupu algoritmu hodnoty pro dále uvedené atributy entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ul><li><strong>Zeměpisná délka</strong>: hodnota získaná v rámci elementu <strong>gps.x</strong>.</li><li><strong>Zeměpisná šířka</strong>: hodnota získaná v rámci elementu <strong>gps.y</strong>.</li><li><strong>Stav geokódování</strong>: předána hodnota <strong>Externí zdroj</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav geokódování</a>).</li></ul></li><li>Jinak validní souřadnice v k dispozici nejsou – systém získá souřadnice z <a href="../../../datove-modely/datovy-78681044.html">Adresy</a>:<br><ol><li>Systém provede geokódování odpovídající <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> – spustí <a href="../700ucxx-obecne/706ucxx-mapove-sluzby/706uc02-117211324.html">706UC02: Získat souřadnice dle adresy</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Adresa</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz <a href="605uc03-116788570.html">ALG14: Zpracování adresy místa realizace</a>).</li><li><strong>Počet záznamů</strong>: předána hodnota <strong>1</strong>.</li></ul></li><li>Pokud proběhlo získání souřadnic v pořádku (viz krok <strong>2.a</strong>), systém předá na výstupu algoritmu hodnoty pro dále uvedené atributy entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ul><li><strong>Zeměpisná délka</strong>: hodnota výstupního parametru <strong>Souřadnice.Zeměpisná délka</strong> volaného UC (viz <a href="../700ucxx-obecne/706ucxx-mapove-sluzby/706uc02-117211324.html">706UC02: Získat souřadnice dle adresy</a>).</li><li><strong>Zeměpisná šířka</strong>: hodnota výstupního parametru <strong>Souřadnice.Zeměpisná šířka</strong> volaného UC (viz <a href="../700ucxx-obecne/706ucxx-mapove-sluzby/706uc02-117211324.html">706UC02: Získat souřadnice dle adresy</a>).</li><li><strong>Stav geokódování</strong>: předána hodnota <strong>Automaticky</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav geokódování</a>).</li></ul></li><li>Jinak získání souřadnic (viz krok <strong>2.a</strong>) v pořádku neproběhlo – systém provede logování uvedené skutečnosti a pokračuje dalším záznamem v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.<br><ul><li><em>Aby mohlo být místo realizace použito v rámci jízdy, musí být k dispozici také jeho souřadnice.</em></li><li><em>Aktuálně jízdy s místem realizace bez souřadnic nejsou synchronizovány (dochází k jejich přeskočení).</em></li></ul></li></ol></li></ol><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">x</td><td colspan="1">Souřadnice místa realizace (zeměpisná délka).</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Zeměpisná délka</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">y</td><td colspan="1">Souřadnice místa realizace (zeměpisná šířka).</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Zeměpisná šířka</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>).</td><td colspan="1">–</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG14: Zpracování adresy místa realizace</h2><p>Cílem algoritmu je zpracování informací o adrese daného místa realizace, které byly získány z WinyX. Pracujeme pak s dále uvedenými informacemi…</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>, které bylo získáno či založeno v rámci <a href="605uc03-116788570.html">ALG12: Zpracování místa realizace pro stanoviště smlouvy</a>.</li><li>Informace o adrese, které byly získány v rámci elementu <strong>adresa</strong>.</li></ul><p>Výsledkem pak může být provedení některé z dále uvedených akcí:</p><ul><li>založení nové <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (neexistuje záznam s odpovídajícím identifikátorem),</li><li>aktualizace stávající <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (případně obnovení již odebraného záznamu).</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takovou <a href="../../../datove-modely/datovy-78681044.html">Adresu</a>, která splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.</li></ul></li><li>Pokud je nalezena <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>1</strong>), systém provede její aktualizaci – spustí TODO: UC – Upravit adresu, na vstup jsou předány následující informace:<br><ul><li><strong>Editovaná adresa</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>1</strong>).</li><li><strong>Změny v adrese</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong> (nedochází ke změně hodnoty).</li><li><strong>Ulice</strong>: hodnota získaná v rámci elementu <strong>ulice</strong>.</li><li><strong>Číslo popisné</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Číslo orientační</strong>: hodnota atributu <strong>Číslo orientační</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Město</strong>: hodnota získaná v rámci elementu <strong>obec</strong>.</li><li><strong>PSČ</strong>: hodnota získaná v rámci elementu <strong>psc</strong>.</li><li><strong>Stát</strong>: hodnota získaná v rámci elementu <strong>zeme</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (opravdu dochází k její změně).</em></li></ul></li><li>Jinak taková <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> nalezena není (viz krok <strong>1</strong>), systém provede její založení – spustí TODO: UC – Založit adresu, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná adresa</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong>.</li><li><strong>Ulice</strong>: hodnota získaná v rámci elementu <strong>ulice</strong>.</li><li><strong>Číslo popisné</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Číslo orientační</strong>: není předána žádná hodnota (NULL).</li><li><strong>Město</strong>: hodnota získaná v rámci elementu <strong>obec</strong>.</li><li><strong>PSČ</strong>: hodnota získaná v rámci elementu <strong>psc</strong>.</li><li><strong>Stát</strong>: hodnota získaná v rámci elementu <strong>zeme</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li></ul></li></ol><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">id</td><td colspan="1">Identifikátor adresy ve WinyX.</td><td colspan="1"><p>Převedení obsažené hodnoty na text (odpovídá atributu <strong>Externí identifikátor</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</p><p>Pokud není hodnota k dispozici, provedeme její generování. Využijeme informace získané v rámci odpovídající jízdy:</p><ul><li>Formát: <strong>MR::<id></strong></li><li>Příklad hodnoty: <strong>MR::11177417</strong></li></ul><p>Význam jednotlivých položek je následující:</p><ul><li><strong>id</strong>: identifikátor jízdy získaný z WinyX (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ul></td><td colspan="1"><p>Slouží k „párování“ záznamů napříč systémy.</p></td></tr><tr><td colspan="1">ulice</td><td colspan="1">Ulice dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Ulice</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">cislo</td><td colspan="1">Číslo popisné (případně také číslo orientační) dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Číslo popisné</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">obec</td><td colspan="1">Obec dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Město</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">psc</td><td colspan="1">Poštovní směrovací číslo dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>PSČ</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">zeme</td><td colspan="1">Stát dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Stát</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG15: Získání názvu místa realizace</h2><p>Cílem algoritmu je získání názvu pro <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> v případě, kdy nebyla tato informace dostupná přímo ve WinyX.</p><p>Výsledná hodnota je pak generována v následujícím formátu: <strong><Město>, <Ulice> (<Název zákazníka>)</strong>. Význam jednotlivých položek je následující:</p><ul><li><strong>Město</strong>: hodnota atributu <strong>Město</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz <a href="605uc03-116788570.html">ALG14: Zpracování adresy místa realizace</a>).</li><li><strong>Ulice</strong>: hodnota atributu <strong>Ulice</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz <a href="605uc03-116788570.html">ALG14: Zpracování adresy místa realizace</a>).</li><li><strong>Název zákazníka</strong>: hodnota atributu <strong>Název</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li></ul><p>Pokud není k dispozici hodnota položky <strong>Ulice</strong>, je výsledný formát následující: <strong><Město> (<Název zákazníka>)</strong>. Význam dílčích položek je shodný.</p><p>V závěru si uvedeme také příklad hodnoty: <strong>Pardubice, Sakařova (TESCO Stores a.s.)</strong>, resp. <strong>Pardubice (TESCO Stores a.s.)</strong>, pokud není k dispozici název ulice.</p><p>Poznámka: Pokud délka výsledného řetězce přesahuje povolený rozsah hodnoty, dojde k „oříznutí“ získaného textu dle povoleného rozsahu hodnoty.</p><ul><li><em>U hodnot získaných přímo z WinyX by nemělo dojít k překročení povolené délky.</em> </li></ul><h2>ALG16: Zpracování odpadů v jízdě</h2><p>Cílem algoritmu je zpracování informací o druzích odpadu, které byly získány z WinyX. Pracujeme pak s dále uvedenými informacemi:</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, na které bude odpad v rámci jízdy vyvážen (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).<br><ul><li><em>Pokud je získáno právě jedno <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, pracujeme přímo s ním (jako druhý bod bylo získáno <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a></em><em>).</em></li><li><em>Pokud jsou získána dvě <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a>, pracujeme s tím, které bylo získáno v rámci elementu <strong>cilJizdy</strong>.</em></li></ul></li><li><a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>, pod kterou je jízda realizována (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li>Informace o druzích odpadu v jízdě, které byly získány v rámci elementu <strong>odpady</strong> (může se jednat o kolekci).</li></ul><p>Na výstupu algoritmu pak získáváme celou řadu informací. Ty jsou důležité nejen při hledání odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a>, ale také při jejím případném založení…</p><ul><li><em>Při hledání odpovídající objednávky pracujeme s <a href="../../../datove-modely/datovy-78681044.html">Vývozy na likvidační místo</a>.</em></li><li><em>Pro získání informace, zda likvidační místo dané druhy odpadu odebírá, vyhodnocujeme odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a>.</em></li><li><em>Při zakládání objednávky pak musíme zajistit, že existují odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu ve smlouvě</a>.</em></li></ul><p>Samotný postup si nyní popíšeme… Prováděn pak je pro všechny objekty získané v rámci elementu <strong>odpady</strong> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p><ol><li>Systém provede validaci právě zkoumaného druhu odpadu (viz <a href="605uc03-116788570.html">VAL02: Validace druhu odpadu v jízdě</a>).<br><ol><li>Pokud proběhla validace záznamu v pořádku, systém pokračuje ve zpracování informací o druhu odpadu v jízdě.</li><li>Jinak validace záznamu skončila chybou – systém provede logování dané skutečnosti a pokračuje další jízdou (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ol></li><li>Systém vyhodnotí, zda pro daný druh odpadu existuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a>: <br><ol><li>Systém nalezne odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Likvidační místo</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Likvidačnímu místu</a> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li>Hodnota atributu <strong>Druh odpadu</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu</a> (element <strong>druhOdpadu</strong>).</li><li>Hodnota atributu <strong>Kód nakládání</strong> odpovídá získanému kódu nakládání (element <strong>kodNakladani</strong>).</li><li>Hodnota atributu <strong>Provozovna</strong> odpovídá získané <a href="../../../datove-modely/datovy-78681044.html">Provozovně</a> (element <strong>provozovna</strong>).<br><ul><li><em>Pokud není hodnota v rámci elementu <strong>provozovna</strong> k dispozici, nesmí být dostupná ani v rámci daného <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu likvidačního místa</a>.</em></li><li><em>Pokud v rámci elementu <strong>provozovna</strong> hodnota získána je, musí <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> okazovat na stejnou nebo ji nadřazenou <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a>.</em></li><li><em> Při zpracování <a href="../../../datove-modely/datovy-78681044.html">Likvidačních míst</a> není předávána <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a>, proto došlo k jejímu odebrání také z tohoto vyhodnocení <a href="../../../datove-modely/datovy-78681044.html">Druhů odpadu likvidačního místa</a>.</em></li></ul></li></ul></li><li>Pokud byl nalezen alespoň jeden <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> (viz krok <strong>2.a</strong>), systém pokračuje ve zpracování právě zkoumaného druhu odpadu.</li><li>Jinak takový <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> (viz krok <strong>2.a</strong>) nalezen nebyl – systém provede logování dané skutečnosti a pokračuje další jízdou (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ol></li><li>Systém zpracuje získané informace o druhu odpadu – získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu ve smlouvě</a>:<br><ol><li>Systém nalezne odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu ve smlouvě</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Rámcová smlouva</strong> odpovídá získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li>Hodnota atributu <strong>Druh odpadu</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu</a> (element <strong>druhOdpadu</strong>).<br></li></ul></li><li>Pokud je nalezen odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu ve smlouvě</a> (viz krok <strong>3.a</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit druh odpadu ve smlouvě, na vstup jsou předány následující informace:<br><ul><li><strong>Editovaný druh odpadu ve smlouvě</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu ve smlouvě</a> (viz krok <strong>3.a</strong>).</li><li><strong>Změny v druhu odpadu ve smlouvě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu ve smlouvě</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG17: Získání externího identifikátoru druhu odpadu ve smlouvě</a>; nedochází ke změně hodnoty).</li><li><strong>Rámcová smlouva</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li><strong>Druh odpadu</strong>: hodnota získaná v rámci elementu <strong>druhOdpadu</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Jedná se o případy, kdy je nalezen neaktivní <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu ve smlouvě</a>. Dochází pak k obnovení tohoto záznamu.</em></li></ul></li><li>Jinak takový <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu ve smlouvě</a> nalezen není, systém provede jeho založení – spustí TODO: UC – Založit druh odpadu ve smlouvě, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaný druh odpadu ve smlouvě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu ve smlouvě</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG17: Získání externího identifikátoru druhu odpadu ve smlouvě</a>).</li><li><strong>Rámcová smlouva</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li><strong>Druh odpadu</strong>: hodnota získaná v rámci elementu <strong>druhOdpadu</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li></ul></li></ol></li><li>Systém připraví pomocný <a href="../../../datove-modely/datovy-78681044.html">Vývoz na likvidační místo</a>, který bude využit při hledání odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> – hodnoty jeho nesystémových atributů jsou nastaveny následovně:<br><ul><li><strong>Objednaná nádoba</strong>: není předána žádná hodnota (NULL; řešeno až následně).</li><li><strong>Druh odpadu</strong>: hodnota získaná v rámci elementu <strong>druhOdpadu</strong>.</li><li><strong>Likvidační místo</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li><strong>Kód nakládání</strong>: hodnota získaná v rámci elementu <strong>kodNakladani</strong>.</li></ul></li></ol><p>Poznámka: Všechny obsažené druhy odpadu musí být validní a pro všechny musí být dostupný záznam s odpovídajícím <a href="../../../datove-modely/datovy-78681044.html">Druhem odpadu likvidačního místa</a>. V opačném případě je přeskočena celá jízda. </p><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích atributů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">druhOdpadu</td><td colspan="1">Kód druhu odpadu, který figuruje v rámci jízdy získané z WinyX.</td><td colspan="1"><p>Dochází k nalezení takového <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu</a>, který splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá obsažené hodnotě.</li></ul></td><td colspan="1">–</td></tr><tr><td colspan="1">kodNakladani</td><td colspan="1">Kód, pod kterým má být s odpadem v rámci jízdy nakládáno.</td><td colspan="1">Předání obsažené hodnoty.</td><td colspan="1">–</td></tr><tr><td colspan="1">provozovna</td><td colspan="1">Identifikátor provozovny, v rámci které je s odpadem nakládáno.</td><td colspan="1"><p>V první řadě je obsažená hodnota převedena na text. Následně dochází k nalezení takové <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a>, která splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá obsažené hodnotě (mapování je uvedeno samostatně, viz <a href="605uc01-116788568.html">ALG02: Mapování provozoven</a> popsaný v rámci <a href="605uc01-116788568.html">605UC01: Zahájit import záznamů</a>).</li></ul><p>Pokud není hodnota k dispozici, nehledáme ani odpovídající <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a>. V takovém případě není nastavena žádná hodnota, resp. je zrušena aktuálně nastavená hodnota (NULL).</p></td><td colspan="1">Pokud není pro zadaný identifikátor nalezena žádná <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> (případně je nalezen neaktivní záznam), končí zpracování jízdy chybou (je přeskočeno).</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG17: Získání externího identifikátoru druhu odpadu ve smlouvě</h2><p>Nepřímo získané druhy odpadu ve smlouvě neobsahují identifikátor, musíme ho tedy složit z dostupných informací. Vyházíme pak ze struktury uvedené v rámci <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>.</p><ul><li>Formát: <strong><smlouva.id>::<odpady.druhOdpadu></strong></li><li>Příklad hodnoty: <strong>10723141::150202</strong></li></ul><p>Význam jednotlivých položek je pak následující:</p><ul><li><strong>smlouva.id</strong> – identifikátor odpovídající smlouvy,</li><li><strong>odpady.druhOdpadu</strong> – kód odpadu, který figuruje v rámci jízdy.</li></ul><p>Poznámka: Uvedené položky svým názvem přímo odpovídají elementům získaným v rámci odpovědi z WinyX.</p><h2>ALG18: Vyhodnocení aktuálnosti objednané služby</h2><p>V rámci algoritmu porovnáváme informace o jízdě získané z WinyX s odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednanou službou</a>. Snažíme se pak zjistit, zda na úrovni jízdy nedošlo ke změně…</p><ul><li>Pokud nedošlo ke změně u žádného ze sledovaných atributů, může být <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> zachována.</li><li>V opačném případě musíme odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> zrušit, následně zakládáme novou.</li></ul><p>Samotné porovnání je popsáno v tabulce…</p><ul><li>na straně jedné jsou uvedeny elementy získané v rámci jízdy (viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>),</li><li>na straně druhé máme atributy odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ul><p>Některé informace se pak na úrovni jízdy ve WinyX měnit nemohou (resp. musí být v případě jejich změny založena nová jízda). V tabulce jsou označeny a jejich vyhodnocení není prováděno. </p><p>Na straně <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> jsou některé informace dostupné nepřímo, musíme tedy pracovat s dalšími entitami:</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> – odpovídá právě zkoumané jízdě (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><a href="../../../datove-modely/datovy-78681044.html">Objednaná nádoba</a> – obsahuje informace o odpovídajícím <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> (jeho typu) a <a href="../../../datove-modely/datovy-78681044.html">Typu dopravy</a>.</li><li><a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> – obsahuje informace o odpovídajícím <a href="../../../datove-modely/datovy-78681044.html">Likvidačním místě</a>.</li><li><a href="../../../datove-modely/datovy-78681044.html">Vývoz na likvidační místo</a> – obsahuje <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu</a> včetně jejich přiřazení na odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>. </li></ul><p>Při zpracování informací dostupných v rámci <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> pak musíme brát v potaz dále uvedené skutečnosti…</p><ul><li>V rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a> mohla být pro jízdu získána více jak jedna <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> (pokud došlo k jejímu rozdělení).</li><li>Porovnávané informace jsou pak společné pro všechny její části – vychází z odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> (resp. souvisejících entit).</li><li>Celá cesta k <a href="../../../datove-modely/datovy-78681044.html">Objednávce</a> je uvedena následně: Atribut <strong>Objednávka</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Položka objednávky</a> – atribut <strong>Položka objednávky</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná nádoba</a> – atribut <strong>Objednaná nádoba</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> – atribut <strong>Objednaný úkon</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>. </li></ul><table><tbody><tr><th>Jízda</th><th>Objednaná služba</th><th>Porovnání</th><th>Poznámka</th></tr><tr><td>id</td><td>–</td><td>–</td><td>Pro danou hodnotu byla získána právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</td></tr><tr><td>posledniZmena</td><td>–</td><td>–</td><td>Není vyhodnocováno.</td></tr><tr><td>provozovna</td><td>–</td><td>–</td><td>Na straně WinyX vzniká nová jízda.</td></tr><tr><td>vozidloEvc</td><td>Entita <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a> (změna na vozidlo jiného typu dopravy).</td><td><p>Porovnání probíhá na úrovni <a href="../../../datove-modely/datovy-78681044.html">Typu dopravy</a>, kdy vyhodnocujeme, zda u nově získaného <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> nedochází k jeho změně. Porovnáváme dále uvedené hodnoty:</p><ul><li><strong>Jízda</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a> nalezený pro získaný <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a> ; element <strong>vozidloEvc</strong>).</li><li><strong>Objednaná služba</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a> je odkazován v rámci <a href="../../../datove-modely/datovy-78681044.html">Objednané nádoby</a> (atribut <strong>Objednaná nádoby</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Objednaného úkonu</a> – atribut <strong>Objednaný úkon</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>).</li></ul><p>Pokud si získané <a href="../../../datove-modely/datovy-78681044.html">Typy dopravy</a> odpovídají, je odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> z tohoto pohledu aktuální.</p></td><td>Částečně řešeno také v rámci <a href="605uc03-116788570.html">ALG20: Vyhodnocení aktuálnosti naplánování objednané služby</a>.</td></tr><tr><td>datumRealizace</td><td>–</td><td>–</td><td>Řešeno až v rámci <a href="605uc03-116788570.html">ALG20: Vyhodnocení aktuálnosti naplánování objednané služby</a>.</td></tr><tr><td>smlouva</td><td>–</td><td>–</td><td>Na straně WinyX vzniká nová jízda.</td></tr><tr><td>zakaznik</td><td>–</td><td>–</td><td>Na straně WinyX vzniká nová jízda.</td></tr><tr><td>pocatekJizdy, cilJizdy</td><td><p>Vyhodnocení probíhá na více úrovních:</p><ul><li>entita <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (navštívená místa),</li><li>výčtový typ <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> (prováděná akce).</li></ul></td><td><p>V první řadě vyhodnocujeme, zda je dodržen odpovídající <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a>. Porovnáváme dále uvedené hodnoty:</p><ul><li><strong>Jízda</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> je získán v rámci <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>.</li><li><strong>Objednaná služba</strong>: Hodnota atributu <strong>Typ úkonu</strong> odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Objednaného úkonu</a> (atribut <strong>Objednaný úkon</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>).</li></ul><p>Pokud je <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> zachován, pokračujeme ve vyhodnocení navštívených míst v rámci jízdy. Zde postupujeme dle získaného <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> (řešeny jsou pouze hodnoty relevantní pro synchronizaci jízd):</p><p><strong>1) Vývoz s výměnou</strong>: Je získáno <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (nevyhodnocujeme) a <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>. Porovnání pak probíhá pouze na úrovni <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a>, odpovídající hodnoty získáme následovně:</p><ul><li><strong>Jízda</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> je získáno v rámci <a href="605uc03-116788570.html">ALG11: Zpracování likvidačního místa</a> (mohlo být obsaženo v kterémkoliv z elementů <strong>pocatekJizdy</strong> a <strong>cilJizdy</strong>).</li><li><strong>Objednaná služba</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> je odkazováno z v rámci <a href="../../../datove-modely/datovy-78681044.html">Vývozů na likvidační místo</a> (atribut <strong>Likvidační místo</strong>). Způsob, jakým jsou jednotlivé <a href="../../../datove-modely/datovy-78681044.html">Vývozy na likvidační místo</a> získány, je uveden v části s vyhodnocením elementu <strong>odpady</strong>, nám pak stačí nalézt ten první (záznamy vzniklé v rámci synchronizace odkazují vždy na právě jedno <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</li></ul><p>Pokud si získaná <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> odpovídají, je odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> z tohoto pohledu aktuální.</p><p><strong>2) Vývoz mezi likvidačními místy</strong>: Jsou získána dvě <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> (výchozí a cílové). Ta jsou porovnávána odděleně…</p><p>Začneme vyhodnocením výchozího <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a>, zde získáme odpovídající záznamy následovně:</p><ul><li><strong>Jízda</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> je získáno v rámci <a href="605uc03-116788570.html">ALG11: Zpracování likvidačního místa</a> (element <strong>pocatekJizdy</strong>).</li><li><strong>Objednaná služba</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> je odkazováno z v rámci <a href="../../../datove-modely/datovy-78681044.html">Objednaného úkonu</a> (atribut <strong>Výchozí likvidační místo</strong>). Samotný <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> je odkazován z atribut <strong>Objednaný úkon</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>.</li></ul><p>Pokračujeme vyhodnocením cílového <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a>, zde získáme odpovídající záznamy následovně:</p><ul><li><strong>Jízda</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> je získáno v rámci <a href="605uc03-116788570.html">ALG11: Zpracování likvidačního místa</a> (element <strong>cilJizdy</strong>).</li><li><strong>Objednaná služba</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> je odkazováno z v rámci <a href="../../../datove-modely/datovy-78681044.html">Vývozů na likvidační místo</a> (atribut <strong>Likvidační místo</strong>). Způsob, jakým jsou jednotlivé <a href="../../../datove-modely/datovy-78681044.html">Vývozy na likvidační místo</a> získány, je uveden v části s vyhodnocením elementu <strong>odpady</strong>, nám pak stačí nalézt ten první (záznamy vzniklé v rámci synchronizace odkazují vždy na právě jedno <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</li></ul><p>Pokud si získaná <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> na úrovni uvedených dvojic odpovídají, je odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> z tohoto pohledu aktuální.<br></p></td><td><p>Uvedené elementy jsou vyhodnocovány společně, potřebné informace pak byly získány v rámci <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>.</p><p>Řešíme zde hned několik typů změn…</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> – záznam tohoto typu je předán vždy, sledujeme tedy změny v získané hodnotě.</li><li><a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> – může se lišit v případě, kdy dojde ke změně typu některého ze získaných bodů.</li><li><em><a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> – záznam tohoto typu je předán pouze v některých případech. V případě jeho změny však vzniká na straně WinyX nová jízda. </em></li></ul></td></tr><tr><td colspan="1">odpady</td><td colspan="1"><p>Entita <a href="../../../datove-modely/datovy-78681044.html">Vývoz na likvidační místo</a>.</p></td><td colspan="1"><p>Porovnání probíhá na úrovni entity <a href="../../../datove-modely/datovy-78681044.html">Vývoz na likvidační místo</a>. Začneme pak specifikací porovnávaných množin záznamů:</p><ul><li><strong>Jízda</strong>: Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Vývozy na likvidační místo</a> jsou získány v rámci <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a>.</li><li><strong>Objednaná služba</strong>: Pracujeme s takovými záznamy, u kterých hodnota atributu <strong>Objednaná nádoba</strong> odkazuje na odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednanou nádobu</a> (atribut <strong>Objednaná nádoba</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> – atribut <strong>Objednaný úkon</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>).</li></ul><p>Uvedené množiny <a href="../../../datove-modely/datovy-78681044.html">Vývozů na likvidační místo</a> následně porovnáme, sledujeme dále uvedená kritéria:</p><ul><li>Je získán stejný počet záznamů na obou stranách (v opačném případě není nutné pokračovat v porovnání záznamů).</li><li>Jednotlivé záznamy si odpovídají (každý záznam na straně jedné má odpovídající záznam na straně druhé). To porovnáváme dle dále uvedených atributů: <strong>Druh odpadu</strong>, <strong>Kód nakládání</strong>, <strong>Likvidační místo</strong>.</li></ul><p>Pokud jsou pro získané záznamy na obou stranách splněna všechna kritéria, je odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> z tohoto pohledu aktuální.</p></td><td colspan="1">V rámci elementu, pokud se jedná o validní jízdu, může být získáno 1..N záznamů. Pro všechny pak musí být získán odpovídající záznam na straně <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>.</td></tr></tbody></table><h2>ALG19: Zrušení neaktuálních objednaných služeb</h2><p>Pokud zjistíme, že pro jízdu získanou z WinyX již existuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která ale není aktuální, provedeme její zrušení (vzniká nová <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>).</p><ol><li>Pro všechny odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>):<ol><li>Pokud je právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> ve stavu <strong>Naplánovaná</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednané služby</a>):<br><ol><li>Systém nalezne odpovídající <a href="../../../datove-modely/datovy-78681044.html">Položku denního výkonu</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Objednaná služba</strong> odpovídá právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané službě</a>.</li></ul></li><li>Systém odebere nalezenou <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> z odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> – spustí <a href="#" data-page-title="200UC26: Odebrat položky z denního výkonu"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Položky denního výkonu</strong>: nalezená <a href="../../../datove-modely/datovy-78681044.html">Položka denního výkonu</a> (viz krok <strong>1.a.i</strong>).</li><li><em>Poznámka: Pokud nedojde k úspěšnému odebrání položky z <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>, je tato <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> přeskočena (současně dochází k logování této skutečnosti).</em><br></li></ul></li></ol></li><li>Pokud je právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> ve stavu <strong>K naplánování</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednané služby</a>):<ol><li>Systém zruší právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> – spustí <a href="#" data-page-title="101UC05: Zrušit objednanou službu"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Objednané služby</strong>: právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> (může se jednat také o <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> zpracovanou v rámci kroku <strong>1.a</strong>).<br></li><li><em>Poznámka: Pokud nedojde k úspěšnému zrušení některé z <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a>, dochází k jejímu přeskočení (současně dochází k logování této skutečnosti).</em></li></ul></li></ol></li></ol></li></ol><h2>ALG20: Vyhodnocení aktuálnosti naplánování objednané služby</h2><p>V rámci algoritmu porovnáváme informace o naplánování jízdy získané z WinyX s odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednanou službou</a>. Snažíme se pak zjistit, zda na úrovni jízdy nedošlo ke změně…</p><ul><li>Pokud nedošlo ke změně u žádného ze sledovaných atributů, může být naplánování <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> zachováno.</li><li>V opačném případě naplánování <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> rušíme, probíhá její přeplánování na odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>.</li></ul><p>Samotné porovnání je popsáno v tabulce…</p><ul><li>na straně jedné jsou uvedeny elementy získané v rámci jízdy (viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>),</li><li>na straně druhé máme výchozí hodnoty uložené na úrovni odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ul><p>Při zpracování informací dostupných v rámci <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> pak musíme brát v potaz dále uvedené skutečnosti…</p><ul><li>V rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a> mohla být pro jízdu získána více jak jedna <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> (pokud došlo k jejímu rozdělení).</li><li>Porovnávané informace jsou pak společné pro všechny její části – při dělení <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> jsou kopírovány na všechny její části.</li></ul><table><tbody><tr><th>Jízda</th><th>Objednaná služba</th><th colspan="1">Porovnání</th><th colspan="1">Poznámka</th></tr><tr><td>id</td><td>–</td><td colspan="1">–</td><td colspan="1">Pro danou hodnotu byla získána právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</td></tr><tr><td>posledniZmena</td><td>–</td><td colspan="1">–</td><td colspan="1">Není vyhodnocováno.</td></tr><tr><td>provozovna</td><td>–</td><td colspan="1">–</td><td colspan="1">Na straně WinyX vzniká nová jízda.</td></tr><tr><td>vozidloEvc</td><td>Entita <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</td><td colspan="1"><p>Porovnáme dále uvedené hodnoty:</p><ul><li><strong>Jízda</strong>: hodnota obsažená v rámci elementu <strong>vozidloEvc</strong>.</li><li><strong>Objednaná služba</strong>: hodnota atributu <strong>Evidenční číslo výchozího vozidla</strong>.</li></ul><p>Pokud si získané hodnoty odpovídají, je odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> z tohoto pohledu aktuální.</p></td><td colspan="1"><p>Porovnání probíhá oproti výchozí hodnotě, která byla získána v rámci jízdy.</p><p>Situace, kdy dojde ke změně na vozidlo jiného typu dopravy, je řešena v rámci <a href="605uc03-116788570.html">ALG18: Vyhodnocení aktuálnosti objednané služby</a> (musí dojít k založení nové objednané služby).</p></td></tr><tr><td>datumRealizace</td><td>Entita <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</td><td colspan="1"><p>Porovnáme dále uvedené hodnoty:</p><ul><li><strong>Jízda</strong>: hodnota obsažená v rámci elementu <strong>datumRealizace</strong>.</li><li><strong>Objednaná služba</strong>: hodnota atributu <strong>Výchozí datum realizace</strong>.</li></ul><p>Pokud si získané hodnoty odpovídají, je odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> z tohoto pohledu aktuální.</p></td><td colspan="1">Porovnání probíhá oproti výchozí hodnotě, která byla získána v rámci jízdy.</td></tr><tr><td>smlouva</td><td>–</td><td colspan="1">–</td><td colspan="1">Na straně WinyX vzniká nová jízda.</td></tr><tr><td>zakaznik</td><td>–</td><td colspan="1">–</td><td colspan="1">Na straně WinyX vzniká nová jízda.</td></tr><tr><td>pocatekJizdy, cilJizdy</td><td><div>–</div></td><td colspan="1">–</td><td colspan="1">Řešeno v rámci <a href="605uc03-116788570.html">ALG18: Vyhodnocení aktuálnosti objednané služby</a>.</td></tr><tr><td colspan="1">odpady</td><td colspan="1"><p>–</p></td><td colspan="1">–</td><td colspan="1">Řešeno v rámci <a href="605uc03-116788570.html">ALG18: Vyhodnocení aktuálnosti objednané služby</a>.</td></tr></tbody></table><h2>ALG21: Odebrání objednaných služeb z denních výkonů</h2><p>Pokud zjistíme, že pro jízdu získanou z WinyX již existuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která ale byla původně naplánována na jiné vozidlo či den, provedeme její (resp. jejich částí) odebrání z <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (následně je provedeno její opětovné naplánování).</p><ol><li>Pro všechny odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>):<ol><li>Pokud je právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> ve stavu <strong>Naplánovaná</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednané služby</a>):<br><ol><li>Systém nalezne odpovídající <a href="../../../datove-modely/datovy-78681044.html">Položku denního výkonu</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Objednaná služba</strong> odpovídá právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Objednané službě</a>.</li></ul></li><li>Systém odebere nalezenou <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> z odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> – spustí <a href="#" data-page-title="200UC26: Odebrat položky z denního výkonu"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Položky denního výkonu</strong>: nalezená <a href="../../../datove-modely/datovy-78681044.html">Položka denního výkonu</a> (viz krok <strong>1.a.i</strong>).</li><li><em>Poznámka: Pokud nedojde k úspěšnému odebrání položky z <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>, je tato <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> přeskočena (současně dochází k logování této skutečnosti).</em></li></ul></li></ol></li></ol></li></ol><h2>ALG22: Získání objednávky</h2><p>V některých případech můžeme při zakládání <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> využít již existující <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a>. Ta musí splňovat určité podmínky…</p><ul><li>musí být v odpovídajícím stavu (umožňuje zakládání <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a>),</li><li>vznikla při synchronizaci jízd (současně obsahuje objednaný úkon na výzvu),</li><li>odpovídá právě zkoumané jízdě (shoduje se ve sledovaných parametrech),</li><li>jedná se o v pořadí první záznam (hledáme pouze jednu <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a>).</li></ul><p>Hledáme tady takovou v pořadí první <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a>, která splňuje všechny dále uvedené podmínky…</p><ul><li>Hodnota atributu <strong>Stav</strong> nabývá jedné z dále uvedených hodnot: <strong>K realizaci</strong>, <strong>Plněná</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednávky</a>).</li><li>Hodnota atributu <strong>Vytvořeno systémem</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Provozovna</strong> odpovídá získané <a href="../../../datove-modely/datovy-78681044.html">Provozovně</a> (element <strong>provozovna</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li>Hodnota atributu <strong>Objednavatel</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Zákazníkovi</a> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li>Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Položka objednávky</a> (atribut <strong>Objednávka</strong> odkazuje na právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a>) splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Rámcová smlouva</strong> odpovídá získané <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li>Pokud jízda představuje jeden z dále uvedených <a href="../../../datove-modely/datovy-78681044.html">Typů úkonu</a>: <strong>Vývoz s výměnou</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>):<br><ul><li>Hodnota atributu <strong>Místo realizace</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Místu realizace</a> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li></ul></li></ul></li><li>Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaná nádoba</a> (hodnota atributu <strong>Položka objednávky</strong> odkazuje na právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">Položku objednávky</a>) splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Typ dopravy</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Typu dopravy</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li>Hodnota atributu <strong>Typ nádoby</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Typu nádoby</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ul></li><li>Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> (hodnota atributu <strong>Objednaná nádoba</strong> odkazuje na právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">Objednanou nádobu</a>) splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Typ úkonu</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Typu úkonu</a> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li>Hodnota atributu <strong>Podmínka vykonání</strong> nabývá jedné z dále uvedených hodnot: <strong>Výzva</strong> (viz <a href="http://Podmínka vykonání objednaného úkonu">Podmínka vykonání objednaného úkonu</a>).</li><li>Pokud jízda představuje jeden z dále uvedených <a href="../../../datove-modely/datovy-78681044.html">Typů úkonu</a>: <strong>Vývoz mezi likvidačními místy</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>):<br><ul><li>Hodnota atributu <strong>Výchozí likvidační místo</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Likvidačnímu místu</a> (element <strong>pocatekJizdy</strong>, viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).<br></li></ul></li></ul></li><li>Odpovídající <a href="../../../datove-modely/datovy-78681044.html">Vývozy na likvidační místo</a> (hodnota atributu <strong>Objednaná nádoba</strong> odkazuje na právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">Objednanou nádobu</a>) splňují všechny dále uvedené podmínky:<br><ul><li>Je k dispozici stejné množství záznamů jako v rámci získané jízdy (viz <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a>).</li><li>Jednotlivé záznamy odpovídají těm, které byly získaný v rámci jízdy – vyhodnocení probíhá dle dále uvedených atributů: <strong>Druh odpadu</strong>, <strong>Kód nakládání</strong>, <strong>Likvidační místo</strong>.<ul><li><em>V rámci <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a> jsou přímo k dispozici pomocné <a href="../../../datove-modely/datovy-78681044.html">Vývozy na likvidační místo</a>.</em></li></ul></li><li><em>Poznámka: Každý záznam na straně jedné má odpovídající záznam na straně druhé, souhlasí tedy také jejich počet).</em></li></ul></li></ul><p>Pokud je taková <a href="../../../datove-modely/datovy-78681044.html">Objednávka</a> nalezena, můžeme pro ni přímo založit <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (pro danou jízdu tedy nemusíme zakládat novou <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a>).</p><ul><li>Jedná se pak o <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> zakládanou na výzvu, ta vzniká v rámci odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Objednaného úkonu</a>.</li><li>Tento <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> nalezený v rámci <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> je pak předán na výstupu algoritmu (viz popis  uvedený dříve).</li></ul><h2>ALG23: Založení objednávky</h2><p>Pokud chceme založit <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> na výzvu, ale nemáme k dispozici odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a>, musíme založit novou. Tu pak můžeme opakovaně využívat pro podobné jízdy (typicky se jedná o cyklické jízdy).</p><ol><li>Systém získá informace o <a href="../../../datove-modely/datovy-78681044.html">Objednávce</a> – připraví hodnoty pro její jednotlivé atributy:<br><ul><li><strong>Provozovna</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> (element <strong>provozovna</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Objednavatel</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li></ul></li><li>Systém získá informace o <a href="../../../datove-modely/datovy-78681044.html">Položce objednávky</a> (je vytvářena pouze jedna) – připraví hodnoty pro její jednotlivé atributy:<br><ul><li><strong>Objednávka</strong>: informace o <a href="../../../datove-modely/datovy-78681044.html">Objednávce</a> (viz krok <strong>1</strong>).</li><li><strong>Rámcová smlouva</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li><strong>Místo realizace</strong>: Předaná hodnota se odvíjí od <a href="../../../datove-modely/datovy-78681044.html">Typu úkonu</a> řešeného v rámci jízdy (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>):<br><ul><li><strong>Vývoz s výměnou</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li><strong>Sběr</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li><em><strong>Jinak</strong></em>: není předána žádná hodnota (NULL).</li><li><em>Poznámka: Obsaženy jsou pouze <a href="../../../datove-modely/datovy-78681044.html">Typy úkonů</a> relevantní pro tento UC.</em></li></ul></li></ul></li><li>Systém získá informace o <a href="../../../datove-modely/datovy-78681044.html">Objednané nádobě</a> (je vytvářena pouze jedna) – připraví hodnoty pro její jednotlivé atributy:<br><ul><li><strong>Položka objednávky</strong>: informace o <a href="../../../datove-modely/datovy-78681044.html">Položce objednávky</a> (viz krok <strong>2</strong>).</li><li><strong>Typ dopravy</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Typ nádoby</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Typ nádoby</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Počet nádob</strong>: předána hodnota <strong>1</strong>.</li><li><strong>Vlastní nádoba</strong>: předána hodnota <strong>TRUE</strong>.</li></ul></li><li>Systém získá informace o <a href="../../../datove-modely/datovy-78681044.html">Objednaném úkonu</a> (je vytvářen pouze jeden) – připraví hodnoty pro její jednotlivé atributy:<br><ul><li><strong>Objednaná nádoba</strong>: informace o <a href="../../../datove-modely/datovy-78681044.html">Objednané nádobě</a> (viz krok <strong>3</strong>).</li><li><strong>Typ úkonu</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Typ úkonu</a> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li><strong>Opakující se</strong>: je předána hodnota <strong>FALSE</strong>.</li><li><strong>Podmínka vykonání</strong>: předána hodnota <strong>Výzva</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Podmínka vykonání objednaného úkonu</a>).</li><li><strong>Výchozí likvidační místo</strong>: Předaná hodnota se odvíjí od <a href="../../../datove-modely/datovy-78681044.html">Typu úkonu</a> řešeného v rámci jízdy (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>):<br><ul><li><strong>Vývoz mezi likvidačními místy</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (element <strong>pocatekJizdy</strong>, viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li><em><strong>Jinak</strong></em>: není předána žádná hodnota (NULL).</li><li><em>Poznámka: Obsaženy jsou pouze <a href="../../../datove-modely/datovy-78681044.html">Typy úkonů</a> relevantní pro tento UC.</em><br></li></ul></li></ul></li><li>Systém získá informace o <a href="../../../datove-modely/datovy-78681044.html">Vývozech na likvidační místo</a> (může být vytvářeno více záznamů) – hodnoty byly připraveny v rámci <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a>.<br><ul><li><em>Předány jsou všechny hodnoty tohoto typu, které byly připraveny v rámci <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a> (vyhodnocení elementu <strong>odpady</strong>).</em></li><li><em>Hodnota pak nebyla vyplněna pouze pro atribut <strong>Objednaná nádoba</strong> – pro všechny záznamy je předána získaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná nádoba</a> (viz krok <strong>3</strong>).</em></li></ul></li><li>Systém založí <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a> – spustí TODO: UC – Založit objednávku, na vstup jsou předány následující informace:<br><ul><li><strong>Informace o objednávce</strong>: informace o <a href="../../../datove-modely/datovy-78681044.html">Objednávce</a> (viz kroky <strong>1-5</strong>).<ul><li><em>Objednávka je uložena do stavu <strong>K realizaci</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednávky</a>).</em></li></ul></li></ul></li></ol><p>Poznámka: Vzhledem k množství informací, které je možné v rámci <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> zadat, jsou uvedeny pouze takové atributy, pro které je předána hodnota. Pokud atribut uveden není, není pro něj předána ani hodnota (NULL).</p><h2>ALG24: Založení objednané služby na výzvu</h2><p>Když máme k dispozici <a href="../../../datove-modely/datovy-78681044.html">Objednávku</a>, již můžeme pro získanou jízdu založit také <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>. Ta vzniká pod odpovídajícím <a href="../../../datove-modely/datovy-78681044.html">Objednaným úkonem</a>…</p><ul><li>u nové <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> je získán v rámci <a href="605uc03-116788570.html">ALG23: Založení objednávky</a>,</li><li>při použití stávající <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> je získán v rámci <a href="605uc03-116788570.html">ALG22: Získání objednávky</a>.</li></ul><p>Postupujeme pak následovně:</p><ol><li>Systém založí <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> na výzvu – spustí <a href="#" data-page-title="101UC02: Vytvořit objednanou službu na výzvu"></a>, na vstup jsou předány následující informace:<ul><li><strong>Objednaný úkon</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> (viz popis uvedený dříve).<br></li><li><p><strong>Datum realizace od</strong>: předána hodnota získaná v rámci elementu <strong>datumRealizace</strong> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p></li><li><p><strong>Datum realizace do</strong>: předána hodnota získaná v rámci elementu <strong>datumRealizace</strong> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p></li><li><p><strong>Čas realizace od</strong>: není předána žádná hodnota (NULL).</p></li><li><p><strong>Čas realizace do</strong>: není předána žádná hodnota (NULL).</p></li><li><p><strong>Poznámka</strong>: hodnota atributu <strong>Identifikátor objektu</strong> odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (element <strong>vozidloEvc</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p></li><li><p><strong>Identifikátor jízdy</strong>: předána hodnota získaná v rámci elementu <strong>id</strong> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p></li><li><p><strong>Evidenční číslo výchozího vozidla</strong>: předána hodnota získaná v rámci elementu <strong>vozidloEvc</strong> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p></li><li><p><strong>Výchozí datum realizace</strong>: předána hodnota získaná v rámci elementu <strong>datumRealizace</strong> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p></li></ul></li></ol><h2>ALG25: Naplánování objednané služby</h2><p>Posledním krokem při zpracování jízdy je naplánování odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (resp. jejich množiny u rozdělených <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a>) na vozidlo a den, tedy její vložení na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>. Zde pak mohou nastat dvě základní situace:</p><ul><li><strong>Jízda vzniká pro vozidlo vlastní provozovny</strong> – v takovém případě typicky existuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, na ten je <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> vložena.</li><li><strong>Jízda vzniká pro vozidlo cizí provozovny (výpůjčka)</strong> – obvykle dochází k vytvoření nového <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> v rámci odpovídající <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a>.</li></ul><p>Při výpůjčkách vozidel však mohou vznikat určité problémy, které si nyní stručně popíšeme…</p><ul><li>Pokud je získána jízda, u které se <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> vozidla liší od <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> dané jízdy, vytváříme pro toto vozidlo nový <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (v rámci <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> dostupné přímo u jízdy).</li><li>Při vytvoření nového <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> pro vozidlo cizí <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> dochází k tomu, že <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> tohoto vozidla v rámci domovské <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> není dále dostupný pro plánování.<br><ul><li>Z takového <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> jsou odebrány všechny <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, následně dochází ke změně jeho stavu na <strong>Vypůjčený</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li><li>Na takto označeném <a href="../../../datove-modely/datovy-78681044.html">Denním výkonu</a> není možné provádět žádné další změny, není na něj tedy možné vkládat ani <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>.</li></ul></li><li>Pokud však přijde další jízda pro takové vozidlo, kde se bude opět lišit <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> jízdy, může dojít k opakovanému provedení uvedených kroků…<br><ul><li>To znamená, že dříve naplánované <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> budou odebrány ze svého <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (vozidlo bude vypůjčeno pro získanou <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a> jízdy).</li><li>Tato skutečnost není na straně RoadPlan ošetřena, zjednodušeně tedy vyhrává poslední získaná jízda, pro kterou bude dostupný platný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>.</li></ul></li></ul><p>Naznačené chování si nyní popíšeme…</p><ol><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> – hledá takové záznamy, které splňují všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Identifikátor jízdy</strong> odpovídá získanému identifikátoru jízdy (element <strong>id</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li>Hodnota atributu <strong>Stav</strong> je nastavena na <strong>K naplánování</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav objednané služby</a>).</li><li><em>Poznámka: V tuto chvíli by všechny <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>, které mají být vloženy na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, již měly splňovat uvedené podmínky.</em></li></ul></li><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a> – hledá takové záznamy, které splňují všechny dále uvedené podmínky (může být získáno 0..2 záznamů):<br><ul><li>Hodnota atributu <strong>Datum realizace</strong> odpovídá získanému datu realizace v rámci jízdy (element <strong>datumRealizace</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li>Hodnota atributu <strong>Vozidlo</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> v rámci jízdy (element <strong>vozidloEvc</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).<br></li><li><em>Poznámka: Přiřazená <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> je řešena až v jednom z následujících kroků.</em></li></ul></li><li>Pokud nebyl získán žádný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>2</strong>):<br><ol><li>Systém provede logování uvedené skutečnosti (odpovídající jízda je přeskočena).</li></ol></li><li>Pokud byl získán právě jeden <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>2</strong>):<br><ol><li>Systém připraví <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, na který budou vkládány <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>:<br><ol><li>Pokud se <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (viz krok <strong>2</strong>; atribut <strong>Provozovna</strong>) liší od <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> získané v rámci jízdy (element <strong>provozovna</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>):<br><ol><li>Systém založí <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> v rámci odpovídající <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> – spustí <a href="#" data-page-title="200UC01: Přidat denní výkon"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Provozovna</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> v rámci jízdy (element <strong>provozovna</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Datum realizace</strong>: získané datum realizace (element <strong>datumRealizace</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Typ dopravy</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Vozidlo</strong>: není nastavena žádná hodnota (NULL). získaný <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> v rámci jízdy (element <strong>vozidloEvc</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Vytvořen uživatelem</strong>: předána hodnota <strong>FALSE</strong>.</li><li><em>Poznámka: V rámci volaného UC je řešeno také vypůjčení vozidla (viz <a href="../200ucxx-planovani-denni-vykony/200uc01-83266874.html">AF01: Vypůjčené vozidlo</a></em><em>).</em></li></ul></li><li>Systém přiřadí k založenému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> odpovídající vozidlo – spustí <a href="#" data-page-title="200UC04: Přiřadit vozidlo dennímu výkonu">200UC04: Přiřadit vozidlo dennímu výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Denní výkon</strong>: založený <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>4.a.i.1</strong>).</li><li><strong>Vozidlo</strong>: v rámci jízdy získaný <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> (element <strong>vozidloEvc</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li></ul></li><li>Systém dále pracuje se založeným <a href="../../../datove-modely/datovy-78681044.html">Denním výkonem</a> (viz krok <strong>4.a.i.1</strong>).</li></ol></li><li>Jinak <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (viz krok <strong>2</strong>) odpovídá té, která byla získána v rámci jízdy:<br><ol><li>Systém dále pracuje se získaným <a href="../../../datove-modely/datovy-78681044.html">Denním výkonem</a> (viz krok <strong>2</strong>).</li></ol></li></ol></li><li>Systém naplánuje získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz krok <strong>1</strong>) na připravený <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>4.a</strong>) – pro všechny získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>:<br><ol><li>Systém vloží právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> na odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> – spustí <a href="#" data-page-title="200UC07: Vložit objednanou službu do denního výkonu"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Objednaná služba</strong>: právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>. </li><li><strong>Denní výkon</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>4.a</strong>).</li></ul></li></ol></li></ol></li><li>Jinak byl získán více jak jeden <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>2</strong>):<br><ol><li>Systém připraví <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> domovské <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Stav</strong> je nastavena na <strong>Vypůjčený</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li><li>Záznam byl získán v rámci kroku <strong>2</strong> (relevantní <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> pro danou jízdu).</li><li><em>Poznámka: Pokud dojde k vypůjčení vozidla, je u výchozího <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> nastaven stav na <strong>Vypůjčený</strong>.</em></li></ul></li><li>Systém připraví vypůjčený <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (pro <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a>, v rámci které došlo k vypůjčení) – hledá takový záznam, který splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Stav</strong> není nastavena na <strong>Vypůjčený</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li><li>Záznam byl získán v rámci kroku <strong>2</strong> (relevantní <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> pro danou jízdu).</li><li><em>Poznámka: Jedná se o <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, který vznikl v rámci <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a>, které bylo vypůjčeno vozidlo.</em></li></ul></li><li>Systém připraví <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, na který budou vkládány <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>:<br><ol><li>Pokud <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> výchozího <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (viz krok <strong>5.a</strong>; atribut <strong>Provozovna</strong>) odpovídá <a href="../../../datove-modely/datovy-78681044.html">Provozovně</a> získané v rámci jízdy (element <strong>provozovna</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>):<br><ol><li>Systém zruší vypůjčení <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (resp. odpovídajícího vozidla) – spustí <a href="#" data-page-title="200UC06: Odebrat vozidlo denního výkonu">200UC06: Odebrat vozidlo denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Denní výkon</strong>: získaný vypůjčený <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>5.b</strong>).<br></li><li><em>Poznámka: V rámci volaného UC je řešeno také zrušení vypůjčení vozidla (viz <a href="../200ucxx-planovani-denni-vykony/200uc06-83266920.html">AF01: Vypůjčené vozidlo</a></em><em>).</em><br></li></ul></li><li>Systém dále pracuje se získaným <a href="../../../datove-modely/datovy-78681044.html">Denním výkonem</a> domovské <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> (viz krok <strong>5.a</strong>).<br><ul><li><em>Poznámka: <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> domovské <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> již není ve stavu <strong>Vypůjčený</strong>, je tedy možné s ním dále pracovat.</em></li></ul></li></ol></li><li>Pokud <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> vypůjčeného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (viz krok <strong>5.b</strong>; atribut <strong>Provozovna</strong>) odpovídá <a href="../../../datove-modely/datovy-78681044.html">Provozovně</a> získané v rámci jízdy (element <strong>provozovna</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>):<br><ol><li>Systém dále pracuje se získaným <a href="../../../datove-modely/datovy-78681044.html">Denním výkonem</a> v rámci <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a>, na kterou bylo vypůjčeno vozidlo (viz krok <strong>5.b</strong>).</li></ol></li><li>Jinak <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> žádného ze získaných <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a> (viz krok <strong>2</strong>) nedopovídá <a href="../../../datove-modely/datovy-78681044.html">Provozovně</a> získané v rámci jízdy:<br><ol><li>Systém zruší vypůjčení <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (resp. odpovídajícího vozidla) – spustí <a href="#" data-page-title="200UC06: Odebrat vozidlo denního výkonu">200UC06: Odebrat vozidlo denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Denní výkon</strong>: získaný vypůjčený <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>5.b</strong>).<br></li><li><em>Poznámka: V rámci volaného UC je řešeno také zrušení vypůjčení vozidla (viz <a href="../200ucxx-planovani-denni-vykony/200uc06-83266920.html">AF01: Vypůjčené vozidlo</a></em><em>).</em><br></li></ul></li><li>Systém založí <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> v rámci odpovídající <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> – spustí <a href="#" data-page-title="200UC01: Přidat denní výkon"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Provozovna</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> v rámci jízdy (element <strong>provozovna</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Datum realizace</strong>: získané datum realizace (element <strong>datumRealizace</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Typ dopravy</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Typ dopravy</a> (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><strong>Vozidlo</strong>: není nastavena žádná hodnota (NULL). získaný <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> v rámci jízdy (element <strong>vozidloEvc</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).<br></li><li><strong>Vytvořen uživatelem</strong>: předána hodnota <strong>FALSE</strong>.</li><li><em>Poznámka: V rámci volaného UC je řešeno také vypůjčení vozidla (viz <a href="../200ucxx-planovani-denni-vykony/200uc01-83266874.html">AF01: Vypůjčené vozidlo</a></em><em>).</em></li></ul></li><li>Systém přiřadí k založenému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> odpovídající vozidlo – spustí <a href="#" data-page-title="200UC04: Přiřadit vozidlo dennímu výkonu">200UC04: Přiřadit vozidlo dennímu výkonu</a>, na vstup jsou předány následující informace:<ul><li><strong>Denní výkon</strong>: založený <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>5.c.iii.2</strong>).</li><li><strong>Vozidlo</strong>: v rámci jízdy získaný <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> (element <strong>vozidloEvc</strong>, viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).<br></li></ul></li><li>Systém dále pracuje se založeným <a href="../../../datove-modely/datovy-78681044.html">Denním výkonem</a> (viz krok <strong>5.c.iii.2</strong>).<em><br></em></li></ol></li></ol></li><li>Systém naplánuje získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (viz krok <strong>1</strong>) na připravený <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>5.c</strong>) – pro všechny získané <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>:<br><ol><li>Systém vloží právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> na odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> – spustí <a href="#" data-page-title="200UC07: Vložit objednanou službu do denního výkonu"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Objednaná služba</strong>: právě zkoumaná <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</li><li><strong>Denní výkon</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>5.c</strong>).</li></ul></li></ol></li></ol></li></ol><p><em>Poznámka: Pokud pro daný den a vozidlo neexistuje <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, pravděpodobně se jedná o datum realizace mimo plánované období.</em></p><ul><li><em>Takový případ by ovšem neměl nastat, synchronizujeme pouze jízdy, které mají datum realizace v rámci plánovaného období.</em></li><li><em>Pokud by taková situace i přesto nastala, dochází k logování této skutečnosti a přeskočení odpovídající jízdy.</em></li></ul><h2>ALG26: Získání externího identifikátoru místa realizace pro stanoviště smlouvy</h2><p>Získaná místa realizace (resp. stanoviště smlouvy) sice obsahují identifikátor, ten ale nemusí být jedinečný. Musíme ho tedy složit z dostupných informací. Vycházíme pak ze struktury uvedené v rámci <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>.</p><ul><li>Formát: odvíjí se od bodu jízdy, v rámci kterého bylo získáno stanoviště smlouvy…<ul><li><strong><smlouva.id>::<pocatekJizdy.id></strong></li><li><strong><smlouva.id>::<cilJizdy.id></strong><br></li></ul></li><li>Příklad hodnoty: <strong>10723141::400104</strong></li></ul><p>Význam jednotlivých položek je pak následující:</p><ul><li><strong>smlouva.id</strong> – identifikátor odpovídající smlouvy,</li><li><strong>pocatekJizdy.id</strong> – identifikátor odpovídajícího stanoviště smlouvy získaný jako počátek jízdy.</li><li><strong>cilJizdy.id</strong> – identifikátor odpovídajícího stanoviště smlouvy získaný jako cíl jízdy.<br></li></ul><p>Poznámka: Uvedené položky svým názvem přímo odpovídají elementům získaným v rámci odpovědi z WinyX.</p><h2>ALG27: Získání externího identifikátoru místa realizace ve smlouvě pro stanoviště smlouvy</h2><p>Získané místo realizace v rámci synchronizace jízd párujeme s odpovídající smlouvou – tím zajistíme získání informace o zasmluvněných místech realizace (entita <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>). Při skládání externího identifikátoru pak vycházíme ze struktury uvedené v rámci <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>.</p><ul><li>Formát: odvíjí se od bodu jízdy, v rámci kterého bylo získáno stanoviště smlouvy…<br><ul><li><strong><strong><smlouva.id>::</strong><smlouva.id>::<pocatekJizdy.id></strong></li><li><strong><strong><smlouva.id>::</strong><smlouva.id>::<cilJizdy.id></strong></li></ul></li><li>Příklad hodnoty: <strong>10723141::</strong><strong>10723141::400104</strong><br></li></ul><p>Význam jednotlivých položek je pak následující:</p><ul><li><strong>smlouva.id</strong> – identifikátor odpovídající smlouvy,</li><li><strong><strong>smlouva.id-</strong>pocatekJizdy.id</strong> – identifikátor odpovídajícího stanoviště smlouvy získaný jako počátek jízdy (viz <a href="605uc03-116788570.html">ALG26: Získání externího identifikátoru místa realizace pro stanoviště smlouvy</a>).</li><li><strong><strong>smlouva.id-</strong>cilJizdy.id</strong> – identifikátor odpovídajícího stanoviště smlouvy získaný jako cíl jízdy (viz <a href="605uc03-116788570.html">ALG26: Získání externího identifikátoru místa realizace pro stanoviště smlouvy</a>).</li></ul><p>Poznámka: Uvedené položky svým názvem přímo odpovídají elementům získaným v rámci odpovědi z WinyX. Identifikátor smlouvy je pak duplikován záměrně… První výskyt identifikuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcovou smlouvu</a>, druhý je pak součásti identifikátoru odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a>.</p><h2>ALG28: Zpracování místa realizace pro předávací místo</h2><p>Cílem algoritmu je zpracování informací o místě realizace, které byly získány z WinyX (jako bod typu <strong>Předávací místo</strong>). Pracujeme pak s dále uvedenými informacemi:</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Zákazník</a>, pro kterého má být provedena realizace jízdy (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><a href="../../../datove-modely/datovy-78681044.html">Provozovna</a>, pod kterou je jízda realizována (viz <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</li><li><a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a>, pod kterou je jízda realizována (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li>Informace o bodu jízdy, které byly získány v rámci jednoho z dále uvedených elementů: <strong>pocatekJizdy</strong>, <strong>cilJizdy</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).<br><ul><li><em>Jedná se o body, které představují <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>. Způsob jejich zpracování se však žádným způsobem neliší.</em></li><li><em>Ke zpracování získaných informací je využita pomocná struktura, viz <a href="../../../datove-modely/datovy-78681044.html">RECO předávací místo</a>.</em></li></ul></li></ul><p>Na výstupu algoritmu pak získáváme nejen samotná <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a>, ale také jemu odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>…</p><ul><li><em>Tyto informace jsou důležité při hledání odpovídající <a href="../../../datove-modely/datovy-78681044.html">Objednávky</a> (resp. jejího <a href="../../../datove-modely/datovy-78681044.html">Objednaného úkonu</a></em><em>).</em></li><li><em>Pokud je takový <a href="../../../datove-modely/datovy-78681044.html">Objednaný úkon</a> nalezen, můžeme pro něj rovnou vytvořit <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a></em><em>.</em></li></ul><p>Struktura záznamu i jeho zpracování je dáno typem bodu, zde pracujeme s <strong>Předávacím místem</strong> (hodnota <strong>PM</strong>)…</p><ul><li>Na straně RoadPlan je zpracováno jako <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (předáno jako identifikátoru pomocného číselníku).</li><li>Snažíme se najít odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> na straně RoadPlan (případně ho zakládáme).</li><li>Získaný záznam pak není dostupný pro běžné zakládání <a href="../../../datove-modely/datovy-78681044.html">Objednávek</a> uživatelem.</li></ul><p>Samotné zpracování bodů tohoto typu je specifické…</p><ul><li>Dle získaného identifikátoru a pozice v jízdě je nalezen odpovídající adresný bod (mapovací tabulka).</li><li>Tento adresný bod slouží jako podklad pro založení odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (ta jsou znovupoužívána).</li><li>Samotná <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> pak vznikají postupně – na úrovni zákazníka pro jeho první jízdu s daným PM.</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém nalezne odpovídající předávací místo – hledá takové <a href="../../../datove-modely/datovy-78681044.html">RECO předávací místo</a>, které splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> je nastavena hodnotu, která je dána následovně: <strong>PM::<Identifikátor PM>::<Pozice v jízdě></strong> (příklad hodnoty <strong>PM::627::S</strong>).<br><ul><li><strong>Identifikátor PM</strong>: hodnota získaná v rámci elementu <strong>id</strong> (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>).</li><li><strong>Pozice v jízdě</strong>: hodnota získána dle elementu, v rámci kterého je předávací místo získáno (viz <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>):<br><ul><li><strong>pocatekJizdy</strong>: předána hodnota <strong>S</strong>.</li><li><strong>cilJizdy</strong>: předána hodnota <strong>F</strong>.<br></li></ul></li></ul></li></ul></li><li>Pokud nebylo odpovídající <a href="../../../datove-modely/datovy-78681044.html">RECO předávací místo</a> (viz krok <strong>1</strong>) nalezeno – systém provede logování uvedené skutečnosti a pokračuje dalším záznamem v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.<br><ul><li><em>Aby mohlo být <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> následně zpracováno, musí být k dispozici odpovídající <a href="../../../datove-modely/datovy-78681044.html">RECO předávací místo</a>.</em></li></ul></li><li>Systém se pokusí najít odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> – hledá takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>, které splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci více elementů (viz <a href="605uc03-116788570.html">ALG29: Získání externího identifikátoru místa realizace pro předávací místo</a>).</li></ul></li><li>Systém zpracuje získané informace získané informace o bodu jízdy – získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ol><li>Systém získá adresu předávacího místa – hledá takovou <a href="../../../datove-modely/datovy-78681044.html">Adresu</a>, které splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě atributu <strong>Externí identifikátor adresy</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz krok <strong>1</strong>).</li></ul></li><li>Pokud bylo nalezeno <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>3</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit místo realizace, na vstup jsou předány následující informace:<br><ul><li><strong>Editované místo realizace</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>3</strong>).</li><li><strong>Změny v místě realizace</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG29: Získání externího identifikátoru místa realizace pro předávací místo</a>; nedochází ke změně hodnoty).</li><li><strong>Zákazník</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><strong>Název</strong>: hodnota atributu <strong>Název</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz krok <strong>1</strong>).</li><li><strong>Adresa</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>4.a</strong>).</li><li><strong>Zeměpisná šířka</strong>: hodnota atributu <strong>Zeměpisná šířka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz krok <strong>1</strong>).<strong><br></strong></li><li><strong>Zeměpisná délka</strong>: hodnota atributu <strong>Zeměpisná délka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz krok <strong>1</strong>).</li><li><strong>Stav geokódování</strong>: předána hodnota <strong>Externí zdroj</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav geokódování</a>).</li><li><strong>Kontakt</strong>: hodnota atributu <strong>Kontakt</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>3</strong>; zachování hodnoty).</li><li><strong>Poznámka</strong>: hodnota atributu <strong>Poznámka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz krok <strong>3</strong>; zachování hodnoty).</li><li><strong>Provozovna</strong>: není předána žádná hodnota (NULL; řešeno na úrovni entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>FALSE</strong> (záznam nemá být dostupný uživatelům).<br></li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (opravdu dochází k jeho změně).</em></li></ul></li><li>Jinak takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> nalezeno není (viz krok <strong>3</strong>), systém provede jeho založení – spustí TODO: UC – Založit místo realizace, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná místo realizace</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG29: Získání externího identifikátoru místa realizace pro předávací místo</a>).</li><li><strong>Zákazník</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Zákazník</a> (viz <a href="605uc03-116788570.html">ALG07: Zpracování zákazníka</a>).</li><li><strong>Název</strong>: hodnota atributu <strong>Název</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz krok <strong>1</strong>).</li><li><strong>Adresa</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>4.a</strong>).</li><li><strong>Zeměpisná šířka</strong>: hodnota atributu <strong>Zeměpisná šířka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz krok <strong>1</strong>).<strong><br></strong></li><li><strong>Zeměpisná délka</strong>: hodnota atributu <strong>Zeměpisná délka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz krok <strong>1</strong>).</li><li><strong>Stav geokódování</strong>: předána hodnota <strong>Externí zdroj</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav geokódování</a>).</li><li><strong>Kontakt</strong>: není předána žádná hodnota (NULL).</li><li><strong>Poznámka</strong>: není předána žádná hodnota (NULL).</li><li><strong>Provozovna</strong>: není předána žádná hodnota (NULL; řešeno na úrovni entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>FALSE</strong> (záznam nemá být dostupný uživatelům).</li></ul></li></ul></li></ol></li><li>Systém zpracuje získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> vzhledem k odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> – získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>:<br><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>, které splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Místo realizace</strong> odpovídá získanému <a href="../../../datove-modely/datovy-78681044.html">Místu realizace</a> (viz krok <strong>3</strong>).</li><li>Hodnota atributu <strong>Rámcová smlouva</strong> odpovídá <a href="../../../datove-modely/datovy-78681044.html">Rámcové smlouvě</a> získané v rámci jízdy (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li></ul></li><li>Pokud je nalezeno <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a> (viz krok <strong>5.a</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit místo realizace ve smlouvě, na vstup jsou předány následující informace:<br><ul><li><strong>Editované místo realizace ve smlouvě</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a> (viz krok <strong>5.a</strong>).</li><li><strong>Změny v místě realizace ve smlouvě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG30: Získání externího identifikátoru místa realizace ve smlouvě pro předávací místo</a>, nedochází ke změně hodnoty).</li><li><strong>Rámcová smlouva</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li><strong>Místo realizace</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>3</strong>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>FALSE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Místa realizace ve smlouvě</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (opravdu dochází k jeho změně).</em></li></ul></li><li>Jinak takové <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a> nalezeno není (viz krok <strong>5.a</strong>), systém provede jeho založení – spustí TODO: UC – Založit místo realizace ve smlouvě, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná místo realizace ve smlouvě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc03-116788570.html">ALG30: Získání externího identifikátoru místa realizace ve smlouvě pro předávací místo</a>).</li><li><strong>Rámcová smlouva</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcová smlouva</a> (viz <a href="605uc03-116788570.html">ALG09: Zpracování smlouvy</a>).</li><li><strong>Místo realizace</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Místo realizace</a> (viz krok <strong>3</strong>).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>FALSE</strong>.</li></ul></li></ul></li></ol></li></ol><p>Strukturu odpovědi (její odpovídající části) je včetně ilustrativního příkladu uvedena v rámci <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a>. Proto ji zde neopakujeme.</p><h2>ALG29: Získání externího identifikátoru místa realizace pro předávací místo</h2><p>Získaná místa realizace (resp. předávací místa) sice obsahují identifikátor, ten ale nemusí být jedinečný. Musíme ho tedy složit z dostupných informací…</p><ul><li>Formát se odvíjí od daného předávacího místa: <strong><Smlouva>::<Předávací místo></strong>.</li><li>Příklad hodnoty: <strong>10723141::PM::627::S</strong></li></ul><p>Význam jednotlivých položek je pak následující:</p><ul><li><strong>Smlouva</strong> – identifikátor odpovídající smlouvy (element <strong>smlouva.id</strong>, viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>),</li><li><strong>Předávací místo</strong> – hodnota atributu <strong>Externí identifikátor</strong> odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">RECO předávacího místa</a> (viz <a href="605uc03-116788570.html">ALG28: Zpracování místa realizace pro předávací místo</a>).</li></ul><h2>ALG30: Získání externího identifikátoru místa realizace ve smlouvě pro předávací místo</h2><p>Získané místo realizace v rámci synchronizace jízd párujeme s odpovídající smlouvou – tím zajistíme získání informace o zasmluvněných místech realizace (entita <a href="../../../datove-modely/datovy-78681044.html">Místo realizace ve smlouvě</a>). Při skládání externího identifikátoru postupujeme následovně…</p><ul><li>Formát se odvíjí od daného místa realizace: <strong><Smlouva>::<Místo realizace></strong>.</li><li>Příklad hodnoty: <strong>10723141::</strong><strong>10723141::PM::627::S</strong></li></ul><p>Význam jednotlivých položek je pak následující:</p><ul><li><strong>Smlouva</strong> – identifikátor odpovídající smlouvy (element <strong>smlouva.id</strong>, viz <a href="605uc03-116788570.html">ALG02: Specifikace metody pro získání jízd</a>),</li><li><strong>Místo realizace</strong> – hodnota atributu <strong>Externí identifikátor</strong> odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a> (viz <a href="605uc03-116788570.html">ALG28: Zpracování místa realizace pro předávací místo</a>).<ul><li><em>Hodnota je nastavována v rámci <a href="605uc03-116788570.html">ALG29: Získání externího identifikátoru místa realizace pro předávací místo</a>.</em></li></ul></li></ul><p>Poznámka: Identifikátor smlouvy je duplikován záměrně… První výskyt identifikuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Rámcovou smlouvu</a>, druhý je pak součásti identifikátoru odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Místa realizace</a>.</p><h1>Validace</h1><h2>VAL01: Validace jízdy</h2><p>Jednotlivé jízdy, které byly získány na API, je nutné před samotným zpracováním ověřit, provedeme tady validaci každé z nich (struktura záznamu je uvedena v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>).</p><ul><li>Pokud je jízda v pořádku (je validní), probíhá její další zpracování.</li><li>V opačném případě je záznam přeskočen, uvedená skutečnost je logována.</li></ul><p>V rámci popisu pak pro zvýšení přehlednosti abstrahujeme od validací „běžného“ typu. Ty budou sice prováděny u všech dostupných elementů, popsány však budou společně na jednom místě…</p><ul><li>datový typ hodnoty není v pořádku,</li><li>hodnota neodpovídá požadovanému rozsahu,</li><li>hodnota pro povinnou položku není k dispozici.</li></ul><p>Nyní se již dostáváme k validaci jednotlivých elementů. Popis validace každého z nich je uveden v tabulce (povinné údaje jsou označeny *).</p><table><tbody><tr><th>Element odpovědi API</th><th>Validace</th><th>Poznámka</th></tr><tr><td>id*</td><td>–</td><td>–</td></tr><tr><td>posledniZmena</td><td>–</td><td>–</td></tr><tr><td><p>provozovna*</p></td><td><p>Musí být splněny dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný).</li></ul></td><td>–</td></tr><tr><td>vozidloEvc*</td><td><p>Musí být splněny dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný),</li><li>tento záznam představuje <a href="../../../datove-modely/datovy-78681044.html">Objekt</a>, pro který jsou generovány <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>.</li></ul></td><td>Specifikace <a href="../../../datove-modely/datovy-78681044.html">Objektu</a>, pro který jsou generovány <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, je uvedena v rámci <a href="605uc03-116788570.html">ALG05: Zpracování jízd</a>.</td></tr><tr><td>datumRealizace*</td><td><p>Hodnota se pohybuje v rozmezí, které je dáno následovně:</p><ul><li>dnešní datum,</li><li>dnešní datum, ke kterému je přičten počet dní daný konfigurační hodnotou <strong>recoveraSyncSettings.ridesPeriodLength</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul></td><td>Datum realizace se tedy vyskytuje v období, pro které jsou získávány jízdy.</td></tr><tr><td><p>smlouva*</p><ul><li>id*</li><li>cislo*</li><li>platnostOd*</li><li>platnostDo</li></ul></td><td>–</td><td>–</td></tr><tr><td><p>zakzaznik*</p><ul><li>id*</li><li>nazev*</li><li>ico</li><li>adresa<br><ul><li>id</li><li>ulice</li><li>obec*</li><li>psc</li><li>zeme*</li></ul></li></ul></td><td>–</td><td>–</td></tr><tr><td><p>pocatekJizdy*, cilJizdy*</p><ul><li>type*</li><li>id</li><li>nazev</li><li>gps<br><ul><li>x</li><li>y</li></ul></li><li>adresa<br><ul><li>id</li><li>ulice</li><li>obec*</li><li>psc</li><li>zeme*</li></ul></li></ul></td><td><p>Validace některých elementů jsou dány typem bodu jízdy…</p><ul><li><strong>id</strong>: povinný pro typ <strong>SS</strong>, <strong>LM</strong>, <strong>PM</strong>.</li><li><strong>adresa</strong>: povinný pro <strong>SS</strong>, <strong>PM</strong>.</li></ul><p>Je získána podporovaná kombinace bodů jízdy.</p><ul><li><em>Možné kombinace jsou dány <a href="../../../datove-modely/datovy-78681044.html">Typem dopravy</a> (získán v rámci elementu <strong>vozidloEvc</strong>).</em></li><li><em>Podporované kombinace počátku a cíle jsou uvedeny v rámci <a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a></em><em>.</em></li></ul><p>Pokud bod jízdy představuje likvidační místo (typ <strong>LM</strong>), musí být splněny dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný),</li><li>nalezený záznam obsahuje validní souřadnice (atributy <strong>Zeměpisná délka</strong> a <strong>Zeměpisná šířka</strong>),</li><li>nalezený záznam přijímá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu</a> (pro objekty získané v rámci elementu <strong>odpady</strong> existují odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a>).<br><ul><li><em>Pokud jsou získána 2 likvidační místa, musí dané <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu</a> odebírat to, které je obsaženo v rámci elementu <strong>cilJizdy</strong></em>.</li><li><em>Způsob, jakým jsou záznamy porovnány, je uveden v rámci <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a></em><em> (krok <strong>2</strong>), tato validace tedy může být řešena až v něm.</em></li></ul></li></ul></td><td><p><strong>gps</strong>: Hodnota musí být k dispozici buď pro oba dílčí elementy, nebo pro žádný z nich. Pravděpodobně může nastat také situace, kdy není element <strong>gps</strong> dostupný vůbec.</p></td></tr><tr><td colspan="1"><p>odpady*</p><ul><li>druhOdpadu*</li><li>kodNakladani*</li><li>provozovna</li></ul></td><td colspan="1">Obsažené objekty (1..N) musí být validní, k dispozici je pak alespoň jeden záznam.</td><td colspan="1">Validace řešena v rámci <a href="605uc03-116788570.html">VAL02: Validace druhu odpadu v jízdě</a>.</td></tr></tbody></table><p>Poznámka: K evidenci chybových stavů může být použit nástroj 3. strany. Aktuálně není nutné, aby tyto informace byly čitelné i pro běžné uživatele.</p><h2>VAL02: Validace druhu odpadu v jízdě</h2><p>Jednotlivé druhy odpadu v jízdě, které byly získány na API, je nutné před samotným zpracováním ověřit. Provedeme tedy validaci každého z nich (struktura záznamu je uvedena v rámci <a href="605uc03-116788570.html">ALG16: Zpracování odpadů v jízdě</a>).</p><ul><li>Pokud je druh odpadu likvidačního místo v pořádku (je validní), probíhá jeho další zpracování.</li><li>V opačném případě je záznam přeskočen, uvedená skutečnost je logována (synchronizace likvidačního místa pokračuje).</li></ul><p>V rámci popisu pak pro zvýšení přehlednosti abstrahujeme od validací „běžného“ typu. Ty budou sice prováděny u všech dostupných elementů, popsány však budou společně na jednom místě…</p><ul><li>datový typ hodnoty není v pořádku,</li><li>hodnota neodpovídá požadovanému rozsahu,</li><li>hodnota pro povinnou položku není k dispozici.</li></ul><p>Nyní se již dostáváme k validaci jednotlivých elementů. Popis validace každého z nich je uveden v tabulce (povinné údaje jsou označeny *).</p><table><tbody><tr><th>Element odpovědi API</div></th><th colspan="1">Validace</div></th><th>Poznámka</div></th></tr><tr><td colspan="1">druhOdpadu*</td><td colspan="1"><p>Musí být splněny dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný).</li></ul></td><td colspan="1">–</td></tr><tr><td colspan="1">kodNakladani*</td><td colspan="1">–</td><td colspan="1">–</td></tr><tr><td colspan="1">provozovna</td><td colspan="1"><p>Pokud je hodnota k dispozici, musí být splněny také dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný),</li><li>tato provozovna koresponduje s tou u jízdy (viz poznámka).</li></ul></td><td colspan="1"><p>Musí být dodržena pravidla daná stromovou strukturou provozoven. Provozovna na úrovni druhu odpadu musí být…</p><ul><li>buď shodná s tou na úrovni likvidačního místa,</li><li>nebo musí být provozovně likvidačního místa podřazena.</li></ul><p>Pokud není provozovna na úrovni druhu odpadu specifikována, nesmí být k dispozici ani v rámci likvidačního místa (naopak to ale možné je).</p></td></tr></tbody></table><p>Poznámka: K evidenci chybových stavů může být použit nástroj 3. strany. Aktuálně není nutné, aby tyto informace byly čitelné i pro běžné uživatele.</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h3>3. 9. 2024: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG25: Naplánování objednané služby</a></td><td colspan="1">Doplněno chování související s výpůjčkami vozidel (naznačeno modře).</td></tr></tbody></table><h3>21. 8. 2024: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG10: Zpracování bodů jízdy</a></td><td colspan="1">Revize způsobu zpracování bodů typu PM (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG12: Zpracování místa realizace pro stanoviště smlouvy</a></td><td colspan="1">Přenesení části se zpracováním bodů typu PM do samostatného ALG (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG13: Zpracování souřadnic místa realizace</a></td><td colspan="1">Revize způsobu zpracování bodů typu PM (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG28: Zpracování místa realizace pro předávací místo</a></td><td colspan="1">Přenesení části se zpracováním bodů typu PM do samostatného ALG (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG29: Získání externího identifikátoru místa realizace pro předávací místo</a></td><td colspan="1">Přenesení části se zpracováním bodů typu PM do samostatného ALG (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG30: Získání externího identifikátoru místa realizace ve smlouvě pro předávací místo</a></td><td colspan="1">Přenesení části se zpracováním bodů typu PM do samostatného ALG (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="605uc03-116788570.html">VAL01: Validace jízdy</a></td><td colspan="1">Revize způsobu validace bodů typu PM (naznačeno růžově).</td></tr></tbody></table><h3>26. 7. 2024: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="605uc03-116788570.html">ALG15: Získání názvu místa realizace</a></td><td colspan="1"><p>Doplněno chování pro ošetření případů, kdy délka názvu MR přesáhne povolený rozsah, viz <a href="https://ai-maps.atlassian.net/servicedesk/customer/portal/9/SDFLWWRP-359">SDFLWWRP-359</a> (naznačeno modře).</p><ul><li><em>Doplněno také do dokumentu <a href="#" data-page-title="Evidované problémy">Evidované problémy</a> (viz bod <strong>7: Zpracování místa realizace s dlouhým názvem</strong>).</em></li></ul></td></tr></tbody></table>
</div>
</body>
</html>
