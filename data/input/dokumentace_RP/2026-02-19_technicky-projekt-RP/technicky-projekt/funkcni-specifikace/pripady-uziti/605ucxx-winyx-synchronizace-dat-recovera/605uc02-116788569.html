<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>605UC02: Získat likvidační místa</title>
</head>
<body>
<div class="wiki-content">
<p><strong>Rozpracováno! </strong><strong>Volané UC.</strong></p><p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je synchronizace likvidačních míst z REST API systému WinyX (metoda <strong>likvmista</strong> typu <strong>GET</strong>). V aplikaci RoadPlan pak pracujeme s entitou <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>.</p><p>Poznámka: Synchronizace je připravena pro data ze systému WinyX (zákazník Recovera).</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>Nastane okamžik, ve kterém má dojít k synchronizaci (viz <a href="#" data-page-title="605UC01: Zahájit import záznamů"></a>).</p><h2>Vstupní podmínky</h2><p>–</p><h2>Vstupní data</h2><p>–</p><h1>Základní tok událostí</h1><ol><li>Systém získá <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> dostupná v RoadPlan – všechny záznamy bez ohledu na hodnotu atributu <strong>Je aktivní</strong>.<br><ul><li><em>Záznam z WinyX může být získán také pro již odebrané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, proto pracujeme s jejich úplnou množinou.</em></li><li><em>V uvedeném případě dochází k obnovení <em><a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (včetně aktualizace odpovídajících </em></em><em><a href="../../../datove-modely/datovy-78681044.html">Druhů odpadu likvidačního místa</a>)</em><em>.</em></li><li><em>Všechna <em><em><a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a>, která nemají k dispozici externí identifikátor, jsou odstraňována (zdrojem informací je WinyX).</em></em></em></li></ul></li><li>Systém získá počet aktuálně dostupných likvidačních míst na straně WinyX (viz <a href="605uc02-116788569.html">ALG02: Získání počtu likvidačních míst</a>).<br><ul><li><em>Dojde k volání API metody, která poskytuje likvidační místa dostupná na straně WinyX. Součástí odpovědi je také celkový počet těchto záznamů.</em></li><li><em>Získaná hodnota je platná pro celý synchronizační běh. Aktuálně není prováděna kontrola, zda se v průběhu synchronizace množství záznamů nezměnilo.</em></li></ul></li><li>Systém získá a zpracuje likvidační místa dostupná na straně WinyX (viz <a href="605uc02-116788569.html">ALG03: Získání likvidačních míst</a>).<br><ul><li><em>Jednotlivé záznamy jsou získávány po skupinách – je použito stránkování. Získaná skupina likvidačních míst je pak zpracována jako celek.</em></li><li><em>Data mohou být zpracována paralelně. To znamená, že načítáme a zpracováváme více stránek současně (možnost parametrizace).</em></li><li><em>Při zpracování získaných záznamů jsou současně označována také jim odpovídající <em><a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> na straně RoadPlan (viz krok <strong>1</strong>).</em></em></li><li><em><em>Pokud je <em><a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> označeno, znamená to, že byl získán a zpracován odpovídající záznam z WinyX.</em></em></em></li><li><em><em><em>Taková <em><em><em><a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a>, která označena nebyla, již nemají odpovídající záznam na straně WinyX (budou odebrána). </em></em></em></em></em></em></li><li><em><em><em>Označování <em><em><em><a href="../../../datove-modely/datovy-78681044.html">Likvidačních míst</a></em></em></em> probíhá pouze na úrovni tohoto UC, informace <strong>není</strong> ukládána na úrovni DB.</em></em></em></li></ul></li><li>Systém zpracuje taková <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> na straně RoadPlan (viz krok <strong>1</strong>), která nebyla označena jako zpracovaná (viz krok <strong>3</strong>) – provede jejich odebrání (viz <a href="605uc02-116788569.html">ALG04: Odebrání likvidačních míst</a>).<br><ul><li><em>Odebrání neoznačených <em><em><em><em><em><em><a href="../../../datove-modely/datovy-78681044.html">Likvidačních míst</a> probíhá až po načtení a zpracování všech likvidačních míst na straně WinyX.</em></em></em></em></em></em></em></li><li><em><em><em><em><em><em><em>V rámci tohoto kroku již pracujeme pouze s aktivními záznamy. Již odebrané záznamy není potřeba znovu odebírat.</em></em></em></em></em></em></em></li></ul></li></ol><h1>Alternativní toky událostí</h1><p>–</p><h1>Výjimkové toky událostí</h1><h2>EF01: Služba není dostupná</h2><p>Dotaz nebylo možné odeslat z důvodu nedostupnosti služby, případně nebyla získána odpověď v požadovaném čase.</p><h3>Vstupní podmínky</h3><ul><li>Volaní metody pro získání likvidačních míst skončilo jednou z dále uvedených chyb:<br><ul><li>500: Internal Server Error,</li><li>502: Bad Gateway,</li><li>503: Service Unavailable,</li><li>504: Gateway Timeout.</li></ul></li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem <strong>2</strong> nebo <strong>3</strong> základního toku událostí.</li><li>Systém provede logování uvedené skutečnosti.</li><li>Systém provede opakované spuštění UC (provedeny jsou maximálně 3 pokusy).</li></ol><h3>Výstupní podmínky</h3><ul><li>Došlo k opakovanému spuštění UC. Uvedená skutečnost byla logována (pro každý pokus).</li></ul><h2>EF02: Chyba dotazu</h2><p>Dotaz nebylo možné zpracovat z důvodu nesprávné syntaxe.</p><h3>Vstupní podmínky</h3><ul><li>Volaní metody pro získání likvidačních míst skončilo chybou 400: Bad Request.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem <strong>2</strong> nebo <strong>3</strong> základního toku událostí.</li><li>Systém provede logování uvedené skutečnosti.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k dokončení UC. Uvedená skutečnost byla logována.</li></ul><h2>EF03: Chyba autorizace</h2><p>Dotaz nebylo možné zpracovat z důvodu vypršení či neprovedení autorizace.</p><ul><li><em>Pokud bude průběžně vyhodnocována platnost tokenu, nemělo by dojít ke spuštění tohoto výjimkového toku.</em></li></ul><h3>Vstupní podmínky</h3><ul><li>Volaní metody pro získání likvidačních míst skončilo chybou 401: Unauthorized.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem <strong>2</strong> nebo <strong>3</strong> základního toku událostí.</li><li>Systém provede logování uvedené skutečnosti.</li><li>Systém provede autorizaci a následné spuštění tohoto UC (provedeny jsou maximálně 3 pokusy).<ul><li><em>Autorizace je řešena v rámci <a href="#" data-page-title="605UC01: Zahájit import záznamů"></a>.</em><em><br></em></li></ul></li></ol><h3>Výstupní podmínky</h3><ul><li>Došlo k autorizaci a opakovanému spuštění UC. Uvedená skutečnost byla logována (pro každý pokus).</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Došlo k synchronizaci validních likvidačních míst (včetně souvisejících záznamů). Případné komplikace byly logovány.</p><h2>Výstupní data</h2><p>–</p><h1>Algoritmy</h1><h2>ALG01: Specifikace metody pro získání likvidačních míst</h2><p>Cílem algoritmu je popis metody odpovídajícího REST API, která poskytuje likvidační místa dostupná na straně WinyX.</p><table><tbody><tr><th>Specifikace volání API</div></th><th>Hodnota</div></th><th>Poznámka</div></th></tr><tr><td>Cesta</td><td><p><url>/<verze>/roadplan/likvmista</p><ul><li><strong>url</strong>: dáno konfigurační hodnotou  <strong>recoveraSyncSettings.disposalSitesUrl</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>verze</strong>: dáno konfigurační hodnotou  <strong>recoveraSyncSettings.disposalSitesVesrion</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul></td><td><p>Viz <a href="https://bridge.api.bclogia.cz/index.html">https://bridge.api.bclogia.cz/index.html</a>.</p></td></tr><tr><td>Metoda</td><td>GET</td><td>–</td></tr><tr><td>Parametry</td><td><p><strong>Spolid</strong>: Identifikátor společnosti z pohledu WinyX.</p><ul><li>Datový typ: integer ($int32).</li></ul><p><strong>Start</strong>: Pořadí prvního záznamu, který chceme získat z jejich výsledné množiny (tedy „začátek“ stránky)</p><ul><li>Datový typ: integer ($int32).</li><li>Minimální hodnota: 0.</li></ul><p><strong>Limit</strong>: Nastavení počtu záznamů na stránce (tedy délka stránky).</p><ul><li>Datový typ: integer ($int32).</li><li>Minimální hodnota: 1.</li><li>Maximální hodnota: 100.</li></ul></td><td>Specifikováno v rámci daného volání této metody.</td></tr><tr><td colspan="1">Příklad volání</td><td colspan="1"><p>https://bridge.api.bclogia.cz/v1/roadplan/likvmista?<strong>Spolid=98</strong>&<strong>Start=0</strong>&<strong>Limit=100</strong></p></td><td colspan="1">Vstupní parametry jsou zvýrazněny tučným řezem písma. Příklad nemusí být aktuální.</td></tr></tbody></table><p>Současně je uvedena také struktura získané odpovědi. Jedná se pak pouze o ilustrativní příklad, samotný popis je uveden v rámci odpovídajících algoritmů.</p><h2>ALG02: Získání počtu likvidačních míst</h2><p>Cílem algoritmu je získání aktuálního počtu likvidačních míst dostupných na straně WinyX. Hodnota je pak dostupná v rámci metody pro získání likvidačních míst (viz <a href="605uc02-116788569.html">ALG01: Specifikace metody pro získání likvidačních míst</a>).</p><p>Poznámka: Získaná hodnota je platná pro celý synchronizační běh. Aktuálně není prováděna kontrola, zda se v průběhu synchronizace množství záznamů nezměnilo.</p><ol><li>Systém zavolá metodu pro získání likvidačních míst (viz <a href="605uc02-116788569.html">ALG01: Specifikace metody pro získání likvidačních míst</a>) s následujícími parametry:<br><ul><li><strong>Spolid</strong>: konfigurační hodnota <strong>recoveraSyncSettings.spolid</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Start</strong>: předána hodnota <strong>0</strong>.</li><li><strong>Limit</strong>: předána hodnota <strong>1</strong>.</li></ul></li><li>Systém zpracuje získanou odpověď – na výstupu algoritmu je předána hodnota získaná v rámci elementu <strong>TotalRecords</strong> (viz dále).</li></ol><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích elementů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td>Data</td><td colspan="1">Informace o požadovaných likvidačních místech.</td><td colspan="1"><em>V rámci tohoto algoritmu není využito.</em></td><td><p>Získané záznamy nejsou v rámci tohoto algoritmu využity, zde pracujeme pouze s celkovým počtem záznamů.</p><p>Samotná likvidační místa jsou načítána až v rámci <a href="605uc02-116788569.html">ALG03: Získání likvidačních míst</a>.</p></td></tr><tr><td>TotalRecords</td><td colspan="1">Celkový počet takových likvidačních míst na straně WinyX, která odpovídají zadaným vstupním parametrům.</td><td colspan="1">Předání obsažené hodnoty.</td><td>–</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG03: Získání likvidačních míst</h2><p>Cílem algoritmu je získání informací o likvidačních místech dostupných na straně WinyX a jejich následné zpracování. Dílčí záznamy jsou pak dostupné v rámci metody pro získání likvidačních míst (viz <a href="605uc02-116788569.html">ALG01: Specifikace metody pro získání likvidačních míst</a>).</p><p>Poznámka: Vzhledem k množství dostupných likvidačních míst je použito stránkování, záznamy jsou tedy získávány postupně. Jednotlivé skupiny záznamů pak mohou být zpracovávány paralelně.</p><ol><li>Systém připraví pomocné proměnné pro stránkování a provede jejich výchozí nastavení:<br><ul><li><strong>Pořadí</strong>: pořadí prvního záznamu v rámci aktuálně zpracovávána stránky (nastaveno na <strong>0</strong>).</li></ul></li><li>Systém postupně načítá informace o likvidačních místech z WinyX – pokud je hodnota pomocné proměnné <strong>Pořadí</strong> menší nebo rovna <strong>celkovému počtu záznamů</strong> (viz <a href="605uc02-116788569.html">ALG02: Získání počtu likvidačních míst</a>), je provedena následující sekvence kroků:<br><ol><li>Systém zavolá metodu pro získání likvidačních míst (viz <a href="605uc02-116788569.html">ALG01: Specifikace metody pro získání likvidačních míst</a>) s následujícími parametry:<br><ul><li><strong>Spolid</strong>: konfigurační hodnota <strong>recoveraSyncSettings.spolid</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Start</strong>: hodnota pomocné proměnné <strong>Pořadí</strong>.</li><li><strong>Limit</strong>: konfigurační hodnota <strong>recoveraSyncSettings.disposalSitesPageSize</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).<br></li></ul></li><li>Systém zpracuje získaná likvidační místa – pro všechny záznamy získané v rámci elementu <strong>Data</strong> (viz dále):<br><ol><li>  Systém provede validaci právě zkoumaného záznamu (viz <a href="605uc02-116788569.html">VAL01: Validace likvidačního místa</a>)…<br><ol><li>Pokud proběhla validace záznamu v pořádku, systém pokračuje ve zpracování informací o likvidačním místě.</li><li>Jinak validace záznamu skončila chybou – systém provede logování dané skutečnosti a pokračuje dalším záznamem (přechod na krok <strong>2.b</strong>).</li></ol></li><li>Systém provede zpracování právě zkoumaného záznamu (viz <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>).<br><ol><li>Pokud zpracování záznamu skončilo chybou, systém provede logování dané skutečnosti.</li></ol></li><li>Přechod na krok <strong>2.b</strong> (zpracování dalšího záznamu).</li></ol></li><li>Systém aktualizuje hodnotu pomocné proměnné <strong>Pořadí</strong> – provede její inkrementaci o konfigurační hodnotu <strong>recoveraSyncSettings.disposalSitesPageSize</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li>Přechod na krok <strong>2</strong> (načtení další stránky).</li></ol></li></ol><p>Poznámka: Získání a zpracování jednotlivých stránek s likvidačními místy (viz krok <strong>2</strong>) může probíhat paralelně. To znamená, že další provedení tohoto kroku může být spuštěno před dokončením toho aktuálně běžícího. Maximální počet aktuálně zpracovávaných stránek je pak dán konfigurační hodnotou <strong>recoveraSyncSettings.disposalSitesParallelRunsCount</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>). Pro zachování přehlednosti algoritmu je tato logika zmíněna pouze ve formě této poznámky.</p><p>Strukturu odpovědi (její odpovídající části) si nyní popíšeme. Význam dílčích elementů je uveden v tabulce.</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td>Data</td><td colspan="1">Informace o požadovaných likvidačních místech (v rámci dané stránky).</td><td colspan="1">Předání obsažených objektů.</td><td><p>Zpracování informací o konkrétním likvidačním místě je řešeno v rámci <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>.</p></td></tr><tr><td>TotalRecords</td><td colspan="1">Celkový počet takových likvidačních míst na straně WinyX, která odpovídají zadaným vstupním parametrům.</td><td colspan="1"><em>V rámci tohoto algoritmu není využito.</em></td><td>Hodnota je využita v rámci <a href="605uc02-116788569.html">ALG02: Získání počtu likvidačních míst</a> (nedochází k její průběžné aktualizaci).</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG04: Odebrání likvidačních míst</h2><p>Cílem algoritmu je odebrání takových aktivních <a href="../../../datove-modely/datovy-78681044.html">Likvidačních míst</a>, která sice figurují na straně RoadPlan, ale již nejsou dostupná ve WinyX.</p><p>Poznámka: Při zpracování likvidačních míst došlo k označení takových <a href="../../../datove-modely/datovy-78681044.html">Likvidačních míst</a>, pro které byly získány informace z WinyX. S touto informací v rámci algoritmu také pracujeme.</p><ol><li>Systém získá taková <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a>, která splňují všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Je aktivní</strong> je rovna <strong>TRUE</strong>.</li><li>Dané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> nebylo označeno (nedošlo k jeho zpracování v rámci <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>).</li></ul></li><li>Pro všechna získaná <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> (viz krok <strong>1</strong>):<br><ol><li>Systém odebere právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> – spustí TODO: UC – Odebrat likvidační místo, na vstup jsou předány následující informace:<br><ul><li><strong>Odebírané likvidační místo</strong>: právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>.</li></ul></li></ol></li></ol><p>Poznámka: Spolu s <a href="../../../datove-modely/datovy-78681044.html">Likvidačním místem</a> jsou odebrány také jeho <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a>.</p><h2>ALG05: Zpracování likvidačního místa</h2><p>Cílem algoritmu je zpracování informací o konkrétním likvidačním místě, které byly získány z WinyX. Výsledkem pak může být provedení jedné z dále uvedených akcí:</p><ul><li>založení nového <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (neexistuje záznam s odpovídajícím identifikátorem),</li><li>aktualizace stávajícího <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (případně obnovení již odebraného záznamu).</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takové <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, které splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.</li></ul></li><li>Pokud je nalezeno <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (viz krok <strong>1</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit likvidační místo, na vstup jsou předány následující informace:<br><ul><li><strong>Editované likvidační místo</strong>: získané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (viz krok <strong>1</strong>).</li><li><strong>Změny v likvidačním místě</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong> (nedochází ke změně hodnoty).</li><li><strong>Název</strong>: hodnota získaná v rámci elementu <strong>nazev</strong>.</li><li><strong>Adresa</strong>: hodnota získaná v rámci elementu <strong>adresa</strong> (viz <a href="605uc02-116788569.html">ALG07: Zpracování adresy likvidačního místa</a>).</li><li><strong>Zeměpisná délka</strong>: vyhodnoceno dle hodnoty atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>).<br><ul><li><strong>Manuálně</strong>: hodnota atributu <strong>Zeměpisná <strong>délka</strong></strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>; zachování hodnoty).<br></li><li><em><strong>Jinak</strong></em>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc02-116788569.html">ALG06: Zpracování souřadnic likvidačního místa</a>).</li></ul></li><li><strong>Zeměpisné šířka</strong>: vyhodnoceno dle hodnoty atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>).<br><ul><li><strong>Manuálně</strong>: hodnota atributu <strong>Zeměpisná <strong>šířka</strong></strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>; zachování hodnoty).<br></li><li><em><strong>Jinak</strong></em>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc02-116788569.html">ALG06: Zpracování souřadnic likvidačního místa</a>).</li></ul></li><li><strong>Kontakt</strong>: hodnota atributu <strong>Kontakt</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Poznámka</strong>: hodnota atributu <strong>Poznámka</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Provozovna</strong>: hodnota získaná v rámci elementu <strong>provozovna</strong>.</li><li><strong>Stav geokódování</strong>: vyhodnoceno dle hodnoty atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>).<br><ul><li><strong>Manuálně</strong>: hodnota atributu <strong>Stav geokódování</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><em><strong>Jinak</strong></em>: hodnota získaná při vyhodnocení elementu <strong>gps</strong> (viz <a href="605uc02-116788569.html">ALG06: Zpracování souřadnic likvidačního místa</a>).</li></ul></li><li><strong>Vlastní likvidační místo</strong>: hodnota získaná v rámci elementu <strong>jeVlastni</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (tedy opravdu dochází k jeho změně).</em></li></ul></li><li>Jinak takové <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> nalezeno není (viz krok <strong>1</strong>), systém provede jeho založení – spustí TODO: UC – Založit likvidační místo, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládané likvidační místo</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong>.</li><li><strong>Název</strong>: hodnota získaná v rámci elementu <strong>nazev</strong>.</li><li><strong>Adresa</strong>: hodnota získaná v rámci elementu <strong>adresa</strong> (viz <a href="605uc02-116788569.html">ALG07: Zpracování adresy likvidačního místa</a>).</li><li><strong>Zeměpisná <strong>délka</strong></strong>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc02-116788569.html">ALG06: Zpracování souřadnic likvidačního místa</a>).</li><li><strong>Zeměpisné <strong>šířka</strong></strong>: hodnota získaná v rámci elementu <strong>gps</strong> (viz <a href="605uc02-116788569.html">ALG06: Zpracování souřadnic likvidačního místa</a>).</li><li><strong>Kontakt</strong>: není předána žádná hodnota (NULL).</li><li><strong>Poznámka</strong>: není předána žádná hodnota (NULL).</li><li><strong>Provozovna</strong>: hodnota získaná v rámci elementu <strong>provozovna</strong>.</li><li><strong>Stav geokódování</strong>: hodnota získaná při vyhodnocení elementu <strong>gps</strong> (viz <a href="605uc02-116788569.html">ALG06: Zpracování souřadnic likvidačního místa</a>).</li><li><strong>Vlastní likvidační místo</strong>: hodnota získaná v rámci elementu <strong>jeVlastni</strong>.<br></li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.<br></li></ul></li></ul></li><li>Systém provede zpracování získaných <a href="../../../datove-modely/datovy-78681044.html">Druhů odpadu likvidačního místa</a> (viz <a href="605uc02-116788569.html">ALG08: Zpracování druhů odpadu likvidačního místa</a>).<br><ul><li><em>V rámci tohoto algoritmu pracujeme s odpovídajícím <a href="../../../datove-modely/datovy-78681044.html">Likvidačním místem</a> – získaným (viz krok <strong>1</strong>) či založeným (viz krok <strong>3</strong>).</em></li><li><em>Zpracovány jsou pak informace o podporovaných druzích odpadu získané v rámci elementu <strong>odpady</strong> (viz dále).</em></li><li><em>Pokud je obsažen nevalidní druh odpadu likvidačního místa, dochází k jeho přeskočení (likvidační místo ale zpracováno je).</em></li></ul></li><li>Systém označí <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (založené či aktualizované) pro potřeby tohoto UC jako zpracované.<br><ul><li><em>Taková <a href="../../../datove-modely/datovy-78681044.html">Likvidační místa</a> nebudou v rámci <a href="605uc02-116788569.html">ALG04: Odebrání likvidačních míst</a> odebrána.</em></li></ul></li></ol><p>V rámci algoritmu je přímo odkazováno na informace získané z WinyX (na odpovídající elementy). Nyní si tedy popíšeme strukturu, ve které jsou informace o likvidačním místě předávány (včetně způsobu, jakým jsou dílčí hodnoty zpracovány).</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">id</td><td colspan="1">Identifikátor likvidačního místa ve WinyX.</td><td colspan="1"><p>Převedení obsažené hodnoty na text (odpovídá atributu <strong>Externí identifikátor</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</p></td><td colspan="1">Slouží k „párování“ záznamů napříč systémy.</td></tr><tr><td colspan="1">nazev</td><td colspan="1">Název likvidačního místo.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Název</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">provozovna</td><td colspan="1">Identifikátor provozovny ve WinyX, pod kterou je záznam dostupný.</td><td colspan="1"><p>V první řadě je obsažená hodnota převedena na text. Následně dochází k nalezení takové <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a>, která splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá obsažené hodnotě (mapování je uvedeno samostatně, viz <a href="605uc01-116788568.html">ALG02: Mapování provozoven</a> popsaný v rámci <a href="#" data-page-title="605UC01: Zahájit import záznamů"></a>).</li></ul><p>Pokud není hodnota k dispozici, nehledáme ani odpovídající <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a>. V takovém případě není nastavena žádná hodnota, resp. je zrušena aktuálně nastavená hodnota (NULL).</p></td><td colspan="1"><p>Pokud není pro zadaný identifikátor nalezena žádná <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> (případně je nalezen neaktivní záznam), končí zpracování likvidačního místa chybou (je přeskočeno).</p><p><em>Likvidační místa jsou v rámci Recovera dostupná pro všechny uživatele bez ohledu na provozovnu, proto v rámci této synchronizace bude vždy předáno NULL.</em></p></td></tr><tr><td colspan="1">gps</td><td colspan="1">Souřadnice likvidačního místa.</td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (odpovídá atributům <strong>Zeměpisná délka</strong> a <strong>Zeměpisná šířka</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1"><p>Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc02-116788569.html">ALG06: Zpracování souřadnic likvidačního místa</a>.</p><p>Souřadnice jsou pak na úrovni existujícího <a href="../../../datove-modely/datovy-78681044.html">Likvidačního místa</a> aktualizovány pouze v případě, kdy nedošlo k jejich upřesnění uživatelem.</p></td></tr><tr><td colspan="1">adresa</td><td colspan="1">Adresa likvidačního místa.</td><td colspan="1">Zpracování obsaženého objektu, viz poznámka (odpovídá atributu <strong>Adresa</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc02-116788569.html">ALG07: Zpracování adresy likvidačního místa</a>.</td></tr><tr><td colspan="1">jeVlastni</td><td colspan="1">Informace, zda se jedná o likvidační místo organizace.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Vlastní Likvidační místo</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">odpady</td><td colspan="1">Likvidačním místem odebírané druhy odpadu (včetně kódu nakládání).</td><td colspan="1">Zpracování obsažených objektů, viz poznámka (odpovídá entitě <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a>, která přímo dokazuje na <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">Informace jsou předány ve formě objektu, zpracování probíhá v rámci <a href="605uc02-116788569.html">ALG08: Zpracování druhů odpadu likvidačního místa</a>.</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG06: Zpracování souřadnic likvidačního místa</h2><p>Cílem algoritmu je zpracování informací o souřadnicích daného likvidačního místa, které byly získány z WinyX. Pracujeme pak s dále uvedenými informacemi…</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, které bylo získáno či založeno v rámci <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>.</li><li>Informace o souřadnicích, které byly získány v rámci elementu <strong>gps</strong>.</li><li>Dále může být využita hodnota získaná v rámci elementu <strong>adresa</strong>.</li></ul><p>Ke spuštění algoritmu pak dochází pouze v dále uvedených případech (viz <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>):</p><ul><li>založení nového záznamu (žádné informace zatím nejsou k dispozici),</li><li>editace záznamu, u kterého ale nebyly souřadnice upřesněny uživatelem.</li></ul><p>Vzhledem k tomu, že jsou souřadnice nepovinným údajem, může být výsledná hodnota získána různými způsoby…</p><ul><li>načtení souřadnic z WinyX (pokud jsou předány),</li><li>geokódování adresy likvidačního místa (pokud je k dispozici).</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Pokud jsou k dispozici validní souřadnice (viz <a href="605uc02-116788569.html">VAL01: Validace likvidačního místa</a>), systém předá na výstupu algoritmu hodnoty pro dále uvedené atributy entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>:<br><ul><li><strong>Zeměpisná délka</strong>: hodnota získaná v rámci elementu <strong>gps.x</strong>.</li><li><strong>Zeměpisná šířka</strong>: hodnota získaná v rámci elementu <strong>gps.y</strong>.</li><li><strong>Stav geokódování</strong>: předána hodnota <strong>Externí zdroj</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav geokódování</a>).</li></ul></li><li>Jinak validní souřadnice v k dispozici nejsou – systém získá souřadnice z <a href="../../../datove-modely/datovy-78681044.html">Adresy</a>:<br><ol><li>Pokud je k dispozici adresa, systém provede její geokódování (případné logování chybějící adresy je provedeno v rámci <a href="605uc02-116788569.html">ALG07: Zpracování adresy likvidačního místa</a>):<br><ol><li>Systém provede geokódování odpovídající <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> – spustí <a href="#" data-page-title="706UC02: Získat souřadnice dle adresy"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Adresa</strong>: odpovídající <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz <a href="605uc02-116788569.html">ALG07: Zpracování adresy likvidačního místa</a>).</li><li><strong>Počet záznamů</strong>: předána hodnota <strong>1</strong>.</li></ul></li><li>Pokud proběhlo získání souřadnic v pořádku (viz krok <strong>2.a.i</strong>), systém předá na výstupu algoritmu hodnoty pro dále uvedené atributy entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>:<br><ul><li><strong>Zeměpisná délka</strong>: hodnota výstupního parametru <strong>Souřadnice.Zeměpisná délka</strong> volaného UC (viz <a href="#" data-page-title="706UC02: Získat souřadnice dle adresy"></a>).</li><li><strong>Zeměpisná šířka</strong>: hodnota výstupního parametru <strong>Souřadnice.Zeměpisná šířka</strong> volaného UC (viz <a href="#" data-page-title="706UC02: Získat souřadnice dle adresy"></a>).</li><li><strong>Stav geokódování</strong>: předána hodnota <strong>Automaticky</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav geokódování</a>).</li></ul></li><li>Jinak získání souřadnic (viz krok <strong>2.a.i</strong>) v pořádku neproběhlo – systém provede logování uvedené skutečnosti (likvidační místo je i přesto zpracováno).<br><ul><li><em>Aby mohlo být likvidační místo použito v rámci jízdy, musí být k dispozici také jeho souřadnice (výpočet trasy).</em></li><li><em>Aktuálně likvidační místa bez souřadnic sice synchronizována budou, ale nebude možné pro ně založit jízdu.</em></li><li><em>Stav geokódování je v takovém případě nastaven běžným způsobem (negeokódováno či nenalezeno).</em></li></ul></li></ol></li></ol></li></ol><p>V rámci algoritmu je přímo odkazováno na informace získané z WinyX (na odpovídající elementy). Nyní si tedy popíšeme strukturu, ve které jsou informace o souřadnicích likvidačního místa předávány (včetně způsobu, jakým jsou dílčí hodnoty zpracovány).</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">x</td><td colspan="1">Souřadnice likvidačního místa (zeměpisná délka).</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Zeměpisná délka</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">y</td><td colspan="1">Souřadnice likvidačního místa (zeměpisná šířka).</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Zeměpisná šířka</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">–</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG07: Zpracování adresy likvidačního místa</h2><p>Cílem algoritmu je zpracování informací o adrese daného likvidačního místa, které byly získány z WinyX. Pracujeme pak s dále uvedenými informacemi…</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, které bylo získáno či založeno v rámci <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>.</li><li>Informace o adrese, které byly získány v rámci elementu <strong>adresa</strong> (pokud jsou k dispozici).</li></ul><p>Výsledkem pak může být provedení některé z dále uvedených akcí:</p><ul><li>založení nové <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (neexistuje záznam s odpovídajícím identifikátorem),</li><li>aktualizace stávající <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (případně obnovení již odebraného záznamu).</li></ul><p>Samotný postup si nyní popíšeme…</p><ol><li>Pokud není adresa k dispozici (není předána hodnota elementu <strong>adresa</strong>):<ol><li>Algoritmus je předčasně ukončen – systém provede logování uvedené skutečnosti (likvidační místo je i přesto zpracováno).</li></ol></li><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takovou <a href="../../../datove-modely/datovy-78681044.html">Adresu</a>, která splňuje všechny dále uvedené podmínky:<ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá hodnotě získané v rámci elementu <strong>id</strong>.</li></ul></li><li>Pokud je nalezena <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>2</strong>), systém provede její aktualizaci – spustí TODO: UC – Upravit adresu, na vstup jsou předány následující informace:<ul><li><strong>Editovaná adresa</strong>: získaná <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> (viz krok <strong>2</strong>).</li><li><strong>Změny v adrese</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>:<ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong> (nedochází ke změně hodnoty).</li><li><strong>Ulice</strong>: hodnota získaná v rámci elementu <strong>ulice</strong>.</li><li><strong>Číslo popisné</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Číslo orientační</strong>: hodnota atributu <strong>Číslo orientační</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> (viz krok <strong>1</strong>; zachování hodnoty).</li><li><strong>Město</strong>: hodnota získaná v rámci elementu <strong>obec</strong>.</li><li><strong>PSČ</strong>: hodnota získaná v rámci elementu <strong>psc</strong>.</li><li><strong>Stát</strong>: hodnota získaná v rámci elementu <strong>zeme</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Adresy</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (opravdu dochází k její změně).</em><br></li></ul></li><li>Jinak taková <a href="../../../datove-modely/datovy-78681044.html">Adresa</a> nalezena není (viz krok <strong>2</strong>), systém provede její založení – spustí TODO: UC – Založit adresu, na vstup jsou předány následující informace:<ul><li><strong>Zakládaná adresa</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>:<ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci elementu <strong>id</strong>.</li><li><strong>Ulice</strong>: hodnota získaná v rámci elementu <strong>ulice</strong>.</li><li><strong>Číslo popisné</strong>: hodnota získaná v rámci elementu <strong>cislo</strong>.</li><li><strong>Číslo orientační</strong>: není předána žádná hodnota (NULL).</li><li><strong>Město</strong>: hodnota získaná v rámci elementu <strong>obec</strong>.</li><li><strong>PSČ</strong>: hodnota získaná v rámci elementu <strong>psc</strong>.</li><li><strong>Stát</strong>: hodnota získaná v rámci elementu <strong>zeme</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li></ul></li></ol><p>V rámci algoritmu je přímo odkazováno na informace získané z WinyX (na odpovídající elementy). Nyní si tedy popíšeme strukturu, ve které jsou informace o adrese likvidačního místě předávány (včetně způsobu, jakým jsou dílčí hodnoty zpracovány).</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">id</td><td colspan="1">Identifikátor adresy ve WinyX.</td><td colspan="1"><p>Převedení obsažené hodnoty na text (odpovídá atributu <strong>Externí identifikátor</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</p><p>Pokud není hodnota k dispozici, provedeme její generování. Využijeme informace získané v rámci odpovídajícího likvidačního místa:</p><ul><li>Formát: <strong>LM::<id></strong></li><li>Příklad hodnoty: <strong>LM::8514</strong></li></ul><p>Význam jednotlivých položek je následující:</p><ul><li><strong>id</strong>: identifikátor likvidačního místa získaný z WinyX (viz <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>).</li></ul></td><td colspan="1">Slouží k „párování“ záznamů napříč systémy.</td></tr><tr><td colspan="1">ulice</td><td colspan="1">Ulice dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Ulice</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">cislo</td><td colspan="1">Číslo popisné (případně také číslo orientační) dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Číslo popisné</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">obec</td><td colspan="1">Obec dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Město</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">psc</td><td colspan="1">Poštovní směrovací číslo dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>PSČ</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr><tr><td colspan="1">zeme</td><td colspan="1">Stát dané adresy.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Stát</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Adresa</a>).</td><td colspan="1">–</td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG08: Zpracování druhů odpadu likvidačního místa</h2><p>Cílem algoritmu je zpracování informací o druzích odpadu odebíraných daným likvidačním místem, které byly získány z WinyX. Pracujeme pak s dále uvedenými informacemi…</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>, které bylo získáno či založeno v rámci <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>.</li><li>Informace o druzích odpadu, které byly získány v rámci elementu <strong>odpady</strong> (kolekce).</li></ul><p>Výsledkem pak může být provedení některé z dále uvedených akcí, kdy se konkrétní akce může se lišit u každého ze získaných záznamů:</p><ul><li>založení nového <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu likvidačního místa</a> (neexistuje záznam s odpovídajícím identifikátorem),</li><li>aktualizace stávajícího <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu likvidačního místa</a> (případně obnovení již odebraného záznamu).</li></ul><p>Poznámka: Při testování dat na REST API systému WinyX bylo zjištěno, že se v rámci elementu <strong>odpady</strong> vyskytují duplicitní záznamy. Před jejich zpracováním tedy musíme zajistit, aby nedošlo k jejich současnému zápisu (v rámci jedné dávky by mohlo dojít k založení duplicit obecnou synchronizační komponentou).</p><p>Samotný postup si nyní popíšeme…</p><ol><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a> dostupné v RoadPlan – hledá takové záznamy, které splňují všechny dále uvedené podmínky zároveň:<br><ul><li> Hodnota atributu <strong>Likvidačního místo</strong> odpovídá právě zkoumanému <a href="../../../datove-modely/datovy-78681044.html">Likvidačnímu místu</a>.</li></ul></li><li>Systém zpracuje získané informace o druzích odpadu likvidačního místo – pro všechny záznamy získané v rámci elementu <strong>odpady</strong> (viz dále):<br><ol><li>Systém provede validaci právě zkoumaného záznamu (viz <a href="605uc02-116788569.html">VAL02: Validace druhu odpadu likvidačního místa</a>)…<br><ol><li>Pokud proběhla validace záznamu v pořádku, systém pokračuje ve zpracování informací o druhu odpadu likvidačního místa.</li><li>Jinak validace záznamu skončila chybou – systém provede logování dané skutečnosti a pokračuje dalším záznamem (přechod na krok <strong>2</strong>).<br></li></ol></li><li>Systém nalezne odpovídající záznam na straně RoadPlan – hledá takový <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a>, který splňuje všechny dále uvedené podmínky:<br><ul><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá složenému identifikátoru právě zkoumaného záznamu získaného v rámci elementu <strong>odpady</strong> (viz <a href="605uc02-116788569.html">ALG09: Získání externího identifikátoru druhu odpadu likvidačního místa</a>).</li></ul></li><li>Pokud je nalezen <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> (viz krok <strong>2.b</strong>), systém provede jeho aktualizaci – spustí TODO: UC – Upravit druh odpadu likvidačního místa, na vstup jsou předány následující informace:<br><ul><li><strong>Editovaný druh odpadu likvidačního místa</strong>: získaný <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> (viz krok <strong>2.b</strong>).</li><li><strong>Změny v druhu odpadu likvidačního místa</strong>:  jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc02-116788569.html">ALG09: Získání externího identifikátoru druhu odpadu likvidačního místa</a>; nedochází ke změně hodnoty).</li><li><strong>Likvidační místo</strong>: právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a> (nedochází ke změně hodnoty).</li><li><strong>Druh odpadu</strong>: hodnota získaná v rámci elementu <strong>druhOdpadu</strong> (nedochází ke změně hodnoty).</li><li><strong>Kód nakládání</strong>: hodnota získaná v rámci elementu <strong>kodNakladani</strong> (nedochází ke změně hodnoty).</li><li><strong>Provozovna</strong>: hodnota získaná v rámci elementu <strong>provozovna</strong> (nedochází ke změně hodnoty).</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li><li><em>Poznámka: Ke skutečné aktualizaci <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu likvidačního místa</a> dochází pouze v případě, kdy se liší alespoň jedna z výše uvedených hodnot (opravdu dochází k jeho změně).</em></li></ul></li><li>Jinak takový <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> nalezen není, systém provede jeho založení – spustí TODO: UC – Založit druh odpadu likvidačního místa, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaný druh odpadu likvidačního místa</strong>: jsou předány hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci více elementů (viz <a href="605uc02-116788569.html">ALG09: Získání externího identifikátoru druhu odpadu likvidačního místa</a>).</li><li><strong>Likvidační místo</strong>: právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>.</li><li><strong>Druh odpadu</strong>: hodnota získaná v rámci elementu <strong>druhOdpadu</strong>.</li><li><strong>Kód nakládání</strong>: hodnota získaná v rámci elementu <strong>kodNakladani</strong>.</li><li><strong>Provozovna</strong>: hodnota získaná v rámci elementu <strong>provozovna</strong>.</li><li><strong>Je aktivní</strong>: nastavena hodnota <strong>TRUE</strong>.</li></ul></li></ul></li><li>Systém označí <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> (založený či aktualizovaný) pro potřeby tohoto UC jako zpracovaný.<br><ul><li><em>Takové <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a> nebudou v rámci kroku <strong>3</strong> odebrány.</em></li></ul></li><li>Přechod na krok <strong>2</strong> (zpracování dalšího záznamu).</li></ol></li><li>Systém zpracuje takové <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a> na straně RoadPlan (viz krok <strong>1</strong>), které nebyly označeny jako zpracované (viz krok <strong>2</strong>).<br><ol><li>Systém získá takové <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a>, které splňují všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Je aktivní</strong> je rovna <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Likvidačního místo</strong> odpovídá právě zkoumanému <a href="../../../datove-modely/datovy-78681044.html">Likvidačnímu místu</a>.</li><li>Daný <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> nebyl označen (nedošlo k jeho zpracování v rámci kroku <strong>2</strong>).</li></ul></li><li>Pro všechny získané <a href="../../../datove-modely/datovy-78681044.html">Druhy odpadu likvidačního místa</a> (viz krok <strong>3.a</strong>):<br><ol><li>Systém odebere právě zkoumaný <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a> – spustí TODO: UC – Odebrat druh odpadu likvidačního místa, na vstup jsou předány následující informace:<br><ul><li><strong>Odebíraný druh odpadu likvidačního místa</strong>: právě zkoumaný <a href="../../../datove-modely/datovy-78681044.html">Druh odpadu likvidačního místa</a>.</li></ul></li></ol></li></ol></li></ol><p>V rámci algoritmu je přímo odkazováno na informace získané z WinyX (na odpovídající elementy). Nyní si tedy popíšeme strukturu, ve které jsou informace o druhu odpadu likvidačního místa předávány (včetně způsobu, jakým jsou dílčí hodnoty zpracovány).</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Stručný popis</th><th colspan="1">Předání hodnoty</th><th>Poznámka</th></tr><tr><td colspan="1">druhOdpadu</td><td colspan="1">Kód druhu odpadu likvidačního místa ve WinyX.</td><td colspan="1"><p>Dochází k nalezení takového <a href="../../../datove-modely/datovy-78681044.html">Druhu odpadu</a>, který splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá obsažené hodnotě.</li></ul></td><td colspan="1"><p>Jedná se o součást složeného klíče (viz <a href="605uc02-116788569.html">ALG09: Získání externího identifikátoru druhu odpadu likvidačního místa</a>).</p><p>V rámci migrace bude hodnota externího identifikátoru obsažených <a href="../../../datove-modely/datovy-78681044.html">Druhů odpadu</a> nastavena dle jejich kódu.</p></td></tr><tr><td colspan="1">kodNakladani</td><td colspan="1">Kód nakládání, pod kterým je druh odpadu v rámci likvidačního místo odebírán.</td><td colspan="1">Předání obsažené hodnoty (odpovídá atributu <strong>Kód nakládání</strong> entity <a href="../../../datove-modely/datovy-78681044.html">Likvidační místo</a>).</td><td colspan="1">Jedná se o součást složeného klíče (viz <a href="605uc02-116788569.html">ALG09: Získání externího identifikátoru druhu odpadu likvidačního místa</a>).</td></tr><tr><td colspan="1">provozovna</td><td colspan="1">Identifikátor provozovny ve WinyX, pod kterou je záznam dostupný.</td><td colspan="1"><p>V první řadě je obsažená hodnota převedena na text. Následně dochází k nalezení takové <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a>, která splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong>.</li><li>Hodnota atributu <strong>Externí identifikátor</strong> odpovídá obsažené hodnotě (mapování je uvedeno samostatně, viz <a href="605uc01-116788568.html">ALG02: Mapování provozoven</a> popsaný v rámci <a href="#" data-page-title="605UC01: Zahájit import záznamů"></a>).</li></ul><p>Pokud není hodnota k dispozici, nehledáme ani odpovídající <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a>. V takovém případě není nastavena žádná hodnota, resp. je zrušena aktuálně nastavená hodnota (NULL).</p></td><td colspan="1"><p>Jedná se o součást složeného klíče (viz <a href="605uc02-116788569.html">ALG09: Získání externího identifikátoru druhu odpadu likvidačního místa</a>).</p><p>Pokud není pro zadaný identifikátor nalezena žádná <a href="../../../datove-modely/datovy-78681044.html">Provozovna</a> (případně je nalezen neaktivní záznam), končí zpracování druhu odpadu likvidačního místa chybou (je přeskočeno).</p><p><em>Likvidační místa jsou v rámci Recovera dostupná pro všechny uživatele bez ohledu na provozovnu, proto v rámci této synchronizace bude vždy předáno NULL.</em></p></td></tr></tbody></table><p>Příklad získané odpovědi (její odpovídající části) je pak naznačen následně (včetně ilustrativních hodnot).</p><h2>ALG09: Získání externího identifikátoru druhu odpadu likvidačního místa</h2><p>Získávané druhy odpadu likvidačního místa neobsahují identifikátor, musíme ho tedy složit z dostupných informací. Vycházíme pak ze struktury uvedené v rámci <a href="605uc02-116788569.html">ALG01: Specifikace metody pro získání likvidačních míst</a>.</p><ul><li>Formát: <strong><id>::<odpady.druhOdpadu>::<odpady.kodNakladani>::<odpady.provozovna></strong></li><li>Příklad hodnoty: <strong>8514::020703::D1::4020</strong></li></ul><p>Pokud není k dispozici hodnota elementu <strong>odpady.provozovna</strong>, liší se také podoba samotného identifikátoru.</p><ul><li>Formát: <strong><id>::<odpady.druhOdpadu>::<odpady.kodNakladani></strong></li><li>Příklad hodnoty: <strong>8514::020703::D1</strong></li></ul><p>Význam jednotlivých položek je pak následující:</p><ul><li><strong>id</strong> – identifikátor likvidačního místa,</li><li><strong>odpady.druhOdpadu</strong> – kód odpadu odebíraného likvidačním místem,</li><li><strong>odpady.kodNakladani</strong> – kód nakládání, pod kterým je daný druh odpadu likvidačním místem odebírán,</li><li><strong>odpady.provozovna</strong> – provozovna, pod kterou je daný druh odpadu likvidačního místa dostupný.<ul><li>Je předána hodnota atributu <strong>Externí identifikátor</strong> odpovídající <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> (důvodem je skutečnost, že více poboček může spadat pod jednu <a href="../../../datove-modely/datovy-78681044.html">Provozovnu</a>).  </li><li>Mapování <a href="../../../datove-modely/datovy-78681044.html">Provozoven</a> na pobočky je uvedeno samostatně, viz <a href="605uc01-116788568.html">ALG02: Mapování provozoven</a> popsaný v rámci <a href="#" data-page-title="605UC01: Zahájit import záznamů">605UC01: Zahájit import záznamů</a>.</li></ul></li></ul><p>Poznámka: Uvedené položky svým názvem přímo odpovídají elementům získaným v rámci odpovědi z WinyX.</p><h1>Validace</h1><h2>VAL01: Validace likvidačního místa</h2><p>Jednotlivá likvidační místa, která byla získána na API, je nutné před samotným zpracováním ověřit, provedeme tedy validaci každého z nich (struktura záznamu je uvedena v rámci <a href="605uc02-116788569.html">ALG05: Zpracování likvidačního místa</a>).</p><ul><li>Pokud je likvidační místo v pořádku (je validní), probíhá jeho další zpracování.</li><li>V opačném případě je záznam přeskočen, uvedená skutečnost je logována.</li></ul><p>V rámci popisu pak pro zvýšení přehlednosti abstrahujeme od validací „běžného“ typu. Ty budou sice prováděny u všech dostupných elementů, popsány však budou společně na jednom místě…</p><ul><li>datový typ hodnoty není v pořádku,</li><li>hodnota neodpovídá požadovanému rozsahu,</li><li>hodnota pro povinnou položku není k dispozici.</li></ul><p>Nyní se již dostáváme k validaci jednotlivých elementů. Popis validace každého z nich je uveden v tabulce (povinné údaje jsou označeny *).</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Validace</th><th>Poznámka</th></tr><tr><td colspan="1">id*</td><td colspan="1">–</td><td colspan="1">–</td></tr><tr><td colspan="1">nazev*</td><td colspan="1">–</td><td colspan="1">–</td></tr><tr><td colspan="1">provozovna</td><td colspan="1"><p>Pokud je hodnota k dispozici, musí být splněny také dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný).</li></ul></td><td colspan="1">–</td></tr><tr><td colspan="1"><p>gps</p><ul><li>x</li><li>y</li></ul></td><td colspan="1"><p>–</p></td><td colspan="1">Hodnota musí být k dispozici buď pro oba dílčí elementy, nebo pro žádný z nich. Pravděpodobně může nastat také situace, kdy není element <strong>gps</strong> dostupný vůbec.</td></tr><tr><td colspan="1"><p>adresa</p><ul><li>id</li><li>ulice</li><li>cislo</li><li>obec*</li><li>psc</li><li>zeme*</li></ul></td><td colspan="1">–</td><td colspan="1">–</td></tr><tr><td colspan="1">jeVlastni*</td><td colspan="1">–</td><td colspan="1">–</td></tr><tr><td colspan="1"><p>odpady</p><ul><li>druhOdpadu*</li><li>kodNakladani*</li><li>provozovna</li></ul></td><td colspan="1">Pokud je hodnota k dispozici, musí být v něm obsažené objekty validní.</td><td colspan="1">Validace řešena v rámci <a href="605uc02-116788569.html">VAL02: Validace druhu odpadu likvidačního místa</a>.</td></tr></tbody></table><p>Poznámka: K evidenci chybových stavů může být použit nástroj 3. strany. Aktuálně není nutné, aby tyto informace byly čitelné i pro běžné uživatele.</p><h2>VAL02: Validace druhu odpadu likvidačního místa</h2><p>Jednotlivé druhy odpadu likvidačního místa, které byly získány na API, je nutné před samotným zpracováním ověřit. Provedeme tedy validaci každého z nich (struktura záznamu je uvedena v rámci <a href="605uc02-116788569.html">ALG08: Zpracování druhů odpadu likvidačního místa</a>).</p><ul><li>Pokud je druh odpadu likvidačního místo v pořádku (je validní), probíhá jeho další zpracování.</li><li>V opačném případě je záznam přeskočen, uvedená skutečnost je logována (synchronizace likvidačního místa pokračuje).</li></ul><p>V rámci popisu pak pro zvýšení přehlednosti abstrahujeme od validací „běžného“ typu. Ty budou sice prováděny u všech dostupných elementů, popsány však budou společně na jednom místě…</p><ul><li>datový typ hodnoty není v pořádku,</li><li>hodnota neodpovídá požadovanému rozsahu,</li><li>hodnota pro povinnou položku není k dispozici.</li></ul><p>Nyní se již dostáváme k validaci jednotlivých elementů. Popis validace každého z nich je uveden v tabulce (povinné údaje jsou označeny *).</p><table><tbody><tr><th>Element odpovědi API</th><th colspan="1">Validace</th><th>Poznámka</th></tr><tr><td colspan="1">druhOdpadu*</td><td colspan="1"><p>Musí být splněny dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný).</li></ul></td><td colspan="1">–</td></tr><tr><td colspan="1">kodNakladani*</td><td colspan="1">–</td><td colspan="1">–</td></tr><tr><td colspan="1">provozovna</td><td colspan="1"><p>Pokud je hodnota k dispozici, musí být splněny také dále uvedené podmínky:</p><ul><li>je nalezen odpovídající záznam na straně RoadPlan,</li><li>nalezený záznam je aktivní (není označen jako odebraný),</li><li>tato provozovna koresponduje s tou u likvidačního místa (viz poznámka).</li></ul></td><td colspan="1"><p>Musí být dodržena pravidla daná stromovou strukturou provozoven. Provozovna na úrovni druhu odpadu musí být…</p><ul><li>buď shodná s tou na úrovni likvidačního místa,</li><li>nebo musí být provozovně likvidačního místa podřazena.</li></ul><p>Pokud není provozovna na úrovni druhu odpadu specifikována, nesmí být k dispozici ani v rámci likvidačního místa (naopak to ale možné je).</p></td></tr></tbody></table><p>Poznámka: K evidenci chybových stavů může být použit nástroj 3. strany. Aktuálně není nutné, aby tyto informace byly čitelné i pro běžné uživatele.</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><p>–</p>
</div>
</body>
</html>
