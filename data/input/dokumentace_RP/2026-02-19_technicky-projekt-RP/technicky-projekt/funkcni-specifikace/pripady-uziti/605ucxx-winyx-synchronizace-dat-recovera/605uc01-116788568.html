<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>605UC01: Zahájit import záznamů</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je zahájení importu dat prostřednictvím REST API při současném zajištění orchestrace přenosu těchto dat.</p><p>Poznámka: Synchronizace je připravena pro data ze systému WinyX (zákazník Recovera).</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>Nastane okamžik, ve kterém má dojít k synchronizaci (erpSyncPeriod, viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</p><h2>Vstupní podmínky</h2><p>Je nastavena konfigurace pro synchronizaci:</p><ul><li>perioda spouštění synchronizace: erpSyncPeriod (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>),</li><li>napojení REST API.</li></ul><h2>Vstupní data</h2><p>–</p><h1>Základní tok událostí</h1><ol><li>Systém v daném intervalu načítá a zpracovává aktivní záznamy z REST API – spouští tedy odpovídající UC ve specifikovaném intervalu:<ul><li><a href="#" data-page-title="605UC02: Získat likvidační místa"></a> (interval: <strong>recoveraSyncSettings.<strong>disposalSites</strong>SyncPeriod</strong>, viz <a href="#" data-page-title="Konfigurační hodnoty"></a>),</li><li><a href="#" data-page-title="605UC03: Získat jízdy">605UC03: Získat jízdy</a> (interval: <strong>recoveraSyncSettings.ridesSyncPeriod</strong>, viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><em>Poznámka: Při iniciálním spuštění synchronizace musí být dodrženo uvedené pořadí synchronizačních UC.</em></li></ul></li></ol><p>Jednotlivé synchronizační UC (viz krok <strong>1</strong>) pak pracují s dále uvedenými informacemi:</p><ul><li>autorizační token (viz <a href="605uc01-116788568.html">ALG01: Získání autorizačního tokenu</a>),</li><li>mapování provozoven (viz <a href="605uc01-116788568.html">ALG02: Mapování provozoven</a>).</li></ul><p>Poznámka: Data jsou aktuálně načítána bez ohledu na to, zda u nich od poslední synchronizace došlo ke změně. Jsou získány všechny platné záznamy s tím, že vyhodnocení provedených změn je řešeno až na straně RoadPlan (včetně případného odebrání záznamu). Některá volání pak pomou být parametrizována (např. datum realizace jízdy).</p><h1>Alternativní toky událostí</h1><h2>AF01: Získání autorizace</h2><p>Cílem alternativního toku událostí je provedení autentizace. Schválení přístupu (autorizace) je pak nutné k získání požadovaných informací z RESP API systému WinyX.</p><ul><li><em>Systém může buď pracovat s platností tokenu (hlídá si konec platnosti), nebo čeká na chybu typu 401: Unauthorized.</em></li><li><em>V daný okamžik pak dochází k vyžádání nového tokenu. Způsob implementace je dán dodavatelem systému.</em></li></ul><h3>Vstupní podmínky</h3><ul><li>Došlo k vypršení autorizačního tokenu.</li></ul><h3>Tok událostí</h3><ol><li>Alternativní tok událostí začíná krokem <strong>1</strong> základního toku událostí.</li><li>Systém provede autentizaci (viz <a href="605uc01-116788568.html">ALG01: Získání autorizačního tokenu</a>).</li><li>Systém pokračuje ve zpracování kroku <strong>1</strong> základního toku událostí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Došlo k získání autorizačního tokenu.</li></ul><h1>Výjimkové toky událostí</h1><h2>EF01: Synchronizace není dokončena</h2><p>Pokud je požadováno spuštění tohoto UC, dochází nejprve k vyhodnocení stavu předchozího synchronizačního běhu (na úrovni volaného synchronizačního UC).</p><ul><li>Pokud již došlo k jeho ukončení, dochází ke spuštění dalšího synchronizačního běhu (provedení odpovídajícího synchronizačního UC).</li><li>V opačném případě dochází k potlačení dalšího synchronizačního běhu (nejprve je dokončen odpovídající aktuálně spuštěný synchronizační UC).</li></ul><p>Poznámka: Vycházíme pak ze skutečnosti, že jsou vždy synchronizovány všechny dostupné záznamy. Vynecháním synchronizačního běhu tedy nepřicházíme o informace.</p><h3>Vstupní podmínky</h3><ul><li>Nebyl dokončen předchozí synchronizační běh (nedošlo k dokončení odpovídajícího synchronizačního UC).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem <strong>1</strong> základního toku událostí.</li><li>Systém provede logování této skutečnosti.</li><li>Případ užití předčasně končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nebyl spuštěn další synchronizační běh (potlačeno další spuštění odpovídajícího synchronizačního UC). Uvedená skutečnost je logována.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Byla provedena synchronizace – byly získány a zpracovány záznamy řešených entit (případné problémy byly logovány).</p><h2>Výstupní data</h2><p>–</p><h1>Algoritmy</h1><h2>ALG01: Získání autorizačního tokenu</h2><p>Cílem algoritmu je získání tokenu, který slouží k autorizaci při volání dílčích API metod systému WinyX.</p><table><tbody><tr><th>Specifikace volání API</div></div></th><th>Hodnota</div></div></th><th>Poznámka</div></div></th></tr><tr><td>Cesta</td><td><p><url>/connect/token</p><ul><li><strong>url</strong>: dáno konfigurační hodnotou  <strong>recoveraSyncSettings.authUrl</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li></ul></td><td>–</td></tr><tr><td>Metoda</td><td>POST</td><td>–</td></tr><tr><td>Parametry</td><td><ul><li><strong>grant_type</strong> (string): dáno konfigurační hodnotou  <strong>recoveraSyncSettings.authGrantType</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li><li><strong>scope</strong> (string): dáno konfigurační hodnotou  <strong>recoveraSyncSettings.authScope</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li><li><strong>SpolID</strong> (int): dáno konfigurační hodnotou  <strong>recoveraSyncSettings.spolid</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li><li><strong>company</strong> (string): dáno konfigurační hodnotou  <strong>recoveraSyncSettings.authCompany</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li><li><strong>client_id</strong> (string): dáno konfigurační hodnotou  <strong>recoveraSyncSettings.authClientId</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li><li><strong>client_secret</strong> (string): dáno konfigurační hodnotou  <strong>recoveraSyncSettings.authClientSecret</strong> (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>).</li></ul></td><td>Parametry jsou předávány v těle dotazu (x-www-form-urlencoded).</td></tr><tr><td colspan="1">Příklad volání</td><td colspan="1">https://identity.bclogia.cz/connect/token</td><td colspan="1">Hodnoty vstupních parametrů jsou předávány v těle dotazu. Příklad nemusí být aktuální.</td></tr></tbody></table><p>Současně je naznačena také struktura těla dotazu, uvedené hodnoty jsou pak pouze ilustrativní…</p><h2>ALG02: Mapování provozoven</h2><p>Identifikátor pobočky ve WinyX se liší od identifikátoru <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> v RoadPlan, jedné <a href="../../../datove-modely/datovy-78681044.html">Provozovně</a> navíc může odpovídat více poboček. Proto si popíšeme způsob mapování dílčích záznamů napříč řešenými systémy.</p><p>Uvedené mapováni je vloženo také jako textový soubor. Ten je určen především pro potřeby strojového zpracování: <strong></strong>.</p><ul><li><strong>Řádek s hlavičkou</strong>: ano.</li><li><strong>Oddělovač záznamů</strong>: nový řádek.</li><li><strong>Oddělovač položek záznamu</strong>: středník.</li><li><strong>Dostupné informace</strong>:<br><ul><li><strong>WinyX_ID</strong>: identifikátor pobočky na straně WinyX (hodnota získaná na API).</li><li><strong>RoadPlan_extID</strong>: externí identifikátor <a href="../../../datove-modely/datovy-78681044.html">Provozovny</a> na straně RoadPlan.</li></ul></li></ul><p>Poznámka: Mapování <a href="../../../datove-modely/datovy-78681044.html">Provozoven</a> by mělo být uloženo v takové podobě, která umožňuje provádění operativních změn (tedy bez zásahu do implementace).</p><table><tbody><tr><th>Pobočka ve WinyX</th><th>Provozovna v RoadPlan</th></tr><tr><td><ul><li>90205: Severní Čechy - Česká Lípa</li><li>91200: Čechy - Srní</li><li>91201: Čechy - Srní MZ</li><li>90202: Severní Čechy - Česká Lípa Bombardier</li><li>91202: Čechy - Varndsdorf</li></ul></td><td>1220: Srní</td></tr><tr><td colspan="1"><ul><li>30203: Západ - Plzeň MZ</li><li>30405: Západ - Plzeň (Skladová)</li><li>30500: Západ - Plzeň spalovna</li><li>31300: Západ - ÚČS</li><li>31700: Západ - Břasy MZ</li><li>30201: Západ - Plzeň Sulkov</li><li>30202: Západ - Klatovy</li><li>31400: Západ - Rekon</li><li>31500: Západ - Břasy SD</li><li>31600: Západ - Břasy skládka</li></ul></td><td colspan="1">3020: Plzeň</td></tr><tr><td><ul><li>30400: Západ - Soběslav Nutralizační stanice</li><li>30402: Západ - Temelín Mobilní zařízení</li><li>30404: Západ - Temelín</li><li>30406: Západ - České Budějovice (U Sirkárny)</li><li>30401: Západ - Soběslav Sklad Na Pískách</li><li>30403: Západ - České Budějovice</li></ul></td><td>3040: Temelín</td></tr><tr><td><ul><li>91203: Čechy - Josefův Důl</li><li>91204: Čechy - Josefův Důl MZ</li><li>31301: Západ - ÚČS (man.plocha)</li><li>40700: Střed - Mladá Boleslav</li><li>40900: Střed - SD Jičín</li></ul></td><td>3130: Josefův Důl</td></tr><tr><td><ul><li>40200: Střed - Praha Vinoř</li><li>40202: Střed - Praha (Kovošrot)</li><li>40203: Střed - Praha (Průmyslová)</li><li>40204: Střed - Praha Kovošrot - demontáž el. zař.</li><li>40099: Čechy - Obchodník</li><li>40504: Střed - Kutná Hora</li><li>40600: Střed - Spalovna Motol</li><li>40201: Střed- Praha, Benešov Mobilní zařízení</li></ul></td><td>4020: Praha</td></tr><tr><td colspan="1"><ul><li>40300: Střed - Benešov</li></ul></td><td colspan="1">4030: Benešov</td></tr><tr><td><ul><li>50099: Sever - Obchodník</li><li>50200: Sever - Ostrava</li><li>50201: Sever - Odr</li><li>50203: Sever - Ostrava Mobilní zařízení</li><li>50204: Sever - Příbor Kompostárna</li><li>50801: Sever - Frýdek Místek deemulgace</li><li>51000: Sever - Ostrava spalovna</li><li>50202: Sever - Ostrava Hrušov</li><li>50205: Sever - Kunčice</li><li>50206: Sever - Ostrava Rychvald</li><li>50207: Sever - Ostrava LCO Rekultivační stavba</li><li>50208: Sever - Bruntál</li><li>50209: Sever - Ostrava (BorsodChem)</li><li>50210: Sever - Ostrava - Přímo na koncovku</li><li>50211: Sever - Ostrava Elektro</li><li>50212: Sever - Ostrava Třebovice</li><li>50299: Sever - Ostrava evidence za zákazníka</li><li>50802: Sever - Frýdek Místek překladiště</li><li>50803: Sever - Frýdek Druhotky</li></ul></td><td>5020: Ostrava</td></tr><tr><td><ul><li>50302: Sever - Olomouc (U Panelárny)</li><li>50303: Sever - Olomouc - MZ (U panelárny)</li><li>50900: Sever - Dolní Sukolom</li><li>50300: Sever - Olomouc</li><li>50301: Sever - Olomouc Ahold</li><li>50305: Sever - Olomouc Siemens</li><li>50306: Sever - Olomouc Mobilní zařízení</li><li>50307: Sever - Křelov kompostárna</li><li>50399: Sever - Olomouc evidence za zákazníka</li><li>50405: Sever - Mob.Drtič ORP 1562 Prostějov</li><li>50406: Sever - SD Letohrad</li><li>50500: Sever - Olomouc Spalovna FM</li></ul></td><td>5030: Olomouc</td></tr><tr><td><ul><li>50400: Sever - Rapotín</li><li>50403: Sever - Rapotín MZ</li><li>50404: Sever - Letohrad SD</li><li>51100: Sever - CSD Rapotín</li><li>51401: Sever - JK Šumperk</li><li>51402: Sever - JK Zábřeh</li><li>51403: Sever - JK Mikulovice</li><li>51404: Sever - JK Jeseník</li><li>51405: Sever - JK Hanušovice</li><li>50401: Sever - Rapotín Sběrné středisko odpadů</li><li>50402: Sever - Šumperk SSO</li><li>51200: Sever - SUEZ Technický servis</li><li>51501: Sever - Mob. drtič ORP 7111 Šumperk</li></ul></td><td>5040: Rapotín</td></tr><tr><td><ul><li>40501: Střed - Pardubice Mobilní zařízení</li><li>40801: Střed - Rybitví mezideponie</li><li>40802: Střed - Skládka STOH Rybitví sklad</li><li>40899: Střed - Pardubice evidence za zákazníka</li><li>40400: Střed - Pardubice</li><li>40403: Střed - Pardubice hala</li><li>40502: Střed - Dašice</li><li>40503: Střed - Hradec Králové</li><li>40800: Střed - Skládka STOH Rybitví</li></ul></td><td>5130: Pardubice</td></tr><tr><td><ul><li>60200: Východ - Val. Mez. Hemy</li><li>60202: Východ - Val. Mez. Uhelná</li><li>60203: Východ - Val. Mez. MZ</li><li>60800: Východ - Vsetín sklad</li><li>60801: Východ - Vsetín Třídírna</li><li>60802: Východ - Vsetín MZ</li><li>60201: Východ - Val. Mez. Milotice</li><li>60301: Východ - Hrušky</li></ul></td><td>6020: Valašské Meziříčí</td></tr><tr><td><ul><li>60300: Východ - Otrokovice</li><li>60302: Východ - Otrokovice MZ</li><li>60303: Východ - Val. Klobouky SSO Groz-Beckert</li><li>60700: Východ - Zlín spalovna</li><li>72900: Východ - Staré Město</li></ul></td><td>6030: Otrokovice</td></tr><tr><td><ul><li>60604: Východ - Břeclav LC</li><li>60605: Východ - Břeclav LC MZ</li><li>60600: Východ - Hodonín</li><li>60601: Východ - Mikulov</li><li>60602: Východ - Mikulov MZ</li><li>60603: Východ - Lužice SSO Groz-Beckert</li></ul></td><td>6060: Břeclav</td></tr><tr><td><ul><li>70099: Jih - Obchodník</li><li>70200: Jih - Brno Líšeň</li><li>70202: Jih - SSO Modřice</li><li>70204: Jih - SSO Bošovice</li><li>70207: Jih - Brno Mobilní zařízení</li><li>71209: JIH - Brno CKB</li><li>70201: Jih - BVV</li><li>70206: Jih - Brno Obřanská Mycí rampa</li><li>70208: Jih - Brno (VZ Šumavská)</li><li>70300: Jih - Syrovice</li><li>71208: JIH - Brno CKB (mobilní drtič dřeva)</li><li>71210: JIH - Brno CKB překladiště</li></ul></td><td>7020: Brno</td></tr><tr><td><ul><li><p>60400: Východ - Hradčany</p></li><li>70500: JIH - Němčice</li><li>70502: JIH - Němčice PLASTY</li><li>60450: Východ - Hradčany - obce</li><li>70203: Jih - SSO Ivančice</li><li>70205: Jih - Němčice sklad</li><li>70501: JIH - Němčice překladiště</li></ul></td><td>7050: Němčice nad Hanou</td></tr><tr><td><ul><li>70603: JIH - Jihlava</li><li>70605: JIH - Jihlava MZ</li><li>70601: Jih - Havl. Brod</li><li>70602: Jih - Havl. Brod Mobilní zařízení</li><li>70700: Jih - !Nepoužívat!</li></ul></td><td>7060: Jihlava</td></tr><tr><td><ul><li>70900: Jih - Boskovice NO</li><li>70901: Jih - Doubravy - překladiště</li><li>70902: Jih - Olešnice</li><li>70903: Jih - Horní Lhota</li><li>70905: Jih - Boskovice</li><li>70906: Jih - Boskovice Mobilní zařízení</li><li>70907: Jih - SSO Chornice</li><li>70908: Jih - SSO Brněnec</li><li>70910: Jih - SSO Vítějeves</li><li>70911: Jih - Boskovice Havlíčkova</li><li>70701: Jih - TS Tišnov</li><li>70702: Jih - Tišnov Mobilní zařízení</li><li>70800: Jih - Blansko Pražská</li><li>70801: Jih - Blansko Mobilní zařízení</li><li>70802: Jih - Výkupna Rájec</li><li>70803: Jih - Výkupna Palava</li><li>70904: Jih - SSO Rájec - Jestřebí</li><li>70909: Jih - SSO Městečko Trnávka</li><li>70912: JIH - Doubravy - kompostárna</li><li>70913: JIH - SSO Jedovnice</li><li>70914: Jih - SSO Protivanov</li><li>70915: Jih - Doubravy Ter. úpravy</li></ul></td><td>7090: Boskovice</td></tr><tr><td><ul><li>90200: Severni Čechy - Skladka</li><li>90201: Severni Čechy - Spalovna Trmice</li><li>90203: Severni Čechy - Usti MZ</li><li><p>90204: Severni Čechy – Skl.Všebořice (PKÚ důl J.Šverma)</p></li></ul></td><td>9022: Ústí nad Labem</td></tr><tr><td><ul><li>91100: Severni Čechy - Chomutov</li><li>91101: Severni Čechy - Chomutov MZ</li></ul></td><td>9110: Chomutov</td></tr></tbody></table><h1>Validace</h1><p>–</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><p>–</p>
</div>
</body>
</html>
