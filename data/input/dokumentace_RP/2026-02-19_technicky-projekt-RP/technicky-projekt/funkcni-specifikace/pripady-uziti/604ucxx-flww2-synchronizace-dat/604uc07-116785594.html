<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>604UC07: Získat FLW pozice</title>
</head>
<body>
<div class="wiki-content">
<p><strong>Rozpracováno – přenášené informace, volaná API.</strong></p><p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je zahájení synchronizace pozičních záznamů z FLWW2.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>Nastane okamžik, ve kterém má dojít k synchronizaci – spuštění probíhá v pravidelném intervalu: <strong>refreshPeriodRoutesMonitoring</strong> (viz <a href="#" data-page-title="Systémové hlášky">Systémové hlášky</a>).</p><ul><li>Oproti ostatním entitám je zde použit výrazně kratší interval. Důvodem je průběžné zobrazení informací na obrazovce monitoringu realizace denních výkonů.</li><li>Nejprve pak probíhá synchronizace pozičních záznamů (tento UC), až následně synchronizace událostí (viz <a href="#" data-page-title="604UC08: Získat FLW události">604UC08: Získat FLW události</a>).</li></ul><p>Nastane okamžik, ve kterém dochází k ukončení realizace denních výkonů – spuštění probíhá na úrovni celého dne (viz <a href="#" data-page-title="300UC14: Ukončit realizaci denního výkonu"></a>).</p><ul><li>Zde dochází k aktualizaci pozičních záznamů – chybějící jsou doplněny, existující aktualizovány (např. doplnění identifikátoru odpovídající jízdy).</li></ul><h2>Vstupní podmínky</h2><p>Je nastavena konfigurace pro synchronizaci záznamů:</p><ul><li>Napojení systému FLWW2 (jeho API).</li></ul><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Datum a čas od</td><td colspan="1">Datum a čas</td><td colspan="1">Ne</td><td colspan="1">Začátek období, v rámci kterého probíhá synchronizace záznamů.</td><td colspan="1">Pokud není k dispozici hodnota pro některý ze vstupních parametrů pro zadání času, jsou použity proměnné <strong>TSYNC</strong> a <strong>TAKT</strong>.</td></tr><tr><td colspan="1">Datum a čas do</td><td colspan="1">Datum a čas</td><td colspan="1">Ne</td><td colspan="1">Konec období, v rámci kterého probíhá synchronizace záznamů.</td><td colspan="1">Pokud není k dispozici hodnota pro některý ze vstupních parametrů pro zadání času, jsou použity proměnné <strong>TSYNC</strong> a <strong>TAKT</strong>.</td></tr><tr><td colspan="1">Denní výkon</td><td colspan="1"><a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a></td><td colspan="1">Ne</td><td colspan="1">Denní výkon, pro který probíhá synchronizace záznamů.</td><td colspan="1">Pokud není hodnota k dispozici, jsou záznamy získávány pro všechny relevantní denní výkony.</td></tr></tbody></table><h1>Základní tok událostí</h1><ol><li>Systém získá <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, pro které mají být získány poziční záznamy:<br><ol><li>Pokud je na vstupu získán <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>) – systém dále pracuje pouze s tímto <a href="../../../datove-modely/datovy-78681044.html">Denním výkonem</a>. </li><li>Jinak na vstupu <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> získán není – systém hledá takové <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, které splňují všechny dále uvedené podmínky zároveň (s těmi dále pracuje):<br><ul><li>Hodnota atributu Datum realizace je nastavena na dnešní datum.</li><li>Hodnota atributu Vozidlo je k dispozici (různá od NULL).</li><li>Hodnota atributu Stav nabývá jedné z uvedených hodnot: Schválený, Plněný (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li></ul></li></ol></li><li>Pokud byl získán alespoň jeden <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>1</strong>):<br><ol><li>Systém zavolá odpovídající metodu API (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>) pro uvedené parametry:<br><ul><li><strong>Identifikátory objektů</strong>: hodnota atributu <strong>Externí identifikátor FLW</strong> odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (atribut <strong>Vozidlo</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>).<br><ul><li><em>Hodnota je předána pro všechny získané <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a> (viz krok <strong>1</strong>). Jednotlivé hodnoty jsou odděleny čárkou.</em></li></ul></li><li><strong>Datum vytvoření</strong>: hodnota vstupního parametru <strong>Datum a čas od</strong> (případně hodnota proměnné <strong>TSYNC</strong>).<br><ul><li><em>Časové razítko je získáno z poslední dostupné pozice pro daný objekt, od něj je pak odečteno 15 minut.</em></li><li><em>Cílem je podchycení situací, kdy jsou některé poziční záznamy dodány s několikaminutovým zpožděním.</em></li></ul></li><li><strong>Datum vytvoření</strong>: hodnota vstupního parametru <strong>Datum a čas do</strong> (případně hodnota proměnné <strong>TAKT</strong>).</li></ul></li><li>Pro všechny získané záznamy v rámci volání odpovídající metody API (viz krok <strong>2.a</strong>): TODO: Pořadí – time (stejný čas: record_order).<br><ol><li>Systém vyhodnotí, zda má být právě zkoumaný záznam zpracován – splněny musí být všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota získaná v rámci položky <strong>gpsDistance</strong> je k dispozici (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li>Hodnota získaná v rámci položky <strong>recordOrder</strong> je k dispozici (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).<br></li><li>Hodnota získaná v rámci položky <strong>recordOrder</strong> je větší nebo rovna 0 (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li>Hodnota získaná v rámci položky <strong>position.latitude</strong> je validní (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li>Hodnota získaná v rámci položky <strong>position.longitude</strong> je validní (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li>TODO: Záznam zatím není k dispozici (aktuální chování).</li></ul></li><li>Systém založí odpovídající <a href="../../../datove-modely/datovy-78681044.html">FLW pozici</a> – spustí <a href="#" data-page-title="502UC01: Založit FLW pozici"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná FLW pozice</strong>: předány dále uvedené hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci položky <strong>positionId</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li><strong>Externí identifikátor jízdy</strong>:</li><li><strong>Externí identifikátor objektu</strong>: hodnota získaná v rámci položky <strong>objectId</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li><strong>Datum a čas</strong>: hodnota získaná v rámci položky <strong>time</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li><strong>Zeměpisná šířka</strong>: hodnota získaná v rámci položky <strong>position.latitude</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li><strong>Zeměpisná délka</strong>: hodnota získaná v rámci položky <strong>position.longitude</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li>Vzdálenost</li><li>Rychlost</li><li>Aktivní vstupy</li><li><strong>Je zapnutý motor</strong>: hodnota získaná v rámci položky <strong>isEngineOn</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li>Oblasti</li><li>Je připojen přívěs</li><li>Přívěsy</li><li>Azimut</li><li>Ulice lokality</li><li>Město lokality</li><li>PSČ lokality</li><li>Stát lokality</li><li>Řidič</li><li><strong>Adresa</strong>: hodnota získána v rámci <a href="#" data-page-title="706UC01: Získat adresu dle souřadnic"></a> (výstupní parametr <strong>Adresy</strong>), na vstup jsou předány následující informace:<br><ul><li><strong>Zeměpisná šířka</strong>: hodnota získaná v rámci položky <strong>position.latitude</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).<br></li><li><strong>Zeměpisná délka</strong>: hodnota získaná v rámci položky <strong>position.longitude</strong> (viz <a href="604uc07-116785594.html">ALG01: Získat informace o pozičním záznamu</a>).</li><li><strong>Počet záznamů</strong>: předána hodnota <strong>1</strong>.<br></li></ul></li></ul></li></ul></li></ol></li></ol></li></ol><p>Poznámka: Pro zvýšení přehlednosti uvedeného toku událostí byly zavedeny určitě proměnné…</p><ul><li><strong>TSYNC</strong>: datum a čas poslední provedené synchronizace záznamů.</li><li><strong>TAKT</strong>: datum a čas, ve který došlo ke spuštění tohoto případu užití.</li></ul><p><em>Interní poznámka: Způsob volání daného API je v režii dodavatele systému, aktuálně probíhá nad celou množinou denních výkonů.</em></p><h1>Alternativní toky událostí</h1><p>–</p><h1>Výjimkové toky událostí</h1><h2>EF01: Nedostupné API</h2><h3>Vstupní podmínky</h3><ul><li>Volané API není dostupné.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF02: Chyba autentizace na API</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API došlo k chybě při autentizaci.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF03: Chyba autorizace na API</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API došlo k chybě při autorizaci.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF04: Chyba dotazu na API</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API nebyl vrácen požadovaný záznam (chyba dotazu).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF05: Záznam není na API k dispozici</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API nebyl vrácen požadovaný záznam (nebyl nalezen).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF06: Záznam z API není validní</h2><h3>Vstupní podmínky</h3><ul><li>Získané informace o <a href="../../../datove-modely/datovy-78681044.html">FLW pozici</a> nejsou validní (viz <a href="604uc07-116785594.html">Validace</a>).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a>, uvedená skutečnost byla zaznamenána.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Došlo k získání a zpracování pozičních záznamů, následně proběhlo jejich uložení do databáze.</p><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Získat informace o pozičním záznamu</h2><p>Cílem algoritmu je získání informací o <a href="../../../datove-modely/datovy-78681044.html">FLW pozici</a> ze systému FLWW2, k tomu je určeno specializované API.</p><table><tbody><tr><th>Specifikace volání API</div></th><th>Hodnota</div></th><th>Poznámka</div></th></tr><tr><td>Cesta</td><td><p>/FleetwareWebAPI/objects/[number_array]/positions</p></td><td>Viz <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-Technick%C3%A1dokumentaceRESTAPIv1-Seznamobjekt%C5%AF">technický popis</a>.</td></tr><tr><td>Metoda</td><td>GET</td><td>–</td></tr><tr><td>Parametry</td><td><p>Identifikátory objektů: seznam <a href="../../../datove-modely/datovy-78681044.html">Objektů</a>, pro které mají být získány poziční záznamy (viz <strong>number_array</strong>).</p><p>Datum a čas od: časové razítko, dle kterého jsou filtrovány poziční záznamy (začátek období, viz <strong>timeFrom</strong>).</p><p>Datum a čas do: časové razítko, dle kterého jsou filtrovány poziční záznamy (konec období, viz <strong>timeTo</strong>).</p></td><td>Specifikováno v rámci základního toku událostí.</td></tr><tr><td colspan="1">Příklad volání</td><td colspan="1"><p>/FleetwareWebAPI/objects/<strong>5878,5814,1247</strong>/positions?<strong>timeFrom=2016-05-01T17:08:32Z</strong>&<strong>timeTo=2016-05-01T19:08:32Z</strong></p></td><td colspan="1">Vstupní parametry jsou zvýrazněny tučným řezem písma.</td></tr></tbody></table><p>Každý vrácený záznam se pak pokusíme zpracovat, cílem je získání odpovídajících informací o dané <a href="../../../datove-modely/datovy-78681044.html">FLW pozici</a>. K tomu slouží dále uvedené mapování…</p><p>Poznámka: Zmíněny jsou pouze takové položky dané odpovědi API, které nás z pohledu synchronizace zajímají.</p><table><tbody><tr><th>Atribut řešené entity</div></th><th>Položka odpovědi API</div></th><th>Poznámka</div></th></tr><tr><td colspan="1">Identifikátor</td><td colspan="1">–</td><td colspan="1">Systémový atribut (nastavován v rámci kroku <strong>2.b.ii</strong> základního toku událostí).</td></tr><tr><td colspan="1">Externí identifikátor</td><td colspan="1">positionId</td><td colspan="1">Formát externího identifikátoru je následující: <strong><positionId></strong> (např. 3961).</td></tr><tr><td colspan="1">Externí identifikátor jízdy</td><td colspan="1">rideId</td><td colspan="1">Formát externího identifikátoru je následující: <strong><TODO></strong> (např. 103961).</td></tr><tr><td colspan="1">Externí identifikátor objektu</td><td colspan="1">objectId</td><td colspan="1"><p>Formát externího identifikátoru je následující: <strong><TODO></strong> (např. 1039).</p><p>Odpovídá atributu <strong>Externí identifikátor FLW</strong> konkrétního <a href="../../../datove-modely/datovy-78681044.html">Objektu</a>.</p></td></tr><tr><td colspan="1">Datum a čas</td><td colspan="1">time</td><td colspan="1">–</td></tr><tr><td colspan="1">Zeměpisná šířka</td><td colspan="1">position.latitude</td><td colspan="1"> </td></tr><tr><td colspan="1">Zeměpisná délka</td><td colspan="1">position.longitude</td><td colspan="1"> </td></tr><tr><td colspan="1">Vzdálenost</td><td colspan="1">gpsDistance</td><td colspan="1"> </td></tr><tr><td colspan="1">Rychlost</td><td colspan="1">speed</td><td colspan="1"> </td></tr><tr><td colspan="1">Pořadí záznamu</td><td colspan="1">recordOrder</td><td colspan="1"> </td></tr><tr><td colspan="1">Aktivní vstupy</td><td colspan="1">inputsOn</td><td colspan="1"> </td></tr><tr><td colspan="1">Je zapnutý motor</td><td colspan="1">isEngineOn</td><td colspan="1">–</td></tr><tr><td colspan="1">Oblasti</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Je připojen přívěs</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Přívěsy</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Azimut</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Ulice lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Město lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">PSČ lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Stát lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Řidič</td><td colspan="1">driverId</td><td colspan="1"><p>Formát externího identifikátoru je následující: <strong><TODO></strong> (např. 139).</p><p>Odpovídá atributu <strong>Externí identifikátor</strong> konkrétního <a href="../../../datove-modely/datovy-78681044.html">Zaměstnance</a>.</p></td></tr><tr><td colspan="1">Adresa</td><td colspan="1">–</td><td colspan="1">Probíhá geokódování získaných souřadnic.</td></tr><tr><td colspan="1">Datum vytvoření</td><td colspan="1">–</td><td colspan="1">Systémový atribut (nastavován v rámci kroku <strong>2.b.ii</strong> základního toku událostí).</td></tr></tbody></table><h1>Validace</h1><p>Získané informace musí svým datovým typem a rozsahem odpovídat atributům řešené entity. Údaje pro povinné atributy musí být k dispozici.</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h3>1. 12. 2023: Tomáš Nadrchal </h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="604uc07-116785594.html">Vstupní data</a></td><td colspan="1">Revize vstupních dat – možnost spuštění pro konkrétní denní výkon (naznačeno modře).</td></tr><tr><td colspan="1"><a href="604uc07-116785594.html">Základní tok událostí</a></td><td colspan="1">Doplněno vyhodnocení množiny denních výkonů, pro které mají být získány poziční záznamy (naznačeno modře).</td></tr></tbody></table>
</div>
</body>
</html>
