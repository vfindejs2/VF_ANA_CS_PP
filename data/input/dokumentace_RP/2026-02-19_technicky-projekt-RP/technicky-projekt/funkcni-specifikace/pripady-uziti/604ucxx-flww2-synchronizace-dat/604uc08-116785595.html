<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>604UC08: Získat FLW události</title>
</head>
<body>
<div class="wiki-content">
<p><strong>Rozpracováno – přenášené informace, volaná API.</strong></p><p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je zahájení synchronizace událostí z FLWW2.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>Nastane okamžik, ve kterém má dojít k synchronizaci – spuštění probíhá v pravidelném intervalu: <strong>refreshPeriodRoutesMonitoring</strong> (viz <a href="#" data-page-title="Systémové hlášky">Systémové hlášky</a>).</p><ul><li>Oproti ostatním entitám je zde použit výrazně kratší interval. Důvodem je průběžné zobrazení informací na obrazovce monitoringu realizace denních výkonů.</li><li>Nejprve pak probíhá synchronizace pozičních záznamů (viz <a href="#" data-page-title="604UC07: Získat FLW pozice">604UC07: Získat FLW pozice</a>), až následně synchronizace událostí (tento UC).</li></ul><p>Nastane okamžik, ve kterém dochází k ukončení realizace denních výkonů – spuštění probíhá na úrovni celého dne (viz <a href="#" data-page-title="300UC14: Ukončit realizaci denního výkonu"></a>).</p><h2>Vstupní podmínky</h2><p>Je nastavena konfigurace pro výchozí sledovaný vstup: <strong>defaultPTOInput</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>). </p><p>Je nastavena konfigurace pro synchronizaci záznamů:</p><ul><li>Napojení systému FLWW2 (jeho API).</li></ul><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Datum a čas od</td><td colspan="1">Datum a čas</td><td colspan="1">Ne</td><td colspan="1">Začátek období, v rámci kterého probíhá synchronizace záznamů.</td><td colspan="1">Pokud není k dispozici hodnota pro některý ze vstupních parametrů pro zadání času, jsou použity proměnné <strong>TSYNC</strong> a <strong>TAKT</strong>.</td></tr><tr><td colspan="1">Datum a čas do</td><td colspan="1">Datum a čas</td><td colspan="1">Ne</td><td colspan="1">Konec období, v rámci kterého probíhá synchronizace záznamů.</td><td colspan="1">Pokud není k dispozici hodnota pro některý ze vstupních parametrů pro zadání času, jsou použity proměnné <strong>TSYNC</strong> a <strong>TAKT</strong>.</td></tr><tr><td colspan="1">Denní výkon</td><td colspan="1"><a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a></td><td colspan="1">Ne</td><td colspan="1">Denní výkon, pro který probíhá synchronizace záznamů.</td><td colspan="1">Pokud není hodnota k dispozici, jsou záznamy získávány pro všechny relevantní denní výkony.</td></tr></tbody></table><h1>Základní tok událostí</h1><ol><li>Systém získá <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, pro které mají být získány poziční záznamy:<br><ol><li>Pokud je na vstupu získán <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>) – systém dále pracuje pouze s tímto <a href="../../../datove-modely/datovy-78681044.html">Denním výkonem</a>.</li><li>Jinak na vstupu <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> získán není – systém hledá takové <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, které splňují všechny dále uvedené podmínky zároveň (s těmi dále pracuje):<ul><li>Hodnota atributu <strong>Datum realizace</strong> je nastavena na dnešní datum.</li><li>Hodnota atributu <strong>Vozidlo</strong> je k dispozici (různá od NULL).</li><li>Hodnota atributu <strong>Stav</strong> nabývá jedné z uvedených hodnot: <strong>Schválený</strong>, <strong>Plněný</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li></ul></li></ol></li><li>Pokud byl získán alespoň jeden <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (viz krok <strong>1</strong>):<br><ol><li>Systém získá sledovaný vstup odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (viz <a href="604uc08-116785595.html">ALG02: Získat sledovaný vstup</a>).</li><li>Systém zavolá odpovídající metodu API (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>) pro uvedené parametry:<br><ul><li><strong>Identifikátory objektů</strong>: hodnota atributu <strong>Externí identifikátor FLW</strong> odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (atribut <strong>Vozidlo</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>).<br><ul><li><em>Hodnota je předána pro všechny získané <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a> (viz krok <strong>1</strong>). Jednotlivé hodnoty jsou odděleny čárkou.</em></li></ul></li><li><strong>Datum vytvoření</strong>: hodnota vstupního parametru <strong>Datum a čas od</strong> (případně hodnota proměnné <strong>TSYNC</strong>).</li><li><strong>Datum vytvoření</strong>: hodnota vstupního parametru <strong>Datum a čas do</strong> (případně hodnota proměnné <strong>TAKT</strong>).</li></ul></li><li>Pro všechny získané záznamy v rámci volání odpovídající metody API (viz krok <strong>2.b</strong>):<br><ol><li>Systém vyhodnotí, zda má být právě zkoumaný záznam zpracován – splněny musí být všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota získaná v rámci položky <strong>latitude</strong> je validní (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li>Hodnota získaná v rámci položky <strong>longitude</strong> je validní (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li>Hodnota atributu v rámci položky <strong>eventType</strong> obsahuje jednu z dále uvedených hodnot (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>):<br><ul><li>31: zapnutí vstupu 1,</li><li>32: zapnutí vstupu 2,</li><li>33: zapnutí vstupu 3,</li><li>34: zapnutí vstupu 4,</li><li>35: zapnutí vstupu 5,</li><li>36: zapnutí vstupu 6,</li><li>37: zapnutí vstupu 7,</li><li>38: zapnutí vstupu 8,</li><li>39: zapnutí vstupu 9,</li><li>40: zapnutí vstupu 10,</li><li>51: zapnutí vstupu 11,</li><li>52: zapnutí vstupu 12,</li><li>53: zapnutí vstupu 13,</li><li>189: připojení přívěsu,</li><li>190: odpojení přívěsu.</li></ul></li><li>TODO: Záznam zatím není k dispozici (aktuální chování).</li></ul></li><li>Pokud má být právě zkoumaný záznam zpracován (viz krok <strong>2.c.i</strong>):<br><ol><li>Systém založí odpovídající <a href="../../../datove-modely/datovy-78681044.html">FLW událost</a> – spustí <a href="#" data-page-title="502UC02: Založit FLW událost"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná FLW událost</strong>: předány dále uvedené hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">FLW událost</a>:<br><ul><li><strong>Externí identifikátor</strong>: hodnota získaná v rámci položky <strong>id</strong> (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li>Externí identifikátor pozičního záznamu</li><li><strong>Externí identifikátor objektu</strong>: hodnota získaná v rámci položky <strong>objectId</strong> (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li><strong>Datum a čas</strong>: hodnota získaná v rámci položky <strong>dateTime</strong> (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li><strong>Zeměpisná šířka</strong>: hodnota získaná v rámci položky <strong>latitude</strong> (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li><strong>Zeměpisná délka</strong>: hodnota získaná v rámci položky <strong>longitude</strong> (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li>Typ události</li><li>Popis</li><li>Lokace</li><li>Ulice lokality</li><li>Město lokality</li><li>PSČ lokality</li><li>Stát lokality</li><li><strong>Adresa</strong>: hodnota získána v rámci <a href="#" data-page-title="706UC01: Získat adresu dle souřadnic"></a> (výstupní parametr <strong>Adresy</strong>), na vstup jsou předány následující informace:<br><ul><li><strong>Zeměpisná šířka</strong>: hodnota získaná v rámci položky <strong>latitude</strong> (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).<br></li><li><strong>Zeměpisná délka</strong>: hodnota získaná v rámci položky <strong>longitude</strong> (viz <a href="604uc08-116785595.html">ALG01: Získat informace o události</a>).</li><li><strong>Počet záznamů</strong>: předána hodnota <strong>1</strong>.<br></li></ul></li></ul></li></ul></li></ol></li></ol></li></ol></li></ol><p>Poznámka: Pro zvýšení přehlednosti uvedeného toku událostí byly zavedeny určitě proměnné…</p><ul><li><strong>TSYNC</strong>: datum a čas poslední provedené synchronizace záznamů.</li><li><strong>TAKT</strong>: datum a čas, ve který došlo ke spuštění tohoto případu užití.</li></ul><p><em>Interní poznámka: Způsob volání daného API je v režii dodavatele systému<em>, aktuálně probíhá nad celou množinou denních výkonů.</em></em></p><h1>Alternativní toky událostí</h1><p>–</p><h1>Výjimkové toky událostí</h1><h2>EF01: Nedostupné API</h2><h3>Vstupní podmínky</h3><ul><li>Volané API není dostupné.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW události</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF02: Chyba autentizace na API</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API došlo k chybě při autentizaci.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW události</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF03: Chyba autorizace na API</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API došlo k chybě při autorizaci.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW události</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF04: Chyba dotazu na API</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API nebyl vrácen požadovaný záznam (chyba dotazu).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW události</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF05: Záznam není na API k dispozici</h2><h3>Vstupní podmínky</h3><ul><li>Při volání API nebyl vrácen požadovaný záznam (nebyl nalezen).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW události</a>, uvedená skutečnost byla zaznamenána.</li></ul><h2>EF06: Záznam z API není validní</h2><h3>Vstupní podmínky</h3><ul><li>Získané informace o <a href="../../../datove-modely/datovy-78681044.html">FLW události</a> nejsou validní (viz <a href="604uc08-116785595.html">Validace</a>).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Případ užití končí.</li></ol><p>Poznámka: Současné dochází k řádnému logování chybového stavu.</p><h3>Výstupní podmínky</h3><ul><li>Nedošlo k synchronizaci <a href="../../../datove-modely/datovy-78681044.html">FLW události</a>, uvedená skutečnost byla zaznamenána.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Došlo k získání a zpracování událostí, následně proběhlo jejich uložení do databáze.</p><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Získat informace o události</h2><p>Cílem algoritmu je získání informací o <a href="../../../datove-modely/datovy-78681044.html">FLW události</a> ze systému FLWW2, k tomu je určeno specializované API.</p><table><tbody><tr><th>Specifikace volání API</div></th><th>Hodnota</div></th><th>Poznámka</div></th></tr><tr><td>Cesta</td><td><p>FleetwareWebAPI/events</p></td><td>Viz <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-Technick%C3%A1dokumentaceRESTAPIv1-Seznamobjekt%C5%AF">technický popis</a>.</td></tr><tr><td>Metoda</td><td>GET</td><td>–</td></tr><tr><td>Parametry</td><td><p>Identifikátory objektů: seznam <a href="../../../datove-modely/datovy-78681044.html">Objektů</a>, pro které mají být získány události (viz <strong>objectIds</strong>).</p><p>Datum a čas od: časové razítko, dle kterého jsou filtrovány události (začátek období, viz <strong>timeFrom</strong>).</p><p>Datum a čas do: časové razítko, dle kterého jsou filtrovány události (konec období, viz <strong>timeTo</strong>).</p></td><td>Specifikováno v rámci základního toku událostí.</td></tr><tr><td colspan="1">Příklad volání</td><td colspan="1"><p>/FleetwareWebAPI/events?<strong>objectIds=395,731</strong>&<strong>timeFrom=2017-09-14T22:00:00.000Z</strong>&<strong>timeTo=2017-09-23T21:59:59.999Z</strong></p><p> </p></td><td colspan="1">Vstupní parametry jsou zvýrazněny tučným řezem písma.</td></tr></tbody></table><p>Každý vrácený záznam se pak pokusíme zpracovat, cílem je získání odpovídajících informací o dané <a href="../../../datove-modely/datovy-78681044.html">FLW události</a>. K tomu slouží dále uvedené mapování…</p><p>Poznámka: Zmíněny jsou pouze takové položky dané odpovědi API, které nás z pohledu synchronizace zajímají.</p><table><tbody><tr><th>Atribut řešené entity</div></th><th>Položka odpovědi API</div></th><th>Poznámka</div></th></tr><tr><td colspan="1">Identifikátor</td><td colspan="1">–</td><td colspan="1">Systémový atribut (nastavován v rámci kroku <strong>2.c.i.1</strong> základního toku událostí).</td></tr><tr><td colspan="1">Externí identifikátor</td><td colspan="1">id</td><td colspan="1">Formát externího identifikátoru je následující: <strong><id></strong> (např. 439617).</td></tr><tr><td colspan="1">Externí identifikátor pozičního záznamu</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Externí identifikátor objektu</td><td colspan="1">objectId</td><td colspan="1">Odpovídá atributu <strong>Externí identifikátor FLW</strong> konkrétního <a href="../../../datove-modely/datovy-78681044.html">Objektu</a>.</td></tr><tr><td colspan="1">Datum a čas</td><td colspan="1">dateTime</td><td colspan="1">–</td></tr><tr><td colspan="1">Zeměpisná šířka</td><td colspan="1">latitude</td><td colspan="1">–</td></tr><tr><td colspan="1">Zeměpisná délka</td><td colspan="1">longitude</td><td colspan="1">–</td></tr><tr><td colspan="1">Typ události</td><td colspan="1">eventType</td><td colspan="1">Význam dílčích typů událostí je uveden samostatně, viz <a href="#" data-page-title="Events.Eventtype">Events.Eventtype</a>.</td></tr><tr><td colspan="1">Popis</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Lokace</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Ulice lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Město lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">PSČ lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Stát lokality</td><td colspan="1"> </td><td colspan="1"> </td></tr><tr><td colspan="1">Adresa</td><td colspan="1">–</td><td colspan="1">Probíhá geokódování získaných souřadnic.</td></tr><tr><td colspan="1">Datum vytvoření</td><td colspan="1">–</td><td colspan="1">Systémový atribut (nastavován v rámci kroku <strong>2.c.i.1</strong> základního toku událostí).</td></tr></tbody></table><h2>ALG02: Získat sledovaný vstup</h2><p>TODO: GET FleetwareWebAPI/objects/<objectid>/labels → [ { "key": "PTOInput", "value": "7" } ]</p><h1>Validace</h1><p>Získané informace musí svým datovým typem a rozsahem odpovídat atributům řešené entity. Údaje pro povinné atributy musí být k dispozici.</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h3>18. 3. 2025: Tomáš Nadrchal </h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="604uc08-116785595.html">Základní tok událostí</a></td><td colspan="1">Doplněno vyhodnocení relevantních událostí (naznačeno modře).</td></tr></tbody></table><h3>1. 12. 2023: Tomáš Nadrchal </h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="604uc08-116785595.html">Vstupní data</a></td><td colspan="1">Revize vstupních dat – možnost spuštění pro konkrétní denní výkon (naznačeno modře).</td></tr><tr><td colspan="1"><a href="604uc08-116785595.html">Základní tok událostí</a></td><td colspan="1">Doplněno vyhodnocení množiny denních výkonů, pro které mají být získány události (naznačeno modře).</td></tr></tbody></table>
</div>
</body>
</html>
