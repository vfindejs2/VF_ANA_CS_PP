<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>602UC14: Přijmout informace o realizaci lokace objednané služby</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je přijetí zprávy z rozhraní aplikace FOB, která poskytuje informace o realizaci konkrétní lokace objednané služby.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">FOB</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>FOB zadá požadavek na předání informací o realizaci lokace objednané služby, a to jedním z uvedených způsobů:</p><ul><li>FOB odešle zprávu obsahující informace o realizaci lokace objednané služby (viz <a href="#" data-page-title="602UC02: Přijmout zprávu z FOB"></a>).</li></ul><h2>Vstupní podmínky</h2><p>–</p><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Identifikátor objektu</td><td colspan="1">Číslo</td><td colspan="1">Ano</td><td colspan="1">Identifikace objektu (entita FLWW2), z kterého byla přijata zpráva.</td><td colspan="1">–</td></tr><tr><td>Obsah zprávy</td><td>Řetězec</td><td>Ano</td><td>Obsah, který byl v rámci zprávy přijat.</td><td><p>Musí být předáno ve formátu dle standardu XML.</p></td></tr><tr><td>Identifikátor zprávy</td><td>Řetězec</td><td>Ne</td><td>Identifikátor přijaté zprávy.</td><td>–</td></tr><tr><td>Verze komunikačního protokolu</td><td>Řetězec</td><td>Ano</td><td>Verze, od které se odvíjí struktura obsahu zprávy.</td><td>Jedná se o verzi použité XML obálky pro obsah zprávy (její struktury).</td></tr></tbody></table><h1>Základní tok událostí</h1><ol><li>Systém odešle potvrzení o přijetí zprávy – spustí <a href="#" data-page-title="602UC03: Odeslat potvrzení o přijetí zprávy na FOB"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Identifikátor objektu</strong>: hodnota vstupního parametru <strong>Identifikátor objektu</strong>.</li><li><strong>Identifikátor odpovědní zprávy</strong>: hodnota vstupního parametru <strong>Identifikátor zprávy</strong>.</li><li><strong>Verze komunikačního protokolu</strong>: hodnota vstupního parametru <strong>Verze komunikačního protokolu</strong>.</li></ul></li><li>Systém vyhodnotí na vstupu získaný obsah zprávy (vstupní parametr <strong>Obsah zprávy</strong>; viz <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>).</li><li>Systém založí odpovídající záznam o realizaci – spustí <a href="#" data-page-title="502UC03: Založit FOB informace o realizaci lokace objednané služby"></a>, na vstup jsou předány následující informace:<br><ul><li><strong>Zakládaná FOB informace o realizaci lokace objednané služby</strong>: předány dále uvedené hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a>:<br><ul><li><strong>Identifikátor zprávy</strong>: hodnota vstupního parametru <strong>Identifikátor zprávy</strong>.<br></li><li><strong>Externí identifikátor objektu</strong>: hodnota vstupního parametru <strong>Identifikátor objektu</strong>. </li><li><strong>Identifikátor lokace objednané služby</strong>: hodnota výstupního parametru <strong>Identifikátor lokace objednané služby</strong> získaného v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li><strong>Způsob odbavení</strong>: hodnota výstupního parametru <strong>Způsob odbavení</strong> získaného v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li><strong>Datum a čas odbavení</strong>: hodnota výstupního parametru <strong>Datum a čas odbavení</strong> získaného v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li><strong>Zeměpisná šířka</strong>: hodnota výstupního parametru <strong>Zeměpisná šířka</strong> získaného v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li><strong>Zeměpisná délka</strong>: hodnota výstupního parametru <strong>Zeměpisná délka</strong> získaného v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.<br></li><li><strong>Adresa odbavení</strong>: hodnota získána v rámci <a href="#" data-page-title="706UC01: Získat adresu dle souřadnic"></a> (výstupní parametr <strong>Adresy</strong>), na vstup jsou předány následující informace:<br><ul><li><strong>Zeměpisná šířka</strong>: hodnota výstupního parametru <strong>Zeměpisná šířka</strong> získaného v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.<br></li><li><strong>Zeměpisná délka</strong>: hodnota výstupního parametru <strong>Zeměpisná délka</strong> získaného v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li><strong>Počet záznamů</strong>: předána hodnota <strong>1</strong>.</li></ul></li></ul></li></ul></li></ol><p>Poznámka: Potvrzení o přijetí zprávy je odesláno bez ohledu na to, zda je tato zpráva úspěšně zpracována. Opakované odeslání zprávy z FOB totiž ve většině případů nepomůže k úspěšnému dokončení UC (chyba obvykle není ve zprávě jako takové). Dochází pak pouze k založení odpovídajícího záznamu v databázi. Samotné vyhodnocení realizace dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a> je řešeno samostatně. Samotná komunikace je pak logována.</p><h1>Alternativní toky událostí</h1><h2>AF01: Zpráva je již obsažena</h2><p>Cílem alternativního toku je vyhodnocení duplicitně získaných zpráv – ty nově nebudou ukládány na straně DB.</p><ul><li>FOB opakovaně odesílá konkrétní zprávu s informacemi o realizaci do doby, než získá potvrzení o jejím přijetí (ACK).</li><li>Pokud se tedy ACK zpráva zpozdí, dochází k opakovanému odeslání odpovídající zprávy z FOB do aplikace RoadPlan.</li></ul><p>Pokud tedy systém zjistí, že již daná zpráva na straně RoadPlan existuje, tu nově získanou zahodí. Uvedená skutečnost bude logována.</p><p>Poznámka: Odpovídající ACK zpráva je odeslána i v případě zahození duplicitní zprávy. Tento AF tedy neovlivňuje odeslání ACK zprávy.</p><h3>Vstupní podmínky</h3><p>Již existuje záznam entity <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a>, který splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> odpovídá hodnotě vstupního parametru <strong>Identifikátor zprávy</strong>.</li><li>Hodnota atributu <strong>Identifikátor lokace objednané služby</strong> odpovídá hodnotě výstupního parametru <strong>Identifikátor lokace objednané služby</strong> získané v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Hodnota atributu <strong>Způsob odbavení</strong> odpovídá hodnotě výstupního parametru <strong>Způsob odbavení</strong> získané v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Hodnota atributu <strong>Datum a čas odbavení</strong> odpovídá hodnotě výstupního parametru <strong>Datum a čas odbavení</strong> získané v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Hodnota atributu <strong>Zeměpisná šířka</strong> odpovídá hodnotě výstupního parametru <strong>Zeměpisná šířka</strong> získané v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li><li>Hodnota atributu <strong>Zeměpisná délka</strong> odpovídá hodnotě výstupního parametru <strong>Zeměpisná délka</strong> získané v rámci <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>.</li></ul><h3>Tok událostí</h3><ol><li>Alternativní tok událostí začíná krokem <strong>3</strong> základního toku událostí.</li><li>Systém provede logování uvedené skutečnosti – došlo k „zahození“ FOB zprávy z důvodu její existence.</li><li>Systém neprovede založení nového záznamu entity <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a>.<br><ul><li><em>Je tedy přeskočen krok <strong>3</strong> základního toku událostí.</em></li></ul></li></ol><h3>Výstupní podmínky</h3><p>Duplicitní záznam entity <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a> nebyl uložen na straně RoadPlan.</p><h1>Výjimkové toky událostí</h1><h2>EF01: Čtení obsahu zprávy skončilo chybou</h2><h3>Vstupní podmínky</h3><ul><li>Při čtení obsahu zprávy došlo k chybě.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení (MSG_ERR_FOB_PACKET_CONTENT_READ_NOT_SUCCESSFUL, viz <a href="../../../systemove-78681299.html">Systémové hlášky</a>).</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Systém nepřijal zprávu.</li></ul><h2>EF02: Verze obsahu zprávy není podporována</h2><h3>Vstupní podmínky</h3><ul><li>Na vstupu získaná verze obsahu zprávy (vstupní parametr <strong>Verze komunikačního protokolu</strong>) není podporována.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení s uvedenými parametry (viz <a href="../../../systemove-78681299.html">Systémové hlášky</a>):<br><ul><li><strong>Chybové hlášení</strong>: MSG_ERR_FOB_PACKET_VERSION_NOT_SUPPORTED.</li><li><strong>Verze</strong>: hodnota vstupního parametru <strong>Verze komunikačního protokolu</strong>.</li></ul></li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Systém nepřijal zprávu.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Systém přijal zprávu s informacemi o realizaci lokace objednané služby, na kterou odpověděl.</p><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Vyhodnotit obsah zprávy</h2><p>Vzhledem k tomu, že v rámci algoritmu dochází ke čtení získané zprávy, jsou na jeho výstupu předány získané informace. Jejich výčet je uveden v tabulce.</p><table><tbody><tr><th>Výstupní parametr</div></div></th><th>Datový typ</div></div></th><th colspan="1">Povinnost</div></div></th><th>Popis</div></div></th><th colspan="1">Podporované verze</div></th><th colspan="1">Poznámka</div></div></th></tr><tr><td colspan="1">Identifikátor lokace objednané služby</td><td colspan="1">Celé číslo</td><td colspan="1">Ano</td><td colspan="1">Identifikátor <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>, u které bylo provedeno odbavení.</td><td colspan="1">Od <a href="602uc14-116785394.html">Verze 1.0</a>.</td><td colspan="1">–</td></tr><tr><td colspan="1">Způsob odbavení</td><td colspan="1"><a href="../../../datove-modely/datovy-78681044.html">Způsob odbavení lokace objednané služby</a></td><td colspan="1">Ano</td><td colspan="1">Způsob, jakým byla odbavena (resp. neodbavena) daná <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Od <a href="602uc14-116785394.html">Verze 1.0</a>.</td><td colspan="1">–</td></tr><tr><td colspan="1">Datum a čas odbavení</td><td colspan="1">Datum a čas</td><td colspan="1">Ano</td><td colspan="1">Datum a čas, ve kterém proběhlo odbavení dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Od <a href="602uc14-116785394.html">Verze 1.0</a>.</td><td colspan="1">–</td></tr><tr><td colspan="1">Zeměpisná šířka</td><td colspan="1">Desetinné číslo</td><td colspan="1">Ano</td><td colspan="1">Souřadnice, na kterých proběhlo odbavení dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Od <a href="602uc14-116785394.html">Verze 1.0</a>.</td><td colspan="1">–</td></tr><tr><td colspan="1">Zeměpisná délka</td><td colspan="1">Desetinné číslo</td><td colspan="1">Ano</td><td colspan="1">Souřadnice, na kterých proběhlo odbavení dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Od <a href="602uc14-116785394.html">Verze 1.0</a>.</td><td colspan="1">–</td></tr></tbody></table><p>Pro zajištění zpětné kompatibility je při generování obsahu zprávy vyhodnocována jeho požadovaná verze (vstupní parametr Verze komunikačního protokolu).</p><table><tbody><tr><th>Verze komunikačního protokolu</div></th><th>Verze obsahu zprávy (algoritmus)</div></th></tr><tr><td>1.0</td><td><a href="602uc14-116785394.html">Verze 1.0</a></td></tr></tbody></table><p>Poznámka: Pokud není požadovaná verze podporována, je vyvolán odpovídající výjimkový tok (viz <a href="602uc14-116785394.html">EF02: Verze obsahu zprávy není podporována</a>).</p><h3>Verze 1.0</h3><p>Cílem algoritmu je vyhodnocení obsahu zprávy získané na vstupu UC. Jeho ukázka je pro úplnost naznačena dále (zobrazené hodnoty jsou pouze ilustrativní).</p>truehtml/xml1<p>Popis jednotlivých elementů je uveden v tabulce.</p><table><tbody><tr><th>Element/atribut</div></div></th><th colspan="1">Datový typ</div></div></th><th colspan="1">Povinnost</div></div></th><th>Popis</div></div></th><th colspan="1">Výstupní parametr</th><th colspan="1"> Hodnota</th><th>Poznámka</div></div></th></tr><tr><td colspan="1">locationId</td><td colspan="1">Celé číslo</td><td colspan="1">Ano</td><td colspan="1">Identifikátor takové <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>, pro kterou jsou v rámci zprávy předány informace o realizaci.</td><td colspan="1">Identifikátor lokace objednané služby</td><td colspan="1">Je převzata obsažená hodnota (není třeba provádět žádné další akce).</td><td colspan="1">Odpovídá identifikátoru <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a> v databázi.</td></tr><tr><td colspan="1">operation</td><td colspan="1">Celé číslo</td><td colspan="1">Ano</td><td colspan="1">Způsob, jakým byla potvrzena (resp. nepotvrzena) realizace dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Způsob odbavení</td><td colspan="1">Hodnota je získána v rámci  <a href="602uc14-116785394.html">ALG02: Získat způsob odbavení lokace objednané služby</a> .</td><td colspan="1">Může být nastaven také výchozí stav (vrácení provedené akce).</td></tr><tr><td colspan="1">time</td><td colspan="1">Datum a čas</td><td colspan="1">Ano</td><td colspan="1">Datum a čas, ve kterém proběhlo potvrzení realizace dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Datum a čas odbavení</td><td colspan="1">Je převzata obsažená hodnota (není třeba provádět žádné další akce).</td><td colspan="1">–</td></tr><tr><td colspan="1">lat</td><td colspan="1">Desetinné číslo</td><td colspan="1">Ano</td><td colspan="1">Souřadnice (zeměpisná šířka), na kterých proběhlo potvrzení realizace dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Zeměpisná šířka</td><td colspan="1">Je převzata obsažená hodnota (není třeba provádět žádné další akce).</td><td colspan="1">–</td></tr><tr><td colspan="1">lon</td><td colspan="1">Desetinné číslo</td><td colspan="1">Ano</td><td colspan="1">Souřadnice (zeměpisná délka), na kterých proběhlo potvrzení realizace dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td colspan="1">Zeměpisná délka</td><td colspan="1">Je převzata obsažená hodnota (není třeba provádět žádné další akce).</td><td colspan="1">–</td></tr></tbody></table><p>Pro úplnost je doplněn i náhled paketu, který je odesílán z FOB (zobrazené hodnoty jsou pouze ilustrativní).</p>html/xml1<h2>ALG02: Získat způsob odbavení lokace objednané služby</h2><p>Cílem algoritmu je získání informace o způsobu odbavení dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>. Hledáme pak takový <a href="../../../datove-modely/datovy-78681044.html">Způsob odbavení lokace objednané služby</a>, který odpovídá hodnotě získané v rámci atributu <strong>operation</strong> přijaté zprávy (viz <a href="602uc14-116785394.html">ALG01: Vyhodnotit obsah zprávy</a>). Požadované chování je pak popsáno v tabulce.</p><table><tbody><tr><th>Způsob odbavení</div></th><th colspan="1">Hodnota (json)</div></th><th>Popis</div></th><th>Způsob odbavení lokace objednané služby</div></th><th colspan="1">Poznámka</div></th></tr><tr><td>Neodbavena</td><td colspan="1">1</td><td>Nad danou <a href="../../../datove-modely/datovy-78681044.html">Lokací objednané služby</a> nebyla provedena žádná akce (výchozí stav).</td><td><p>Neodbavena</p></td><td colspan="1">Do výchozího stavu je možné se vrátit (např. odvoláním potvrzení realizace).</td></tr><tr><td>Potvrzena realizace</td><td colspan="1">2</td><td>Byla potvrzena realizace dané <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>.</td><td><p>Potvrzena realizace</p></td><td colspan="1">–</td></tr><tr><td>Přeskočena realizace</td><td colspan="1">3</td><td>Daná <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a> byla přeskočena (nedošlo k jejímu potvrzení).</td><td>Přeskočena realizace</td><td colspan="1">–</td></tr></tbody></table><h1>Validace</h1><p>–</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h3>4. 2. 2025: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></th><th>Stručný popis změny/doplnění</div></th></tr><tr><td colspan="1"><a href="602uc14-116785394.html">AF01: Zpráva je již obsažena</a></td><td colspan="1">Doplněno vyhodnocení duplicitních FOB zpráv (naznačeno modře).</td></tr></tbody></table>
</div>
</body>
</html>
