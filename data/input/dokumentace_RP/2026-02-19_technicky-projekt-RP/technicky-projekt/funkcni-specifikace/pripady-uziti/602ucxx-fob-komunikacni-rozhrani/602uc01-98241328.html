<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>602UC01: Odeslat zprávu na FOB</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je odeslání zprávy na rozhraní aplikace FOB. Jedná se pak o popis té části komunikace mezi RoadPlan a FOB, která je společná pro všechny odesílané zprávy v tomto směru (je volána z dalších UC).</p><p>Poznámka: Technický popis architektury komunikace je uveden samostatně, viz <a href="#" data-page-title="FOB - architektura komunikace">FOB - architektura komunikace</a>.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Uživatel</td><td colspan="1">–</td></tr><tr><td colspan="1">FOB</td><td colspan="1">Příjemce zprávy.</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="#" data-page-title="Aktéři"></a>.</p><h1>Spuštění případů užití</h1><p>Uživatel zadá požadavek na odeslání zprávy na FOB, a to jedním z uvedených způsobů:</p><ul><li>Uživatel provede akci nad denním výkonem, která způsobí odeslání notifikace o této akci nad odpovídající trasou (viz <a href="#" data-page-title="602UC11: Odeslat notifikaci o akci nad trasou na FOB">602UC11: Odeslat notifikaci o akci nad trasou na FOB</a>).</li></ul><p>FOB zadá požadavek na odeslání zprávy na FOB, a to jedním z uvedených způsobů:</p><ul><li>FOB odešle zprávu, u které dochází k jejímu potvrzení (viz <a href="#" data-page-title="602UC03: Odeslat potvrzení o přijetí zprávy na FOB"></a>).</li><li>FOB odešla zprávu, kdy dochází k předání informace o chybě (viz <a href="#" data-page-title="602UC05: Odeslat informaci o chybě na FOB"></a>).</li><li>FOB odešle zprávu, kdy dochází k odeslání dostupných tras (viz <a href="#" data-page-title="602UC08: Odeslat dostupné trasy na FOB">602UC08: Odeslat dostupné trasy na FOB</a>).</li><li>FOB odešle zprávu, kdy dochází k odeslání konkrétní části trasy (viz <a href="#" data-page-title="602UC10: Odeslat konkrétní části trasy na FOB"></a>).</li><li>FOB odešla zprávu, kdy dochází k předání informace o změně na trase (viz <a href="#" data-page-title="602UC11: Odeslat notifikaci o akci nad trasou na FOB">602UC11: Odeslat notifikaci o akci nad trasou na FOB</a>).</li><li>FOB odešle zprávu, kdy dochází k odeslání konkrétní části souhrnného itineráře trasy (viz <a href="#" data-page-title="602UC13: Odeslat konkrétní části souhrnného itineráře trasy na FOB">602UC13: Odeslat konkrétní části souhrnného itineráře trasy na FOB</a>).</li></ul><h2>Vstupní podmínky</h2><p>–</p><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Identifikátor objektu</td><td colspan="1">Číslo</td><td colspan="1">Ano</td><td colspan="1">Identifikace objektu (entita FLWW2), na který má být odeslána zpráva.</td><td colspan="1">–</td></tr><tr><td colspan="1">Typ obsahu zprávy</td><td colspan="1"><a href="../../../datove-modely/datovy-78681044.html">Typ FOB zprávy</a></td><td colspan="1">Ano</td><td colspan="1">Typ obsahu zprávy specifikující její význam, obsah a strukturu.</td><td colspan="1">–</td></tr><tr><td colspan="1">Obsah zprávy</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1">Obsah, který má být v rámci zprávy odeslán.</td><td colspan="1"><p>Musí být předáno ve formátu dle standardu XML.</p></td></tr><tr><td colspan="1">Identifikátor odpovědní zprávy</td><td colspan="1">Řetězec</td><td colspan="1">Ne</td><td colspan="1">Identifikátor zprávy, na kterou se v rámci tohoto UC odpovídá („request“ zpráva).</td><td colspan="1">–</td></tr><tr><td colspan="1">Je vyžadováno potvrzení zprávy</td><td colspan="1">Boolean</td><td colspan="1">Ano</td><td colspan="1">Informace, zda je vyžadováno potvrzení o přijetí zprávy adresátem.</td><td colspan="1">–</td></tr><tr><td colspan="1">Verze komunikačního protokolu</td><td colspan="1">Řetězec</td><td colspan="1">Ano</td><td colspan="1">Verze, od které se odvíjí struktura obsahu zprávy.</td><td colspan="1">Jedná se o verzi použité XML obálky pro obsah zprávy (její struktury).</td></tr></tbody></table><h1>Základní tok událostí</h1><ol><li>Systém připraví zprávu o zadané struktuře (viz <a href="602uc01-98241328.html">ALG01: Generovat zprávu</a>).</li><li>Systém odešle zprávu na FOB.</li><li>Pokud je požadována informace o přijetí zprávy (hodnota vstupního parametru Je požadováno potvrzení zprávy je rovna TRUE):<br><ol><li>Systém čeká na potvrzení, že byla zpráva v rámci FOB přijata.  </li><li><em>FOB přijme zprávu a odešle informaci o přijetí zprávy (je v kompetenci FOB).</em></li><li>Systém přijme informaci o potvrzení zprávy ve FOB (viz <a href="#" data-page-title="602UC04: Přijmout potvrzení o přijetí zprávy z FOB"></a>). Vyhodnocení vazby mezi uvedenou dvojicí zpráv je prováděno na základě shody uvedených hodnot:<br><ul><li>Odeslaná zpráva: hodnota atributu <code>packetId</code> (viz <a href="602uc01-98241328.html">ALG01: Generovat zprávu</a>).</li><li>Přijaté potvrzení o přijetí zprávy: hodnota výstupního parametru Identifikátor odpovědní zprávy (viz <a href="#" data-page-title="602UC04: Přijmout potvrzení o přijetí zprávy z FOB"></a>).</li></ul></li><li>Systém nastaví hodnotu výstupního parametru Potvrzeno přijetí zprávy na TRUE.</li></ol></li></ol><p>Poznámka: Při „pádu“ komunikačního rozhraní zůstanou zprávy připraveny ve frontě tohoto rozhraní. Po obnovení spojení pokračuje odesílání zpráv z této fronty. FOB by tedy měl být schopen vyhodnotit, zda jsou pro něj zmíněné zprávy relevantní (čas odeslání není v rámci zprávy aktuálně obsažen).</p><h1>Alternativní toky událostí</h1><h2>AF01: Nebylo doručeno potvrzení o přijetí zprávy</h2><h3>Vstupní podmínky</h3><ul><li>V zadaném intervalu po odeslání zprávy nebylo získáno potvrzení o přijetí zprávy (fobAckDelay, viz <a href="#" data-page-title="Konfigurační hodnoty"></a>). </li></ul><h3>Tok událostí</h3><ol><li>Alternativní tok událostí začíná krokem 3.a základního toku událostí.</li><li>Systém nastaví hodnotu výstupního parametru Potvrzeno přijetí zprávy na FALSE. <strong>Konec toku událostí.</strong></li></ol><p>Poznámka: Aktuálně není potvrzení o přijetí zprávy vyhodnocováno. V případě, že není získáno, nejsou prováděny žádné další akce a UC je korektně ukončen.</p><h3>Výstupní podmínky</h3><p>–</p><h1>Výjimkové toky událostí</h1><h2>EF01: Generování zprávy skončilo chybou</h2><h3>Vstupní podmínky</h3><ul><li>Při generování zprávy došlo k chybě.</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení (MSG_ERR_FOB_PACKET_GENERATE_NOT_SUCCESSFUL, viz <a href="../../../systemove-78681299.html">Systémové hlášky</a>).</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k odeslání zprávy.</li></ul><h2>EF02: Maximální velikost zprávy byla překročena</h2><h3>Vstupní podmínky</h3><ul><li>Velikost vygenerované zprávy přesahuje maximální povolenou hodnotu (fobMaxPacketSize, viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul><h3>Tok událostí</h3><ol><li>Výjimkový tok událostí začíná krokem 2 základního toku událostí.</li><li>Systém předá na výstupu UC chybové hlášení (MSG_ERR_FOB_PACKET_SIZE_EXCEEDED, viz <a href="../../../systemove-78681299.html">Systémové hlášky</a>).</li><li>Případ užití končí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Nedošlo k odeslání zprávy.</li></ul><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Systém odeslal zprávu na FOB. Pokud je vyžadováno potvrzení o přijetí zprávy, systém ho v zadaném intervalu získal. </p><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Potvrzeno přijetí zprávy</td><td colspan="1">Boolean</td><td colspan="1">Ne</td><td colspan="1">Informace, zda došlo k potvrzení přijetí zprávy adresátem.</td><td colspan="1">–</td></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Generovat zprávu</h2><p>Cílem algoritmu je vytvoření zprávy o zadané struktuře dle specifikace získané na vstupu UC. Tato zpráva pak může být bez dalších úprav odeslána na FOB (technický popis komunikace je uveden samostatně, viz <a href="#" data-page-title="FOB - architektura komunikace">FOB - architektura komunikace</a>).</p><p>Zpráva jako taková je kódována pomocí <a href="#" data-page-title="Protocol Buffers">Protocol Buffers</a>, datový kontrakt je popsán následně (detailní technický popis je uveden samostatně, viz <a href="#" data-page-title="flw-commservice-hub">flw-commservice-hub</a>).</p>truecsharp1<p>Výsledkem tedy je konkrétní zpráva o zadané struktuře (zobrazené hodnoty jsou pouze ilustrativní).</p>truecsharp1<p>Hodnoty, které jsou v rámci zprávy předány, jsou pak specifikovány v tabulce.</p><table><tbody><tr><th>Atribut</th><th>Hodnota</th><th>Poznámka</th></tr><tr><td>senderGroup</td><td>fobSenderGroup (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>)</td><td>–</td></tr><tr><td>objectId</td><td>Hodnota vstupního parametru Identifikátor objektu.</td><td>–</td></tr><tr><td colspan="1">sentTime</td><td colspan="1">Datum a čas odeslání zprávy.</td><td colspan="1">–</td></tr><tr><td>packetId</td><td>Generováno při odeslání zprávy.</td><td>Generováno jako GUID (Globally Unique Identifier).</td></tr><tr><td>fobPacketType</td><td>Hodnota vstupního parametru Typ obsahu zprávy.</td><td>–</td></tr><tr><td>fobPacketContent</td><td>Hodnota vstupního parametru Obsah zprávy.</td><td>–</td></tr><tr><td>requestId</td><td>Hodnota vstupního parametru Identifikátor odpovědní zprávy.</td><td>Generováno jako GUID (Globally Unique Identifier).</td></tr><tr><td>requireAcknowledge</td><td>Hodnota vstupního parametru Je vyžadováno potvrzení zprávy.</td><td>–</td></tr><tr><td>formatVersion</td><td>Hodnota vstupního parametru Verze komunikačního protokolu.</td><td>–</td></tr><tr><td>CompanyAlias</td><td>fobCompanyAlias (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>)</td><td>Aplikace RoadPlan nepodporuje multitenantní režim, proto je použita konfigurační hodnota (dočasné řešení).</td></tr></tbody></table><p>Po odeslání zprávy na FOB (přesněji na <a href="#" data-page-title="flw-commservice-hub">flw-commservice-hub</a>) dochází k vygenerování paketu. Ukázka jeho „hlavičky“ je pro úplnost naznačena dále (zobrazené hodnoty jsou pouze ilustrativní).</p>truehtml/xml1<p>V závěru je uveden přehled jednotlivých zpráv spolu s náhledem výsledného paketu, které systém na FOB odesílá (zobrazené hodnoty jsou pouze ilustrativní).</p><table><tbody><tr><th>Případ užití</th><th>Náhled</th></tr><tr><td><a href="#" data-page-title="602UC03: Odeslat potvrzení o přijetí zprávy na FOB"></a></td><td>html/xml1</td></tr><tr><td colspan="1"><a href="#" data-page-title="602UC05: Odeslat informaci o chybě na FOB"></a></td><td colspan="1">html/xml1</td></tr><tr><td colspan="1"><a href="#" data-page-title="602UC08: Odeslat dostupné trasy na FOB">602UC08: Odeslat dostupné trasy na FOB</a></td><td colspan="1">html/xml1</td></tr><tr><td colspan="1"><a href="#" data-page-title="602UC10: Odeslat konkrétní části trasy na FOB"></a></td><td colspan="1">html/xml1</td></tr><tr><td><a href="#" data-page-title="602UC11: Odeslat notifikaci o akci nad trasou na FOB">602UC11: Odeslat notifikaci o akci nad trasou na FOB</a></td><td>html/xml1</td></tr><tr><td colspan="1"><a href="#" data-page-title="602UC13: Odeslat konkrétní části souhrnného itineráře trasy na FOB">602UC13: Odeslat konkrétní části souhrnného itineráře trasy na FOB</a></td><td colspan="1">html/xml1</td></tr></tbody></table><h1>Validace</h1><p>–</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h3>21. 9. 2023: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></th></tr><tr><td colspan="1"><a href="602uc01-98241328.html">Spuštění případu užití</a></td><td colspan="1">Doplněna podpora pro nový typ zprávy (naznačeno modře).</td></tr><tr><td colspan="1"><a href="602uc01-98241328.html">ALG01: Generovat zprávu</a></td><td colspan="1">Doplněn příklad pro nový typ zprávy (naznačeno modře).</td></tr></tbody></table>
</div>
</body>
</html>
