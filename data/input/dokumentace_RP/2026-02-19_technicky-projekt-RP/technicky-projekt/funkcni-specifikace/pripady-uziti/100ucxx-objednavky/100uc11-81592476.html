<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>100UC11: xAktualizovat objednávku</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl UC</h1><p>Změna Objednávky ve stavech K realizaci nebo Plněná není řešena běžnou editací, ale tzv. <a href="100uc11-xaktualizovat-objednavku/aktualizace-82117229.html">aktualizací Objednávky</a>. Aktualizace Objednávky obnáší: </p><ul><li>Zadání data, ke kterému přestává platit původní verze Objednávky a začíná platit nová verze Objednávky.</li><li>Modifikaci požadovaných atributů Objednávky.</li><li>Uložení nové verze Objednávky.</li><li>Smazání nebo zkrácení termínu realizace dotčených Objednaných služeb pro původní verzi Objednávky.</li><li>Vygenerování sady Objednaných služeb pro novou verzi Objednávky.</li></ul><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th>Popis</th><th colspan="1">Typická role</th></tr><tr><td>Uživatel</td><td><p>Jedná se o uživatele aplikace RoadPlan, který musí mít oprávnění spouštět tento UC.</p></td><td colspan="1"><p>Příjem objednávek</p></td></tr></tbody></table><h1>Spuštění případu užití</h1><p>Uživatel zadá požadavek k aktualizaci Objednávky:</p><ul><li>z editačního formuláře při úpravě Objednávky: <a href="#" data-page-title="100UC03: Upravit objednávku">100UC03: Upravit objednávku</a>,</li><li>z přehledu verzí v detailu Objednávky: 100UC13: Zobrazit přehled verzí v detailu objednávky</li></ul><h1>Vstupní podmínky</h1><ul><li>Uživatel je přihlášený a má oprávněný ke spuštění tohoto UC (viz <a href="../../../uzivatelska-78681297.html">Práva a role</a>).</li><li>Na vstupu je předána identifikace vybrané Objednávky, přičemž:<br><ul><li>Objednávka je v jednom z těchto <a href="../../../high-level-concept/stavove-78680652.html">stavů</a>: {K realizaci, Plněná}.</li><li>Jedná se o poslední verzi Objednávky, tj. neexistuje novější verze dané Objednávky. </li></ul></li></ul><h1>Základní tok událostí</h1><ol><li>Systém zobrazí editační formulář Objednávky, provede jeho inicializaci dle <a href="../../uzivatelske-rozhrani/100uixx/100ui01-79429663.html">100UI01: Formulář objednávky</a>. Formulář bude předvyplněný údaji z poslední verze Objednávky.</li><li>Uživatel provede požadované změny. Může měnit všechny atributy Objednávky tak, jako by byla ve stavu Rozpracovaná, s těmito výjimkami:<br><ul><li>Nelze měnit pole Provozovna, ovládaní prvek není zpřístupněn. </li><li>Nelze měnit pole Objednatel, ovládaní prvek není zpřístupněn.</li><li>Nelze měnit pole Stav, ovládaní prvek není zpřístupněn.</li></ul></li><li>Uživatel stiskne tlačítko Uložit (<a href="100uc11-81592476.html">EF01: Uživatel stiskne Storno na objednávkovém formuláři</a>).</li><li>Systém provede validaci vstupních údajů. Viz <a href="100uc11-81592476.html">Validace objednávkového formuláře</a>.</li><li>Systém zobrazí formulář pro nastavení platnosti změny (TODO odkaz na UI). Předvyplněno je zítřejší datum.</li><li>Uživatel nastaví datum platnosti a stiskne tlačítko Uložit (<a href="100uc11-81592476.html">EF02: Uživatel stiskne Storno na formuláři pro zadání platnosti</a>).</li><li><p>Systém ověří, zda k zadanému datu lze Objednávku aktualizovat (<a href="100uc11-81592476.html">ALG01: Kontrola, zda lze aktualizovat Objednávku k zadanému datu</a>, <a href="100uc11-81592476.html">EF03: Stav Objednaných služeb neumožňuje aktualizaci Objednávky</a>).</p></li><li>Systém uloží aktualizaci Objednávky, přičemž:<br><ol><li>Smaže příslušné Objednané služby, které vznikly z původní verze Objednávky (<a href="100uc11-81592476.html">ALG02: Smazání Objednaných služeb</a>).</li><li>Zkrátí termín možné realizace příslušných Objednaných služeb (<a href="100uc11-81592476.html">ALG03: Zkrácení termínu možné realizace Objednaných služeb</a>)</li><li>Nastaví parametry původní a nové verze Objednávky(<a href="100uc11-81592476.html">ALG04: Nastavení parametrů původní a nové verze Objednávky</a>).</li></ol></li><li>Systém vrátí uživatele zpět na případ užití, ze kterého funkčnost vyvolal.</li><li>Systém označí řádek, který odpovídá právě aktualizované Objednávce.</li><li>Konec toku události.</li></ol><h1>Alternativní toky událostí</h1><p>Nejsou.</p><h1>Výjimkové toky událostí</h1><h3>EF01: Uživatel stiskne Storno na objednávkovém formuláři</h3><h4>Tok událostí</h4><ol><li>Systém uzavře objednávkový formulář.</li><li>Konec toku událostí. (Systém vrátí uživatele zpět na případ užití, ze kterého funkčnost vyvolal.)</li></ol><h3>EF02: Uživatel stiskne Storno na formuláři pro zadání platnosti</h3><h4>Tok událostí</h4><ol><li>Systém uzavře formulář pro zadání platnosti.</li><li>Pokračování krokem 2 základního toku. (Systém vrátí uživatele zpět na objednávkový formulář.)</li></ol><h3>EF03: Stav Objednaných služeb neumožňuje aktualizaci Objednávky</h3><h4>Tok událostí</h4><ol><li>Systém zobrazí uživateli informaci, že stav Objednaných služeb neumožňuje k zadanému datu aktualizovat Objednávku (kód hlášky MSG_ERR_UNABLE_UPDATE_ORDER_VERSION, viz <a href="../../../systemove-78681299.html">Systémové hlášky</a>).</li><li>Pokračování krokem 5 základního toku. (Systém vrátí uživatele na formulář zadání platnosti.)</li></ol><h1>Výstupní podmínky</h1><p>Vznikla nová verze Objednávky, která k zadanému datu nahrazuje původní verzi Objednávky.</p><h1>Validace</h1><h3>Validace objednávkového formuláře</h3><ul><li>Validace je prováděna průběžně, pokud uživatel vstoupí do pole s možností zadání hodnoty a opustí jej ve stavu, kdy hodnota není validní, je na to upozorněn. <br><ul><li>Ovládací prvek je graficky zvýrazněn a je doplněno chybové hlášení. Konkrétní validace jednotlivých polí je uvedena v <a href="../../uzivatelske-rozhrani/100uixx/100ui01-79429663.html">100UI01: Formulář objednávky</a>. Hlídána jsou jak konkrétní validační kritéria každé položky, tak i to, zda je položka povinná.</li></ul></li><li>Jakmile uživatel stiskne tlačítko Uložit, je provedena validace všech polí. <br><ul><li>Pokud není nějaký údaj v pořádku, je příslušné vstupní pole zvýrazněno a doplněno o chybové hlášení. Uživateli je navíc zobrazeno chybové hlášení, že objednávka nemůže být uložena.</li></ul></li></ul><h3>Validace formuláře pro zadání platnosti</h3><ul><li>Pole "Platnost od" musí být vyplněno. </li><li>Lze zadat datum s platností nejdříve od následujícího dne.</li></ul><h1>Algoritmy</h1><h3>ALG01: Kontrola, zda lze aktualizovat Objednávku k zadanému datu</h3><ol><li>Systém zkontroluje, zda pro všechny Objednané služby vzniklé z původní verze příslušné Objednávky platí:<br><ol><li>Pokud je Objednaná služba v některém ze stavů {Naplánována, Ke kontrole, Realizována}, pak její parametr "Datum realizace do" je menší než D (= datum, od kdy začíná platit nová verze Objednávky).</li></ol></li><li>Pokud tuto podmínku některá z Objednaných služeb nesplňuje, pak pokračovat na <a href="100uc11-81592476.html">EF03: Stav Objednaných služeb neumožňuje aktualizaci Objednávky</a>.</li></ol><p><em>Poznámka: Tato kontrola je nyní poměrně přísná; až bude jasnější proces zpracování služeb v rámci plánování tras, může být upravena.</em></p><h3>ALG02: Smazání Objednaných služeb</h3><ol><li>Systém smaže všechny Objednané služby vzniklé z původní verze příslušné Objednávky, pro které současně platí:<br><ol><li>Stav Objednané služby patří do množiny: {K naplánování, Zrušená}.</li><li>Parametr "Datum realizace od" Objednané služby je větší nebo roven D (= datum, od kdy začíná platit nová verze Objednávky).</li></ol></li></ol><p><em>Poznámka: V případě pozdějšího zrušení této aktualizace budou Objednané služby přegenerovány ve svém výchozím tvaru (tedy bez provedených úprav). Služby založené na výzvu obnoveny nebudou.</em></p><h3>ALG03: Zkrácení termínu možné realizace Objednaných služeb</h3><ol><li>Systém vyhledá všechny Objednané služby vzniklé z původní verze příslušné Objednávky, pro které současně platí:<br><ol><li>Stav Objednané služby patří do množiny: {K naplánování, Zrušená}.</li><li>Parametr "Datum realizace od" Objednané služby je menší než D (= datum, od kdy začíná platit nová verze Objednávky).</li><li>Parametr "Datum realizace do" Objednané služby je větší nebo roven D.</li></ol></li><li>Systém nastaví Parametr "Datum realizace do" takto nalezených Objednaných služeb na D - 1.</li></ol><h3>ALG04: Nastavení parametrů původní a nové verze Objednávky</h3><ol><li>Systém nastaví vyjmenované parametry pro původní a novou verzi Objednávky následovně:</li></ol><table><tbody><tr><th>Parametr</th><th>Původní verze Objednávky</th><th>Nová verze Objednávky</th></tr><tr><td>Vytvořeno</td><td>beze změny</td><td>aktuální datum a čas</td></tr><tr><td colspan="1">Vytvořil</td><td colspan="1">beze změny</td><td colspan="1">aktuální uživatel (spouští tento UC)</td></tr><tr><td colspan="1">Změněno</td><td colspan="1">aktuální datum a čas</td><td colspan="1"><p>aktuální datum a čas</p></td></tr><tr><td colspan="1">Změnil</td><td colspan="1">aktuální uživatel (spouští tento UC)</td><td colspan="1">aktuální uživatel (spouští tento UC)</td></tr><tr><td>Stav</td><td>beze změny</td><td><p>převzít hodnotu z původní verze</p></td></tr><tr><td colspan="1">Číslo objednávky</td><td colspan="1">beze změny</td><td colspan="1">převzít hodnotu z původní verze</td></tr><tr><td colspan="1">Datum od</td><td colspan="1">beze změny</td><td colspan="1"><p>D (zadaný datum), čas 00:00:00</p></td></tr><tr><td colspan="1">Datum do</td><td colspan="1"><p>D - 1, čas 23:59:59</p></td><td colspan="1">NULL</td></tr></tbody></table><h1>Uživatelské rozhraní</h1><h2><Název obrazovky></h2><h3>Drátový diagram</h3><p> </p><h3>Přehled UI komponent</h3><table><tbody><tr><th colspan="1">Callout</th><th>Komponenta</th><th>Typ komponenty</th><th>Zpřístupněná</th><th>Viditelná</th><th>Hodnota</th><th colspan="1">Chování</th></tr><tr><td colspan="1">1</td><td> </td><td> </td><td> </td><td> </td><td> </td><td colspan="1"> </td></tr></tbody></table>
</div>
</body>
</html>
