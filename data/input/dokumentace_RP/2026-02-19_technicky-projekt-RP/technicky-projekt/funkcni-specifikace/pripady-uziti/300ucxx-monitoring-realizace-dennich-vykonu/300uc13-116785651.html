<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>300UC13: Zahájit realizaci denního výkonu</title>
</head>
<body>
<div class="wiki-content">
<p><strong>Rozpracováno!</strong></p><p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je zahájení a průběžné sledování realizace konkrétního denního výkonu. To probíhá následovně…</p><ul><li>Na úrovni denního výkonu sledujeme informace o realizaci, ty jsou získávány v průběhu celého dne. Jejich zdroj je pak dán nastavením denního výkonu (např. vozidlový tablet).</li><li>Jakmile jsou na úrovni takového denního výkonu splněny určité podmínky, je zahájena jeho realizace (např. přihlášení vozidla na trasu). Mění se také stav tohoto denního výkonu.</li><li>Současně probíhá zpracování získaných informací o realizaci a jejich ukládání k dennímu výkonu (např. poloha vozidla či obsluha přiřazených nádob).</li></ul><p>Případ užití je pak popsán z pohledu jednoho konkrétního denního výkonu, jeho spouštění však probíhá dle stanoveného intervalu nad celou množinou těchto záznamů. Relevantní denní výkony pro každé spuštění případu užití jsou dány množinou podmínek a mohou se během dne měnit (např. schválení denního výkonu až v den realizace). Ta hlavní kritéria pro vyhodnocení řešených denních výkonů si představíme…</p><ul><li>Datum realizace denního výkonu je nastaveno na dnešní datum (daný den realizace).</li><li>Jedná o schválení či plněný denní výkon (podmínkou tedy je schválení denního výkonu).</li><li>K dennímu výkonu je přiřazeno vozidlo (pro dané vozidlo musí být splněny další podmínky). </li></ul><p>Poznámka: Vychází z <a href="#" data-page-title="300UC10: Vyhodnotit realizaci denního výkonu">300UC10: Vyhodnotit realizaci denního výkonu</a>, který částečně nahrazuje.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">–</td></tr><tr><td colspan="1">Uživatel</td><td colspan="1">–</td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>Nastane čas, ve kterém je zahájena realizace denního výkonu:</p><ul><li>Začíná den realizace (zahájeno sledování nové skupiny denních výkonů).</li></ul><p>Nastane čas, ve kterém je ukončena realizace denního výkonu:</p><ul><li>Dojde k ukončení realizace denního výkonu (viz <a href="#" data-page-title="300UC14: Ukončit realizaci denního výkonu"></a>; dochází k přepočtu informací o realizaci).</li></ul><p>Uživatel zadá požadavek na zahájení realizace denního výkonu, a to jedním z uvedených způsobů:</p><ul><li>Uživatel schválí denní výkon v den jeho realizace (viz <a href="#" data-page-title="200UC37: Schválit denní výkon">200UC37: Schválit denní výkon</a>; dochází k přepočtu informací o realizaci).</li><li>Dojde ke změně v rámci schváleného či plněného denního denního výkonu (viz <a href="300uc16-116786592.html">300UC16: Aktualizovat realizaci denního výkonu</a>; dochází k přepočtu informací o realizaci).</li></ul><h2>Vstupní podmínky</h2><p>Na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>) splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Stav</strong> je nastavena na jednu z uvedených hodnot: <strong>Schválený</strong>, <strong>Plněný</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li><li>Hodnota atributu <strong>Datum realizace</strong> je rovna dnešnímu datu.</li><li>Hodnota atributu <strong>Vozidlo</strong> je k dispozici (různá od NULL).</li></ul><p>Pro na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> existuje takový záznam entity <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a>, který splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Denní výkon</strong> odpovídá na vstupu získanému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> (vstupní parametr <strong>Denní výkon</strong>).</li><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong> (atribut implementován, ale nevyužíván).</li></ul><p>Je nastavena hodnota pro všechny dále uvedené konfigurační hodnoty (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>):</p><ul><li>locationServiceRadius (poloměr detekce výskytu vozidla v okolí lokace),</li><li>defaultPTOInput (výchozí číslo vstupu, dle kterého je vyhodnocována realizace),</li><li>PTOInputLabelKey (název klíče, pod kterým je evidován číslo vstupu, dle kterého je vyhodnocována realizace).</li></ul><p>Ke spuštění případu užití jsou nutná následující oprávnění na entity (viz <a href="../../../uzivatelska-78681297.html">Uživatelská oprávnění a role</a>):</p><ul><li>Denní výkony - zobrazení a modifikace.</li><li>Realizace denního výkonu - zobrazení a modifikace.</li></ul><p><em>Interní poznámka: Oproti původnímu chování <strong>není</strong> vyhodnocení realizace daného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> omezeno dále uvedenými podmínkami…</em></p><ul><li><em>Hodnota atributu <strong>Kompletní</strong> odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> je nastavena na <strong>FALSE</strong>.</em></li><li><em>Hodnota atributu <strong>Datum a čas konce</strong> odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> není k dispozici.</em></li></ul><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Denní výkon</td><td colspan="1"><a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a></td><td colspan="1">Ano</td><td colspan="1">Denní výkon, u kterého má být zahájena realizace denního výkonu.</td><td colspan="1">–</td></tr><tr><td colspan="1">Datum a čas od</td><td colspan="1">Datum a čas</td><td colspan="1">Ne</td><td colspan="1">Začátek období, v rámci kterého probíhá vyhodnocení nových informací o realizace denního výkonu.</td><td colspan="1">Pokud není k dispozici hodnota pro některý ze vstupních parametrů pro období, jsou použity proměnné <strong>TSYNC</strong> a <strong>TAKT</strong>.</td></tr><tr><td colspan="1">Datum a čas do</td><td colspan="1">Datum a čas</td><td colspan="1">Ne</td><td colspan="1">Konec období, v rámci kterého probíhá vyhodnocení nových informací o realizace denního výkonu.</td><td colspan="1">Pokud není k dispozici hodnota pro některý ze vstupních parametrů pro období, jsou použity proměnné <strong>TSYNC</strong> a <strong>TAKT</strong>.</td></tr><tr><td colspan="1">Jen pozice v jízdě</td><td colspan="1">Boolean</td><td colspan="1">Ano</td><td colspan="1"><p>Informace, zda mají být zpracovávány pouze <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> v jízdě (pokud ano – <strong>TRUE</strong>, jinak – <strong>FALSE</strong>).</p></td><td colspan="1"><p>Při on-line zpracování <a href="../../../datove-modely/datovy-78681044.html">FLW Pozic</a> načítáme záznamy bez ohledu na to, zda se vyskytují v jízdě (jízda vzniká až dodatečně). Při ukončení realizace, které probíhá v nočních hodinách, již načítáme pouze <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> v jízdě.</p><p>Pokud tento UC spouští <strong>Čas</strong>, je předána hodnota <strong>FALSE</strong>.</p></td></tr></tbody></table><h1>Základní tok událostí</h1><p>Základní tok událostí je popsán z pohledu jednoho konkrétního <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>, spouštěn je však nad jejich množinou a ve stanoveném intervalu (průběžně v rámci celého dne).</p><ul><li>Tok událostí je spuštěn pro všechny takové <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, které splňují určité podmínky nutné ke sledování jejich realizace (viz <a href="300uc13-116785651.html">Vstupní podmínky</a>).</li><li>Tok událostí je spouštěn v pravidelném intervalu, ten je dán konfiguračním parametrem <strong>refreshPeriodRoutesMonitoring</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul><p>Pro každý takový <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> jsou pak průběžně získávány informace o realizaci. Pracujeme s dále uvedenými typy záznamů:</p><ul><li><strong>Poziční záznamy</strong> – informace o poloze daného vozidla, které jsou využívány především pro zobrazení jeho trajektorie. Aktuálně slouží také k vyhodnocení začátku realizace.</li><li><strong>Informace o realizaci</strong> – informace, které slouží k vyhodnocení realizace dílčích lokací daného denního výkonu. Skutečný zdroj se pak liší dle způsobu vyhodnocení realizace:<br><ul><li><strong>PTO</strong> – zdrojem jsou událostí získané z FLWW2. Vyhodnocení realizace pak probíhá porovnáním polohy dílčích lokací v perimetru, jehož střed tvoří právě tato událost.  </li><li><strong>FOB</strong> – zdrojem jsou zprávy získané z FOB, které představují potvrzení realizace přímo řidičem. Vyhodnocení realizace pak probíhá přímým párováním zprávy a lokace.</li></ul></li></ul><p>Pro zvýšení přehlednosti uvedeného algoritmu si pak zavedeme určitě proměnné, které budeme dále používat…</p><ul><li><strong>TSYNC</strong>: datum a čas poslední provedené synchronizace záznamů (resp. načtení dat v rámci algoritmu).<br><ul><li><em>Časové razítko je získáno z poslední dostupné pozice pro daný objekt, od něj je pak odečteno 15 minut.</em></li><li><em>Cílem je podchycení situací, kdy jsou některé poziční záznamy dodány s několikaminutovým zpožděním. </em></li></ul></li><li><strong>TAKT</strong>: datum a čas, ve který došlo ke spuštění tohoto případu užití (aktuální datum a čas).</li></ul><p>Nyní se již dostáváme k samotnému algoritmu pro zpracování informací o realizaci konkrétního <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>… </p><ol><li>Systém získá <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> zajišťující realizaci <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>:<br><ul><li>Hodnota atributu <strong>Vozidlo</strong> na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>(vstupní parametr <strong>Denní výkon</strong>).</li></ul></li><li>Systém načte takové záznamy entity <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a>, které splňují všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> odpovídá hodnotě atributu <strong>Externí identifikátor FLW</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (viz krok <strong>1</strong>).</li><li>Hodnota atributu <strong>Datum a čas</strong> je větší než hodnota vstupního parametru <strong>Datum a čas od</strong> (případně hodnota proměnné <strong>TSYNC</strong>).</li><li>Hodnota atributu <strong>Datum a čas</strong> je menší nebo rovna hodnotě vstupního parametru <strong>Datum a čas do</strong> (případně hodnota proměnné <strong>TAKT</strong>).</li><li>Pokud je v rámci vstupního parametru <strong>Jen pozice v jízdě</strong> předána hodnota <strong>TRUE</strong> (jinak není dále uvedená podmínky vyhodnocována):<br><ul><li>Hodnota atributu <strong>Externí identifikátor jízdy</strong> je k dispozici (různá od NULL).</li></ul></li></ul></li><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Denní výkon</strong> odpovídá na vstupu získanému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> (vstupní parametr <strong>Denní výkon</strong>).</li><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong> (atribut implementován, ale nevyužíván).</li></ul></li><li>Systém vyhodnotí realizaci dílčích lokací na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (vstupní parametr <strong>Denní výkon</strong>) – zvolený algoritmus se odvíjí od hodnoty atributu <strong>Způsob vyhodnocení realizace</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Způsob vyhodnocení realizace</a>):<br><ul><li><strong>PTO</strong>: vyhodnocení realizace probíhá dle <a href="300uc13-116785651.html">ALG01: Vyhodnotit obsluhu lokací denního výkonu dle PTO</a>.</li><li><strong>FOB</strong>: vyhodnocení realizace probíhá dle <a href="300uc13-116785651.html">ALG02: Vyhodnotit obsluhu lokací denního výkonu dle FOB</a>.<br></li></ul></li><li>Systém aktualizuje získanou <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> (viz krok <strong>3</strong>) – provede nastavení dále uvedených atributů:<br><ul><li><strong>Trajektorie</strong>: aktualizace dle získaných záznamů entity <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> (viz krok <strong>2</strong>).</li><li><strong>Ujetá vzdálenost celkem</strong>: aktualizace dle získaných záznamů entity <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> (viz krok <strong>2</strong>).</li><li><strong>Ujetá vzdálenost s přívěsem</strong>: aktualizace dle získaných záznamů entity <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> (viz krok <strong>2</strong>).</li><li><strong>Doba jízdy celkem</strong>: získáno jako rozdíl proměnné <strong>TAKT</strong> a hodnoty atributu <strong>Datum a čas začátku</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>3</strong>).<br><ul><li><em>Pokud není hodnota atributu <strong>Datum a čas začátku</strong> k dispozici, neprobíhá ani nastavení hodnoty tohoto atributu.</em></li></ul></li><li><strong>Kompletní</strong>: vyhodnocení probíhá v rámci <a href="300uc13-116785651.html">ALG05: Vyhodnotit úplnost realizace denního výkonu</a>.</li></ul></li></ol><h1>Alternativní toky událostí</h1><h2>AF01: Zahájení realizace denního výkonu</h2><p>V rámci alternativního toku událostí je řešeno zahájení realizace denního výkonu – jeho „přepnutí“ ze stavu <strong>Schválený</strong> na <strong>Plněný</strong>. To probíhá následovně:</p><ol><li>Systém průběžně sleduje poziční záznamy odpovídajícího vozidla (čeká na první výskyt pozice, která splňuje určité podmínky).</li><li>Jakmile je získán poziční záznam splňující určité podmínky (viz vstupní podmínky), dochází ke změně stavu denního výkonu.</li></ol><p>Poznámka: Po zahájení realizace již není alternativní tok pro takový denní výkon dále spouštěn.</p><h3>Vstupní podmínky</h3><ul><li>Hodnota atributu <strong>Stav</strong> na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (vstupní parametr <strong>Denní výkon</strong>) je nastavena na <strong>Schválený</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li><li>Pro na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> byla získána alespoň jedna <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> (viz krok <strong>2</strong> základního toku událostí).</li></ul><h3>Tok událostí</h3><ol><li>Alternativní tok událostí začíná po provedení kroku <strong>2</strong> základního toku událostí.</li><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">FLW Pozici</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Záznam je obsažen v kolekci získané v rámci korku <strong>2</strong> základního toku událostí.</li><li>Hodnota atributu <strong>Je zapnutý motor</strong> je nastavena na <strong>TRUE</strong>.</li><li>TODO: Doplnit dle implementace</li><li>Hodnota atributu <strong>Datum a čas</strong> je minimální (hledáme nejstarší záznam ve zkoumané kolekci).</li><li>Pokud je v rámci vstupního parametru <strong>Jen pozice v jízdě</strong> předána hodnota <strong>TRUE</strong> (jinak není dále uvedená podmínky vyhodnocována):<br><ul><li>Hodnota atributu <strong>Externí identifikátor jízdy</strong> je k dispozici (různá od NULL).</li></ul></li></ul></li><li>Pokud je nalezena odpovídající <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> (poziční záznam, který spustí realizaci):<br><ol><li>Systém aktualizuje na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>) – provede nastavení dále uvedených atributů:</li></ol><ul><li><ul><li><strong>Stav</strong>: nastavena hodnota <strong>Plněný</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li></ul></li></ul><ol><li>Systém aktualizuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> (viz krok <strong>3</strong> základního toku událostí) – provede nastavení dále uvedených atributů:</li></ol><ul><li><ul><li><strong>Datum a čas začátku</strong>: hodnota atributu <strong>Datum a čas</strong> získané <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> (viz krok <strong>2</strong>).</li></ul></li></ul></li><li>Systém pokračuje v základním toku událostí.</li></ol><h3>Výstupní podmínky</h3><ul><li>Došlo ke změně stavu na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>, ten je aktuálně nastaven na hodnotu <strong>Plněný</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li></ul><h1>Výjimkové toky událostí</h1><p>–</p><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Došlo k aktualizaci informací o realizaci u na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (pokud byla tato realizace zahájena):</p><ul><li>trajektorie vozidla včetně souvisejících informací o ujeté vzdálenosti a době jízdy,</li><li>informace o realizaci dílčích lokací (dle nastaveného způsobu vyhodnocení realizace),</li><li>případné zahájení realizace denního výkonu (změna stavu denního výkonu).</li></ul><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Vyhodnotit obsluhu lokací denního výkonu dle PTO</h2><p>Algoritmus slouží k vyhodnocení získaných informací o realizaci dílčích lokací (aktivace PTO). Samotné párování pak probíhá dle pozice lokace v rámci denního výkonu a její polohy oproti dané aktivaci PTO.</p><ol><li>Pokud není pro daný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> k dispozici žádná <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a> (viz <a href="300uc13-116785651.html">ALG03: Získat obsluhy lokací objednaných služeb</a>):<br><ol><li><strong>Algoritmus předčasně končí</strong> (neexistuje žádný záznam, pro který by mohla být vyhodnocována realizace).</li></ol></li><li>Systém načte takové záznamy entity <a href="../../../datove-modely/datovy-78681044.html">FLW Událost</a>, které splňují všechny dále uvedené podmínky zároveň:<ul><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> odpovídá hodnotě atributu <strong>Externí identifikátor FLW</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (viz krok <strong>1</strong> základního toku událostí).</li><li>Hodnota atributu <strong>Datum a čas</strong> je větší než hodnota vstupního parametru <strong>Datum a čas od</strong> (případně hodnota proměnné <strong>TSYNC</strong>).</li><li>Hodnota atributu <strong>Datum a čas</strong> je menší nebo rovna hodnotě vstupního parametru <strong>Datum a čas do</strong> (případně hodnota proměnné <strong>TAKT</strong>).<br></li></ul></li><li>Pro všechny získané záznamy typu <a href="../../../datove-modely/datovy-78681044.html">FLW Událost</a> (viz krok <strong>2</strong>) – procházeno ve vzestupném pořadí dle atributu <strong>Datum a čas</strong> (od nejstaršího):<br><ol><li>Systém provede pro právě zkoumanou <a href="../../../datove-modely/datovy-78681044.html">FLW Událost</a> vyhodnocení realizace (viz dále uvedené chování).</li><li>Pokud vyhodnoceno úspěšné provedení realizace (viz krok <strong>3.a</strong>):<br><ol><li>Systém provede aktualizaci odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluhy lokace objednané služby</a> – provede nastavení dále uvedených atributů:<br><ul><li><strong>Datum a čas obsluhy</strong>: hodnota atributu <strong>Datum a čas</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FLW Události</a>.</li><li><strong>Je realizována</strong>: nastavena hodnota <strong>TRUE</strong>.</li><li><strong>Způsob odbavení</strong>: nastavena hodnota <strong>Potvrzena realizace</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Způsob odbavení lokace objednané služby</a>).</li><li><strong>Identifikátor záznamu o realizaci</strong>: hodnota atributu <strong>Identifikátor</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FLW Události</a>.</li><li><strong>Správné pořadí</strong>: vyhodnocení probíhá v rámci <a href="300uc13-116785651.html">ALG04: Vyhodnotit správné pořadí obsluhy lokace</a>.<br></li></ul></li></ol></li></ol></li></ol><p>Dále uvedená část algoritmu vychází z <a href="#" data-page-title="300UC10: Vyhodnotit realizaci denního výkonu">300UC10: Vyhodnotit realizaci denního výkonu</a>, změny v chování jsou pak naznačeny modře.</p><p>Využívané pojmy a značení:</p><ul><li><em><strong>Lokace</strong></em> ... Pokud se v rámci algoritmu hovoří o Lokaci bez dalšího upřesnění, je myšlena <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a>, která odpovídá příslušné instanci <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a> z právě vyhodnocované <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a>, a současně má příznak Monitoring realizace = TRUE.</li><li><em><strong>Okolí Lokace</strong></em> ... Vozidlo se v danou chvíli nachází v okolí dané Lokace, pokud vzdálenost aktuálního pozičního záznamu vozidla od souřadnic Lokace je menší nebo rovna poloměru detekce (konfigurační hodnota, viz <a href="300uc10-84840374.html">Vstupní podmínky</a>).</li><li><em><strong>Sledovaný vstup</strong></em> ... Sledovaný vstup vozidla dle konfigurační hodnoty, viz <a href="300uc10-84840374.html">Vstupní podmínky</a> </li><li><em><strong>L</strong></em> ... Posloupnost všech instancí <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a>. Jsou seřazené dle pořadí realizace v rámci plánu Denního výkonu. Stejná Lokace se může v posloupnosti <a href="../../../datove-modely/datovy-78681044.html">Obsluh lokací objednané služby</a> opakovat, jednotlivé výskyty se liší svým pořadím. <em>Např. v posloupnosti {A1, B2, D3, A4, E5, A6} má být Lokace A navštívena celkem 3x - jako první, čtvrtá a šestá v pořadí.</em></li><li><em><strong>Stav obsluhy lokace</strong></em> <em><strong>objednané služby</strong></em>... Může být buď neobsloužená nebo obslužená. Obsloužené mají v odpovídající instanci <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a> vyplněné atributy Datum a čas obsluhy a Souřadnice.</li><li><em><strong>β</strong></em> ... V této proměnné je udržovaná Lokace, která bude při případné další aktivaci sledovaného vstupu vozidla v jejím okolí ignorována (tj. odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a> nebude prohlášena za obslouženou). Ignorována bude do té doby, dokud buď vozidlo neopustí její okolí a opět se do něho nevrátí, nebo dokud předtím nedojde k obsluze jiné Lokace.</li></ul><p>Inicializace:</p><ul><li>Všechny Lokace jsou neobsloužené, proměnná <em>β</em> je prázdná.</li><li>(Inicializace probíhá pouze před vyhodnocením první pozice pro danou realizaci denního výkonu.)</li></ul><p>Kroky algoritmu:</p><ol><li>Pokud poziční záznam předaný na vstupu není spojený s událostí zapnutí sledovaného vstupu, přejít na krok 5. Jinak pokračovat následujícím krokem.</li><li>Vyhledat první výskyt (tedy prvek s nejnižším pořadím realizace v rámci Denního výkonu) dosud neobslouženého prvku z <em>L</em>, pro který platí níže uvedené podmínky. Pokud taková <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a> neexistuje, přejít na krok 5. Podmínky:<br><ul><li>odpovídající Lokace není obsažena v proměnné <em>β</em>, </li><li>souřadnice vyhodnocovaného pozičního záznamu leží v okolí odpovídající Lokace.</li></ul></li><li>Pro <a href="../../../datove-modely/datovy-78681044.html">Obsluhu lokace objednané služby</a> nalezenou v předchozím kroku:<br><ul><li>Nastavit Datum a čas obsluhy na datum a čas z vyhodnocovaného pozičního záznamu.</li><li>Nastavit atribut Souřadnice na souřadnice z vyhodnocovaného pozičního záznamu.</li><li>Nastavit příznak dodržení pořadí dle ALG04.</li><li>Vynulovat proměnnou <em>β</em>.</li><li>Rozhodnout, zda odpovídající Lokace patří do proměnné <em>β</em>:<br><ul><li>Nechť <em>Act =</em> pořadí zkoumané Lokace v rámci Denního výkonu<em>.</em></li><li>Pokud existuje bezprostředně následující (tedy s pořadím <em>Act</em>+1) <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a>, která nemá shodnou Lokaci jako je ta právě obsloužená, </li><li>a současně se dále v pořadí (tedy od pozice <em>Act</em>+2 včetně) vyskytuje <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a>, která má shodnou Lokaci jako je ta právě obsloužená,</li><li>pak nastavit <em>β</em> = právě obsloužená Lokace.</li></ul></li></ul></li><li>Pokud v <em>L</em> neexistuje žádná další neobsloužená <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a>, pak pro danou <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> nastavit atribut Kompletní = True.</li><li>Pokud <em>β</em> není prázdná: Když platí, že souřadnice vyhodnocovaného pozičního záznamu neleží v okolí Lokace z proměnné <em>β</em>, je proměnná <em>β</em> vynulována.</li></ol><p>Poznámka:</p><ul><li>Jako obsloužená lokace je brána taková lokace, u které odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednaných služeb</a> nabývá v rámci atributu <strong>Způsob odbavení</strong> jedné z uvedených hodnot: <strong>Potvrzena realizace</strong>, <strong>Přeskočena realizace</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Způsob odbavení lokace objednané služby</a>). Tento stav by však neměl nastat, v rámci potvrzení realizace je vždy nastavena hodnota <strong>Potvrzena realizace</strong>.</li><li>Pro každou lokaci již v tuto chvíli existují informace o její obsluze. Pokud tedy dojde v rámci algoritmu k potvrzení realizace, není vytvářená odpovídající obsluha lokace, je pouze nastavena hodnota atributu <strong>Způsob odbavení</strong>.</li><li>Logika algoritmu je naznačena na obrázku (včetně vyhodnocení správného pořadí obsluhy, viz <a href="300uc13-116785651.html">ALG04: Vyhodnotit správné pořadí obsluhy lokace</a>).</li></ul><p><img src="300uc13-zahajit-realizaci-denniho-vykonu-116785651_images/image2023-11-4 12-32-1.png" data-attachment="true"></p><h2>ALG02: Vyhodnotit obsluhu lokací denního výkonu dle FOB</h2><p>Algoritmus slouží k vyhodnocení získaných informaci o realizaci dílčích lokací (zprávy z FOB). Samotné párování pak probíhá na úrovni identifikátoru dané lokace, která je také součástí zprávy z FOB.</p><ol><li>Pokud není pro daný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> k dispozici žádná <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a> (viz <a href="300uc13-116785651.html">ALG03: Získat obsluhy lokací objednaných služeb</a>):<br><ol><li><strong>Algoritmus předčasně končí</strong> (neexistuje žádný záznam, pro který by mohla být vyhodnocována realizace).</li></ol></li><li>Systém načte takové záznamy entity <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a>, které splňují všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> odpovídá hodnotě atributu <strong>Externí identifikátor FLW</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (viz krok <strong>1</strong> základního toku událostí).</li><li>Hodnota atributu <strong>Datum a čas odbavení</strong> je větší než hodnota vstupního parametru <strong>Datum a čas od</strong> (případně hodnota proměnné <strong>TSYNC</strong>).</li><li>Hodnota atributu <strong>Datum a čas odbavení</strong> je menší nebo rovna hodnotě vstupního parametru <strong>Datum a čas do</strong> (případně hodnota proměnné <strong>TAKT</strong>).<br></li></ul></li><li>Pro všechny získané záznamy typu <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a> (viz krok <strong>2</strong>) – procházeno ve vzestupném pořadí dle atributu <strong>Datum a čas odbavení</strong> (od nejstaršího):<br><ol><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluhu lokace objednané služby</a> – hledá taková záznam, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Záznam je obsažen v kolekci získané v rámci <a href="300uc13-116785651.html">ALG03: Získat obsluhy lokací objednaných služeb</a> (vyhodnocujeme pouze záznamy relevantní pro daný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>).</li><li>Hodnota atributu <strong>Lokace objednané služby</strong> odpovídá <a href="../../../datove-modely/datovy-78681044.html">Lokaci objednané služby</a> obsažené v rámci právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a> (atribut <strong>Identifikátor lokace objednané služby</strong>).</li></ul></li><li>Pokud je nalezena odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a> (viz krok <strong>3.a</strong>):<br><ol><li>Systém provede aktualizaci této <a href="../../../datove-modely/datovy-78681044.html">Obsluhy lokace objednané služby</a> – provede nastavení dále uvedených atributů:<br><ul><li><strong>Datum a čas obsluhy</strong>: hodnota atributu <strong>Datum a čas odbavení</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a>.</li><li><strong>Je realizována</strong>: nastaveno dle hodnoty atributu <strong>Způsob odbavení</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a> (viz <a href="../../../datove-modely/datovy-78681044.html">Způsob odbavení lokace objednané služby</a>):<br><ul><li><strong>Neodbavena</strong>: nastavena hodnota <strong>FALSE</strong> (ze strany řidiče může dojít ke zrušení realizace).</li><li><strong>Potvrzena realizace</strong>: nastavena hodnota <strong>TRUE</strong>.</li><li><strong>Přeskočena realizace</strong>: nastavena hodnota <strong>FALSE</strong>.</li></ul></li><li><strong>Způsob odbavení</strong>: hodnota atributu <strong>Způsob odbavení</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a>.</li><li><strong>Identifikátor záznamu o realizaci</strong>: hodnota atributu <strong>Identifikátor</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a>.</li><li><strong>Správné pořadí</strong>: nastaveno dle hodnoty atributu <strong>Způsob odbavení</strong> právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">FOB informace o realizaci lokace objednané služby</a> (viz <a href="../../../datove-modely/datovy-78681044.html">Způsob odbavení lokace objednané služby</a>):<br><ul><li><strong>Neodbavena</strong>: je zrušeno nastavení aktuální hodnoty (předáno NULL).</li><li><strong>Potvrzena realizace</strong>: vyhodnocení probíhá v rámci <a href="300uc13-116785651.html">ALG04: Vyhodnotit správné pořadí obsluhy lokace</a>.</li><li><strong>Přeskočena realizace</strong>: vyhodnocení probíhá v rámci <a href="300uc13-116785651.html">ALG04: Vyhodnotit správné pořadí obsluhy lokace</a>.</li></ul></li></ul></li></ol></li></ol></li><li>Systém provede aktualizaci trasy denního výkonu (jsou do ní zaneseny nové získané informace o realizaci):<br><ol><li>Systém nalezne takový záznam o <a href="../../../datove-modely/datovy-78681044.html">Přihlášeném zařízení na denním výkonu</a>, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Jedná se o aktivní záznam.</li><li>Hodnota atributu <strong>Denní výkon</strong> odpovídá na vstupu získanému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> (vstupní parametr <strong>Denní výkon</strong>).<br></li></ul></li><li>Pokud je nalezen záznam o <a href="../../../datove-modely/datovy-78681044.html">Přihlášeném zařízení na denním výkonu</a> (viz krok 4.a):<br><ol><li>Systém aktualizuje nalezený záznam o <a href="../../../datove-modely/datovy-78681044.html">Přihlášeném zařízení na denním výkonu</a> – spustí <a href="../205ucxx-generovani-tras/205uc04-99123475.html">205UC04: Upravit záznam o přihlášeném zařízení na denním výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Editovaný záznam o přihlášeném zařízení na denním výkonu</strong>: nalezené <a href="../../../datove-modely/datovy-78681044.html">Přihlášené zařízení na denním výkonu</a> (viz krok 4.a).</li><li><strong>Změny v záznamu o přihlášeném zařízení na denním výkonu</strong>: hodnoty jednotlivých atributů entity <a href="../../../datove-modely/datovy-78681044.html">Přihlášené zařízení na denním výkonu</a> jsou změněny následovně (hodnota v rámci neuvedených atributů je zachována):<br><ul><li><strong>Trasa</strong>: pokud je pro právě zkoumané <a href="../../../datove-modely/datovy-78681044.html">Přihlášené zařízení na denním výkonu</a> (viz krok 4.a) k dispozici hodnota atributu <strong>Trasa</strong>:<br><ul><li>Systém vygeneruje trasu pro odpovídající <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> – spustí <a href="../205ucxx-generovani-tras/205uc01-98241179.html">205UC01: Generovat trasu denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Verze</strong>: hodnota atributu <strong>Verze trasy</strong> nalezeného <a href="../../../datove-modely/datovy-78681044.html">Přihlášeného zařízení na denním výkonu</a> (viz krok 4.a).</li><li><strong>Denní výkon</strong>: na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>).<br></li></ul></li></ul></li></ul></li></ul></li></ol></li><li><em>Poznámka: V tomto případě nedochází ke změně trasy jako takové, jsou získány pouze informace související s realizací odpovídajícího <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>. Proto zde nejsou prováděny akce jako nastavení data poslední změny trasy v rámci <a href="../../../datove-modely/datovy-78681044.html">Přihlášeného zařízení na denním výkonu</a>, odeslání notifikace o změna trasy na FOB apod.</em></li></ol></li></ol><p>Poznámka: K jedné lokaci může být získáno více zpráv z FOB. Vzhledem k tomu, že jsou tyto zprávy zpracovávány od nejstarší po nejnovější, bude k dané lokaci přiřazena taková zpráva z FOB, které má nejnovější čas odbavení. Stav realizace se navíc může v průběhu dne měnit.</p><h2>ALG03: Získat obsluhy lokací objednaných služeb</h2><p>Algoritmus slouží k získání takových <a href="../../../datove-modely/datovy-78681044.html">Obsluh lokací objednaných služeb</a>, které figurují v rámci na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>. Jedná se pak o záznamy, v rámci kterých jsou uchovány informace o realizaci dílčích lokací.</p><ol><li>Systém nalezne odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluhy lokací objednaných služeb</a> – hledá takové záznamy, které splňují všechny dále uvedené podmínky zároveň:<ul><li>Hodnota atributu <strong>Realizace denního výkonu</strong> odpovídá získané <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> (viz krok <strong>3</strong> základního toku událostí).</li></ul></li></ol><p>Poznámka: Získané <a href="../../../datove-modely/datovy-78681044.html">Obsluhy lokací objednaných služeb</a> jsou předány na výstupu algoritmu, předána pak může být také prázdná kolekce.</p><h2>ALG04: Vyhodnotit správné pořadí obsluhy lokace</h2><p>Algoritmus vychází z <a href="#" data-page-title="300UC10: Vyhodnotit realizaci denního výkonu">300UC10: Vyhodnotit realizaci denního výkonu</a>, změny v chování jsou pak naznačeny modře.</p><p>Algoritmus porovná, zda se Očekávaná lokace (LExp) shoduje s Aktuálně obslouženou lokací (LAct). V případě, že tomu tak není, nastaví Aktuálně obsloužené lokaci příznak nedodržování pořadí.</p><ul><li>Očekávaná lokace (LExp) = lokace, která by měla následovat dle plánu.</li><li>Aktuálně obsloužená lokace (LAct) = lokace, která byla právě obsloužena</li></ul><p>Inicializace: (je vykonána jednou pro celou sadu obsloužených lokací)</p><ul><li>Pokud ještě nebyla žádná lokace obsloužená:<br><ol><li>Očekávaná lokace (LExp) = první lokace dle plánu.</li></ol></li><li>Pokud je počet dosud obsloužených lokací z intervalu větší než 1 a menší než celkový počet lokací v plánu:<br><ol><li>Nalézt naposledy obslouženou lokaci (LLast) - tj. má nejmladší datum a čas obsluhy; pokud je takových více, pak použít tu, která má nejnižší pořadí dle plánu.</li><li>Očekávaná lokace (LExp) = dosud neobsloužená lokace, která v plánu následuje bezprostředně za LLast; pokud taková neexistuje, pak první dosud neobsloužená lokace v plánu.</li></ol></li></ul><p>Vyhodnocení:</p><ul><li>Pokud Aktuálně obsloužená lokace (LAct) = Očekávaná lokace (LExp), pak nastavit pro Aktuálně obslouženou lokaci (LAct) příznak Správné pořadí = TRUE.</li><li>Jinak nastavit pro Aktuálně obslouženou lokaci (LAct) příznak Správné pořadí = FALSE.</li></ul><p>Poznámka:</p><ul><li>Jako obsloužená lokace je brána taková lokace, u které odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednaných služeb</a> nabývá v rámci atributu <strong>Způsob odbavení</strong> jedné z uvedených hodnot: <strong>Potvrzena realizace</strong>, <strong>Přeskočena realizace</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Způsob odbavení lokace objednané služby</a>).</li><li>Pokud je realizace vyhodnocována dle informací z FOB, může dojít ke „zrušení“ realizace některé z již obsloužených lokací. Tato skutečnost není v rámci algoritmu řešena. Vyhodnocení probíhá dle stávající logiky.</li></ul><h2>ALG05: Vyhodnotit úplnost realizace denního výkonu</h2><p>Algoritmus složí k vyhodnocení stavu realizace <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>. Zkoumá, zda již došlo k úspěšné realizaci všech obsažených lokací.</p><ol><li>Pokud existuje alespoň jedna <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a>, která splňuje všechny dále uvedené podmínky zároveň, není odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> označena jako kompletní (předáno <strong>FALSE</strong>).<ul><li>Záznam je obsažen v kolekci získané v rámci <a href="300uc13-116785651.html">ALG03: Získat obsluhy lokací objednaných služeb</a> (vyhodnocujeme pouze záznamy relevantní pro daný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>).</li><li>Hodnota atributu <strong>Je realizována</strong> je nastavena na <strong>FALSE</strong> (lokace nebyla úspěšně obsloužena).</li></ul></li><li>Jinak se jedná o kompletní <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> (předáno <strong>TRUE</strong>).</li></ol><h1>Validace</h1><p>–</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h3>30. 7. 2024: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="300uc13-116785651.html">Vstupní data</a></td><td colspan="1">Doplnění vstupní parametru pro vyhodnocení způsobu zpracování pozičních záznamů (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="300uc13-116785651.html">Základní tok událostí</a></td><td colspan="1">Revize způsobu zpracování pozičních záznamů (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="300uc13-116785651.html">AF01: Zahájení realizace denního výkonu</a></td><td colspan="1">Revize způsobu zpracování pozičních záznamů (naznačeno růžově).</td></tr></tbody></table><h3>16. 6. 2024: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="300uc13-116785651.html">ALG02: Vyhodnotit obsluhu lokací denního výkonu dle FOB</a></td><td colspan="1">Doplněno generování trasy denního výkonu po získání nových informací o realizaci (naznačeno oranžově).</td></tr></tbody></table>
</div>
</body>
</html>
