<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>300UC14: Ukončit realizaci denního výkonu</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl</h1><p>Cílem případu užití je ukončení realizace konkrétního denního výkonu. Od tohoto okamžiku již neprobíhá průběžné sledování jeho realizace. Provedeny jsou následující úkony:</p><ul><li>Pro odpovídající vozidlo jsou získány informace o realizaci (zpožděné poziční záznamy a události).</li><li>Následně jsou „přepočítány“ informace o realizaci (aktualizace dle nové získaných informací).</li><li>V závěru dochází ke změně stavu denního výkonu, ten je připraven ke kontrole dispečerem.</li></ul><p>Případ užití je popsán z pohledu jednoho konkrétního denního výkonu, jeho spouštění však probíhá ve stanovený čas nad celou množinou těchto záznamů. Relevantní denní výkony pro každé spuštění případu užití jsou dány množinou podmínek, ta hlavní kritéria pro vyhodnocení řešených denních výkonů jsou následující…</p><ul><li>Datum realizace denního výkonu je nastaveno na dnešní (resp. včerejší) datum (spouštěno v ranních hodinách pro předchozí den).</li><li>Jedná o schválení či plněný denní výkon (nutnou podmínkou tedy je schválení denního výkonu, nikoliv zahájení jeho realizace).</li><li>Případ užití je spouštěn také pro denní výkony bez přiřazeného vozidla (i ty je nutné „překlopit“ do požadovaného stavu).</li></ul><p>Spolehlivost celého procesu je pak zajištěna doplněním určité logiky, která řeší jak jeho efektivitu, tak ošetření chybových stavů. Ve zkratce se jedná o následující opatření:</p><ul><li><strong>Serializace </strong>– TODO</li><li><strong>Opakované zpracování denních výkonů</strong> – pokud dojde k chybě při zpracování denního výkonu, dochází k opakovanému provedení této akce (s určitou prodlevou).<br><ul><li>Typickým příkladem je situace, kdy nebylo možné získat informace o realizaci z FLWW2 (volání API skončilo chybou).</li><li>Dochází pak k opakovanému provedení této akce, kdy je dán jak počet opakování, tak délka prodlevy.</li></ul></li><li><strong>Postupné zpracování denních výkonů</strong> – jednotlivé denní výkony jsou zpracovány odděleně. Dílčí chyba tedy neznamená předčasné ukončení celého procesu.<ul><li>Postupným zpracováním denních výkonů dochází jak ke snížení nároků na provedení této akce (množství dat při volání API), tak ke zvýšení robustnosti celého řešení.</li><li>Pokud tedy dojde k chybě při zpracování konkrétního denního výkonu, neovlivní to zpracování zbývajících záznamů (pokračujeme zpracováním dalšího záznamu).</li></ul></li></ul><p>Poznámka: Vychází z <a href="300uc11-84840376.html">300UC11: Ukončit vyhodnocování realizace denního výkonu</a>, který nahrazuje.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th colspan="1">Poznámka</th></tr><tr><td colspan="1">Čas</td><td colspan="1">Spouští případ užití.</td></tr><tr><td colspan="1">FLWW2</td><td colspan="1">Prostřednictvím API poskytuje informace o realizaci.</td></tr><tr><td colspan="1"><em>Systémový administrátor</em></td><td colspan="1"><em>Ruční spuštění případu užití (na úrovni tohoto UC není řešeno).</em></td></tr></tbody></table><p>Poznámka: Úplný přehled aktérů je zobrazen samostatně, viz <a href="../../../high-level-concept/akteri-78680673.html">Aktéři</a>.</p><h1>Spuštění případu užití</h1><p>Nastane čas, ve kterém je prováděno ukončení realizace denního výkonu:</p><ul><li>Je spuštěn noční proces, který provádí zpracování denních výkonů (ukončeno sledování dané skupiny denních výkonů).</li><li>Samotný čas spuštění je dán konfigurační hodnotou (generateDailyRoutesSchedule, viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul><h2>Vstupní podmínky</h2><p>Na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>) splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Stav</strong> je nastavena na jednu z uvedených hodnot: <strong>Schválený</strong>, <strong>Plněný</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li><li>Hodnota atributu <strong>Datum realizace</strong> je rovna dnešnímu datu (resp. včerejšímu, případ užití je spuštěn v ranních hodinách následujícího dne).</li></ul><p>Pro na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> existuje takový záznam entity <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a>, který splňuje všechny dále uvedené podmínky zároveň:</p><ul><li>Hodnota atributu <strong>Denní výkon</strong> odpovídá na vstupu získanému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> (vstupní parametr <strong>Denní výkon</strong>).</li><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong> (atribut implementován, ale nevyužíván).</li></ul><p>Je nastavena hodnota pro všechny dále uvedené konfigurační hodnoty (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>):</p><ul><li>locationServiceRadius (poloměr detekce výskytu vozidla v okolí lokace),</li><li>defaultPTOInput (výchozí číslo vstupu, dle kterého je vyhodnocována realizace),</li><li>PTOInputLabelKey (název klíče, pod kterým je evidován číslo vstupu, dle kterého je vyhodnocována realizace).</li></ul><p>Ke spuštění případu užití jsou nutná následující oprávnění na entity (viz <a href="../../../uzivatelska-78681297.html">Uživatelská oprávnění a role</a>):</p><ul><li>Denní výkony - zobrazení a modifikace.</li><li>Realizace denního výkonu - zobrazení a modifikace.</li></ul><p><em>Interní poznámka: Oproti původnímu chování <strong>není</strong> vyhodnocení realizace daného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> omezeno dále uvedenými podmínkami…</em></p><ul><li><em>Hodnota atributu <strong>Datum a čas konce</strong> odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> není k dispozici.</em></li></ul><h2>Vstupní data</h2><table><tbody><tr><th>Vstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Denní výkon</td><td colspan="1"><a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a></td><td colspan="1">Ano</td><td colspan="1">Denní výkon, u kterého má být ukončena realizace.</td><td colspan="1">–</td></tr></tbody></table><h1>Základní tok událostí</h1><p>Základní tok událostí je popsán z pohledu jednoho konkrétního <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>, spouštěn je však nad jejich množinou.</p><ul><li>Tok událostí je spuštěn pro všechny takové <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, které splňují určité podmínky nutné k ukončení jejich realizace (viz <a href="300uc13-116785651.html">Vstupní podmínky</a>).</li><li>Tok událostí je spouštěn v nočních hodinách, každý <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> je pak zpracován minimálně jednou (za předpokladu úspěšného dokončení toku událostí).</li><li>Tok událostí může být spouštěn opakovaně – daný běh probíhá pro množinu dosud neodbavených <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a> (jejich předchozí zpracování skončilo chybou).<br><ul><li>Maximální počet opakování procesu i časová prodleva mezi nimi je dána konfiguračně. </li></ul></li><li>Dílčí <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a> jsou zpracovány jednotlivě (včetně získání potřebných informací o realizaci ze systému FLWW2).</li><li>Po dokončení celého procesu je odeslána e-mailová notifikace s jeho výsledkem – proces je ukončen splněním jedné z dále uvedených podmínek:<br><ul><li>Dojde k úspěšnému ukončení realizace všech <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a> (notifikace obsahuje pouze informaci o úspěšném provedení akce).</li><li>Část <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a> je úspěšně dokončena, u zbývající části byl vyčerpán maximálně počet opravných pokusů (notifikace obsahuje seznam problematických <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a>).</li></ul></li></ul><p>Pro každý takový <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> jsou pak hromadně získány informace o realizaci za daný den (doplnění chybějících dat). Pracujeme s dále uvedenými typy záznamů:</p><ul><li><strong>Poziční záznamy</strong> – informace o poloze daného vozidla, které jsou využívány především pro zobrazení jeho trajektorie. Aktuálně slouží také k vyhodnocení začátku realizace.</li><li><strong>Informace o realizaci</strong> – informace, které slouží k vyhodnocení realizace dílčích lokací daného denního výkonu. Skutečný zdroj se pak liší dle způsobu vyhodnocení realizace:<br><ul><li><strong>PTO</strong> – zdrojem jsou událostí získané z FLWW2. Vyhodnocení realizace pak probíhá porovnáním polohy dílčích lokací v perimetru, jehož střed tvoří právě tato událost.  </li><li><strong>FOB</strong> – zdrojem jsou zprávy získané z FOB, které představují potvrzení realizace přímo řidičem. Vyhodnocení realizace pak probíhá přímým párováním zprávy a lokace.</li></ul></li></ul><p>Pro zvýšení přehlednosti uvedeného algoritmu si pak zavedeme určitě proměnné, které budeme dále používat…</p><ul><li><strong>D</strong>: datum realizace, pro které je případ užití spouštěn.<br><ul><li><em>Typicky se jedná o včerejší datum, protože UC je spouštěn v brzkých ranních následujícího dne.</em></li><li><em>Při ručním spuštění administrátorem pak může být předáno konkrétní datum realizace. </em></li></ul></li><li><strong>TFROM</strong>: datum a čas představující začátek období, pro které jsou získávány informace o realizaci…<ul><li>Datum je dáno pomocnou proměnnou <strong>D</strong> (datum realizace).</li><li>Čas je nastaven na <strong>0:00:00</strong> (začátek dne realizace).</li></ul></li><li><strong>TTO</strong>: datum a čas představující konec období, pro které jsou získávány informace o realizaci…<ul><li>Datum je dáno pomocnou proměnnou <strong>D</strong> (datum realizace).</li><li>Čas je nastaven na <strong>23:59:59</strong> (konec dne realizace).<br></li></ul></li></ul><p>Zapomenout nesmíme ani na parametrizaci celého procesu, definujeme dále uvedené proměnné:</p><ul><li><strong>Počet opakování</strong> – maximální počet pokusů pro opakovaní tohoto procesu (closeDayPerformanceRealizationCount, viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li><li><strong>Prodleva</strong> – přestávka mezi dílčími opakováními tohoto procesu (closeDayPerformanceRealizationDelay, viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul><p>Nyní se již dostáváme k samotnému algoritmu pro zpracování informací o realizaci konkrétního <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>…</p><ol><li>Systém provede aktualizaci informací o realizaci (získání „opožděných“ záznamů):<br><ol><li>Systém získá chybějící <a href="../../../datove-modely/datovy-78681044.html">FLW pozice</a> – spustí <a href="#" data-page-title="604UC07: Získat FLW pozice">604UC07: Získat FLW pozice</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Datum a čas od</strong>: hodnota proměnné <strong>TFROM</strong>.</li><li><strong>Datum a čas do</strong>: hodnota proměnné <strong>TTO</strong>.</li><li><strong>Denní výkon</strong>: na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>).</li></ul></li><li>Systém získá chybějící <a href="../../../datove-modely/datovy-78681044.html">FLW události</a> – spustí <a href="#" data-page-title="604UC08: Získat FLW události">604UC08: Získat FLW události</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Datum a čas od</strong>: hodnota proměnné <strong>TFROM</strong>.</li><li><strong>Datum a čas do</strong>: hodnota proměnné <strong>TTO</strong>.</li><li><strong>Denní výkon</strong>: na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>).</li></ul></li></ol></li><li>Systém získá <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> zajišťující realizaci <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a>:<br><ul><li>Hodnota atributu <strong>Vozidlo</strong> na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (vstupní parametr <strong>Denní výkon</strong>).<br><ul><li><em>Pokud není <a href="../../../datove-modely/datovy-78681044.html">Objekt</a> k dispozici, nejsou dostupné ani informace o jeho realizaci.</em></li><li><em>Současně probíhá vyhodnocení dostupných pozičních záznamů (zda vozidlo vyjelo).</em></li><li><em>Může pak dojít ke spuštění <a href="300uc14-116785653.html">AF01: Zpracování denního výkonu bez informací o realizaci</a>.</em></li></ul></li></ul></li><li>Systém připraví informace o realizaci na opětovné zpracování (pro zpracování včetně „opožděných“ záznamů): <br><ol><li>Systém zruší stávající realizaci na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkon</a> – spustí <a href="300uc15-116785654.html">300UC15: Zrušit realizaci denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Denní výkon</strong>: na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>).<em><br></em></li></ul></li><li>Systém připraví novou realizaci pro na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> – spustí <a href="300uc12-116785650.html">300UC12: Připravit realizaci denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Denní výkon</strong>: na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>).</li></ul></li><li><em>Poznámka: Nedochází k rušení stávajících informací o realizaci, probíhá pouze jejich přepočet (viz krok 4). Uvedená logika bude doplněna v případě, kdy se stávající chování ukáže jako nedostatečné.</em><br></li></ol></li><li>Systém zpracuje informace o realizaci v rámci odpovídajícího dne – spustí <a href="300uc13-116785651.html">300UC13: Zahájit realizaci denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Denní výkon</strong>: na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>).</li><li><strong>Datum a čas od</strong>: hodnota proměnné <strong>TFROM</strong>.</li><li><strong>Datum a čas do</strong>: hodnota proměnné <strong>TTO</strong>.<br></li><li><strong>Jen pozice v jízdě</strong>: předána hodnota <strong>TRUE</strong>.</li></ul></li><li>Systém vyhodnotí ukončení realizace denního výkonu (hledá poslední poziční záznam pro daný den realizace).<br><ol><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">FLW Pozici</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> odpovídá hodnotě atributu <strong>Externí identifikátor FLW</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (viz krok <strong>2</strong>).</li><li>Hodnota atributu <strong>Datum a čas</strong> je větší nebo rovna hodnotě proměnné <strong>TFROM</strong>.</li><li>Hodnota atributu <strong>Datum a čas</strong> je menší nebo rovna hodnotě proměnné <strong>TTO</strong>.<br></li><li>Hodnota atributu <strong>Je zapnutý motor</strong> je nastavena na <strong>TRUE</strong>.</li><li>TODO: Doplnit dle implementace</li><li>Hodnota atributu <strong>Externí identifikátor jízdy</strong> je k dispozici (různá od NULL).</li><li>Hodnota atributu <strong>Datum a čas</strong> je maximální (hledáme nejnovější záznam ve zkoumané kolekci).<br></li></ul></li><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Denní výkon</strong> odpovídá na vstupu získanému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> (vstupní parametr <strong>Denní výkon</strong>).</li><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong> (atribut implementován, ale nevyužíván).</li></ul></li><li>Systém aktualizuje získanou <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> – spustí <a href="#" data-page-title="502UC05: Upravit realizaci denního výkonu">502UC05: Upravit realizaci denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Editovaná realizace denního výkonu:</strong> odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Změny v realizaci denního výkonu</strong>: předány dále uvedené hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a>…<br><ul><li><strong>Denní výkon</strong>: hodnota atributu <strong>Denní výkon</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Datum a čas začátku</strong>: hodnota atributu <strong>Datum a čas začátku</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Datum a čas konce</strong>: hodnota atributu <strong>Datum a čas</strong> získané <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a> (viz krok <strong>5.a</strong>). TODO: Ověřit, zda není dle poslední jízdy.</li><li><strong>Časové využití</strong>: získáno jako podíl dále uvedených hodnot, který je vynásoben hodnotou <strong>100</strong> (převod na procenta): TODO: Ověřit dle implementace.<br><ul><li>atribut <strong>Doba jízdy celkem</strong> této <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> (použita nově nastavená hodnota),</li><li>konfigurační hodnota <strong>workingHoursLength</strong> (viz <a href="#" data-page-title="Konfigurační hodnoty"></a>).</li></ul></li><li><strong>Ujetá vzdálenost celkem</strong>: hodnota atributu <strong>Ujetá vzdálenost celkem</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Ujetá vzdálenost s přívěsem</strong>: hodnota atributu <strong>Ujetá vzdálenost celkem</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Doba jízdy celkem</strong>: získáno jako rozdíl dále hodnot:<br><ul><li>atribut <strong>Datum a čas konce</strong> této <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> (použita nově nastavená hodnota),</li><li>atribut <strong>Datum a čas začátku</strong> této <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a>.</li></ul></li><li><strong>Kompletní</strong>: hodnota atributu <strong>Kompletní</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Trajektorie</strong>: hodnota atributu <strong>Trajektorie</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Ukončena</strong>: předána hodnota <strong>TRUE</strong>.</li><li><strong>Datum a čas potvrzení realizace</strong>: hodnota atributu <strong>Datum a čas potvrzení realizace</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Potvrdil realizaci</strong>: hodnota atributu <strong>Potvrdil realizaci</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li><li><strong>Poznámka</strong>: hodnota atributu <strong>Poznámka</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>5.b</strong>).</li></ul></li></ul></li><li>Systém provede nastavení odpovídajících <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz <a href="300uc14-116785653.html">ALG01: Provést nastavení objednaných služeb</a>).</li><li>Systém aktualizuje na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>) – provede nastavení dále uvedených atributů:<br><ul><li><strong>Stav</strong>: nastavena hodnota <strong>Ke kontrole</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li></ul></li></ol></li></ol><p>Poznámka: Dodatečně získané informace o realizaci mohou mít vliv nejen na vyhodnocení obsluhy jednotlivých lokací, měnit se může také trajektorie či začátek realizace denního výkonu.</p><ul><li>Pro každý denní výkon jsou získávány jak poziční záznamy, tak události – bez ohledu na způsob vyhodnocení realizace daného denního výkonu.</li><li>Události sice nemusí být využity pro samotné vyhodnocení realizace dílčích lokací (potvrzování ve FOB), předpokládáme však jejich využití do budoucna.</li></ul><p>Jakmile je dokončeno zpracování <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a> (u všech je buď je ukončena realizace, nebo byl vyčerpán počet pokusů o ukončení), dochází k odeslání e-mailové notifikace zodpovědným osobám. Vzhledem k tomu, že se jedná o existující funkčnost, popíšeme si pouze změny v tomto chování…</p><ul><li>V případě, že jsou úspěšně zpracovány všechny <a href="../../../datove-modely/datovy-78681044.html">Denní výkony</a>, je zachováno stávající chování.</li><li>V opačném případě se mění obsah zprávy, my si uvedeme jak aktuální chování, tak požadovaný stav:<br><ul><li><strong>Aktuální chování</strong>: Preklopenie DV na prostredí 'production' dňa 01.11.2023 <strong>zlyhalo</strong>.</li><li><strong>Požadovaný stav</strong>: Preklopenie niektorých DV na prostredí 'production' dňa 01.11.2023 <strong>zlyhalo</strong> (TN241EX, TN875EX, ZV581EX).</li></ul></li></ul><p>Poznámka: Do budoucna je pak vhodné odesílat notifikaci pouze v případě, kdy nedojde k „překlopení“ některého z <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a>. Po určité období však bude notifikace posílána vždy, bez ohledu na výsledek zpracování <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a>. Proto je popis chování uveden pouze v této podobě.</p><h1>Alternativní toky událostí</h1><h2>AF01: Zpracování denního výkonu bez informací o realizaci</h2><p>Cílem alternativního toku událostí je zpracování takových <a href="../../../datove-modely/datovy-78681044.html">Denních výkonů</a>, u kterých nemáme k dispozici informace o realizaci. To může nastat v uvedených případech:</p><ul><li>K odpovídajícímu <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> není přiřazeno vozidlo (resp. <a href="../../../datove-modely/datovy-78681044.html">Objekt</a>).</li><li>Pro dané vozidlo nebyly získány poziční záznamy (vozidlo nevyjelo). </li></ul><h3>Vstupní podmínky</h3><p>Je splněna jedna z dále uvedených podmínek.</p><ul><li>K na vstupu získanému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> není přiřazeno vozidlo – hodnota atributu <strong>Vozidlo</strong> na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (vstupní parametr <strong>Denní výkon</strong>) není k dispozici.</li><li>Pro na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> nebyly získány informace o realizaci – neexistuje ani jedna <a href="../../../datove-modely/datovy-78681044.html">FLW Pozice</a>, která splňuje všechny dále uvedené podmínky zároveň:<ul><li>Hodnota atributu <strong>Externí identifikátor objektu</strong> odpovídá hodnotě atributu <strong>Externí identifikátor FLW</strong> získaného <a href="../../../datove-modely/datovy-78681044.html">Objektu</a> (viz krok <strong>2</strong> základního toku událostí).</li><li>Hodnota atributu <strong>Datum a čas</strong> je větší nebo rovna hodnotě proměnné <strong>TFROM</strong>.</li><li>Hodnota atributu <strong>Datum a čas</strong> je menší nebo rovna hodnotě proměnné <strong>TTO</strong>.<br></li><li>Hodnota atributu <strong>Je zapnutý motor</strong> je nastavena na <strong>TRUE</strong>.</li><li>TODO: Doplnit dle implementace<br></li><li>Hodnota atributu <strong>Externí identifikátor jízdy</strong> je k dispozici (různá od NULL).</li></ul></li></ul><h3>Tok událostí</h3><ol><li>Alternativní tok událostí začíná krokem <strong>2</strong> základního toku událostí.</li><li>Systém získá odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a> – hledá takový záznam, který splňuje všechny dále uvedené podmínky zároveň:<br><ul><li>Hodnota atributu <strong>Denní výkon</strong> odpovídá na vstupu získanému <a href="../../../datove-modely/datovy-78681044.html">Dennímu výkonu</a> (vstupní parametr <strong>Denní výkon</strong>).</li><li>Hodnota atributu <strong>Je aktivní</strong> je nastavena na <strong>TRUE</strong> (atribut implementován, ale nevyužíván).</li></ul></li><li>Systém provede aktualizaci získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> – spustí <a href="#" data-page-title="502UC05: Upravit realizaci denního výkonu">502UC05: Upravit realizaci denního výkonu</a>, na vstup jsou předány následující informace:<br><ul><li><strong>Editovaná realizace denního výkonu:</strong> odpovídající <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>2</strong>).<br></li><li><strong>Změny v realizaci denního výkonu</strong>: předány dále uvedené hodnoty nesystémových atributů entity <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a>…<br><ul><li><strong>Denní výkon</strong>: hodnota atributu <strong>Denní výkon</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>2</strong>).</li><li><strong>Datum a čas začátku</strong>: není předána žádná hodnota (nastaveno NULL).</li><li><strong>Datum a čas konce</strong>: není předána žádná hodnota (nastaveno NULL).</li><li><strong>Časové využití</strong>: předána hodnota <strong>0</strong> (výchozí stav).</li><li><strong>Ujetá vzdálenost celkem</strong>: předána hodnota <strong>0</strong> (výchozí stav).</li><li><strong>Ujetá vzdálenost s přívěsem</strong>: předána hodnota <strong>0</strong> (výchozí stav).</li><li><strong>Doba jízdy celkem</strong>: předána hodnota <strong>0</strong> (výchozí stav).</li><li><strong>Kompletní</strong>: předána hodnota <strong>FALSE</strong>. TODO: odpovídá implementaci?</li><li><strong>Trajektorie</strong>: není předána žádná hodnota (nastaveno NULL).</li><li><strong>Ukončena</strong>: předána hodnota <strong>TRUE</strong>.</li><li><strong>Datum a čas potvrzení realizace</strong>: hodnota atributu <strong>Datum a čas potvrzení realizace</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>2</strong>).</li><li><strong>Potvrdil realizaci</strong>: hodnota atributu <strong>Potvrdil realizaci</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>2</strong>).</li><li><strong>Poznámka</strong>: hodnota atributu <strong>Poznámka</strong> získané <a href="../../../datove-modely/datovy-78681044.html">Realizace denního výkonu</a> (viz krok <strong>2</strong>).<br></li></ul></li></ul></li><li>Systém provede nastavení odpovídajících <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> (viz <a href="300uc14-116785653.html">ALG01: Provést nastavení objednaných služeb</a>).<br><ul><li><em>V rámci atributu Realizována bude nastavena hodnota FLASE (realizace lokací není v tomto případě vyhodnocována).</em></li></ul></li><li>Systém aktualizuje na vstupu získaný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> (vstupní parametr <strong>Denní výkon</strong>) – provede nastavení dále uvedených atributů:<br><ul><li><strong>Stav</strong>: nastavena hodnota <strong>Ke kontrole</strong> (viz <a href="../../../datove-modely/datovy-78681044.html">Stav denního výkonu</a>).</li></ul></li><li>Případ užití končí (systém se již nevrací k základnímu toku událostí, pro denní výkon byly provedeny potřebné akce).</li></ol><h3>Výstupní podmínky</h3><h1>Výjimkové toky událostí</h1><p>–</p><h1>Ukončení případu užití</h1><h2>Výstupní podmínky</h2><p>Došlo k aktualizaci informací o realizaci u na vstupu získaného <a href="../../../datove-modely/datovy-78681044.html">Denního výkonu</a> (pokud byla tato realizace zahájena):</p><ul><li>trajektorie vozidla včetně souvisejících informací o ujeté vzdálenosti a době jízdy,</li><li>informace o realizaci dílčích lokací (dle nastaveného způsobu vyhodnocení realizace),</li><li>ukončení realizace denního výkonu (změna stavu denního výkonu).</li></ul><h2>Výstupní data</h2><table><tbody><tr><th>Výstupní parametr</div></th><th>Datový typ</div></th><th colspan="1">Povinnost</div></th><th>Popis</div></th><th colspan="1">Poznámka</div></th></tr><tr><td colspan="1">Chybové hlášení</td><td colspan="1">–</td><td colspan="1">Ne</td><td colspan="1">V podstatě se jedná o kód chyby, kvůli které nemohl být dokončen UC.</td><td colspan="1"><p>Informace je předána pouze v případě, kdy nebyly splněny výstupní podmínky tohoto UC.</p></td></tr></tbody></table><h1>Algoritmy</h1><h2>ALG01: Provést nastavení objednaných služeb</h2><p>Pro každou Objednanou službu zařazenou do Denního výkonu, který odpovídá zpracovávané Realizaci denního výkonu, bude provedeno následující nastavení atributů:</p><p><em>Interní poznámka: Chování vychází z původního případu užití pro vyhodnocení realizace denního výkonu (viz <a href="#" data-page-title="300UC11: Ukončit vyhodnocování realizace denního výkonu"></a>).</em></p><table><tbody><tr><th>Atribut</div></th><th>Hodnota</div></th><th>Poznámka</div></th></tr><tr><td colspan="1">Stav</td><td colspan="1">Ke kontrole</td><td colspan="1">–</td></tr><tr><td>Realizace denního výkonu</td><td>reference na vyhodnocovanou <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a></td><td>–</td></tr><tr><td>Realizována</td><td><p><strong>TRUE</strong>: Pokud ke všem <a href="../../../datove-modely/datovy-78681044.html">Lokacím objednané služby</a> (které mají vazbu na danou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> a <a href="../../../datove-modely/datovy-78681044.html">Realizaci denního výkonu</a>) existuje odpovídající <a href="../../../datove-modely/datovy-78681044.html">Obsluha lokace objednané služby</a>, která v rámci atributu <strong>Je realizována</strong> nabývá hodnoty <strong>TRUE</strong>.</p><p><strong>FALSE</strong>: V ostatních případech.</p></td><td>Tj. služba je považována za realizovanou, pokud byla pozitivně vyhodnocená obsluha všech jejích lokací.</td></tr><tr><td>Pořadí v kontrole realizace</td><td><p>Pořadí, které má Objednaná služba v příslušném Denním výkonu.</p><p>Viz poznámka </p></td><td><p>Uvažovat pouze pořadí v rámci Položek denního výkonu typu Objednaná služba.</p><p>Nezohledňovat výskyt ostatních typů položek.</p></td></tr></tbody></table><h1>Validace</h1><p>–</p><h1>Uživatelské rozhraní</h1><p>–</p><h1>Grafický návrh</h1><p>–</p><h1>Revize</h1><h3>30. 7. 2024: Tomáš Nadrchal </h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="300uc14-116785653.html">Základní tok událostí</a></td><td colspan="1">Revize způsobu zpracování pozičních záznamů (naznačeno růžově).</td></tr><tr><td colspan="1"><a href="300uc14-116785653.html">AF01: Zpracování denního výkonu bez informací o realizaci</a></td><td colspan="1">Revize způsobu zpracování pozičních záznamů (naznačeno růžově).</td></tr></tbody></table><h3>2. 12. 2023: Tomáš Nadrchal </h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="300uc14-116785653.html">Stručný popis, cíl</a></td><td colspan="1">Doplnění stručného popisu k postupnému zpracování denních výkonů (naznačeno modře).</td></tr><tr><td colspan="1"><a href="http://Základní tok událostí">Základní tok událostí</a></td><td colspan="1">Doplněno chování pro postupné zpracování denních výkonů (naznačeno modře).</td></tr></tbody></table>
</div>
</body>
</html>
