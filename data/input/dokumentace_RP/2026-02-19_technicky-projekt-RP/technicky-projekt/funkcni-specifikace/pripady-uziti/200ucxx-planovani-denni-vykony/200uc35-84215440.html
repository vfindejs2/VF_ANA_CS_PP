<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>200UC35: Sloučit rozdělenou objednanou službu</title>
</head>
<body>
<div class="wiki-content">
<p><strong>Nahrazeno, viz <a href="#" data-page-title="200UC55: Sloučit objednanou službu"></a>!</strong></p><p></p><h1>Stručný popis, cíl UC</h1><p>Cílem UC je sloučení rozdělené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a>.</p><p>Poznámka: Sloučit rozdělenou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> je možné pouze v případě, že je druhá <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> naplánována buď na stejný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, nebo není naplánována na žádný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>.</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th>Popis</th><th colspan="1">Typická role</th></tr><tr><td>Uživatel</td><td><p>Jedná se o uživatele aplikace RoadPlan, který musí mít oprávnění spouštět tento UC.</p></td><td colspan="1"><p> </p></td></tr></tbody></table><h1>Spuštění případu užití</h1><p>Uživatel zadá požadavek na sloučení rozdělené Položky denního výkonu jedním z těchto způsobů:</p><ul><li>Sloučení rozdělené Objednané služby v tabulce s Položkami denního výkonu ve formuláři Denního výkonu (<a href="../../uzivatelske-rozhrani/200uixx/200ui02/200ui02-84214534.html">200UI02: Tabulka pro editaci denního výkonu</a>).</li><li>Sloučení rozdělené Objednané služby v tabulce s Objednanými službami na obrazovce pro plánování Denních výkonů z kontextové nabídky (<a href="../../uzivatelske-rozhrani/200uixx/200ui01/200ui01-83266005.html">200UI01: Přehled objednaných služeb</a>).</li></ul><h1>Vstupní podmínky</h1><p>Aby bylo možné sloučit rozdělenou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>, musí být splněna celá řada podmínek. První skupina neumožní UC vůbec spustit, ošetření pak probíhá přímo na úrovni UI (není dostupné odpovídající tlačítko):</p><ul><li><a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> představuje přímo navazující <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>: atribut Určení objednané služby nabývá hodnoty Rozdělení.</li><li><a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> obsahuje odkaz na navazující <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>: hodnota atribut Navazující objednaná služba není NULL.</li></ul><p>Druhá skupina těchto podmínek pak vyžaduje zobrazení chybové hlášky uživateli. Tyto podmínky nezamezují ve spuštění UC a jsou ošetřeny v rámci jeho toků událostí (musí tedy být splněny podmínky obsažené v první skupině):</p><ul><li>Obě <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (výchozí i navazující) musí být naplánovány na stejný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, a to ten, ze kterého byl volán tento UC. Tento <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> musí být v jednom u zvedených stavů: Plánovaný, Schválený, Plněný.</li><li>Jedna z <a href="../../../datove-modely/datovy-78681044.html">Objednaných služeb</a> musí být naplánována na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, ze kterého byl volán tento UC, a druhá nesmí být naplánována na žádný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>. První <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> musí být v jednom u zvedených stavů: Plánovaný, Schválený, Plněný.</li><li>Obě <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (výchozí i navazující) nesmí být naplánovány na žádný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>.</li></ul><p>Uživatel má následující <a href="../../../uzivatelska-78681297.html">oprávnění na moduly a UC</a>:</p><ul><li>Plánování denních výkonů.</li></ul><p>Uživatel má následující <a href="../../../uzivatelska-78681297.html">oprávnění na typ entit</a>:</p><ul><li>Denní výkony - zobrazení a modifikace,</li><li>Objednané služby - zobrazení a modifikace.</li></ul><h3>Vstupní data</h3><ul><li>Entita <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</li></ul><h1>Základní tok událostí</h1><ol><li>Systém vyhodnotí, zda je možné odebrat <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> – viz <a href="200uc35-84215440.html">Vyhodnocení možnosti odebrat objednanou službu</a>.</li><li>Systém zobrazí modální okno s dotazem pro potvrzení požadavku na sloučení rozdělené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (MSG_CONF_CANCEL_MERGE_SERVICES, viz <a href="../../../systemove-78681299.html">Systémové hlášky</a>).</li><li>Uživatel potvrdí požadavek na sloučení – stiskne tlačítko Ano.</li><li>Systém odebere navazující <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> a provede potřebná opatření v <a href="../../../datove-modely/datovy-78681044.html">Denním výkonu</a> – viz <a href="200uc35-84215440.html">Odebrání navazující objednané služby</a>.</li></ol><h1>Alternativní toky událostí</h1><p>Nejsou.</p><h1>Výjimkové toky událostí</h1><h3>EF01: Storno</h3><h4>Tok událostí</h4><ol><li>Výjimkový tok událostí začíná krokem 3 základního toku událostí.</li><li>KDYŽ uživatel stiskne tlačítko Ne.<br><ol><li>Systém zavře modální okno. <strong>Konec toku událostí</strong>.</li></ol></li><li>KDYŽ uživatel stiskne tlačítko křížku pro zavření modálního okna.<br><ol><li>Systém zavře modální okno. <strong>Konec toku událostí</strong>.</li></ol></li></ol><h4>Výstupní podmínky</h4><ul><li>Nebyla sloučena rozdělená <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</li></ul><h3>EF02: Není možné sloučit rozdělené položky</h3><h4>Vstupní podmínky</h4><ul><li>Není možné sloučit rozdělenou <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</li></ul><h4>Tok událostí</h4><ol><li>Výjimkový tok událostí začíná krokem 1 základního toku událostí.</li><li>Systém zobrazí modální okno s informací, že není možné sloučit rozdělené <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> (MSG_INFO_SERVICES_MERGE_NOT_POSSIBLE, viz <a href="../../../systemove-78681299.html">Systémové hlášky</a>).</li><li>Uživatel stisknutím tlačítka potvrdí zobrazené hlášení.</li><li>Systém zavře modální okno se zobrazenou informací. <strong>Konec toku událost</strong>.</li></ol><h4>Výstupní podmínky</h4><ul><li>Nebyla sloučena rozdělená <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</li></ul><h1>Výstupní podmínky</h1><ul><li>Byla sloučena rozdělená <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>.</li></ul><h1>Validace</h1><p>Nejsou.</p><h1>Algoritmy</h1><h3>Vyhodnocení možnosti odebrat objednanou službu</h3><p>Jako první je nutné ověřit, zda není <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, pro kterou je volán UC, naplánována na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, který již neumožňuje provádění dalších změn:</p><ul><li>Hodnota atributu Položka denního výkonu je různá od NULL (entita <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>).</li><li>Hodnota atributu Stav nabývá jedné z uvedených hodnot: Plánovaný, Schválený, Plněný (entita <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> – atribut Denní výkon entity <a href="../../../datove-modely/datovy-78681044.html">Položka denního výkonu</a> – atribut Položka denního výkonu entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>).</li></ul><p>Pokud jsou splněny obě podmínky zároveň:</p><ul><li><strong>Pokračuje se výjimkovým tokem událostí <a href="200uc35-84215440.html">EF02: Není možné sloučit rozdělené položky</a></strong>.</li></ul><p>Aby bylo možné sloučit rozdělenou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>, je nutné ověřit, že druhá <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> není naplánována na jiný <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>.</p><p>Systém tedy nejdříve získá druhou <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>, a to následovně:</p><ul><li>Pokud se jedná o navazující <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> – atribut Určení objednané služby nabývá hodnoty Rozdělení:<br><ul><li>Atribut Výchozí objednaná služba entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> získané na vstupu UC.</li></ul></li><li>Jinak:<br><ul><li>Atribut Navazující objednaná služba entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> získané na vstupu UC.</li></ul></li></ul><p>Pokud je hodnota atributu Položka denního výkonu entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> získané v předchozím kroku rovna NULL:</p><ul><li><strong>Pokračuje se v základním toku událostí</strong>.</li></ul><p>Pokud je hodnota atributu Položka denního výkonu entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> získané v předchozím kroku různá od NULL a zároveň je tato <a href="../../../datove-modely/datovy-78681044.html">Položku denního výkonu</a> obsažena ve stejném <a href="../../../datove-modely/datovy-78681044.html">Denním výkonu</a> jako <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> předaná na vstupu UC:</p><ul><li><strong>Pokračuje se v základním toku událostí</strong>.</li></ul><p>Pokud je hodnota atributu Položka denního výkonu entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> získané v předchozím kroku různá od NULL a zároveň je tato <a href="../../../datove-modely/datovy-78681044.html">Položku denního výkonu</a> obsažena v jiném <a href="../../../datove-modely/datovy-78681044.html">Denním výkonu</a> než <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> předaná na vstupu UC:</p><ul><li><strong>Pokračuje se výjimkovým tokem událostí <a href="200uc35-84215440.html">EF02: Není možné sloučit rozdělené položky</a></strong>.</li></ul><h3>Odebrání navazující objednané služby</h3><p>Nejprve je nutné určit výchozí a navazující <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>, ty jsou získány následovně:</p><ul><li>Pokud na vstupu UC byla předána navazující <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> – atribut Určení objednané služby nabývá hodnoty Rozdělení:<ul><li>Výchozí <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> = <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> získaná z atributu Výchozí objednaná služba entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která byla předána na vstupu.</li><li>Navazující <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> = <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která byla předána na vstupu.<br></li></ul></li><li>Jinak:<ul><li>Výchozí <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> = <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která byla předána na vstupu.</li><li>Navazující <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> = <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> získaná z atributu Navazující objednaná služba entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která byla předána na vstupu.<br></li></ul></li></ul><p>Nyní aktualizujeme výchozí <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a> – dojde ke změně u následujících atributů:</p><ul><li>Navazující objednaná služba: NULL.</li><li>Lokace objednané služby – pro všechny <a href="../../../datove-modely/datovy-78681044.html">Lokace objednané služby</a> jsou nastaveny hodnoty následujících atributů:<br><ul><li>Platná: TRUE.</li><li>Splněno časové okno, Vzdálenost do další lokace, Doba jízdy do další lokace, Trasa do další lokace: jsou aktualizovány později v rámci tohoto algoritmu.</li></ul></li></ul><p>Poznámka: U atributů, které nejsou uvedeny, zůstává hodnota nezměněna.</p><p>Pokud je navazující <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> naplánována na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, je odpovídající <a href="../../../datove-modely/datovy-78681044.html">Položka denního výkonu</a> odebrána – spustí <a href="#" data-page-title="200UC26: Odebrat položky z denního výkonu"></a> (poznámka: dojde k aktualizaci trasy denního výkonu), na vstup UC jsou předány následující hodnoty:</p><ul><li>Položka denního výkonu: atribut Položka denního výkonu entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která byla vyhodnocena jako navazující.</li></ul><p>Pokud je výchozí <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> naplánována na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a> a zároveň navazující <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> není naplánována na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, dojde k aktualizaci trasy denního výkonu – spustí <a href="#" data-page-title="200UC29: Získat trasu denního výkonu">200UC29: Získat trasu denního výkonu</a> (poznámka: v tomto případě nebyla trasa aktualizována v rámci předchozího kroku), na vstup UC jsou předány následující hodnoty:</p><ul><li>Denní výkon: atribut Denní výkon entity <a href="../../../datove-modely/datovy-78681044.html">Položka denního výkonu</a> – atribut Položka denního výkonu entity <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která byla vyhodnocena jako výchozí.</li></ul><p>Pokud není výchozí <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a> naplánována na <a href="../../../datove-modely/datovy-78681044.html">Denní výkon</a>, je přepočítána trasa této <a href="../../../datove-modely/datovy-78681044.html">Objednané služby</a> – viz <a href="../101ucxx-objednane-sluzby/101uc01-82116734.html">Získání trasy</a>.</p><p>Nakonec je smazána <a href="../../../datove-modely/datovy-78681044.html">Objednaná služba</a>, která byla identifikována jako navazující.</p><h1>Uživatelské rozhraní</h1><p>Rozložení dialogového okna je uvedeno v samostatném dokumentu – viz <a href="../../uzivatelske-rozhrani/700uixx-obecne/700ui06-79430049.html">700UI06: Systémové hlášky</a>.</p><h1>Revize</h1><h3>23. 3. 2020: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></th><th>Stručný popis změny/doplnění</div></th></tr><tr><td colspan="1"><a href="200uc35-84215440.html">Vyhodnocení možnosti odebrat objednanou službu</a></td><td colspan="1">Doplněna podmínka pro vyhodnocení stavu odpovídajícího denního výkonu tak, aby vyhodnocení korespondovalo s odebíráním MDU (naznačeno modře).</td></tr><tr><td colspan="1"><a href="200uc35-84215440.html">Vstupní podmínky</a></td><td colspan="1">Aktualizovány vstupní podmínky tak, aby korespondovaly s odebíráním MDU (naznačeno modře).</td></tr></tbody></table><h3>8. 4. 2019: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></th><th>Stručný popis změny/doplnění</div></th></tr><tr><td colspan="1"><a href="200uc18-83266949.html">Vstupní podmínky</a></td><td colspan="1"><p>Aktualizace práva na <a href="../../../uzivatelska-78681297.html">oprávnění na typ entit</a> ze Zobrazení na Zobrazení a modifikace – Objednané služby - zobrazení a modifikace.</p><p>Změna typu entity vstupní hodnoty UC z <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> na <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>.</p></td></tr><tr><td colspan="1"><a href="200uc35-84215440.html">Základní tok událostí</a></td><td colspan="1">Změna typu entity v rámci toku událostí z <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> na <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>.</td></tr><tr><td colspan="1"><a href="200uc35-84215440.html">Výjimkové toky událostí</a></td><td colspan="1">Změna typu entity výstupní podmínky u obsažených výjimkových toků z <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> na <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>.</td></tr><tr><td colspan="1"><a href="200uc35-84215440.html">Výstupní podmínky</a></td><td colspan="1">Změna typu entity výstupní podmínky z <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> na <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>.</td></tr><tr><td colspan="1"><a href="200uc35-84215440.html">Algoritmy</a></td><td colspan="1">Změna typu entity v obsažených v rámci algoritmů z <a href="../../../datove-modely/datovy-78681044.html">Položky denního výkonu</a> na <a href="../../../datove-modely/datovy-78681044.html">Objednanou službu</a>. Odpovídající změny v těch algoritmech.</td></tr></tbody></table><p><br></p>
</div>
</body>
</html>
