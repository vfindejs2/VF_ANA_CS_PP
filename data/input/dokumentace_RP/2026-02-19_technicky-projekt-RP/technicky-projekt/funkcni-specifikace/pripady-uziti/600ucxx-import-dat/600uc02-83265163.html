<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>600UC02: Předání dat z WinyX do Fleetware</title>
</head>
<body>
<div class="wiki-content">
<p></p><h1>Stručný popis, cíl UC</h1><p>UC zpracovává data, která jsou z externího systému (WinyX) zapsána na databázové rozhraní. Jedná se o data Vozidlech, Zaměstnancích a o související číselníkové hodnoty.</p><p>Na základě těchto dat systém RoadPlan provádí synchronizaci záznamů o příslušných entitách mezi WinyX a Fleetware - tj. vytváří nové záznamy, upravuje údaje stávajících záznamů, nebo záznamy označuje za smazané.</p><p>Konkrétní struktura dat k importu je uvedená v <a href="../../../high-level-concept/integrace-78680671.html">Definici rozhraní</a> (na listu WinyX → FleetwareWeb).</p><h1>Seznam aktérů</h1><table><tbody><tr><th>Aktér</th><th>Popis</th><th colspan="1">Typická role</th></tr><tr><td>Čas</td><td><p>Komponenta systému, která spouští dávkové úlohy ve stanoveném čase.</p></td><td colspan="1"><p> </p></td></tr><tr><td colspan="1">Fleetware</td><td colspan="1">Externí aplikace FleetwareWeb2, která komunikuje s aplikací RoadPlan na systémové úrovni.</td><td colspan="1"> </td></tr></tbody></table><h1>Spuštění případu užití</h1><p>UC je spouštěn podle definovaného časového harmonogramu (viz <a href="../../../konfiguracni-81592468.html">Konfigurační hodnoty</a>) automaticky.</p><h1>Vstupní podmínky</h1><p>Je dostupné (databázové) rozhraní pro synchronizaci údajů (<a href="600uc02-83265163.html">EF02: Nedostupné DB rozhraní</a>).</p><p>Je dostupné rozhraní (webová služba) pro předání údajů do Fleetware (<a href="600uc02-83265163.html">EF03: Nedostupné FleetwareWebAPI</a>).</p><h1>Základní tok událostí</h1><p>Systém načte aktuální hodnotu parametru MostRecentLastModified. Do toho parametru systém uložil po skončení posledního úspěšného importu datum a čas z nejnovějšího záznamu (tj. takového záznamu ze zdrojových dat, který má nejnovější datum a čas změny).</p><ol><li>Systém vyhledá jednotlivé zdrojové záznamy, jejichž datum změny je novější než hodnota MostRecentLastModified. Pokud má parametr hodnotu NULL, pak systém vezme všechny zdrojové záznamy.</li><li>Pro každý záznam systém zkontroluje, že je validní - viz <a href="600uc02-83265163.html">Validace vstupních dat</a> (<a href="600uc02-83265163.html">EF01: Nevalidní vstupní data</a>).<br><ul><li>Viz <a href="../../../high-level-concept/integrace-78680671.html">Definice rozhraní</a> (list WinyX → FleetwareWeb) a <a href="../../../datove-modely/datovy-78681044.html">Datový slovník</a>.</li></ul></li><li>Pro každý záznam systém vyhodnotí typ operace, která má být s odpovídající instancí dané entity v systému FleetwareWeb provedena (viz Poznámka 1). Poté systém danou operaci vykoná (zavolá příslušný endpoint FleetwareWebAPI) a zaloguje do transakčního logu.<br><ol><li>Buď založení nového záznamu,</li><li>nebo úpravu stávajícího záznamu,</li><li>nebo smazání záznamu (resp. označení záznamu jako smazaného). </li></ol></li><li>Po úspěšném dokončení importu všech záznamů systém aktualizuje hodnotu parametru MostRecentLastModified = nejnovější datum a čas změny, který se vyskytl mezi záznamy úspěšně importovanými v této iteraci. </li></ol><p><em>Poznámka 1: </em></p><ul><li><em>Systém RoadPlan neukládá získaná data do své databáze.</em></li><li><em>Ke zjištění toho, zda daná instance entity v systému RoadPlan již existuje (a tedy jaká operace má být provedena), využije systém RoadPlan volání FleetwareWebAPI (GET metoda nad příslušným endpointem + filtr na externalId).</em></li></ul><h1>Alternativní toky událostí</h1><p>Nejsou.</p><h1>Výjimkové toky událostí</h1><h3>EF01: Nevalidní vstupní data</h3><ol><li>Systém zaloguje informaci o chybě do business logu.</li><li>Systém ukončí další zpracování tohoto záznamu a pokračuje zpracováním dalšího záznamu.</li></ol><h3>EF02: Nedostupné databázové rozhraní</h3><ol><li>Systém zaloguje informaci o nedostupnosti rozhraní do business logu.</li></ol><h3>EF03: Nedostupné FleetwareWebAPI</h3><ol><li>Systém zaloguje informaci o nedostupnosti rozhraní do business logu.</li></ol><h1>Výstupní podmínky</h1><h1>Validace</h1><h3>Validace vstupních dat</h3><ul><li>Všechny povinné položky jsou vyplněny.</li><li>Není porušena referenční integrita (chybějící nebo nevalidní záznamy, na které odkazují cizí klíče).</li><li>Vyplněné položky jsou správného datového typu, v povoleném rozsahu.</li><li>Datum vytvoření / modifikace záznamu nesmí ležet v budoucnosti.</li></ul><h1>Algoritmy</h1><h3>Mapování mezi entitou DB rozhraní a endpointy FleetwareWebAPI</h3><table><tbody><tr><th>Entita DB rozhraní</th><th>FleetwareWebAPI endpointy</th></tr><tr><td>Vehicle</td><td><p>/FleetwareWebAPI/objectsExtended - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Objekty">popis API</a>  (obecné parametry)</p><p>PUT FleetwareWebAPI/objects/{objectId}/fuelTank - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Uloženíparametrůnádržívozidla">popis API</a> (editace paliva, nádrže, spotřeby)</p></td></tr><tr><td>VehicleManufacturer</td><td><pre>/FleetwareWebAPI/VehicleManufacturers - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Značkyvozidel">popis API</a> </pre></td></tr><tr><td>VehicleType</td><td><pre>/FleetwareWebAPI/vehicleTypes - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Druhyvozidel">popis API</a> </pre></td></tr><tr><td colspan="1">VehicleCategory</td><td colspan="1"><pre>FleetwareWebAPI/vehicleCategories - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Kategorievozidel">popis API</a> </pre></td></tr><tr><td colspan="1">VehicleModel</td><td colspan="1"><pre>FleetwareWebAPI/vehicleManufacturerModels</pre><pre> - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Modelyvozidel">popis API</a> </pre></td></tr><tr><td colspan="1">Employee</td><td colspan="1"><pre>/FleetwareWebAPI/employees - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Zaměstnanci">popis API</a> </pre></td></tr><tr><td colspan="1">JobTitle</td><td colspan="1"><pre>API má pouze GET metodu; jedná se o statický číselník, jeho naplnění zajistíme ručně</pre><pre>/FleetwareWebAPI/employeejobs - <a href="https://confluence.radium.cz/pages/viewpage.action?pageId=53903422#FleetwareWebAPI-TechnickádokumentaceRESTAPIv1-Seznampracovníchpoziczaměstnanců">popis API</a> </pre></td></tr></tbody></table><h3>Mapování mezi atributy Vehicle a FleetwareWebAPI</h3><table><tbody><tr><th>Vehicle</th><th colspan="1">API endpoint</th><th>objectsExtended</th><th>poznámky</th></tr><tr><td>Name</td><td colspan="1"><pre>/objectsExtended</pre></td><td>"name"</td><td> </td></tr><tr><td>RegistrationNumber</td><td colspan="1"><pre>/objectsExtended</pre></td><td>"identification"</td><td>atribut "registrationPlate" je obsolete</td></tr><tr><td>OrganizationalUnitId</td><td colspan="1"><pre> </pre></td><td>--</td><td> </td></tr><tr><td colspan="1">--</td><td colspan="1"><pre>/objectsExtended</pre></td><td colspan="1">"groupId"</td><td colspan="1"><p>pro nově zakládané objekty nastavit skupinu "Všechny objekty"</p><p>(viz volání GET /objectGroups; "id": 1, "name": "Všechny objekty", "parentId": 0)</p><p>v rámci update existujících objektů groupId neměnit</p></td></tr><tr><td colspan="1">IdentificationNumber</td><td colspan="1"><pre>/objectsExtended</pre></td><td colspan="1">"evidenceNumber"</td><td colspan="1">Interní číslo. Mj. slouží k rozlišení <a href="600uc02-83265163.html">typu vozidla</a> / <a href="600uc02-83265163.html">typu přívěsu</a>.</td></tr><tr><td colspan="1">VIN</td><td colspan="1"><pre>/objectsExtended</pre></td><td colspan="1">"vin"</td><td colspan="1"> </td></tr><tr><td colspan="1">RegistrationPapersNumber</td><td colspan="1"><pre>/objectsExtended</pre></td><td colspan="1">--</td><td colspan="1">číslo tech. průkazu není na API podporováno</td></tr><tr><td colspan="1">YearOfManufacture</td><td colspan="1"><pre>/objectsExtended</pre></td><td colspan="1">--</td><td colspan="1">rok výroby není na API podporován</td></tr><tr><td colspan="1">VehicleModelId</td><td colspan="1"><pre>/objectsExtended</pre></td><td colspan="1">--</td><td colspan="1">model vozidla nelze zadat pomocí API; aktuálně WinyX nedokáže číselník naplnit</td></tr><tr><td colspan="1">Vehicle ManufacturerId</td><td colspan="1"><pre>/objectsExtended</pre></td><td colspan="1">--</td><td colspan="1">výrobce vozidla nelze zadat pomocí API; aktuálně WinyX nedokáže číselník naplnit</td></tr><tr><td colspan="1">FuelType</td><td colspan="1">/objects/{objectId}/fuelTank</td><td colspan="1"><div class="line number3 index2 alt2"><code>"primaryTank"</code><code>: {</code></div><div class="line number4 index3 alt1"><code>    </code><code>"fuelCategoryId"</code></div><div class="line number7 index6 alt2"><code>  </code><code>}</code></div></td><td colspan="1"><p>hodnoty id kategorie paliva vrací volání GET /fuelCategoryTypes</p><p>ve FLWW jsou read-only</p></td></tr><tr><td colspan="1">FuelTankCapacity</td><td colspan="1">/objects/{objectId}/fuelTank</td><td colspan="1"><div class="line number3 index2 alt2"><code>"primaryTank"</code><code>: {</code></div><div class="line number5 index4 alt2"><code>    </code><code>"capacity"</code></div><div class="line number7 index6 alt2"><code>  </code><code>}</code></div></td><td colspan="1"> </td></tr><tr><td colspan="1">FuelConsumption</td><td colspan="1">/objects/{objectId}/fuelTank</td><td colspan="1"><code>"primaryTank"</code><code>: {</code><div class="line number6 index5 alt1"><code>    </code><code>"consumption"</code></div><div class="line number7 index6 alt2"><code>  </code><code>}</code></div></td><td colspan="1"> </td></tr></tbody></table><h3>Převodní můstek interní číslo MPG - typ vozidla</h3><table><tbody><tr><th>Typ dopravy</th><th>Interní číslo (Purpose)</th><th>Poznámka</th></tr><tr><td colspan="1">Hákový nakladač</td><td colspan="1">Začíná jednou z uvedených hodnot: 07, 21, 27, 47.</td><td colspan="1">–</td></tr><tr><td colspan="1">Ramenový nakladač</td><td colspan="1">Začíná jednou z uvedených hodnot: 06, 25.</td><td colspan="1">–</td></tr><tr><td colspan="1">Valník</td><td colspan="1">Začíná jednou z uvedených hodnot: 10.</td><td colspan="1">–</td></tr><tr><td colspan="1">Lisovací vozidlo</td><td colspan="1"><p>Začíná jednou z uvedených hodnot: 32, 33.</p></td><td colspan="1">–</td></tr><tr><td colspan="1">Komunální vozidlo – pilot</td><td colspan="1">Začíná jednou z uvedených hodnot: 02, 05, 20, 24, 35.</td><td colspan="1">Doplněn nový prefix: <strong>24</strong>.</td></tr><tr><td colspan="1">Cisterna</td><td colspan="1">–</td><td colspan="1">V rámci původní synchronizační komponenty není řešen.</td></tr></tbody></table><h3>Převodní můstek interní číslo MPG - typ přívěsu</h3><table><tbody><tr><th>Typ dopravy</th><th>Interní číslo (Purpose)</th><th>Poznámka</th></tr><tr><td>Hákový nakladač</td><td>Začíná jednou z uvedených hodnot: 09.</td><td>–</td></tr><tr><td>Ramenový nakladač</td><td>Začíná jednou z uvedených hodnot: 08.</td><td>–</td></tr><tr><td>Hákový nakladač / Ramenový nakladač</td><td>Začíná jednou z uvedených hodnot: 19.</td><td>–</td></tr><tr><td>Hákový nakladač / Valník</td><td>Začíná jednou z uvedených hodnot: 48.</td><td>MPG 9.7.2019 avizovalo, že zvažují zavedení separátního příznaku ve WinyX, který by pro nás reprezentovat typ vozidla. Zejména u valníků se na prefix nedá vždy spolehnout (část vozidel jsou tzv. malé háky).</td></tr></tbody></table><h1>Uživatelské rozhraní</h1><div class="wiki-content"><p>UC není vizuální.</p><h1>Revize</h1><h3>17. 7. 2025: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ vozidla</a></td><td colspan="1"><p>Doplněn nový prefix pro Komunální vozidlo – pilot (naznačeno modře).</p><p> <strong>Vyžaduje buď spuštění synchronizace nebo migraci dat – cílem je aktualizace vazby daných vozidel na odpovídající typ dopravy.</strong></p></td></tr></tbody></table><h3>12. 2. 2024: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></div></div></div></div></div></th><th>Stručný popis změny/doplnění</div></div></div></div></div></div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ vozidla</a></td><td colspan="1">Doplněn nový prefix pro Komunální vozidlo – pilot (naznačeno modře).</td></tr></tbody></table><h3>20. 4. 2023: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ vozidla</a></td><td colspan="1"><p>Upravena specifikace pro nový typu dopravy (naznačeno modře).</p><p>Poznámka: Vyžaduje přegenerování denních výkonů.</p></td></tr></tbody></table><h3>13. 4. 2023: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ vozidla</a></td><td colspan="1">Upravena specifikace dle nového typu dopravy (naznačeno růžově).</td></tr></tbody></table><h3>1. 3. 2023: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ vozidla</a></td><td colspan="1">Doplněna podpora pro nové typy dopravy (naznačeno modře).</td></tr></tbody></table><h3>22. 11. 2021: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ přívěsu</a></td><td colspan="1">Revize způsobu vyhodnocení přívěsů s prefixem 48 (naznačeno modře).</td></tr></tbody></table><h3>16. 10. 2020: Tomáš Nadrchal</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ vozidla</a></td><td colspan="1">Doplněn výčet hodnot pro vozidla typu dopravy Lisovací vozidlo (naznačeno modře).</td></tr></tbody></table><h3>9. 7. 2019: Miroslav Slivoně</h3><table><tbody><tr><th>Odkaz</div></div></th><th>Stručný popis změny/doplnění</div></div></th></tr><tr><td colspan="1"><a href="600uc02-83265163.html">Převodní můstek interní číslo MPG - typ přívěsu</a></td><td colspan="1">Doplněn prefix pro valník.</td></tr></tbody></table></div>
</div>
</body>
</html>
